{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\setting\\settingVolume.js"],"names":["glGame","baseclass","extend","properties","spBar","cc","SpriteFrame","onLoad","initUI","onClick","name","node","onMusicToggle","onEffectToggle","panel","showPanelByName","showRegister","onMusicProcess","process","musicSlider","getComponent","Slider","progress","getChildByName","ProgressBar","audio","setBGMVolume","musicToggle","isChecked","setToggle","openBGM","setSliderState","onEffectProcess","effectSlider","setSoundEffectVolume","effectToggle","openSE","bInit","user","isTourist","active","userinfo","headImage","showHeadImage","get","Label","string","lab_userVip","volume","Toggle","BGMSE","OnClickToggle","event","buttonName","buttonNode","console","log","playLoadSoundEffectByPath","closeBGM","closeSE","toggle","isOn","iconChouma","state","bar","Sprite","spriteFrame","registerEvent","emitter","on","MESSAGE","UI","ACTION_END","showInfo","unRegisterEvent","off","OnDestroy"],"mappings":";;;;;;AAAA;;;AAIAA,MAAM,CAACC,SAAP,CAAiBC,MAAjB,CAAwB;AACpBC,EAAAA,UAAU,EAAE;AACRC,IAAAA,KAAK,EAAE,CAACC,EAAE,CAACC,WAAJ;AADC,GADQ;AAKpBC,EAAAA,MALoB,oBAKX;AACL,SAAKC,MAAL;AACH,GAPmB;AASpBC,EAAAA,OAToB,mBASZC,IATY,EASNC,IATM,EASA;AAChB,YAAQD,IAAR;AACI,WAAK,aAAL;AACI,aAAKE,aAAL;AACA;;AACJ,WAAK,cAAL;AACI,aAAKC,cAAL;AACA;;AACJ,WAAK,YAAL;AACIb,QAAAA,MAAM,CAACc,KAAP,CAAaC,eAAb,CAA6B,SAA7B;AACA;;AACJ,WAAK,WAAL;AACIf,QAAAA,MAAM,CAACc,KAAP,CAAaE,YAAb;AACA;AAZR;AAcH,GAxBmB;AA0BpBC,EAAAA,cA1BoB,4BA0BF;AACd,QAAIC,OAAO,GAAG,KAAKC,WAAL,CAAiBC,YAAjB,CAA8Bf,EAAE,CAACgB,MAAjC,EAAyCC,QAAvD;AACA,SAAKH,WAAL,CAAiBI,cAAjB,CAAgC,aAAhC,EAA+CH,YAA/C,CAA4Df,EAAE,CAACmB,WAA/D,EAA4EF,QAA5E,GAAuFJ,OAAvF;AACAlB,IAAAA,MAAM,CAACyB,KAAP,CAAaC,YAAb,CAA0BR,OAA1B;;AAEA,QAAG,CAAC,KAAKS,WAAL,CAAiBC,SAArB,EAAgC;AAC5B,WAAKC,SAAL,CAAe,KAAKF,WAApB,EAAiC,IAAjC;AACA3B,MAAAA,MAAM,CAACyB,KAAP,CAAaK,OAAb;AACA,WAAKC,cAAL,CAAoB,KAAKZ,WAAzB,EAAsC,CAAtC;AACH;AACJ,GApCmB;AAsCpBa,EAAAA,eAtCoB,6BAsCF;AACd,QAAId,OAAO,GAAG,KAAKe,YAAL,CAAkBb,YAAlB,CAA+Bf,EAAE,CAACgB,MAAlC,EAA0CC,QAAxD;AACA,SAAKW,YAAL,CAAkBV,cAAlB,CAAiC,aAAjC,EAAgDH,YAAhD,CAA6Df,EAAE,CAACmB,WAAhE,EAA6EF,QAA7E,GAAwFJ,OAAxF;AACAlB,IAAAA,MAAM,CAACyB,KAAP,CAAaS,oBAAb,CAAkChB,OAAlC;;AAEA,QAAG,CAAC,KAAKiB,YAAL,CAAkBP,SAAtB,EAAiC;AAC9B,WAAKC,SAAL,CAAe,KAAKM,YAApB,EAAkC,IAAlC;AACCnC,MAAAA,MAAM,CAACyB,KAAP,CAAaW,MAAb;AACA,WAAKL,cAAL,CAAoB,KAAKE,YAAzB,EAAuC,CAAvC;AACH;AACJ,GAhDmB;AAkDpBzB,EAAAA,MAlDoB,oBAkDX;AAEL,SAAK6B,KAAL,GAAa,KAAb,CAFK,CAIL;;AACA,QAAGrC,MAAM,CAACsC,IAAP,CAAYC,SAAZ,EAAH,EAA4B;AACxB,WAAK5B,IAAL,CAAUY,cAAV,CAAyB,WAAzB,EAAsCiB,MAAtC,GAA+C,IAA/C;AACH,KAFD,MAEO;AACH,WAAK7B,IAAL,CAAUY,cAAV,CAAyB,YAAzB,EAAuCiB,MAAvC,GAAgD,IAAhD;AACH,KATI,CAWL;;;AACA,QAAIC,QAAQ,GAAG,KAAK9B,IAAL,CAAUY,cAAV,CAAyB,UAAzB,CAAf,CAZK,CAcL;;AACA,QAAImB,SAAS,GAAGD,QAAQ,CAAClB,cAAT,CAAwB,UAAxB,CAAhB;AACAvB,IAAAA,MAAM,CAACc,KAAP,CAAa6B,aAAb,CAA2BD,SAA3B,EAAsC1C,MAAM,CAACsC,IAAP,CAAYM,GAAZ,CAAgB,SAAhB,CAAtC,EAhBK,CAkBL;;AACAH,IAAAA,QAAQ,CAAClB,cAAT,CAAwB,SAAxB,EAAmCH,YAAnC,CAAgDf,EAAE,CAACwC,KAAnD,EAA0DC,MAA1D,GAAmE9C,MAAM,CAACsC,IAAP,CAAYM,GAAZ,CAAgB,UAAhB,KAA+B,EAAlG,CAnBK,CAqBL;;AACAH,IAAAA,QAAQ,CAAClB,cAAT,CAAwB,QAAxB,EAAkCA,cAAlC,CAAiD,MAAjD,EAAyDH,YAAzD,CAAsEf,EAAE,CAACwC,KAAzE,EAAgFC,MAAhF,GAAyF9C,MAAM,CAACsC,IAAP,CAAYM,GAAZ,CAAgB,UAAhB,KAA+B,EAAxH,CAtBK,CAwBL;;AACA,QAAIG,WAAW,GAAGN,QAAQ,CAAClB,cAAT,CAAwB,QAAxB,EAAkCA,cAAlC,CAAiD,aAAjD,CAAlB;AACAwB,IAAAA,WAAW,CAAC3B,YAAZ,CAAyBf,EAAE,CAACwC,KAA5B,EAAmCC,MAAnC,GAA4C9C,MAAM,CAACsC,IAAP,CAAYM,GAAZ,CAAgB,UAAhB,CAA5C;;AAEA,QAAG5C,MAAM,CAACsC,IAAP,CAAYC,SAAZ,EAAH,EAA4B;AACxBE,MAAAA,QAAQ,CAAClB,cAAT,CAAwB,QAAxB,EAAkCiB,MAAlC,GAA2C,KAA3C;AACAC,MAAAA,QAAQ,CAAClB,cAAT,CAAwB,QAAxB,EAAkCiB,MAAlC,GAA2C,KAA3C;AACAC,MAAAA,QAAQ,CAAClB,cAAT,CAAwB,SAAxB,EAAmCH,YAAnC,CAAgDf,EAAE,CAACwC,KAAnD,EAA0DC,MAA1D,GAAmE,KAAnE;AACH,KAhCI,CAmCL;;;AACA,QAAIE,MAAM,GAAG,KAAKrC,IAAL,CAAUY,cAAV,CAAyB,QAAzB,CAAb;AAEA,SAAKI,WAAL,GAAmBqB,MAAM,CAACzB,cAAP,CAAsB,aAAtB,EAAqCH,YAArC,CAAkDf,EAAE,CAAC4C,MAArD,CAAnB;AACA,SAAKd,YAAL,GAAoBa,MAAM,CAACzB,cAAP,CAAsB,cAAtB,EAAsCH,YAAtC,CAAmDf,EAAE,CAAC4C,MAAtD,CAApB;AACA,SAAK9B,WAAL,GAAmB6B,MAAM,CAACzB,cAAP,CAAsB,aAAtB,CAAnB;AACA,SAAKU,YAAL,GAAoBe,MAAM,CAACzB,cAAP,CAAsB,cAAtB,CAApB;AAEA,QAAI2B,KAAK,GAAGlD,MAAM,CAACyB,KAAP,CAAamB,GAAb,CAAiB,OAAjB,CAAZ;AACA,SAAKf,SAAL,CAAe,KAAKF,WAApB,EAAiCuB,KAAK,CAAC,cAAD,CAAtC;AACA,SAAKrB,SAAL,CAAe,KAAKM,YAApB,EAAkCe,KAAK,CAAC,sBAAD,CAAvC;;AAEA,QAAGA,KAAK,CAAC,cAAD,CAAR,EAA0B;AACtB,WAAKnB,cAAL,CAAoB,KAAKZ,WAAzB,EAAsC,CAAtC;AACH,KAFD,MAEO;AACH,WAAKY,cAAL,CAAoB,KAAKZ,WAAzB,EAAsC,CAAtC;AACH;;AAED,QAAG+B,KAAK,CAAC,sBAAD,CAAR,EAAkC;AAC9B,WAAKnB,cAAL,CAAoB,KAAKE,YAAzB,EAAuC,CAAvC;AACH,KAFD,MAEO;AACH,WAAKF,cAAL,CAAoB,KAAKE,YAAzB,EAAuC,CAAvC;AACH;;AAED,SAAKd,WAAL,CAAiBC,YAAjB,CAA8Bf,EAAE,CAACgB,MAAjC,EAAyCC,QAAzC,GAAoD4B,KAAK,CAAC,WAAD,CAAzD;AACA,SAAKjB,YAAL,CAAkBb,YAAlB,CAA+Bf,EAAE,CAACgB,MAAlC,EAA0CC,QAA1C,GAAqD4B,KAAK,CAAC,mBAAD,CAA1D;AACA,SAAK/B,WAAL,CAAiBI,cAAjB,CAAgC,aAAhC,EAA+CH,YAA/C,CAA4Df,EAAE,CAACmB,WAA/D,EAA4EF,QAA5E,GAAuF4B,KAAK,CAAC,WAAD,CAA5F;AACA,SAAKjB,YAAL,CAAkBV,cAAlB,CAAiC,aAAjC,EAAgDH,YAAhD,CAA6Df,EAAE,CAACmB,WAAhE,EAA6EF,QAA7E,GAAwF4B,KAAK,CAAC,mBAAD,CAA7F;AAEA,SAAKb,KAAL,GAAa,IAAb;AACH,GAnHmB;AAqHpBc,EAAAA,aArHoB,yBAqHNC,KArHM,EAqHC;AACjB,QAAG,CAAC,KAAKf,KAAT,EAAgB;AACZ;AACH;;AAED,QAAIgB,UAAU,GAAGD,KAAK,CAACzC,IAAN,CAAWD,IAA5B;AACA,QAAI4C,UAAU,GAAGF,KAAK,CAACzC,IAAvB;AACA4C,IAAAA,OAAO,CAACC,GAAR,uCAA4BH,UAA5B;AACArD,IAAAA,MAAM,CAACyB,KAAP,CAAagC,yBAAb,CAAuC,QAAvC;AACA,SAAKhD,OAAL,CAAa4C,UAAb,EAAyBC,UAAzB;AACH,GA/HmB;AAiIpB1C,EAAAA,aAjIoB,2BAiIJ;AACZ,QAAG,CAAC,KAAKyB,KAAT,EAAgB;AACZ;AACH;;AAED,QAAIT,SAAS,GAAG,KAAKD,WAAL,CAAiBC,SAAjC;AACA,SAAKC,SAAL,CAAe,KAAKF,WAApB,EAAiCC,SAAjC;AACA,QAAIA,SAAJ,EAAe5B,MAAM,CAACyB,KAAP,CAAaK,OAAb,GAAf,KACK9B,MAAM,CAACyB,KAAP,CAAaiC,QAAb;;AAEL,QAAG9B,SAAH,EAAc;AACV,WAAKG,cAAL,CAAoB,KAAKZ,WAAzB,EAAsC,CAAtC;AACH,KAFD,MAEO;AACH,WAAKY,cAAL,CAAoB,KAAKZ,WAAzB,EAAsC,CAAtC;AACH;AACJ,GAhJmB;AAkJpBN,EAAAA,cAlJoB,4BAkJH;AACb,QAAG,CAAC,KAAKwB,KAAT,EAAgB;AACZ;AACH;;AAED,QAAIT,SAAS,GAAG,KAAKO,YAAL,CAAkBP,SAAlC;AACA,SAAKC,SAAL,CAAe,KAAKM,YAApB,EAAkCP,SAAlC;AACA,QAAIA,SAAJ,EAAe5B,MAAM,CAACyB,KAAP,CAAaW,MAAb,GAAf,KACKpC,MAAM,CAACyB,KAAP,CAAakC,OAAb;;AAEL,QAAG/B,SAAH,EAAc;AACV,WAAKG,cAAL,CAAoB,KAAKE,YAAzB,EAAuC,CAAvC;AACH,KAFD,MAEO;AACH,WAAKF,cAAL,CAAoB,KAAKE,YAAzB,EAAuC,CAAvC;AACH;AACJ,GAjKmB;AAmKpBJ,EAAAA,SAnKoB,qBAmKV+B,MAnKU,EAmKFC,IAnKE,EAmKI;AACpBD,IAAAA,MAAM,CAAChC,SAAP,GAAmBiC,IAAnB;AAEA,QAAIC,UAAU,GAAGF,MAAM,CAACjD,IAAP,CAAYY,cAAZ,CAA2B,YAA3B,EAAyCA,cAAzC,CAAwD,YAAxD,CAAjB;AACAuC,IAAAA,UAAU,CAACtB,MAAX,GAAoB,CAACqB,IAArB;AACH,GAxKmB;AA0KpB9B,EAAAA,cA1KoB,0BA0KLpB,IA1KK,EA0KCoD,KA1KD,EA0KQ;AACxB,QAAIC,GAAG,GAAGrD,IAAI,CAACY,cAAL,CAAoB,aAApB,EAAmCA,cAAnC,CAAkD,KAAlD,CAAV;AACAyC,IAAAA,GAAG,CAAC5C,YAAJ,CAAiBf,EAAE,CAAC4D,MAApB,EAA4BC,WAA5B,GAA0C,KAAK9D,KAAL,CAAW2D,KAAX,CAA1C;AACH,GA7KmB;AA+KpB;AACAI,EAAAA,aAhLoB,2BAgLJ;AACZnE,IAAAA,MAAM,CAACoE,OAAP,CAAeC,EAAf,WAAqB,KAAK1D,IAAL,CAAUD,IAA/B,SAAsC4D,OAAO,CAACC,EAAR,CAAWC,UAAjD,GAA+D,KAAKC,QAApE,EAA8E,IAA9E;AACH,GAlLmB;AAoLpB;AACAC,EAAAA,eArLoB,6BAqLF;AACd1E,IAAAA,MAAM,CAACoE,OAAP,CAAeO,GAAf,WAAsB,KAAKhE,IAAL,CAAUD,IAAhC,SAAuC4D,OAAO,CAACC,EAAR,CAAWC,UAAlD,GAAgE,IAAhE;AACH,GAvLmB;AAyLpBI,EAAAA,SAzLoB,uBAyLR;AACR,SAAKF,eAAL;AACH;AA3LmB,CAAxB","sourceRoot":"/","sourcesContent":["/**\r\n * 设置\r\n */\r\n\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        spBar: [cc.SpriteFrame],\r\n    },\r\n\r\n    onLoad() {\r\n        this.initUI();\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"musicswitch\":\r\n                this.onMusicToggle();\r\n                break;\r\n            case \"effectswitch\":\r\n                this.onEffectToggle();\r\n                break;\r\n            case \"btn_change\":\r\n                glGame.panel.showPanelByName(\"exitAcc\");\r\n                break;\r\n            case \"btn_login\":\r\n                glGame.panel.showRegister();\r\n                break;\r\n        }\r\n    },\r\n\r\n    onMusicProcess () {\r\n        let process = this.musicSlider.getComponent(cc.Slider).progress;\r\n        this.musicSlider.getChildByName(\"progressBar\").getComponent(cc.ProgressBar).progress = process;\r\n        glGame.audio.setBGMVolume(process);\r\n\r\n        if(!this.musicToggle.isChecked) {\r\n            this.setToggle(this.musicToggle, true);\r\n            glGame.audio.openBGM();\r\n            this.setSliderState(this.musicSlider, 0);\r\n        }\r\n    },\r\n\r\n    onEffectProcess() {\r\n        let process = this.effectSlider.getComponent(cc.Slider).progress;\r\n        this.effectSlider.getChildByName(\"progressBar\").getComponent(cc.ProgressBar).progress = process;\r\n        glGame.audio.setSoundEffectVolume(process);\r\n\r\n        if(!this.effectToggle.isChecked) {\r\n           this.setToggle(this.effectToggle, true);\r\n            glGame.audio.openSE();\r\n            this.setSliderState(this.effectSlider, 0); \r\n        }\r\n    },\r\n\r\n    initUI() {\r\n\r\n        this.bInit = false;\r\n\r\n        // 如果是游客 隐藏切换账号按钮\r\n        if(glGame.user.isTourist()) {\r\n            this.node.getChildByName(\"btn_login\").active = true;\r\n        } else {\r\n            this.node.getChildByName(\"btn_change\").active = true;\r\n        }\r\n\r\n        // 玩家信息\r\n        let userinfo = this.node.getChildByName(\"userinfo\");\r\n\r\n        // 设置头像\r\n        let headImage = userinfo.getChildByName(\"img_head\");\r\n        glGame.panel.showHeadImage(headImage, glGame.user.get(\"headURL\"));\r\n\r\n        // 设置账号\r\n        userinfo.getChildByName(\"account\").getComponent(cc.Label).string = glGame.user.get(\"userName\") || \"\";\r\n\r\n        // 设置昵称\r\n        userinfo.getChildByName(\"nickbg\").getChildByName(\"nick\").getComponent(cc.Label).string = glGame.user.get(\"nickname\") || \"\";\r\n\r\n        // vip等级\r\n        let lab_userVip = userinfo.getChildByName(\"vip_bg\").getChildByName(\"lab_userVip\");\r\n        lab_userVip.getComponent(cc.Label).string = glGame.user.get(\"vip_name\");\r\n\r\n        if(glGame.user.isTourist()) {\r\n            userinfo.getChildByName(\"vip_bg\").active = false;\r\n            userinfo.getChildByName(\"nickbg\").active = false;\r\n            userinfo.getChildByName(\"account\").getComponent(cc.Label).string = \"未登录\";\r\n        }\r\n\r\n\r\n        // 音量信息\r\n        let volume = this.node.getChildByName(\"volume\");\r\n\r\n        this.musicToggle = volume.getChildByName(\"musicswitch\").getComponent(cc.Toggle);\r\n        this.effectToggle = volume.getChildByName(\"effectswitch\").getComponent(cc.Toggle);\r\n        this.musicSlider = volume.getChildByName(\"musicslider\");\r\n        this.effectSlider = volume.getChildByName(\"effectslider\");\r\n\r\n        let BGMSE = glGame.audio.get(\"BGMSE\");\r\n        this.setToggle(this.musicToggle, BGMSE[\"BGMPlayState\"]);\r\n        this.setToggle(this.effectToggle, BGMSE[\"SoundEffectPlayState\"]);\r\n\r\n        if(BGMSE[\"BGMPlayState\"]) {\r\n            this.setSliderState(this.musicSlider, 0);\r\n        } else {\r\n            this.setSliderState(this.musicSlider, 1);\r\n        }\r\n\r\n        if(BGMSE[\"SoundEffectPlayState\"]) {\r\n            this.setSliderState(this.effectSlider, 0);\r\n        } else {\r\n            this.setSliderState(this.effectSlider, 1);\r\n        }\r\n\r\n        this.musicSlider.getComponent(cc.Slider).progress = BGMSE[\"BGMVolume\"];\r\n        this.effectSlider.getComponent(cc.Slider).progress = BGMSE[\"SoundEffectVolume\"];\r\n        this.musicSlider.getChildByName(\"progressBar\").getComponent(cc.ProgressBar).progress = BGMSE[\"BGMVolume\"];\r\n        this.effectSlider.getChildByName(\"progressBar\").getComponent(cc.ProgressBar).progress = BGMSE[\"SoundEffectVolume\"];\r\n\r\n        this.bInit = true;\r\n    },\r\n\r\n    OnClickToggle(event) {\r\n        if(!this.bInit) {\r\n            return;\r\n        }\r\n\r\n        let buttonName = event.node.name;\r\n        let buttonNode = event.node;\r\n        console.log(`点击了toggle -> ${buttonName}`);\r\n        glGame.audio.playLoadSoundEffectByPath(\"select\");\r\n        this.onClick(buttonName, buttonNode);\r\n    },\r\n\r\n    onMusicToggle() {\r\n        if(!this.bInit) {\r\n            return;\r\n        }\r\n\r\n        let isChecked = this.musicToggle.isChecked;\r\n        this.setToggle(this.musicToggle, isChecked);\r\n        if (isChecked) glGame.audio.openBGM();\r\n        else glGame.audio.closeBGM();\r\n\r\n        if(isChecked) {\r\n            this.setSliderState(this.musicSlider, 0);\r\n        } else {\r\n            this.setSliderState(this.musicSlider, 1);\r\n        }\r\n    },\r\n\r\n    onEffectToggle() {\r\n        if(!this.bInit) {\r\n            return;\r\n        }\r\n\r\n        let isChecked = this.effectToggle.isChecked;\r\n        this.setToggle(this.effectToggle, isChecked);\r\n        if (isChecked) glGame.audio.openSE();\r\n        else glGame.audio.closeSE();\r\n\r\n        if(isChecked) {\r\n            this.setSliderState(this.effectSlider, 0);\r\n        } else {\r\n            this.setSliderState(this.effectSlider, 1);\r\n        }\r\n    },\r\n\r\n    setToggle(toggle, isOn) {\r\n        toggle.isChecked = isOn;\r\n\r\n        let iconChouma = toggle.node.getChildByName(\"Background\").getChildByName(\"img_chouma\");\r\n        iconChouma.active = !isOn;\r\n    },\r\n\r\n    setSliderState(node, state) {\r\n        let bar = node.getChildByName(\"progressBar\").getChildByName(\"bar\");\r\n        bar.getComponent(cc.Sprite).spriteFrame = this.spBar[state];\r\n    },\r\n\r\n    // 注册界面监听事件\r\n    registerEvent() {\r\n        glGame.emitter.on(`${this.node.name}${MESSAGE.UI.ACTION_END}`, this.showInfo, this);\r\n    },\r\n\r\n    // 销毁界面监听事件\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(`${this.node.name}${MESSAGE.UI.ACTION_END}`, this);\r\n    },\r\n\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n});\r\n"]}