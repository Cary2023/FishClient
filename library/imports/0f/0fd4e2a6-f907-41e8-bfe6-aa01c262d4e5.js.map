{"version":3,"sources":["assets\\modules\\login\\script\\scene\\login.js"],"names":["cc","Class","Component","properties","login_frame","Prefab","update_frame","update_bag","login_logo","click_action","btn_cleanupCache","Node","btn_serive","btn_website","VideoPlayer","onLoad","active","sys","isNative","startGame","serviceUrl","localStorage","getItem","glGame","gamecfg","emitter","on","updateService","MESSAGE","UI","HIDE_CLEANUP","hideCleanupCache","DOWNLOAD","BAG","updatebag","setLoginFrame","END","openLogin","director","getScene","getChildByName","panel","showPanel","zIndex","isAudioPlay","console","log","os","OS_WINDOWS","isBrowser","videoPlayer","node","videoPlayerEnd","playCallFunc","videoplayer","eventType","customEventData","EventType","PLAYING","scheduleOnce","videoMask","opacity","PAUSED","STOPPED","COMPLETED","CLICKED","READY_TO_PLAY","META_LOADED","currentTime","play","start","coinArral","coinArrvalTip","destroy","showChildPanel","audio","playPathBGM","user","get","serviceOuter","cleanupCache_cb","clearGame","servier_cb","openURL","index","login_switch","login_node","loginSwitch","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        login_frame: cc.Prefab,         //登入界面\r\n        update_frame: cc.Prefab,        //热更界面\r\n        update_bag: cc.Prefab,          //热更底包\r\n        login_logo: cc.Prefab,          //添加logo\r\n        click_action: cc.Prefab,\r\n        btn_cleanupCache: cc.Node,      //修复按钮\r\n        btn_serive: cc.Node,            //客服按钮\r\n        btn_website: cc.Node,           //客服按钮\r\n        btn_website: cc.Node,           //客服按钮\r\n        login_switch: [cc.Node],        //登录页面区分\r\n        videoMask: cc.Node,\r\n        videoPlayer: cc.VideoPlayer,\r\n        coinArrvalTip: cc.Prefab,\r\n    },\r\n    onLoad() {\r\n        this.btn_cleanupCache.active = cc.sys.isNative;\r\n        startGame();\r\n        this.serviceUrl = cc.sys.localStorage.getItem('serviceUrl') || glGame.gamecfg.serviceUrl;\r\n        glGame.emitter.on(\"userurldata\", this.updateService, this);\r\n        glGame.emitter.on(MESSAGE.UI.HIDE_CLEANUP, this.hideCleanupCache, this);\r\n        glGame.emitter.on(MESSAGE.DOWNLOAD.BAG, this.updatebag, this);\r\n\r\n        this.setLoginFrame();\r\n\r\n        glGame.emitter.on(MESSAGE.DOWNLOAD.END, this.openLogin, this);\r\n\r\n        if (!cc.director.getScene().getChildByName(\"click_action\")) glGame.panel.showPanel(this.click_action).zIndex = 999999;\r\n\r\n        let isAudioPlay = cc.sys.localStorage.getItem(\"isAudioPlay\");\r\n        console.log(\"是否播放视频 isAudioPlay ===>\", isAudioPlay);\r\n\r\n        if (isAudioPlay || cc.sys.os === cc.sys.OS_WINDOWS || cc.sys.isBrowser) {\r\n            this.videoPlayer.node.active = false;\r\n            this.videoPlayerEnd();\r\n        } else {\r\n            this.videoPlayer.node.active = true;\r\n        }\r\n    },\r\n\r\n    playCallFunc(videoplayer, eventType, customEventData) {\r\n        if (!this.videoPlayer.node.active) return;\r\n        switch (eventType) {\r\n            case cc.VideoPlayer.EventType.PLAYING:\r\n                // console.log(\"videoplayer ===> 表示视频正在播放中。\");\r\n                this.scheduleOnce(() => {\r\n                    this.videoMask.opacity = 1;\r\n                }, 0.1);\r\n                break;\r\n            case cc.VideoPlayer.EventType.PAUSED:\r\n                // console.log(\"videoplayer ===> 表示视频暂停播放。\");\r\n                break;\r\n            case cc.VideoPlayer.EventType.STOPPED:\r\n                // console.log(\"videoplayer ===> 表示视频已经停止播放。\");\r\n                break;\r\n            case cc.VideoPlayer.EventType.COMPLETED:\r\n                // console.log(\"videoplayer ===> 表示视频播放完成。\");\r\n                this.videoPlayerEnd();\r\n                break;\r\n            case cc.VideoPlayer.EventType.CLICKED:\r\n                // console.log(\"videoplayer ===> 表示视频被用户点击了。（只支持 Web 平台）\");\r\n                break;\r\n            case cc.VideoPlayer.EventType.READY_TO_PLAY:\r\n                // console.log(\"videoplayer ===> 表示视频准备好了，可以开始播放了。\");\r\n                break;\r\n            case cc.VideoPlayer.EventType.META_LOADED:\r\n                // console.log(\"videoplayer ===> 表示视频的元信息已加载完成，你可以调用 getDuration 来获取视频总时长。\");\r\n                if (cc.sys.isNative) {\r\n                    this.videoPlayer.currentTime = 0;\r\n                    this.videoPlayer.play();\r\n                } else this.videoPlayerEnd();\r\n                break;\r\n        }\r\n    },\r\n\r\n    start() {\r\n        if(glGame.coinArral == null){\r\n            glGame.panel.showPanel(this.coinArrvalTip);\r\n        }\r\n    },\r\n\r\n    videoPlayerEnd(){\r\n        this.videoMask.active = false;\r\n        this.videoPlayer.node.destroy();\r\n\r\n        glGame.panel.showChildPanel(this.update_frame, this.node);\r\n        \r\n        glGame.audio.playPathBGM();\r\n    },\r\n\r\n    hideCleanupCache() {\r\n        if (this.btn_cleanupCache) this.btn_cleanupCache.active = false;\r\n        if (this.btn_serive) this.btn_serive.active = false;\r\n        if (this.btn_website) this.btn_website.active = false;\r\n    },\r\n    updateService() {\r\n        if (glGame.user.get('url').serviceOuter) this.serviceUrl = glGame.user.get('url').serviceOuter;\r\n    },\r\n    cleanupCache_cb() {\r\n        clearGame();\r\n        this.btn_cleanupCache.active = false;\r\n    },\r\n    servier_cb() {\r\n        cc.sys.openURL(this.serviceUrl);\r\n    },\r\n    servier_cb() {\r\n        cc.sys.openURL(this.serviceUrl);\r\n    },\r\n    openLogin() {\r\n        this.node.getChildByName('loading_logo').active = false;\r\n        //glGame.panel.showPanel(this.login_frame);\r\n    },\r\n\r\n    updatebag() {\r\n        glGame.panel.showPanel(this.update_bag);\r\n    },\r\n\r\n    setLoginFrame() {\r\n        for (let index in this.login_switch) this.login_switch[index].active = false;\r\n        let login_node = this.login_switch[glGame.gamecfg.loginSwitch];\r\n        login_node.active = true;\r\n\r\n        glGame.panel.showChildPanel(this.login_logo, login_node.getChildByName(\"loading_logo\"));\r\n    },\r\n\r\n    onDestroy() {\r\n        glGame.emitter.off(MESSAGE.UI.HIDE_CLEANUP, this);\r\n        glGame.emitter.off(MESSAGE.DOWNLOAD.END, this);\r\n        glGame.emitter.off(MESSAGE.DOWNLOAD.BAG, this);\r\n    }\r\n});\r\n"]}