{"version":3,"sources":["assets\\frames\\model\\noticelogic.js"],"names":["NOTICE_SYSTEM","NOTICE_GAME_UERS","NOTICE_GAME_ROBOT","NoticeLogic","resetData","initData","noticelogic","prototype","g_instance","bNetwork","bEnterPlaza","special_end","list_min","list_max","delayTime","registerGlobalEvent","EnterForeground","content_list","plaza_list","task_list","enterPlaza","_connectPlazaNotice","interval","setInterval","glGame","notice","checkTackList","exitPlaza","_disconnectPlazaNotice","clearInterval","gameNet","send_msg","NETWORK","POMELO","NOTICE_ENTER_HANDLER","NOTICE_EXIT_HANDLER","emitter","on","EnterBackground","NOTICE_MARQUEE","onMarquee","unRegisterGlobalEvent","off","length","now_time","Date","now","index","data","endtime","delay","starttime","intervalstart","intervaltime","every","value","id","addPlazaNotice","emit","MESSAGE","NOTICE","PLAZA","removeRedundance","count","removeList","type","removelist","num","push","sort","a","b","i","splice","room","getGameDictById","gameId","task_notice","speed","content","getPlazaGameContent","Math","ceil","random","mode","level","Number","logicId","gameName","scenetag","LABA","getRoomType","betType","strList","name","nickname","winCoin","getNumber","strText","getPlazaContent","getContentList","getContent","addTaskContent","taskData","time","startTime","endTime","intervalTime","playSpeed","showLevel","removePlazaContentId","bAdd","addContent","strContent","BASE","addContentList","contentList","bStart","removeContent","removePlazaContent","removePlazaContentType","insertContent","unshift","reqGetHorseRaceLamp","http_reqGetHorseRaceLamp","bind","route","serverTime","addHorseRaceLamp","div","toString","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["const NOTICE_SYSTEM = 0;\r\nconst NOTICE_GAME_UERS = 1;\r\nconst NOTICE_GAME_ROBOT = 2;\r\n\r\n\r\n\r\nlet NoticeLogic = function () {\r\n    this.resetData();\r\n    this.initData();\r\n},\r\n    noticelogic = NoticeLogic.prototype,\r\n    g_instance = null;\r\n/**\r\n * 初始化数据\r\n */\r\nnoticelogic.initData = function () {\r\n    this.bNetwork = false;\r\n    this.bEnterPlaza = false;\r\n    this.special_end = 0;\r\n    this.list_min = 20;     //最小启动进入大厅协议包\r\n    this.list_max = 100;\r\n    this.delayTime = 60 * 1000;\r\n    this.registerGlobalEvent();\r\n    this.EnterForeground();\r\n};\r\n/**\r\n * 重置数据\r\n */\r\nnoticelogic.resetData = function () {\r\n    this.content_list = [];         //游戏内播报 内部\r\n    this.plaza_list = [];           //大厅播报列表 正在播报\r\n    this.task_list = [];            //任务列表      ,php服务端任务跑马\r\n};\r\n/**\r\n * 进入大厅，游戏跑马监测\r\n */\r\nnoticelogic.enterPlaza = function () {\r\n    this.bEnterPlaza = true;\r\n    this._connectPlazaNotice();\r\n    if (this.interval == null) {\r\n        this.interval = setInterval(() => {\r\n            glGame.notice.checkTackList();\r\n        }, 1000);\r\n    }\r\n}\r\n\r\nnoticelogic.exitPlaza = function () {\r\n    this.bEnterPlaza = false;\r\n    this._disconnectPlazaNotice();\r\n    if (this.interval != null) {\r\n        clearInterval(this.interval);\r\n        this.interval = null;\r\n    }\r\n}\r\n\r\nnoticelogic._connectPlazaNotice = function () {\r\n    if (this.bNetwork || !this.bEnterPlaza) return;\r\n    glGame.gameNet.send_msg(NETWORK.POMELO.NOTICE_ENTER_HANDLER);\r\n    this.bNetwork = true;\r\n}\r\n\r\nnoticelogic._disconnectPlazaNotice = function () {\r\n    if (!this.bNetwork) return;\r\n    glGame.gameNet.send_msg(NETWORK.POMELO.NOTICE_EXIT_HANDLER);\r\n    this.bNetwork = false;\r\n}\r\n\r\n\r\n/**\r\n * 注册监听\r\n */\r\nnoticelogic.registerGlobalEvent = function () {\r\n    glGame.emitter.on(\"EnterBackground\", this.EnterBackground, this);\r\n    glGame.emitter.on(\"EnterForeground\", this.EnterForeground, this);\r\n    glGame.emitter.on(NETWORK.POMELO.NOTICE_MARQUEE, this.onMarquee, this);\r\n}\r\n\r\n/**\r\n * 取消监听\r\n */\r\nnoticelogic.unRegisterGlobalEvent = function () {\r\n    glGame.emitter.off(\"EnterBackground\", this);\r\n    glGame.emitter.off(\"EnterForeground\", this);\r\n    glGame.emitter.off(NETWORK.POMELO.NOTICE_MARQUEE, this);\r\n}\r\n\r\n/**\r\n * 后台切换回调\r\n */\r\nnoticelogic.EnterBackground = function () {\r\n    if (this.interval != null) {\r\n        clearInterval(this.interval);\r\n        this.interval = null;\r\n    }\r\n}\r\n\r\n/**\r\n * 前台切换回调(开启公共列表设计)\r\n */\r\nnoticelogic.EnterForeground = function () {\r\n    if (this.interval == null) {\r\n        this.interval = setInterval(() => {\r\n            glGame.notice.checkTackList();\r\n        }, 1000);\r\n    }\r\n}\r\n\r\n/**\r\n * 监测大厅播放任务列表\r\n */\r\nnoticelogic.checkTackList = function () {\r\n    if (this.task_list.length == 0) return;\r\n    let now_time = Date.now();\r\n    for (let index in this.task_list) {\r\n        let data = this.task_list[index];\r\n        if (!data) continue;\r\n        let endtime = data.endtime + data.delay,\r\n            starttime = data.starttime + data.delay;\r\n        //判定是否符合跑马开启时间\r\n        if (data.endtime != 0 && data.starttime != 0) {  //data.endtime和data.starttime都等于0，为不限时间；\r\n            if (now_time < starttime || now_time > endtime) continue;\r\n        }\r\n\r\n        //判定是否符合添加进入播放列表\r\n        if (now_time - data.intervalstart >= data.intervaltime) {\r\n            if (this.plaza_list.every((value) => value.id != data.id)) {\r\n                this.addPlazaNotice(data);\r\n                data.intervalstart = 0;\r\n                if (this.plaza_list.length === 1) glGame.emitter.emit(MESSAGE.NOTICE.PLAZA);\r\n            }\r\n        }\r\n    }\r\n    if (this.plaza_list.length <= this.list_min && !this.bNetwork) {\r\n        this._connectPlazaNotice();\r\n    } else if (this.plaza_list.length >= this.list_max) {\r\n        this.removeRedundance();\r\n        this._disconnectPlazaNotice();\r\n    }\r\n}\r\n\r\n/**\r\n * 超过上限，后将对过早的跑马进行清理  系统跑马 > 真人跑马 > 机器跑马\r\n * @param {number} count  需要删除的数量\r\n */\r\nnoticelogic.removeRedundance = function (count = 1) {\r\n    if (this.plaza_list.length < this.list_max) return;\r\n    if (this.removeList(NOTICE_GAME_ROBOT, count)) return;\r\n    else if (this.removeList(NOTICE_GAME_UERS, count)) return;\r\n    else if (this.removeList(NOTICE_SYSTEM, count)) return;\r\n}\r\n\r\n/**\r\n * 清理相关类型的上限后的最远跑马\r\n * @param {number} type   需要删除的类型\r\n * @param {number} count  需要删除的数量\r\n */\r\nnoticelogic.removeList = function (type, count) {\r\n    let removelist = [];\r\n    let num = this.plaza_list.length - this.list_max;\r\n    num > 0 ? num : count;\r\n    for (let index in this.plaza_list) {\r\n        let notice = this.plaza_list[index];\r\n        if (notice.type == type) {\r\n            removelist.push(index);\r\n        }\r\n        if (removelist.length >= num) break;\r\n    }\r\n    if (removelist.length == 0) return false;\r\n    removelist.sort((a, b) => b - a);\r\n    for (let i in removelist) {\r\n        let index = removelist[i];\r\n        this.plaza_list.splice(index, 1);\r\n    }\r\n    if (removelist.length < num) return false;\r\n    return true\r\n}\r\n\r\n/**\r\n * 监听pomelo 的通知消息\r\n * @param {any} data 游戏内数据类型\r\n */\r\nnoticelogic.onMarquee = function (data) {\r\n    if (!glGame.room.getGameDictById(data.gameId)) return;\r\n    if (this.plaza_list.length >= this.list_max) this.removeRedundance();\r\n    let task_notice = {           //\r\n        starttime: 0,               //开启时间段\r\n        endtime: 0,                 //关闭时间段\r\n        intervaltime: 0,            //时间间隔\r\n        speed: 3,                   //播放速率\r\n        delay: 0,                   //服务端与客户端的时间差\r\n        content: this.getPlazaGameContent(Math.ceil(Math.random() * 100), data),                  //播放内容\r\n        mode: 1,                    //播放方式，1为左右滚动，2为上下滚动\r\n        level: data.level,          //档次 1 普通 2 高档\r\n        type: Number(data.logicId) > 0 ? NOTICE_GAME_UERS : NOTICE_GAME_ROBOT,\r\n    }\r\n    this.addPlazaNotice(task_notice);\r\n    if (this.plaza_list.length === 1) glGame.emitter.emit(MESSAGE.NOTICE.PLAZA);\r\n}\r\n\r\n/**\r\n * 获取跑马说明文字\r\n * @param {number} index    公告描述类型\r\n * @param {any} data        游戏内数据类型\r\n */\r\nnoticelogic.getPlazaGameContent = function (index, data) {\r\n    let gameName = \"\";\r\n    if(data.gameId == glGame.scenetag.LABA) {\r\n        gameName = `<color=#ffdd20>${glGame.room.getGameDictById(data.gameId)}</color>`\r\n    } else {\r\n        gameName = `<color=#ffdd20>${glGame.room.getGameDictById(data.gameId)}-${glGame.room.getRoomType(data.gameId, data.betType)}</color>`\r\n    }\r\n\r\n    let strList = [],\r\n        name = `<color=#27d9ff>${data.nickname}</color>`,\r\n        winCoin = `<color=#f4c404>${this.getNumber(data.winCoin)}</color>`;\r\n    strList.push(`恭喜玩家${name}在${gameName}大赢特赢，赢得了${winCoin}金币！`);\r\n    strList.push(`玩家${name}鸿运当头，在${gameName}赢得了${winCoin}金币！`);\r\n    strList.push(`吉星高照，玩家${name}在${gameName}赢得了${winCoin}金币！`);\r\n    strList.push(`福到运到财气到，在${gameName}中玩家${name}赢得了${winCoin}金币！`);\r\n    let strText = strList[index % strList.length];\r\n\r\n\r\n    return strText;\r\n}\r\n/**\r\n * 获取大厅公告的内容\r\n */\r\nnoticelogic.getPlazaContent = function () {\r\n    if (!this.plaza_list[0]) {\r\n        return \"\";\r\n    }\r\n    return this.plaza_list[0];\r\n};\r\n\r\n/**\r\n * 获取普通公告列表\r\n */\r\nnoticelogic.getContentList = function () {\r\n    return this.content_list;\r\n};\r\n\r\n/**\r\n * 获取普通公告第一条\r\n */\r\nnoticelogic.getContent = function () {\r\n    if (!this.content_list[0]) {\r\n        return \"\";\r\n    }\r\n    return this.content_list[0];\r\n};\r\n\r\n/**\r\n * 大厅推送的任务公告\r\n * @param {any}   taskData   公告内容\r\n * @param {number} time      结束时间戳\r\n */\r\nnoticelogic.addTaskContent = function (taskData, time) {\r\n    //判定是否有重复添加\r\n    if (this.task_list[0]) {\r\n        for (let index in this.task_list) {\r\n            let data = this.task_list[index];\r\n            if (!data) continue;\r\n            if (data.id == taskData.id) {\r\n                data.starttime = taskData.startTime;              //开启时间段\r\n                data.endtime = taskData.endTime;                  //关闭时间段\r\n                data.intervaltime = taskData.intervalTime;        //时间间隔\r\n                data.speed = taskData.playSpeed;                   //播放速率\r\n                data.delay = time;                                //服务端与客户端的时间差\r\n                data.content = taskData.content;                  //播放内容\r\n                data.mode = taskData.type;                        //播放方式，1为左右滚动，2为上下滚动\r\n                data.level = taskData.showLevel;                  //档次 1 普通 2 高档\r\n                this.removePlazaContentId(data.id);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    //添加到任务列表\r\n    let now_time = Date.now();\r\n    let task_notice = {\r\n        id: taskData.id,\r\n        starttime: taskData.startTime,              //开启时间段\r\n        endtime: taskData.endTime,                  //关闭时间段\r\n        intervaltime: taskData.intervalTime,        //时间间隔\r\n        speed: taskData.playSpeed,                  //播放速率\r\n        delay: time,                                //服务端与客户端的时间差\r\n        content: taskData.content,                  //播放内容\r\n        mode: taskData.type,                        //播放方式，1为左右滚动，2为上下滚动\r\n        level: taskData.showLevel,                  //档次 1 普通 2 高档\r\n        type: NOTICE_SYSTEM,                         //系统任务标记\r\n    }\r\n\r\n    let endtime = taskData.endTime + time,\r\n        starttime = taskData.startTime + time;\r\n    task_notice.intervalstart = (now_time < starttime || now_time > endtime) || taskData.startTime == 0 ? 0 : now_time - taskData.intervalTime;\r\n    this.task_list.push(task_notice);\r\n};\r\n\r\n\r\n/**\r\n * 次序添加大厅跑马\r\n */\r\nnoticelogic.addPlazaNotice = function (data) {\r\n    if (this.plaza_list.length == 0) this.plaza_list.push(data);\r\n    else if (data.type == this.plaza_list[this.plaza_list.length - 1].type) this.plaza_list.push(data);\r\n    else {\r\n        let bAdd = false;\r\n        for (let index in this.plaza_list) {\r\n            if (this.plaza_list[index].type > data.type) {\r\n                if (index == 0) index = 1;  //防止添加完后背第一条跑马踢出\r\n                this.plaza_list.splice(index, 0, data);\r\n                bAdd = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!bAdd) this.plaza_list.push(data);\r\n    }\r\n    if (this.plaza_list.length <= this.list_min && !this.bNetwork) {\r\n        this._connectPlazaNotice();\r\n    } else if (this.plaza_list.length >= this.list_max) {\r\n        this.removeRedundance();\r\n        this._disconnectPlazaNotice();\r\n    }\r\n}\r\n\r\n/**\r\n * 非单局内出现的公告往后排\r\n * @param strContent string 公告内容 \r\n */\r\nnoticelogic.addContent = function (strContent) {\r\n    this.content_list.push(strContent);\r\n    if (this.content_list.length === 1) glGame.emitter.emit(MESSAGE.NOTICE.BASE);\r\n};\r\n\r\n/**\r\n * 非单局内出现的公告往后排(列表)\r\n * @param contentList string[] 公告列表\r\n */\r\nnoticelogic.addContentList = function (contentList) {\r\n    let bStart = !this.content_list[0];\r\n    this.content_list.push(...contentList);\r\n    if (bStart) glGame.emitter.emit(MESSAGE.NOTICE.BASE);\r\n};\r\n\r\n/**\r\n * 对播放结束的通用列表进行清理\r\n */\r\nnoticelogic.removeContent = function () {\r\n    if (this.content_list[0]) this.content_list.splice(0, 1);\r\n};\r\n\r\n/**\r\n * 对播放结束的大厅列表进行清理\r\n */\r\nnoticelogic.removePlazaContent = function () {\r\n    if (!this.plaza_list[0]) return;\r\n\r\n    if (this.plaza_list[0].type == NOTICE_SYSTEM && this.task_list[0]) {\r\n        let now_time = Date.now();\r\n        for (let index in this.task_list) {\r\n            let data = this.task_list[index];\r\n            if (!data) continue;\r\n            if (data.id == this.plaza_list[0].id) {\r\n                data.intervalstart = now_time;\r\n                break;\r\n            }\r\n        }\r\n        this.plaza_list.splice(0, 1);\r\n        if (this.plaza_list.length === 1) glGame.emitter.emit(MESSAGE.NOTICE.PLAZA);\r\n    } else this.plaza_list.splice(0, 1);\r\n};\r\n\r\n\r\n/**\r\n * 清理相关类型的跑马\r\n * @param {number} type   需要删除的类型\r\n */\r\nnoticelogic.removePlazaContentType = function (type) {\r\n    let removelist = [];\r\n    for (let index in this.plaza_list) {\r\n        let notice = this.plaza_list[index];\r\n        if (notice.type == type) {\r\n            removelist.push(index);\r\n        }\r\n    }\r\n    if (removelist.length == 0) return false;\r\n    removelist.sort((a, b) => b - a);\r\n    for (let i in removelist) {\r\n        let index = removelist[i];\r\n        this.plaza_list.splice(index, 1);\r\n    }\r\n    return true\r\n}\r\n\r\n\r\n/**\r\n * 对播放结束的大厅列表进行清理\r\n * @param {number} id     任务ID\r\n */\r\nnoticelogic.removePlazaContentId = function (id) {\r\n    let removelist = [];\r\n    for (let index in this.plaza_list) {\r\n        let notice = this.plaza_list[index];\r\n        if (notice.id == id) removelist.push(index);\r\n    }\r\n    if (removelist.length == 0) return;\r\n    removelist.sort((a, b) => b - a);\r\n    for (let i in removelist) {\r\n        let index = removelist[i];\r\n        this.plaza_list.splice(index, 1);\r\n    }\r\n};\r\n\r\n/**\r\n * 作用单局内需要提前公告\r\n * @param strContent string 公告内容\r\n */\r\nnoticelogic.insertContent = function (strContent) {\r\n    this.content_list.unshift(strContent);\r\n    if (this.special_end === 0 && this.content_list.length === 1) glGame.emitter.emit(MESSAGE.NOTICE.BASE);\r\n};\r\n\r\n/**\r\n * 发送获取http的跑马\r\n */\r\nnoticelogic.reqGetHorseRaceLamp = function () {\r\n    glGame.gameNet.send_msg(\"http.reqGetHorseRaceLamp\", {}, this.http_reqGetHorseRaceLamp.bind(this));\r\n};\r\n\r\n/**\r\n * 解析并对现有跑马进行赋值 等pomelo通知在请求\r\n * @param route string  访问地址\r\n * @param data  Array[] 获取公告列表\r\n */\r\nnoticelogic.http_reqGetHorseRaceLamp = function (route, data) {\r\n    this.removePlazaContentType(NOTICE_SYSTEM);\r\n    this.task_list = [];\r\n    if (data.data) {\r\n        let delay = data.serverTime - Date.now();\r\n        for (let i in data.data) {\r\n            let notice = data.data[i];\r\n            this.addTaskContent(notice, delay);\r\n        }\r\n        this.checkTackList();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * 登录时刷新跑马\r\n * @param data  Array[] 获取公告列表\r\n */\r\nnoticelogic.addHorseRaceLamp = function (data) {\r\n    this.resetData();\r\n    if (data.data) {\r\n        let delay = data.serverTime - Date.now();\r\n        for (let i in data.data) {\r\n            let notice = data.data[i];\r\n            this.addTaskContent(notice, delay);\r\n        }\r\n        this.checkTackList();\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * 获取跑马说明文字\r\n * @param {number} value 修改金币为浮点型保留两位\r\n */\r\nnoticelogic.getNumber = function (value) {\r\n    return (Number(value).div(100)).toString();\r\n};\r\n\r\n\r\nmodule.exports = function () {\r\n    if (!g_instance) {\r\n        g_instance = new NoticeLogic();\r\n    }\r\n    return g_instance;\r\n};\r\n"]}