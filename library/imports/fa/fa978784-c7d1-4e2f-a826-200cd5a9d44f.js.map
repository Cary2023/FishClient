{"version":3,"sources":["assets\\modules\\public\\script\\notice\\rollnotice.js"],"names":["NOTICE_PLAZA","NOTICE_PUBLIC","NOTICE_PUBLIC2","NOTICE_HORIZONTAL","NOTICE_VERTICAL","HtmlTextParser","require","_htmlTextParser","glGame","baseclass","extend","properties","node_bottom","cc","Node","node_icon","node_spine","node_mask","Widget","content","contentTemp","frame_di","SpriteFrame","frame_laba","onLoad","_mutipleLineText","_labelSegmentsCache","bactive","node","active","speed","noticeType","registerEvent","actionStart","_originSize","getContentSize","actionType","scene_names","sceneName","scene","getSceneName","setApperance","indexOf","onEnable","onCanvasResize","emitter","on","MESSAGE","NOTICE","BASE","basestart","PLAZA","plazastart","unregisterEvent","off","type","getComponent","Sprite","spriteFrame","rect","getRect","setContentSize","size","width","height","setSpeed","_size","new_pos","pos_h","setScale","left","updateAlignment","fsize","RichText","fontSize","initSize","scaleX","scaleY","x","sp","Skeleton","setAnimation","setPosition","pos","_pos","setActive","bol","setBottom","setZIndex","zIndex","getContent","contentData","taskData","notice","getPlazaContent","mode","level","setCompleteListener","trackEntry","loopCount","getNumberOfRunningActions","_action","position","v2","content_data","CowRoll","label_content","string","movex","textSpeed","move_act","moveTo","call","callFunc","removePlazaContent","removeContent","runAction","sequence","callRun","record","length","stopAllActions","actionArr","push","delayTime","y","getStrContent","actRun","actRun2","delayCallback","moveBy","bind","initCowData","isRollOne","self","preHandleContent","richText","maxWidth","lastEmptyLine","_lineOffsetX","textArray","parse","_textArray","i","richTextElement","text","multilineTexts","split","j","labelString","_isLastComponentCR","labelWidth","_measureText","_updateRichTextWithMaxWidth","styleIndex","fragmentWidth","checkStartIndex","checkEndIndex","_getFirstWordLen","checkString","substr","checkStringWidth","remainingString","fragments","textUtils","fragmentText","plaza","director","getScene","getChildByName","showsize","OnDestroy","resetData"],"mappings":"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","sourceRoot":"/","sourcesContent":["const NOTICE_PLAZA = 0      //大厅跑马\r\nconst NOTICE_PUBLIC = 1     //普通跑马\r\nconst NOTICE_PUBLIC2 = 2    //普通跑马2\r\n\r\nconst NOTICE_HORIZONTAL = 1         //垂直滚动\r\nconst NOTICE_VERTICAL = 2           //特殊跑马\r\n\r\nconst HtmlTextParser = require('./html-text-parser');\r\nconst _htmlTextParser = new HtmlTextParser();\r\n\r\nglGame.baseclass.extend({\r\n\r\n    properties: {\r\n        node_bottom: cc.Node,\r\n        node_icon: cc.Node,\r\n        node_spine: cc.Node,\r\n        node_mask: cc.Widget,\r\n        content: cc.Node,\r\n        contentTemp: cc.Node,\r\n        frame_di: [cc.SpriteFrame],\r\n        frame_laba: [cc.SpriteFrame],\r\n    },\r\n\r\n    onLoad() {\r\n        this._mutipleLineText = [];\r\n        this._labelSegmentsCache = [];\r\n        this.bactive = false;\r\n        this.node.active = false;\r\n        this.speed = 60;\r\n        this.noticeType = NOTICE_PUBLIC;\r\n        this.registerEvent();\r\n        this.actionStart();\r\n        this._originSize = this.node.getContentSize();\r\n        this.actionType = 2;                        //初始化默认为普通跑马特效\r\n        this.scene_names = [\"wqznn\", \"zhajinhua\", \"ebg\", \"ddz\"];     //普通跑马灯2列表\r\n\r\n        let sceneName = glGame.scene.getSceneName();\r\n        if(sceneName === \"plaza\") {\r\n            this.setApperance(NOTICE_PLAZA);\r\n        } else if(this.scene_names.indexOf(sceneName) != -1) {\r\n            this.setApperance(NOTICE_PUBLIC2);\r\n        } else {\r\n            this.setApperance(NOTICE_PUBLIC);\r\n        }\r\n    },\r\n\r\n    onEnable() {\r\n        this.onCanvasResize();\r\n    },\r\n\r\n    registerEvent() {\r\n        glGame.emitter.on(MESSAGE.NOTICE.BASE, this.basestart, this);\r\n        glGame.emitter.on(MESSAGE.NOTICE.PLAZA, this.plazastart, this);\r\n        glGame.emitter.on(\"resize\", this.onCanvasResize, this);\r\n    },\r\n    unregisterEvent() {\r\n        glGame.emitter.off(MESSAGE.NOTICE.BASE, this);\r\n        glGame.emitter.off(MESSAGE.NOTICE.PLAZA, this);\r\n        glGame.emitter.off(\"resize\", this);\r\n    },\r\n    basestart() {\r\n        this.actionStart();\r\n    },\r\n    plazastart() {\r\n        this.actionStart();\r\n    },\r\n\r\n    /**\r\n     * 设置跑马灯外观\r\n     * @param type number \r\n     */\r\n    setApperance(type) {\r\n        this.node_bottom.getComponent(cc.Sprite).spriteFrame = this.frame_di[type];\r\n        this.node_icon.getComponent(cc.Sprite).spriteFrame = this.frame_laba[type];\r\n\r\n        let rect = this.frame_di[type].getRect();\r\n        this.node.setContentSize(cc.size(rect.width, rect.height));\r\n        this._originSize = this.node.getContentSize();\r\n    },\r\n\r\n    /**\r\n     * 设置结束的速率\r\n     * @param speed number 长度/秒速  每秒位移像素\r\n     */\r\n    setSpeed(speed) {\r\n        this.speed = speed;\r\n    },\r\n\r\n    /**\r\n     * 设置跑马大小\r\n     * @param size cc.size 长宽\r\n     */\r\n    setContentSize(size) {\r\n        this._size = size;\r\n        let new_pos = this.node.getContentSize(),\r\n            pos_h = size.height / new_pos.height;\r\n        this.node.setContentSize(size);\r\n\r\n        //设置图片\r\n        this.node_icon.setScale(pos_h);\r\n        \r\n        //设置遮罩\r\n        this.node_mask.left = this.node_icon.getContentSize().width * pos_h + 30;\r\n        this.node_mask.updateAlignment();\r\n        \r\n        //设置字体大小\r\n        let fsize = size.height / 2 + 3;\r\n        this.content.getComponent(cc.RichText).fontSize = fsize;\r\n        this.contentTemp.getComponent(cc.RichText).fontSize = fsize;\r\n        //设置特效\r\n        let initSize = cc.size(1201, 68);\r\n        if (size.width != initSize.width || size.height != initSize.height) {\r\n            this.node_spine.scaleX = size.width / initSize.width * 1.02;\r\n            this.node_spine.scaleY = size.height / initSize.height;\r\n            this.node_spine.x = this.node_spine.x * (size.width / initSize.width);\r\n            this.node_spine.getComponent(sp.Skeleton).setAnimation(0, this.actionType, true);\r\n        }\r\n\r\n        this.node_bottom.getComponent(cc.Widget).updateAlignment();\r\n        this.node_icon.getComponent(cc.Widget).updateAlignment();\r\n\r\n    },\r\n    /**\r\n     * 设置跑马位置\r\n     * @param pos cc.v2 x,y\r\n     */\r\n    setPosition(pos) {\r\n        this._pos = pos;\r\n        this.node.setPosition(pos);\r\n    },\r\n    /**\r\n     * 设置是否自动做显示隐藏\r\n     * @param bol bool 开关\r\n     */\r\n    setActive(bol) {\r\n        this.bactive = bol;\r\n        if (!this.node.active && this.bactive) this.node.active = bol;\r\n    },\r\n    /**\r\n     * 设置底图的开关\r\n     * @param bol bool 开关\r\n     */\r\n    setBottom(bol) {\r\n        this.node_bottom.active = bol;\r\n    },\r\n\r\n    /**\r\n     * 设置跑马的层级\r\n     * @param zIndex bool 开关\r\n     */\r\n    setZIndex(zIndex) {\r\n        if (zIndex != 0) this.node.zIndex = zIndex;\r\n    },\r\n\r\n    /**\r\n     * 获取数据层里面的数据\r\n     */\r\n    getContent() {\r\n        let contentData = \"\",\r\n            taskData = glGame.notice.getPlazaContent();\r\n        this.noticeType = NOTICE_PUBLIC;\r\n        if (taskData && glGame.scene.getSceneName() === \"plaza\") {\r\n            this.noticeType = NOTICE_PLAZA;\r\n            contentData = taskData.content;\r\n            this.mode = taskData.mode;\r\n            this.actionType = taskData.level;\r\n\r\n            if(this.actionType == 2) {\r\n                this.node_spine.active = true;\r\n                this.node_spine.getComponent(sp.Skeleton).setAnimation(0, \"1\", false);\r\n                this.node_spine.getComponent(sp.Skeleton).setCompleteListener((trackEntry, loopCount) => {\r\n                    this.node_spine.active = false;\r\n                });\r\n\r\n            } else {\r\n                this.node_spine.active = true;\r\n                this.node_spine.getComponent(sp.Skeleton).setAnimation(0, \"1\", false);\r\n                this.node_spine.getComponent(sp.Skeleton).setCompleteListener((trackEntry, loopCount) => {\r\n                    this.node_spine.getComponent(sp.Skeleton).setAnimation(0, \"2\", true);\r\n                });\r\n            }\r\n\r\n            if (taskData.speed) this.setSpeed(taskData.speed);\r\n        } else {\r\n            contentData = glGame.notice.getContent();\r\n        }\r\n        return contentData;\r\n    },\r\n\r\n    /**\r\n     * 动画启动\r\n     */\r\n    actionStart() {\r\n        if (this.content.getNumberOfRunningActions()) return;\r\n        if (this.contentTemp && this.contentTemp.getNumberOfRunningActions()) return;\r\n        if (!this.bactive) this.node.active = true;\r\n        this._action();\r\n    },\r\n    /**\r\n     * 动画流程\r\n     */\r\n    _action() {\r\n        this.content.position = cc.v2(0, 0);\r\n        this.contentTemp.position = cc.v2(0, -68);\r\n        this.content_data = this.getContent();\r\n        if (this.mode == NOTICE_VERTICAL && this.noticeType == NOTICE_PLAZA) {\r\n            return this.CowRoll();\r\n        }\r\n        if (!this.content_data) {\r\n            if (!this.bactive) this.node.active = false;\r\n            return;\r\n        }\r\n        let label_content = this.content.getComponent(cc.RichText);\r\n        label_content.string = this.content_data;\r\n        let movex = this.node.width / 2 + this.content.width / 2 + 20;\r\n        this.content.x = movex;\r\n        let textSpeed = this.speed * this.content.getComponent(cc.RichText).fontSize;\r\n        let move_act = cc.moveTo(movex / textSpeed, -movex, 0);\r\n        let call = cc.callFunc(() => {\r\n            if(this.noticeType === NOTICE_PLAZA) glGame.notice.removePlazaContent();\r\n            else glGame.notice.removeContent();\r\n            this._action();\r\n        })\r\n        this.content.runAction(cc.sequence(move_act, call))\r\n    },\r\n\r\n    callRun(content, speed) {\r\n        if(this.record == this._mutipleLineText.length) {\r\n            content.stopAllActions();\r\n            let actionArr = [];\r\n            actionArr.push(cc.delayTime(speed));\r\n            actionArr.push(cc.callFunc(() => {\r\n                if(this.noticeType === NOTICE_PLAZA) glGame.notice.removePlazaContent();\r\n                else glGame.notice.removeContent();\r\n                this.CowRoll();\r\n            }));\r\n            content.runAction(cc.sequence(actionArr));\r\n        } else {\r\n            if(this.content.y > this.contentTemp.y) {\r\n                this.content.y = -this.content.height;\r\n                this.getStrContent(this.content);\r\n            } else {\r\n                this.contentTemp.y = -this.contentTemp.height;\r\n                this.getStrContent(this.contentTemp);\r\n            }\r\n\r\n            this.actRun(this.content, this.speed);\r\n            this.actRun2(this.contentTemp, this.speed);\r\n        }\r\n    },\r\n\r\n    delayCallback() {\r\n        this.getStrContent(this.contentTemp);\r\n        this.contentTemp.runAction(cc.moveBy(0.5, 0, this.contentTemp.height));\r\n\r\n        this.content.runAction(cc.sequence(\r\n            cc.moveBy(0.5, 0, this.content.height),\r\n            cc.callFunc(this.callRun.bind(this, this.content, this.speed))\r\n        ));\r\n    },\r\n\r\n    actRun2(content, speed) {\r\n        content.stopAllActions();\r\n        content.runAction(cc.sequence(\r\n            cc.delayTime(speed),\r\n            cc.moveBy(0.5, 0, content.height)\r\n        ));\r\n    },\r\n\r\n    actRun(content, speed) {\r\n        content.stopAllActions();\r\n        content.runAction(cc.sequence(\r\n            cc.delayTime(speed),\r\n            cc.moveBy(0.5, 0, content.height),\r\n            cc.callFunc(this.callRun.bind(this, content, speed))\r\n        ));\r\n    },\r\n\r\n    //垂直滚动\r\n    CowRoll() {\r\n        this.content_data = this.getContent();\r\n        this.initCowData();\r\n        if (this.mode == NOTICE_HORIZONTAL && this.noticeType == NOTICE_PLAZA) {\r\n            return this._action();\r\n        }\r\n        \r\n        if (!this.content_data) {\r\n            if (!this.bactive) {\r\n                this.node.active = false;\r\n                this.content.stopAllActions();\r\n                this.contentTemp.stopAllActions();\r\n                this.contentTemp.getComponent(cc.RichText).string = \"\";\r\n                this.content.getComponent(cc.RichText).string = \"\";\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.isRollOne) {\r\n            let self = this;\r\n            this.content.stopAllActions();\r\n            this.content.runAction(cc.sequence(\r\n                cc.delayTime(this.speed),\r\n                cc.callFunc(() => {\r\n                    if(self.noticeType === NOTICE_PLAZA) glGame.notice.removePlazaContent();\r\n                    else glGame.notice.removeContent();\r\n                    self.CowRoll();\r\n                })\r\n            ))\r\n            return;\r\n        }\r\n\r\n        this.content.runAction(cc.sequence(cc.delayTime(this.speed), cc.callFunc(this.delayCallback.bind(this))));\r\n    },\r\n    //初始化滚动数据\r\n    initCowData() {\r\n        this.content.position = cc.v2(0, 0);\r\n        this.contentTemp.position = cc.v2(0, -68);\r\n        this.contentTemp.getComponent(cc.RichText).string = \"\";\r\n        this.content.getComponent(cc.RichText).string = \"\";\r\n        this.content.stopAllActions();\r\n        this.contentTemp.stopAllActions();\r\n        this.record = 0;\r\n\r\n        if(this.mode != NOTICE_VERTICAL) {\r\n            return;\r\n        }\r\n\r\n        if(this.content_data.length > 0)\r\n            this.preHandleContent();\r\n        this.getStrContent(this.content);\r\n        if (this.record == this._mutipleLineText.length) {\r\n            this.isRollOne = true;\r\n            return\r\n        } else {\r\n            this.isRollOne = false;\r\n        }\r\n    },\r\n\r\n    preHandleContent() {\r\n        let richText = this.content.getComponent(cc.RichText);\r\n        this.richText = richText;\r\n        richText.string = \"\";\r\n        this.maxWidth = this.node.width - 120;\r\n        this._mutipleLineText = [];\r\n\r\n        let lastEmptyLine = false;\r\n        this._lineOffsetX = 0;\r\n\r\n        let textArray = _htmlTextParser.parse(this.content_data);\r\n        this._textArray = textArray;\r\n        for(let i = 0; i < textArray.length; i++) {\r\n            let richTextElement = this._textArray[i];\r\n            let text = richTextElement.text;\r\n            let multilineTexts = text.split(\"\\n\");\r\n\r\n            for (let j = 0; j < multilineTexts.length; ++j) {\r\n                let labelString = multilineTexts[j];\r\n                if (labelString === \"\") {\r\n                    if (richText._isLastComponentCR(text)\r\n                        && j === multilineTexts.length - 1) {\r\n                        continue;\r\n                    }\r\n                    this._mutipleLineText.push(\"\");\r\n                    this._lineOffsetX = 0;\r\n                    lastEmptyLine = true;\r\n                    continue;\r\n                }\r\n                lastEmptyLine = false;\r\n\r\n                let labelWidth = richText._measureText(i, labelString);\r\n                this._updateRichTextWithMaxWidth(labelString, labelWidth, i, richText);\r\n\r\n                if (multilineTexts.length > 1 && j < multilineTexts.length - 1) {\r\n                    this._mutipleLineText.push(\"\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //获取当前的字数\r\n    getStrContent(node) {\r\n        node.getComponent(cc.RichText).string = this._mutipleLineText[this.record++];\r\n    },\r\n\r\n    _updateRichTextWithMaxWidth (labelString, labelWidth, styleIndex, richText) {\r\n        let fragmentWidth = labelWidth;\r\n        if (this._lineOffsetX > 0 && fragmentWidth + this._lineOffsetX > this.maxWidth) {\r\n            //concat previous line\r\n            let checkStartIndex = 0;\r\n            while (this._lineOffsetX <= this.maxWidth) {\r\n                let checkEndIndex = richText._getFirstWordLen(labelString,\r\n                    checkStartIndex,\r\n                    labelString.length);\r\n                let checkString = labelString.substr(checkStartIndex, checkEndIndex);\r\n                let checkStringWidth = richText._measureText(styleIndex, checkString);\r\n\r\n                if (this._lineOffsetX + checkStringWidth <= this.maxWidth) {\r\n                    this._lineOffsetX += checkStringWidth;\r\n                    checkStartIndex += checkEndIndex;\r\n                }\r\n                else {\r\n\r\n                    if (checkStartIndex > 0) {\r\n                        let remainingString = labelString.substr(0, checkStartIndex);\r\n                        this._mutipleLineText.push(remainingString);\r\n                        labelString = labelString.substr(checkStartIndex, labelString.length);\r\n                        fragmentWidth = richText._measureText(styleIndex, labelString, richText);\r\n                    }\r\n                    this._mutipleLineText.push(\"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (fragmentWidth > this.maxWidth) {\r\n            let fragments = cc.textUtils.fragmentText(labelString,\r\n                fragmentWidth,\r\n                this.maxWidth,\r\n                richText._measureText(styleIndex));\r\n            for(let i = 0; i < fragments.length; i++) {\r\n                this._mutipleLineText.push(fragments[i]);\r\n            }\r\n        }\r\n        else {\r\n            this._lineOffsetX += fragmentWidth;\r\n            this._mutipleLineText.push(labelString);\r\n        }\r\n    },\r\n\r\n    onCanvasResize() {\r\n        this.node.runAction(cc.sequence(cc.delayTime(0.01), cc.callFunc(()=> {\r\n            let plaza = cc.director.getScene().getChildByName(\"plaza\");\r\n            if(plaza) {\r\n                let height = 68;\r\n                let showsize = cc.size(plaza.width * 0.65, height);\r\n                this.setContentSize(showsize);\r\n                this.setPosition(cc.v2(plaza.width / 2 + 439 / 2, plaza.height - 185));\r\n            }\r\n            \r\n        })))\r\n    },\r\n\r\n    OnDestroy() {\r\n        this.unregisterEvent();\r\n        glGame.notice.resetData();\r\n    },\r\n});"]}