{"version":3,"sources":["assets\\frames\\net\\http.js"],"names":["errCheck","require","HTTP","http","prototype","g_instance","POST","route","msg","next","resend","timeout","xhr","cc","loader","getXMLHttpRequest","onreadystatechange","readyState","status","console","log","statusText","respone","responseText","resp","JSON","parse","head","body","glGame","gameNet","getNetMgr","setLoginToken","token","key","encrypt","getDecodeData","CheckError","code","onerror","error","open","getWebHost","setRequestHeader","tempData","data","getEncodeData","send","stringify","GET","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["let\r\n    errCheck = require(\"errckect\"),\r\n    HTTP = function () { },\r\n    http = HTTP.prototype,\r\n    g_instance = null;\r\n\r\nhttp.POST = function (route, msg, next, resend = false, timeout = 5000) {\r\n    let xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n            console.log(\"Status: Got GET response! \" + xhr.statusText);\r\n            let respone = xhr.responseText;\r\n            let resp = JSON.parse(respone);\r\n            let head = resp.head;\r\n            let body = resp.body;\r\n            glGame.gameNet.getNetMgr().setLoginToken(head.token);\r\n            if (head.key) body = glGame.encrypt.getDecodeData(body, head.key);\r\n            if (errCheck.CheckError(head.route, head.code, body)) {\r\n                next(head.route, body)\r\n            }\r\n        }\r\n    };\r\n    // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n    // method and before calling the send() method.\r\n    xhr.timeout = timeout;\r\n    xhr.onerror = (error) => {\r\n        console.log(\"出错啦 http.POST ...\")\r\n    }\r\n    xhr.open(\"POST\", glGame.gameNet.getWebHost(), true);\r\n    xhr.setRequestHeader(\"Content-Type\", \"application/json;charset=utf-8\");\r\n\r\n    let tempData = msg.body;\r\n    console.log(\"http.POST 发送数据\", glGame.gameNet.getWebHost(), route, tempData)\r\n    \r\n    if (msg.body && !msg.head.key && !resend) {\r\n        let data = {};\r\n        data = glGame.encrypt.getEncodeData(msg.body);\r\n        msg.body = data[\"data\"];\r\n        msg.head.key = data[\"dataKey\"];\r\n    }\r\n    xhr.send(JSON.stringify(msg));\r\n}\r\n\r\nhttp.GET = function (route, msg) {\r\n    let xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n            console.log(\"Status: Got GET response! \" + xhr.statusText);\r\n        } else {\r\n            console.log(\"Status: fail GET response! \" + xhr.statusText);\r\n        }\r\n    };\r\n    // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n    // method and before calling the send() method.\r\n    xhr.timeout = 5000;\r\n    xhr.onerror = (error) => {\r\n        console.log(\"客户端出错啦webGetReq\")\r\n    }\r\n    xhr.open(\"POST\", glGame.gameNet.getWebHost(), msg);\r\n    xhr.send();\r\n    console.log(\"发送=\", route, msg)\r\n}\r\n\r\nmodule.exports = function () {\r\n    if (!g_instance) {\r\n        g_instance = new HTTP();\r\n    }\r\n    return g_instance;\r\n}();"]}