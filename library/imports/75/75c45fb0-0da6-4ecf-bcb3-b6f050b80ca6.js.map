{"version":3,"sources":["assets\\modules\\games\\nfish\\script\\prefab\\nfish_Bg.js"],"names":["CONST","require","glGame","baseclass","extend","properties","onLoad","registerEvent","logic","getInstance","index","isSshockIng","time","wateSpeed","start","emitter","on","clientEvent","changeBackGround","changeBackGroundHandler","seaWaveChangeBg","seaWaveChangeBgHandler","onSshock","onShockHandler","unregisterEvent","off","update","dt","material","setProperty","setResolution","cc","v2","node","width","height","SshockTime","oldPos","position","getComponent","Widget","enabled","runAction","repeatForever","sequence","moveTo","x","y","scheduleOnce","stopAllActions","setPosition","bgIndex","MaxBgNum","i","getChildByName","active","Sprite","getMaterial","emit","fishBgSound","old","Number","old_Bg","new_Bg","winSizeWidth","getIsRotation","winSize","callFunc","OnDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["/***\r\n *  捕鱼：桌子BG\r\n * **/\r\nlet CONST = require(\"nfishConst\");\r\nglGame.baseclass.extend({\r\n    properties: {\r\n\r\n    },\r\n    onLoad () {\r\n        this.registerEvent();\r\n        this.logic = require(\"nfishlogic\").getInstance();//数据中心\r\n        this.index = 0;\r\n        this.isSshockIng = false;\r\n        this.time = 0;//水波波动时间\r\n        this.wateSpeed = 1.5;//水波波动参数\r\n    },\r\n    start () {\r\n    },\r\n    //注册监听\r\n    registerEvent() {\r\n        glGame.emitter.on(CONST.clientEvent.changeBackGround,this.changeBackGroundHandler,this);\r\n        glGame.emitter.on(CONST.clientEvent.seaWaveChangeBg,this.seaWaveChangeBgHandler,this);\r\n        glGame.emitter.on(CONST.clientEvent.onSshock,this.onShockHandler,this);                     //震动屏幕\r\n    },\r\n    //反注册监听\r\n    unregisterEvent() {\r\n        glGame.emitter.off(CONST.clientEvent.changeBackGround,this);\r\n        glGame.emitter.off(CONST.clientEvent.seaWaveChangeBg,this);\r\n        glGame.emitter.off(CONST.clientEvent.onSshock,this);\r\n    },\r\n    //水波赋值\r\n    update(dt) {\r\n        if(this.material){\r\n            this.time += dt * this.wateSpeed;\r\n            this.material.setProperty(\"time\", this.time);\r\n        }\r\n    },\r\n    //设置水波波及范围参数\r\n    setResolution() {\r\n        this.material.setProperty(\r\n            \"resolution\",\r\n            cc.v2(this.node.width, this.node.height)\r\n        );\r\n    },\r\n    //震动 - 通用震动库\r\n    onShockHandler(){\r\n        if(this.isSshockIng)return;\r\n        const SshockTime = 0.8;\r\n        this.isSshockIng = true;\r\n        this.oldPos = this.node.position;\r\n        this.node.getComponent(cc.Widget).enabled = false;\r\n        this.node.runAction(cc.repeatForever(cc.sequence(    cc.moveTo(0.02, cc.v2(this.oldPos.x+5, this.oldPos.y+7)), cc.moveTo(0.02, cc.v2(this.oldPos.x-6, this.oldPos.y+7)),    cc.moveTo(0.02, cc.v2(this.oldPos.x-13, this.oldPos.y+3)), cc.moveTo(0.02, cc.v2(this.oldPos.x+3, this.oldPos.y-6)),    cc.moveTo(0.02, cc.v2(this.oldPos.x-5, this.oldPos.y+5)), cc.moveTo(0.02, cc.v2(this.oldPos.x+2, this.oldPos.y-8)),    cc.moveTo(0.02, cc.v2(this.oldPos.x-8, this.oldPos.y-10)), cc.moveTo(0.02, cc.v2(this.oldPos.x+3, this.oldPos.y+10)),    cc.moveTo(0.02, cc.v2(this.oldPos.x+0, this.oldPos.y+0)))));\r\n        this.scheduleOnce(() => {\r\n            this.node.stopAllActions();\r\n            this.node.setPosition(this.oldPos);\r\n            this.node.getComponent(cc.Widget).enabled = true;\r\n            this.isSshockIng = false;\r\n        }, SshockTime);\r\n    },\r\n    //常规更换背景\r\n    changeBackGroundHandler(bgIndex){\r\n        const MaxBgNum = 4;\r\n        for(let i=0;i<MaxBgNum;i++){\r\n            this.node.getChildByName(\"ui_Bg\"+i).active = bgIndex == i;\r\n            if(bgIndex == i){\r\n                this.material = this.node.getChildByName(\"ui_Bg\"+i).getComponent(cc.Sprite).getMaterial(0);\r\n                this.setResolution();\r\n            }\r\n        }\r\n        this.index = bgIndex;\r\n        glGame.emitter.emit(CONST.clientEvent.fishBgSound,this.index);\r\n    },\r\n    //海浪更换背景\r\n    seaWaveChangeBgHandler(bgIndex){\r\n        let old = Number(\"\"+this.index);\r\n        this.index  = bgIndex;\r\n        glGame.emitter.emit(CONST.clientEvent.fishBgSound,this.index);\r\n        let old_Bg = this.node.getChildByName(\"ui_Bg\"+old);\r\n        let new_Bg = this.node.getChildByName(\"ui_Bg\"+this.index);\r\n        this.material = new_Bg.getComponent(cc.Sprite).getMaterial(0);\r\n        this.setResolution();\r\n        old_Bg.stopAllActions();\r\n        new_Bg.stopAllActions();\r\n        const winSizeWidth  = this.logic.getIsRotation() ? cc.winSize.width : -cc.winSize.width;\r\n        new_Bg.x = this.logic.getIsRotation() ? -winSizeWidth : cc.winSize.width;\r\n        new_Bg.active = true;\r\n        new_Bg.runAction(cc.moveTo(1.01,cc.v2(0,new_Bg.y)));\r\n        old_Bg.runAction(cc.sequence(cc.moveTo(1.01,cc.v2(winSizeWidth,old_Bg.y)),cc.callFunc(()=>{\r\n            old_Bg.active = false;\r\n            old_Bg.x = 0;\r\n        })));\r\n    },\r\n    OnDestroy() {\r\n        this.unregisterEvent();\r\n    },\r\n});"]}