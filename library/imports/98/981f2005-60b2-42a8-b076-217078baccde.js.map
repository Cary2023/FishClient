{"version":3,"sources":["assets\\modules\\games\\nfish\\script\\prefab\\nfish_Bullet.js"],"names":["CONST","require","glGame","baseclass","extend","onLoad","initBulletAtlas","f","fish_Atlas","logic","getInstance","data","isInit","speed","leftBorder","rightBorder","topBorder","downBorder","lockCollder","unLockTime","leftCollisionTimes","buttomeCollisionTimes","rightCollisionTimes","topCollisionTimes","moveEndTimeBoom","lockStatusTime","bulletOnCollisionEnterMaxTime","BulletMaxTime","missile","missileFrequency","missileTime","missilePre","missileIndex","missileMaxIndex","node","color","cc","Color","removeBullet","cannonType","CannonType","Normal","Missile","currentBullteType","Not","emitter","emit","clientEvent","clearSpecialBulletPool","seatNum","fishSound","onSpecialBulletExp","Number","uid","pos","v2","position","x","y","getComponent","BoxCollider","enabled","bulletPool","put","initBullet","res","spr","Sprite","collider","placeOfBirth","angle","level","gunLevel","cannonLevel","PartialBomb","spriteFrame","getSpriteFrame","SpecialBulletSkin","MissileSpeed","error","Lightning","size","getOriginalSize","tag","bulletId","name","lock","winSize","width","height","zIndex","nodeZIndex","zIndexBullet","macro","MAX_ZINDEX","serverTime","undefined","createTime","nmpos","Math","random","setPosition","fixSideRunOver","Width","Height","MaxAngle","MaxDirectionHALFArg","HALF","DirectionX","DirectionY","ceil","bulletMove","dt","getIsRotation","sin","PI","cos","update","sendHitFish","NoonFish","MissileChangeRed","c","MissileRedMaxValue","MissileRedSpeed","MissileRedValue","fish","parent","getChildByName","ui_physicalPool","warn","UnLockMaxTime","deathFish","onCollisionEnter","other","self","isPool","effectPosition","curWaitTime","Date","now","hitMax","playFishnetEffect","gunType","id","getFishID","userMissileHitFish","CannonOpention","MissileHit","currFishId","hit","user","userID","bullteNum","oprEvent","NormalHit","isEnterRoom","gameNet","send_msg","room","getPlayerOp","scenetag","FISH2","op","log","OnDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["/***\r\n *  捕鱼：子弹\r\n * **/\r\nlet CONST = require(\"nfishConst\");\r\nglGame.baseclass.extend({\r\n    onLoad () {\r\n    },\r\n    //初始化图集\r\n    initBulletAtlas(f){\r\n        this.fish_Atlas  = f;//子弹 图集\r\n        this.logic       = require(\"nfishlogic\").getInstance();//数据中心\r\n        this.data        = null;\r\n        this.isInit      = false;\r\n        this.speed       = 1500; //子弹速度\r\n        this.leftBorder  = 0;    //左边界\r\n        this.rightBorder = 0;    //右边界\r\n        this.topBorder   = 0;    //上边界\r\n        this.downBorder  = 0;    //下边界\r\n        this.lockCollder = 1;\r\n        this.unLockTime  = 0;\r\n        this.leftCollisionTimes     = 0;//防止卡边计数器\r\n        this.buttomeCollisionTimes  = 0;//防止卡边计数器\r\n        this.rightCollisionTimes    = 0;//防止卡边计数器\r\n        this.topCollisionTimes      = 0;//防止卡边计数器\r\n        this.moveEndTimeBoom        = 0;//仙剑移动爆炸\r\n        this.lockStatusTime         = 0;//带锁定属性的存活时间\r\n        this.bulletOnCollisionEnterMaxTime = CONST.BulletMaxTime;\r\n        this.missile                = false;//是否是仙剑，如果是那么播放帧动画\r\n        this.missileFrequency       = 0.009;\r\n        this.missileTime            = 0;\r\n        this.missilePre             = \"missile_\";//仙剑 pre\r\n        this.missileIndex           = 0;//仙剑 开始点\r\n        this.missileMaxIndex        = 11;//仙剑 最大点\r\n        this.node.color             = cc.Color(255,255,255,255);\r\n    },\r\n    //销毁子弹\r\n    removeBullet(){\r\n        if(this.data.cannonType != CONST.CannonType.Normal){\r\n            if(this.data.cannonType == CONST.CannonType.Missile){//解锁发射锁定   仙剑\r\n                this.logic.currentBullteType = CONST.CannonType.Not;\r\n            }else{\r\n                // cc.error(\"========= delete ======== 销毁 cannonType \"+this.data.cannonType)\r\n                glGame.emitter.emit(CONST.clientEvent.clearSpecialBulletPool,this.data.seatNum);\r\n            }\r\n        }\r\n        //播放仙剑 爆炸\r\n        if(this.data.cannonType == CONST.CannonType.Missile){\r\n            glGame.emitter.emit(CONST.clientEvent.fishSound,\"MissileBoom\");\r\n            // if(this.logic.specialBulletPool[this.data.seatNum] != null){\r\n            //     cc.warn(\">>>>>仙剑 爆炸 \"+this.data.seatNum)\r\n            // }\r\n            glGame.emitter.emit(CONST.clientEvent.onSpecialBulletExp,{cannonType:Number(this.data.cannonType+\"\"),uid:Number(this.data.uid+\"\"),pos:cc.v2(this.node.position.x,this.node.position.y)});\r\n        }\r\n        this.data        = null;\r\n        this.isInit      = false;\r\n        this.speed       = 0;    //子弹速度\r\n        this.leftBorder  = 0;    //左边界\r\n        this.rightBorder = 0;    //右边界\r\n        this.topBorder   = 0;    //上边界\r\n        this.downBorder  = 0;    //下边界\r\n        this.data        = null;\r\n        this.node.getComponent(cc.BoxCollider).enabled = false;\r\n        if(this.logic){\r\n            this.logic.bulletPool.put(this.node);\r\n        }\r\n        this.logic       = null;//数据中心\r\n        // this.node.destroy();\r\n    },\r\n    initBullet(res) {\r\n        this.data           = res;\r\n        this.lockCollder    = 1;\r\n        let spr             = this.node.getComponent(cc.Sprite);\r\n        let collider        = this.node.getComponent(cc.BoxCollider);\r\n        collider.enabled    = true;\r\n        this.node.position  = this.data.placeOfBirth;\r\n        this.node.angle     = this.data.angle; //初始化角速度\r\n        let level           = this.data.gunLevel == null ? this.data.cannonLevel : this.data.gunLevel;\r\n        if(level == null || level == 0){\r\n            level = 1;\r\n        }\r\n        this.speed          = 2500;\r\n        if(this.data.cannonType == CONST.CannonType.PartialBomb){\r\n            spr.spriteFrame     = this.fish_Atlas.getSpriteFrame(CONST.SpecialBulletSkin.PartialBomb);//炎爆专用\r\n        }else if(this.data.cannonType == CONST.CannonType.Missile) {\r\n            spr.spriteFrame     = this.fish_Atlas.getSpriteFrame(this.missilePre+this.missileIndex);//仙剑专用\r\n            this.missile = true;\r\n            const MissileSpeed  = 2750;\r\n            this.speed          = MissileSpeed;\r\n            if(spr.spriteFrame == null){\r\n                cc.error(\">>获取仙剑子弹图集失败 key: \"+this.missilePre+this.missileIndex);\r\n            }\r\n        }else if(this.data.cannonType == CONST.CannonType.Lightning) {\r\n            spr.spriteFrame     = this.fish_Atlas.getSpriteFrame(CONST.SpecialBulletSkin.Lightning);//闪电专用\r\n        }else{\r\n            spr.spriteFrame     = this.fish_Atlas.getSpriteFrame(CONST.SpecialBulletSkin.Normal+level);\r\n        }\r\n        if(spr.spriteFrame == null) {\r\n            cc.error(\"该子弹无法获取到级别，可能 res 结构有误 : \",this.data);\r\n        }else{\r\n            collider.size       = spr.spriteFrame.getOriginalSize();\r\n        }\r\n        collider.tag        =  \"bullet_\"+this.data.bulletId;\r\n        this.node.name      =  this.data.lock ? this.data.lock+\"\" : CONST.SpecialBulletSkin.Normal+this.data.seatNum+\"_\"+collider.tag;\r\n        this.rightBorder    = cc.winSize.width/2;                     //右边界\r\n        this.leftBorder     = -cc.winSize.width/2;                    //左边界\r\n        this.topBorder      = cc.winSize.height/2;                    //上边界\r\n        this.downBorder     = -cc.winSize.height/2;                   //下边界\r\n        let zIndex          = CONST.nodeZIndex.zIndexBullet + this.node.zIndex;\r\n        this.node.zIndex    = zIndex > cc.macro.MAX_ZINDEX ? cc.macro.MAX_ZINDEX -1 : zIndex;\r\n        this.isInit         = true;\r\n        //状态同步\r\n        if(res.serverTime != undefined && res.createTime != undefined){\r\n            let nmpos = cc.v2((cc.winSize.width/2) * Math.random(),(cc.winSize.height/2) * Math.random());\r\n            this.node.setPosition(nmpos);\r\n        }\r\n    },\r\n    //解决卡边重置\r\n    fixSideRunOver(){\r\n        const Width = cc.winSize.width/2;\r\n        const Height = cc.winSize.height/2;\r\n        const MaxAngle = 180;\r\n        const MaxDirectionHALFArg = 100;\r\n        const HALF = 50;\r\n        const DirectionX = (Math.random() * MaxDirectionHALFArg) > HALF ? -1 : 1;\r\n        const DirectionY = (Math.random() * MaxDirectionHALFArg) > HALF ? -1 : 1;\r\n        this.node.x = Math.ceil(Math.random() * Width * DirectionX);\r\n        this.node.y = Math.ceil(Math.random() * Height * DirectionY);\r\n        this.node.angle = Math.ceil(Math.random() * MaxAngle);\r\n    },\r\n    bulletMove(dt){\r\n        //是否在屏幕\r\n        if(this.node.x > this.rightBorder){\r\n\r\n            this.leftCollisionTimes     = 0;//重置计数器\r\n            this.buttomeCollisionTimes  = 0;//重置计数器\r\n            this.topCollisionTimes      = 0;//重置计数器\r\n\r\n            if(this.rightCollisionTimes > 1){\r\n                this.fixSideRunOver();\r\n                this.rightCollisionTimes=0;\r\n            }\r\n            this.rightCollisionTimes++;\r\n\r\n            this.node.angle = -this.node.angle;\r\n        }else if(this.node.x < this.leftBorder){\r\n\r\n            this.buttomeCollisionTimes  = 0;//重置计数器\r\n            this.rightCollisionTimes    = 0;//重置计数器\r\n            this.topCollisionTimes      = 0;//重置计数器\r\n\r\n            if(this.leftCollisionTimes > 1){\r\n                this.fixSideRunOver();\r\n                this.leftCollisionTimes = 0;\r\n            }\r\n            this.leftCollisionTimes++;\r\n\r\n            this.node.angle = -this.node.angle;\r\n        }\r\n        if(this.node.y > this.topBorder){\r\n\r\n            this.leftCollisionTimes     = 0;//重置计数器\r\n            this.buttomeCollisionTimes  = 0;//重置计数器\r\n            this.rightCollisionTimes    = 0;//重置计数器\r\n\r\n            if(this.topCollisionTimes > 1){\r\n                if(this.logic != null && this.logic.getIsRotation()){\r\n                    this.fixSideRunOver();//正上方不处理卡边问题\r\n                }\r\n                this.topCollisionTimes = 0;\r\n            }\r\n            this.topCollisionTimes++;\r\n\r\n            this.node.angle = 180-this.node.angle;\r\n        }else if(this.node.y < this.downBorder){\r\n\r\n            this.leftCollisionTimes     = 0;//重置计数器\r\n            this.rightCollisionTimes    = 0;//重置计数器\r\n            this.topCollisionTimes      = 0;//重置计数器\r\n            if(this.buttomeCollisionTimes > 1){\r\n                if(this.logic != null && !this.logic.getIsRotation()){\r\n                    this.fixSideRunOver();//正下方不处理卡边问题\r\n                }\r\n                this.buttomeCollisionTimes = 0;\r\n            }\r\n            this.buttomeCollisionTimes++;\r\n\r\n            this.node.angle = 180-this.node.angle;\r\n        }\r\n        this.node.x += dt * this.speed * Math.sin(-this.node.angle / 180 * Math.PI);\r\n        this.node.y += dt * this.speed * Math.cos(-this.node.angle / 180 * Math.PI);\r\n    },\r\n    update(dt){\r\n        this.bulletOnCollisionEnterMaxTime -= dt;\r\n        if(this.bulletOnCollisionEnterMaxTime < 0 && this.data.cannonType == CONST.CannonType.Normal){//38秒 都没有碰撞\r\n            this.bulletOnCollisionEnterMaxTime = CONST.BulletMaxTime;\r\n            this.sendHitFish(CONST.NoonFish);\r\n            this.removeBullet();\r\n        }\r\n        if(this.moveEndTimeBoom > 0){\r\n            this.moveEndTimeBoom -= dt;\r\n\r\n            if(this.moveEndTimeBoom < CONST.MissileChangeRed){\r\n                if(this.node.c == undefined)this.node.c = CONST.MissileRedMaxValue;\r\n                this.node.color = cc.color(CONST.MissileRedMaxValue,this.node.c,this.node.c,CONST.MissileRedMaxValue);//慢慢变红\r\n                this.node.c -= dt*CONST.MissileRedSpeed;\r\n                if(this.node.c <= CONST.MissileRedValue){\r\n                    this.node.c = CONST.MissileRedValue;\r\n                }\r\n            }\r\n            if(this.moveEndTimeBoom < 1){\r\n                //删除自己\r\n                this.removeBullet();\r\n                this.moveEndTimeBoom = 0;\r\n            }\r\n        }\r\n        if(this.isInit){\r\n            this.bulletMove(dt);\r\n        }\r\n        if(this.unLockTime > 0 && this.data != null){\r\n            this.unLockTime += dt;\r\n            if(this.unLockTime > 0.5){\r\n                this.data.lock = null;\r\n            }\r\n        }\r\n        if(this.data && this.data.lock != null){\r\n            this.lockStatusTime += dt;\r\n            let fish = this.node.parent.getChildByName(this.data.lock+\"\");\r\n            if(!fish){\r\n                let seatNum = Number(this.data.seatNum);\r\n                if(this.logic.seatNum == seatNum){\r\n                    if(this.logic.ui_physicalPool != this.node.parent){\r\n                        cc.error(\">>>>> 物理池 变异 无法找到鱼 \")\r\n                    }\r\n                    cc.warn(\">> ==锁定找不到鱼== >> \"+this.data.lock)\r\n                }\r\n                //0.5-0.3    (0.2秒后 解锁)\r\n                this.unLockTime = CONST.UnLockMaxTime;\r\n            }\r\n            if(this.lockStatusTime > 0.8){//锁定状态下超过0.8秒解除锁定\r\n                this.data.lock = null;\r\n            }\r\n        }\r\n        if(this.missile){\r\n            this.missileTime += dt;\r\n            if(this.missileTime > this.missileFrequency){\r\n                this.missileTime = 0;\r\n                this.node.getComponent(cc.Sprite).spriteFrame = this.fish_Atlas.getSpriteFrame(this.missilePre+this.missileIndex);\r\n                this.missileIndex   ++;\r\n                if(this.missileIndex > this.missileMaxIndex){\r\n                    this.missileIndex = 0;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    deathFish(tag){\r\n        if(this.data){\r\n            if(Number(this.data.lock) == Number(tag)){\r\n                this.data.lock = null;\r\n            }\r\n        }\r\n    },\r\n    //进入碰撞检测\r\n    onCollisionEnter(other, self) {\r\n        if(this.isPool){\r\n            cc.error(\">>>使用对象池的对象 进入碰撞\")\r\n        }\r\n        if(this.data == undefined || this.lockCollder == 0){//数据丢失不参与碰撞检测\r\n            if(this.isPool){\r\n                cc.error(\">>>使用对象池的对象出错了 。 1 \")\r\n            }\r\n            return;\r\n        }\r\n        let effectPosition;\r\n        this.bulletOnCollisionEnterMaxTime = CONST.BulletMaxTime;\r\n        if(this.data.cannonType == CONST.CannonType.Missile){                //仙剑子弹\r\n            if(this.logic.seatNum == this.data.seatNum){\r\n                this.logic.curWaitTime = Date.now();//重置时间\r\n            }\r\n            effectPosition = other.node.position;\r\n            if(this.data.hitMax > 0){\r\n                glGame.emitter.emit(CONST.clientEvent.playFishnetEffect,{cannonType:Number(\"\"+this.data.cannonType),position:effectPosition,gunLevel:this.data.gunLevel,gunType:this.data.gunType,zIndex:this.node.zIndex});\r\n                let id = other.node.getComponent(\"nfish_Unit\").getFishID();\r\n                glGame.emitter.emit(CONST.clientEvent.fishSound,\"MissileHit\");\r\n                this.userMissileHitFish(id,CONST.CannonOpention.MissileHit);\r\n                this.data.hitMax --;\r\n            }\r\n            if(this.data.hitMax == 0){\r\n                this.data.hitMax = -1;\r\n                //开始倒计时 结束后爆炸\r\n                this.moveEndTimeBoom = 3;\r\n            }\r\n        }else{  //普通子弹和三个特殊子弹的逻辑（不包括龙溪）\r\n            let currFishId = Number(other.tag);\r\n            if (this.data.lock != null) {//锁定\r\n                if(currFishId == Number(this.data.lock)){//碰撞到目标鱼\r\n                    this.lockCollder = 0;\r\n                }else{\r\n                    // cc.error(\">> currFishId \",currFishId,\" my lock \",this.data.lock)\r\n                    return;\r\n                }\r\n            }else{\r\n                this.lockCollder = 0;\r\n            }\r\n            let id = other.node.getComponent(\"nfish_Unit\").getFishID();\r\n            if(this.data.seatNum == this.logic.seatNum){\r\n                other.node.getComponent(\"nfish_Unit\").hit();\r\n            }\r\n\r\n            //播放闪电、炎爆，播放完成解锁\r\n            if(this.data.cannonType == CONST.CannonType.Lightning || this.data.cannonType == CONST.CannonType.PartialBomb){\r\n                glGame.emitter.emit(CONST.clientEvent.onSpecialBulletExp,{cannonType:this.data.cannonType,uid:this.data.uid,pos:cc.v2(other.node.position.x,other.node.position.y)});\r\n            }\r\n            if(this.data.cannonType == CONST.CannonType.Normal){//普通子弹\r\n                this.sendHitFish(id);\r\n            }\r\n            if (this.data.lock != null) {//锁定使用中心点\r\n                effectPosition = other.node.position;\r\n            }else{                       //手动使用边缘 + 内 偏移量\r\n                let dt = 0.028\r\n                // let ux = this.node.x + dt * this.speed * Math.sin(-this.node.angle / 180 * Math.PI);\r\n                // let uy = this.node.y + dt * this.speed * Math.cos(-this.node.angle / 180 * Math.PI);\r\n                // effectPosition = cc.v2(ux,uy);\r\n                effectPosition = this.node.position;\r\n            }\r\n            if(this.data.cannonType == CONST.CannonType.Normal) {//普通子弹\r\n                glGame.emitter.emit(CONST.clientEvent.playFishnetEffect,{cannonType:Number(\"\"+this.data.cannonType),position:effectPosition,gunLevel:this.data.gunLevel,gunType:this.data.gunType,zIndex:this.node.zIndex});\r\n            }\r\n            this.removeBullet();\r\n        }\r\n    },\r\n    //发送普通子弹的碰撞鱼\r\n    sendHitFish(id){\r\n        if(this.data.cannonType == CONST.CannonType.Normal && Number(this.data.uid) == glGame.user.userID){\r\n            this.logic.bullteNum --;\r\n        }\r\n        let oprEvent = {\r\n            \"op\":CONST.CannonOpention.NormalHit,\r\n            \"fishId\": id,\r\n            \"shellId\": this.data.bulletId\r\n        };\r\n        if(this.data.uid && this.data.uid != glGame.user.userID){\r\n            oprEvent[\"uid\"] = Number(this.data.uid);\r\n            // cc.log(\">>　------ 机器人 的子弹碰撞  bulletId: \",this.data.bulletId)\r\n        }\r\n        if(this.logic.isEnterRoom){\r\n            // cc.log(\"--==-->发送普通子弹的碰撞鱼 \",oprEvent);\r\n            glGame.gameNet.send_msg(glGame.room.getPlayerOp(glGame.scenetag.FISH2),oprEvent);//子弹碰撞\r\n        }else{\r\n            cc.warn(\">>游戏未初始化无法发射\")\r\n        }\r\n    },\r\n    //发送仙剑的子弹碰撞鱼 入口\r\n    userMissileHitFish(id,op){\r\n        let oprEvent = {\r\n            \"op\":op,\r\n            \"fishIds\": [id],\r\n            \"uid\":this.data.uid\r\n        };\r\n        // cc.error(\"---仙剑撞击--- uid: \"+this.data.uid+\" fish id \"+id+\"  >> 剩余次数 \"+this.data.hitMax);\r\n        if(this.logic.isEnterRoom){\r\n            cc.log(\"--==-->发送仙剑的子弹碰撞 \",oprEvent);\r\n            glGame.gameNet.send_msg(glGame.room.getPlayerOp(glGame.scenetag.FISH2),oprEvent);//仙剑子弹碰撞\r\n        }\r\n    },\r\n    OnDestroy() {\r\n    },\r\n});"]}