{"version":3,"sources":["assets\\modules\\public\\script\\loading\\loading.js"],"names":["glGame","baseclass","extend","properties","progress","cc","ProgressBar","node_logo","Node","light","lab_percent","Label","lab_loading","coinLoading","commonLoading","onLoad","dianLiveCount","scene","director","getScene","nextSceneTag","storage","getItem","scenetag","NEXTSCENETAG","PLAZA","nextSceneName","getSceneNameByID","setloadingSprite","node","active","name","position","v2","plazaPreload","panel","preloadPlazaState","completedCount","totalCount","preloadtotal","preloadtotalMax","string","emitter","on","MESSAGE","UI","PLAZA_LOADING","plazaloading","zIndex","setProcessNext","setloadingTipsSprite","data","count","Math","floor","posX","remove","loader","onProgress","item","uuid","OnDestroy","off","onComplete","unschedule","dianAni"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n    properties: {\r\n        progress: cc.ProgressBar,\r\n        node_logo: cc.Node,\r\n        light: cc.Node,\r\n        lab_percent: cc.Label,\r\n        lab_loading: cc.Label,\r\n\r\n        coinLoading: cc.Node,\r\n        commonLoading: cc.Node,\r\n    },\r\n    onLoad() {\r\n        this.dianLiveCount = 0;     //点显示的个数\r\n\r\n        this.scene = cc.director.getScene();\r\n\r\n        this.nextSceneTag = glGame.storage.getItem(glGame.scenetag.NEXTSCENETAG) || glGame.scenetag.PLAZA;\r\n        this.nextSceneName = glGame.scene.getSceneNameByID(this.nextSceneTag.nextSceneTag);\r\n        this.setloadingSprite();\r\n        this.node.active = this.scene.name !== this.nextSceneName && this.nextSceneName !== \"login\";\r\n        this.light.position = cc.v2(-20, 0)\r\n        this.plazaPreload = (this.nextSceneName === \"plaza\" && !glGame.panel.preloadPlazaState());\r\n        this.completedCount = 0;\r\n        this.totalCount = 0;\r\n        this.preloadtotal = 0;\r\n        this.preloadtotalMax = 0;\r\n        this.progress.progress = 0;\r\n        this.lab_percent.string = '0%';\r\n        glGame.emitter.on(MESSAGE.UI.PLAZA_LOADING, this.plazaloading, this);\r\n\r\n        this.node.zIndex = 1000;\r\n        this.setProcessNext();\r\n    },\r\n    //加载界面设置不同的图片\r\n    setloadingSprite() {\r\n        if (this.scene.name == \"plaza\" && this.nextSceneName != \"login\") {\r\n            this.coinLoading.active = true;\r\n            this.commonLoading.active = false;\r\n            //播放动画\r\n        } else {\r\n            this.lab_loading.string = '正在加载中';\r\n        }\r\n    },\r\n\r\n    setloadingTipsSprite() {\r\n        this.node.active = true;\r\n        this.progress.progress = 1;\r\n        this.lab_percent.string = '100%';\r\n    },\r\n\r\n    //加载界面读条设置\r\n    plazaloading(data) {\r\n        if (data.count >= 0) this.preloadtotal = data.count - 1;\r\n\r\n        if (this.completedCount == 0 && this.preloadtotal != 0) {\r\n            this.preloadtotalMax = this.preloadtotal > this.preloadtotalMax ? this.preloadtotal * 2 : this.preloadtotalMax;\r\n            let progress = (this.preloadtotalMax / 2 - this.preloadtotal) / this.preloadtotalMax || 0;\r\n            if (progress > this.progress.progress) {\r\n                progress = progress > 1 ? 1 : progress;\r\n                this.progress.progress = progress;\r\n                this.lab_percent.string = `${Math.floor(progress * 100)}%`;\r\n                let posX = Math.floor(730 * progress)\r\n                this.light.position = cc.v2(posX - 20, 0)\r\n            }\r\n        }\r\n    },\r\n\r\n    //加载界面设置\r\n    setProcessNext() {\r\n        if (this.scene.name === \"plaza\" && this.scene.name === this.nextSceneName) {\r\n            this.remove();\r\n            return;\r\n        }\r\n\r\n        cc.loader.onProgress = (completedCount, totalCount, item) => {\r\n            this.completedCount = completedCount;\r\n            this.totalCount = totalCount;\r\n            let progress = completedCount / (this.totalCount + this.preloadtotal) || 0;\r\n            if (item && item.uuid && progress > this.progress.progress) {\r\n\r\n                progress = progress > 1 ? 1 : progress;\r\n                this.progress.progress = progress;\r\n                this.lab_percent.string = `${Math.floor(progress * 100)}%`;\r\n                let posX = Math.floor(730 * progress)\r\n                this.light.position = cc.v2(posX - 20, 0)\r\n            }\r\n\r\n        };\r\n    },\r\n    OnDestroy() {\r\n        glGame.emitter.off(MESSAGE.UI.PLAZA_LOADING, this);\r\n        cc.loader.onProgress = () => { };\r\n        cc.loader.onComplete = () => { }\r\n        this.unschedule(this.dianAni);\r\n    },\r\n});\r\n"]}