{"version":3,"sources":["assets\\modules\\public\\script\\birthday\\birthday.js"],"names":["glGame","baseclass","extend","properties","monthitem","cc","Node","monthcontent","mothScrollView","dayitem","daycontent","dayScrollView","onLoad","birthMonth","birthDay","registerEvent","on","EventType","TOUCH_END","mothtouchend","TOUCH_CANCEL","daytouchend","showBirthday","onClick","name","node","remove","birthday_cb","birthdaymask_cb","i","instantiate","parent","active","children","getComponent","Label","string","top","Layout","paddingTop","itemH","height","midPos","pos","ScrollView","getContentPosition","y","Math","floor","setContentPosition","v2","initDayUI","index","daycount","childrenCount","removeChild","panel","showErrorTip","str","emitter","emit","unRegisterEvent","OnDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 玩家个人信息界面\r\n */\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        monthitem: cc.Node,\r\n        monthcontent: cc.Node,\r\n        mothScrollView: cc.Node,\r\n        dayitem: cc.Node,\r\n        daycontent: cc.Node,\r\n        dayScrollView: cc.Node,\r\n    },\r\n    onLoad() {\r\n        this.birthMonth = 1;\r\n        this.birthDay = 1;\r\n        this.registerEvent();\r\n\r\n        this.mothScrollView.on(cc.Node.EventType.TOUCH_END, this.mothtouchend, this)\r\n        this.mothScrollView.on(cc.Node.EventType.TOUCH_CANCEL, this.mothtouchend, this)\r\n        this.dayScrollView.on(cc.Node.EventType.TOUCH_END, this.daytouchend, this)\r\n        this.dayScrollView.on(cc.Node.EventType.TOUCH_CANCEL, this.daytouchend, this)\r\n        this.showBirthday();\r\n    },\r\n\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"close\": this.remove(); break;\r\n            case \"btn_birthday\": this.birthday_cb(); break;\r\n            case \"birthday_mask\": this.birthdaymask_cb(); break;\r\n        }\r\n    },\r\n\r\n    birthdaymask_cb() {\r\n        this.remove();\r\n    },\r\n    //=======生日\r\n    showBirthday() {\r\n        for (let i = 1; i < 13; i++) {\r\n            let monthitem = cc.instantiate(this.monthitem);\r\n            monthitem.parent = this.monthcontent;\r\n            monthitem.active = true;\r\n            monthitem.children[0].getComponent(cc.Label).string = i >= 10 ? `${i}月` : `0${i}月`;\r\n        }\r\n\r\n        for (let i = 1; i < 32; i++) {\r\n            let dayitem = cc.instantiate(this.dayitem);\r\n            dayitem.parent = this.daycontent;\r\n            dayitem.active = true;\r\n            dayitem.children[0].getComponent(cc.Label).string = i >= 10 ? `${i}日` : `0${i}日`;\r\n        }\r\n    },\r\n    //月份滑动停止回调\r\n    mothtouchend() {\r\n        let top = this.monthcontent.getComponent(cc.Layout).paddingTop;\r\n        let itemH = this.monthitem.height;\r\n        let midPos = top + itemH / 2;                                                       //view中心点的位置\r\n        let pos = this.mothScrollView.getComponent(cc.ScrollView).getContentPosition();     //当前content的位置\r\n        let y = pos.y;\r\n\r\n        if (((y - midPos) % itemH) < itemH / 2) {\r\n            y = midPos + ((Math.floor((y - midPos) / itemH)) * itemH);\r\n        } else {\r\n            y = midPos + (Math.floor((y - midPos) / itemH) + 1) * itemH;\r\n        }\r\n\r\n        if ((Math.floor((y - top) / itemH) + 1) < 1) {\r\n            this.birthMonth = 1;\r\n        } else if ((Math.floor((y - top) / itemH) + 1) > 12) {\r\n            this.birthMonth = 12;\r\n        } else {\r\n            this.birthMonth = Math.floor((y - top) / itemH) + 1;\r\n        }\r\n\r\n        this.mothScrollView.getComponent(cc.ScrollView).setContentPosition(cc.v2(0, y));\r\n        this.initDayUI(this.birthMonth);\r\n    },\r\n    //渲染生日scrollView\r\n    initDayUI(index) {\r\n        let daycount;\r\n        if (index == 1 || index == 3 || index == 5 || index == 7 || index == 8 || index == 10 || index == 12) {\r\n            daycount = 31;\r\n        } else if (index == 4 || index == 6 || index == 9 || index == 11) {\r\n            daycount = 30;\r\n        } else {\r\n            daycount = 29\r\n        }\r\n        let childrenCount = this.daycontent.childrenCount;\r\n        if (childrenCount > 29) {\r\n            for (let i = 29; i < childrenCount;) {\r\n                if (!this.daycontent.children[i]) break;\r\n                this.daycontent.removeChild(this.daycontent.children[i]);\r\n            }\r\n        }\r\n        for (let i = 29; i < daycount; i++) {\r\n            let dayitem = cc.instantiate(this.dayitem);\r\n            dayitem.parent = this.daycontent;\r\n            dayitem.active = true;\r\n            dayitem.children[0].getComponent(cc.Label).string = `${i + 1} 日`;\r\n        }\r\n        this.daytouchend();\r\n    },\r\n    //日滑动停止回调\r\n    daytouchend() {\r\n        let top = this.daycontent.getComponent(cc.Layout).paddingTop;\r\n        let itemH = this.dayitem.height;\r\n        let midPos = top + itemH / 2; \r\n        let pos = this.dayScrollView.getComponent(cc.ScrollView).getContentPosition();\r\n        let y = pos.y;\r\n        if ((y - midPos) < 0) {\r\n            y = midPos + ((Math.floor((y - midPos) / itemH) + 1) * itemH);\r\n        } else if (((y - midPos) % itemH) < itemH / 2) {\r\n            y = midPos + ((Math.floor((y - midPos) / itemH)) * itemH);\r\n        } else {\r\n            y = midPos + (Math.floor((y - midPos) / itemH) + 1) * itemH;\r\n        }\r\n\r\n        if ((Math.floor((y - top) / itemH) + 1) < 1) {\r\n            this.birthDay = 1;\r\n        } else if ((Math.floor((y - top) / itemH) + 1) > this.daycontent.childrenCount) {\r\n            this.birthDay = this.daycontent.childrenCount;\r\n        } else {\r\n            this.birthDay = Math.floor((y - top) / itemH) + 1;\r\n        }\r\n        this.dayScrollView.getComponent(cc.ScrollView).setContentPosition(cc.v2(0, y));\r\n    },\r\n    //点击生日确定\r\n    birthday_cb() {\r\n        if (this.birthMonth == 1 || this.birthMonth == 3 || this.birthMonth == 5 || this.birthMonth == 7\r\n            || this.birthMonth == 8 || this.birthMonth == 10 || this.birthMonth == 12) {\r\n            if (this.birthDay > 31) return glGame.panel.showErrorTip(\"日期格式错误！\");\r\n        }\r\n        else if (this.birthMonth == 4 || this.birthMonth == 6 || this.birthMonth == 9 || this.birthMonth == 11) {\r\n            if (this.birthDay > 30) return glGame.panel.showErrorTip(\"日期格式错误！\");\r\n        } else {\r\n            if (this.birthDay > 29) return glGame.panel.showErrorTip(\"日期格式错误！\");\r\n        }\r\n        let str = `${this.birthMonth}_${this.birthDay}`\r\n        glGame.emitter.emit(\"editBirthDay\", str);\r\n        this.remove();\r\n    },\r\n\r\n    // 注册界面监听事件\r\n    registerEvent() {\r\n    },\r\n    // 销毁界面监听事件\r\n    unRegisterEvent() {\r\n    },\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n});\r\n"]}