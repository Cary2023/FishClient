{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\setting\\settingSelectMusic.js"],"names":["glGame","baseclass","extend","properties","content","cc","Node","item","onLoad","netMusic","localMusic","localCount","audio","musicList","length","i","name","audioMap","bgName","storage","getItem","index","bInit","reqBackgroundMusic","OnClickToggle","event","buttonName","node","buttonNode","playLoadSoundEffectByPath","onClick","click_itemAudio","click_download","initLocalMusic","count","instantiate","active","parent","getChildByName","getComponent","Label","string","setToggle","initNetMusic","data","url","sys","isNative","audioloader","isLoaded","isLoading","setPercent","getPercent","loadAudio","onLoadProgress","bind","allLength","height","Math","ceil","scorllview","ScrollView","scrollToTop","hideAllSpine","setItem","playPathBGM","then","audioClip","playBGM","reqBackgroundMusicDownloadsInc","id","k","percent","info","progress","download","ProgressBar","Toggle","isChecked","gameNet","send_msg","page","pageSize","route","msg","OnDestroy","clearCallback"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 设置\r\n */\r\n\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        content: cc.Node,\r\n        item: cc.Node,\r\n    },\r\n\r\n    onLoad() {\r\n        this.netMusic = null;                       // 网络音乐列表\r\n        this.localMusic = [];                       // 本地音乐列表\r\n\r\n        let localCount = glGame.audio.musicList.length;\r\n        for(let i = 0; i < localCount; i++) {\r\n            this.localMusic[i] = {name: glGame.audio.musicList[i]}\r\n        }\r\n\r\n        this.audioMap = {};\r\n        this.bgName = glGame.storage.getItem(\"bgName\") || { audio: this.localMusic[0].name };\r\n        this.index = 0;\r\n        this.bInit = false;\r\n        this.reqBackgroundMusic();\r\n    },\r\n\r\n    OnClickToggle(event) {\r\n        if(!this.bInit) return;\r\n        let buttonName = event.node.name;\r\n        let buttonNode = event.node;\r\n        glGame.audio.playLoadSoundEffectByPath(\"select\");\r\n        this.onClick(buttonName, buttonNode);\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"toggle\":\r\n                this.click_itemAudio(node);\r\n                break;\r\n            case \"download\":\r\n                this.click_download(node)\r\n                break;\r\n        }\r\n    },\r\n\r\n    // 初始化本地音乐列表\r\n    initLocalMusic() {\r\n        let localMusic = this.localMusic;\r\n        let count = localMusic.length;\r\n\r\n        for(let i = 0; i < count; i++) {\r\n            let item = cc.instantiate(this.item);\r\n            item.active = true;\r\n            item.index = i;\r\n            item.parent = this.content;\r\n            item.getChildByName(\"title\").getComponent(cc.Label).string = localMusic[i].name;\r\n            item.getChildByName(\"download\").active = false;\r\n            item.getChildByName(\"download\").index = i;\r\n            if(this.bgName.audio == localMusic[i].name) {\r\n                this.setToggle(item);\r\n                this.index = i;\r\n            }\r\n\r\n            this.audioMap[localMusic[i].name] = {name: localMusic[i], node: item};\r\n        }\r\n    },\r\n\r\n    // 初始化网络音乐列表\r\n    initNetMusic() {\r\n        let netMusic = this.netMusic.data;\r\n        let localCount = this.localMusic.length;\r\n        let count = netMusic.length;\r\n\r\n        for (let i = 0; i < count; i++) {\r\n            let item = cc.instantiate(this.item);\r\n            item.active = true;\r\n            item.index = localCount + i;\r\n            item.parent = this.content;\r\n            item.getChildByName(\"title\").getComponent(cc.Label).string = netMusic[i].name; \r\n            item.getChildByName(\"download\").index = localCount + i;\r\n\r\n            let url = netMusic[i].url;\r\n            if(this.bgName.audio == url) {\r\n                this.setToggle(item);\r\n                this.index = localCount + i;\r\n            }\r\n\r\n            if(cc.sys.isNative) {\r\n                if(!glGame.audioloader.isLoaded(url)) {\r\n                    if(glGame.audioloader.isLoading(url)) {\r\n                        this.setPercent(url, glGame.audioloader.getPercent(url));\r\n                        glGame.audioloader.loadAudio(url, this.onLoadProgress.bind(this));\r\n                    } else {\r\n                        item.getChildByName(\"download\").active = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.audioMap[netMusic[i].url] = {data: netMusic[i], node: item};\r\n        }\r\n\r\n        let allLength = localCount + count;\r\n        let height = Math.ceil(allLength / 2) * 128;\r\n        this.content.height = height;\r\n        let scorllview = this.node.getChildByName(\"scrollview\").getComponent(cc.ScrollView);\r\n        scorllview.scrollToTop();\r\n    },\r\n\r\n    click_itemAudio(node) {\r\n        if(!this.bInit) {\r\n            return false;\r\n        }\r\n\r\n        let localCount = this.localMusic.length;\r\n        let musicList = this.netMusic.data;\r\n        let index = node.index; \r\n        this.index = index;\r\n\r\n        this.hideAllSpine();\r\n        node.getChildByName(\"sp_play\").active = true;\r\n\r\n        if(index < localCount) {\r\n            glGame.storage.setItem(\"bgName\", {audio: this.localMusic[index].name});\r\n            glGame.audio.playPathBGM();\r\n        } else {\r\n            let url = musicList[node.index - localCount].url;\r\n            glGame.audioloader.loadAudio(url, this.onLoadProgress.bind(this)).then((audioClip)=> {\r\n                if(this.index != index) return;\r\n                glGame.storage.setItem(\"bgName\", {audio: url, netMusic: true})\r\n                glGame.audio.playBGM(audioClip);\r\n            });\r\n\r\n\r\n\r\n            if(cc.sys.isNative) {\r\n                if(!glGame.audioloader.isLoaded(url)) {\r\n                    node.getChildByName(\"process\").active = true;\r\n                }\r\n\r\n                node.getChildByName(\"download\").active = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    click_download(node) {\r\n        let localCount = this.localMusic.length;\r\n        let musicList = this.netMusic.data;\r\n        let index = node.index - localCount;\r\n\r\n        let url = musicList[index].url;\r\n\r\n        if(glGame.audioloader.isLoaded(url)) {\r\n            return;\r\n        }\r\n\r\n        if(glGame.audioloader.isLoading(url)) {\r\n            return;\r\n        }\r\n\r\n        node.getChildByName(\"Background\").active = false;\r\n        glGame.audioloader.loadAudio(url, this.onLoadProgress.bind(this));\r\n        this.reqBackgroundMusicDownloadsInc(musicList[index].id);\r\n    },\r\n\r\n    hideAllSpine() {\r\n        for(let k in this.audioMap) {\r\n            let item = this.audioMap[k];\r\n            item.node.getChildByName(\"sp_play\").active = false;\r\n        }\r\n    },\r\n\r\n    // 音乐下载进度\r\n    onLoadProgress(url, percent) {\r\n        this.setPercent(url, percent);\r\n    },\r\n\r\n    // 设置百分比\r\n    setPercent(url, percent) {\r\n        let info = this.audioMap[url];\r\n        if(!info) return;\r\n        let node = info.node;\r\n        let progress = node.getChildByName(\"process\");\r\n        let download = node.getChildByName(\"download\");\r\n\r\n        if(percent == 100) {\r\n            progress.active = false;\r\n            download.active = false;\r\n            return;\r\n        }\r\n\r\n        progress.active = true;\r\n        progress.getChildByName(\"pro\").getComponent(cc.ProgressBar).progress = percent / 100;\r\n        progress.getChildByName(\"label\").getComponent(cc.Label).string = `${percent}%`;\r\n    },\r\n\r\n    setToggle(node) {\r\n        node.getComponent(cc.Toggle).isChecked = true;\r\n        node.getChildByName(\"sp_play\").active = true;\r\n    },\r\n\r\n    reqBackgroundMusic() {\r\n        glGame.gameNet.send_msg('http.ReqBackgroundMusic', { page: 1, pageSize: 100 }, (route, msg)=> {\r\n            this.netMusic = msg;\r\n            let data = this.netMusic.data;\r\n            this.initLocalMusic();\r\n            this.initNetMusic();\r\n            this.bInit = true;\r\n        });\r\n    },\r\n\r\n    reqBackgroundMusicDownloadsInc(id) {\r\n        glGame.gameNet.send_msg('http.ReqBackgroundMusicDownloadsInc', {id: id}, (route, msg)=> {\r\n\r\n        });\r\n    },\r\n\r\n    OnDestroy() {\r\n        glGame.audioloader.clearCallback();\r\n    },\r\n});\r\n"]}