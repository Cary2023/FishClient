{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\room\\exchangeDiamond.js"],"names":["glGame","baseclass","extend","properties","exchangeBox","cc","Prefab","labCoin","Label","labDiamonds","content","Node","item","iconList","SpriteFrame","onLoad","diamondList","registerEvent","updataInfo","ReqDiamondShop","start","emitter","on","unRegisterEvent","off","string","getFixNumber","user","get","onClick","name","node","remove","click_shop","click_record","indexOf","click_item","isTourist","panel","showRegisteredGift","showSuspicious","showShop","showPanelByName","substring","index","Number","data","showPanel","str","extraGift","coin","diamond","getComponent","showMsg","ReqBuyDiamond","refreshUi","removeAllChildren","diamondItem","instantiate","active","getChildByName","Sprite","spriteFrame","Math","min","length","addChild","gameNet","send_msg","route","msg","result","showTip","tips","ROOM","GOLDNOTENOUGH","diamondId","id","addDiamond","showAwardBox","type","awardtype","DIAMOND","value","showErrorTip","EXCHANGEFAIL","value1","div","isNaN","toString","toFixed","OnDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n\r\n    properties: {\r\n        exchangeBox: cc.Prefab,\r\n        labCoin: cc.Label,\r\n        labDiamonds: cc.Label,\r\n        content: cc.Node,\r\n        item: cc.Node,\r\n        iconList: [cc.SpriteFrame],\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    onLoad() {\r\n        this.diamondList = [];\r\n        this.registerEvent();\r\n        this.updataInfo();\r\n        this.ReqDiamondShop();\r\n    },\r\n    start() {\r\n    },\r\n\r\n    // 注册界面监听事件\r\n    registerEvent() {\r\n        glGame.emitter.on(\"updateUserData\", this.updataInfo, this);\r\n    },\r\n    // 销毁界面监听事件\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(\"updateUserData\", this);\r\n    },\r\n\r\n    //刷新钻石数量\r\n    updataInfo() {\r\n        this.labCoin.string = this.getFixNumber(glGame.user.get(\"coin\"));\r\n        this.labDiamonds.string = this.getFixNumber(glGame.user.get(\"diamond\"));\r\n    },\r\n\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"btn_close\": this.remove(); break;\r\n            case \"btn_shop\": this.click_shop(); break;\r\n            case \"btn_record\": this.click_record(); break;\r\n            default:\r\n                if (name.indexOf(\"item_\") > -1) return this.click_item(name);\r\n                break;\r\n        }\r\n    },\r\n\r\n    click_shop() {\r\n        if (glGame.user.isTourist()) {\r\n            glGame.panel.showRegisteredGift(true);\r\n            return;\r\n        }\r\n        if (glGame.panel.showSuspicious(\"recharge\")) {\r\n            return;\r\n        }\r\n        glGame.panel.showShop();\r\n    },\r\n\r\n    click_record() {\r\n        glGame.panel.showPanelByName(\"diamondRecord\");\r\n    },\r\n\r\n    click_item(name) {\r\n        let string = name.substring(5), index = Number(string);\r\n        let data = this.diamondList[index];\r\n        let panel = glGame.panel.showPanel(this.exchangeBox);\r\n        let str = '';\r\n        if (data.extraGift > 0) {\r\n            str = `使用<color=#f4c404> ${this.getFixNumber(data.coin)} 金币</color>可兑换<color=#cf62fe> ${this.getFixNumber(data.diamond)} 钻石</color>,并且获得<color=#cf62fe> ${this.getFixNumber(data.extraGift)} 钻石</color>赠礼，总计<color=#cf62fe> ${this.getFixNumber(data.diamond + data.extraGift)} 钻石</color>，是否确定兑换？`;\r\n        } else {\r\n            str = `使用<color=#f4c404> ${this.getFixNumber(data.coin)} 金币</color>可兑换<color=#cf62fe> ${this.getFixNumber(data.diamond)} 钻石</color>，是否确定兑换？`;\r\n        }\r\n        panel.getComponent(panel.name).showMsg(str, () => {\r\n            this.ReqBuyDiamond(data);\r\n        })\r\n    },\r\n\r\n    refreshUi() {\r\n        this.content.removeAllChildren();\r\n        for (let index in this.diamondList) {\r\n            let data = this.diamondList[index];\r\n            if (!data) continue;\r\n            let diamondItem = cc.instantiate(this.item);\r\n            diamondItem.active = true;\r\n            diamondItem.name = `item_${index}`;\r\n            diamondItem.getChildByName(\"img_zuanshidaban\").getChildByName(\"img_icon\").getComponent(cc.Sprite).spriteFrame = this.iconList[Math.min(index, this.iconList.length - 1)]\r\n            diamondItem.getChildByName(\"diamond\").getComponent(cc.Label).string = this.getFixNumber(data.diamond)+\"钻石\";\r\n            diamondItem.getChildByName(\"coinLayout\").getChildByName(\"coin\").getComponent(cc.Label).string = this.getFixNumber(data.coin);\r\n            diamondItem.getChildByName(\"img_zuanshiredban\").active = data.extraGift > 0;\r\n            diamondItem.getChildByName(\"img_zuanshiredban\").getChildByName(\"extraGift\").getComponent(cc.Label).string = `额外赠送${this.getFixNumber(data.extraGift)}钻石`;\r\n            this.content.addChild(diamondItem);\r\n        }\r\n    },\r\n\r\n    ReqDiamondShop() {\r\n        glGame.gameNet.send_msg(\"http.ReqDiamondShop\", {}, (route, msg) => {\r\n            this.diamondList = msg.result;\r\n            this.refreshUi();\r\n        })\r\n    },\r\n\r\n    ReqBuyDiamond(data) {\r\n        if (data.coin > glGame.user.get(\"coin\")) {\r\n            glGame.panel.showTip(glGame.tips.ROOM.GOLDNOTENOUGH);\r\n            return;\r\n        }\r\n       \r\n        glGame.gameNet.send_msg(\"http.ReqBuyDiamond\", { diamondId: data.id,diamond:data.diamond,coin:data.coin, extraGift:data.extraGift}, (route, msg) => {\r\n            if (msg.result.diamond > 0) {\r\n                let addDiamond = 0;\r\n                addDiamond = msg.result.diamond - glGame.user.diamond\r\n                glGame.user.diamond = msg.result.diamond;\r\n                glGame.panel.showAwardBox(\"成功获得\", [{ type: glGame.awardtype.DIAMOND, value: this.getFixNumber(addDiamond) }]);\r\n                this.updataInfo();\r\n            }else glGame.panel.showErrorTip(glGame.tips.ROOM.EXCHANGEFAIL);\r\n        })\r\n    },\r\n\r\n\r\n    getFixNumber(value) {\r\n        let value1 = Number(value).div(10);\r\n        value = Number(value).div(100);\r\n        if (isNaN(value)) return;\r\n        if (~~value === value) {\r\n            return value.toString();\r\n        } else if (~~value1 === value1) {\r\n            return value.toFixed(1);\r\n        } else {\r\n            return value.toFixed(2);\r\n        }\r\n    },\r\n\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n\r\n})"]}