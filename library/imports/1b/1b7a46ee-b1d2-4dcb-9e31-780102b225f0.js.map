{"version":3,"sources":["assets\\modules\\public\\script\\coinArrvalTip\\coinArrvalTip.js"],"names":["glGame","showGodOfWealth","baseclass","extend","properties","caishen_spine","sp","Skeleton","lab_money","cc","RichText","node_frame","Node","node_alltip","node_tip2","audio_succeed","type","AudioClip","onLoad","game","addPersistRootNode","node","on","touchstart","touchend","emitter","onCoinChangedHandler","settingPotionHandler","MESSAGE","UI","CHANGE_SCENE_COMPLE","onChangeSceneComple","data","coinArral","start","active","res","msg","undefined","console","warn","user","set","emit","reqGetCoin","arrvalCoin","GoldTemp","offset","audio","playSoundEffect","discount","get","discount_max","exists","changeCoin","Number","getFixNumber","pos","coin","scheduleOnce","showAniHandler","updatePostion","sceneName","angle","getChildByName","getComponent","Widget","updateAlignment","position","scale","systemclass","convertInterface","x","y","actionEnd","zIndex","macro","MAX_ZINDEX","stopAllActions","string","runAction","sequence","delayTime","callFunc","setAnimation","setCompleteListener","event","value","div","toString","OnDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.showGodOfWealth = \"showGodOfWealth\";\r\n//财神到账 统一处理 入口\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        caishen_spine: sp.Skeleton,\r\n        lab_money: cc.RichText,\r\n        node_frame: cc.Node,\r\n        node_alltip: cc.Node,\r\n        node_tip2: cc.Node,\r\n        audio_succeed: {\r\n            type: cc.AudioClip,\r\n            default: null,\r\n        },\r\n    },\r\n    onLoad() {\r\n        cc.game.addPersistRootNode(this.node);\r\n        this.node.on('touchstart', this.touchstart, this);\r\n        this.node.on('touchend', this.touchend, this);\r\n        glGame.emitter.on('onCoinChanged', this.onCoinChangedHandler, this);\r\n        glGame.emitter.on(glGame.showGodOfWealth, this.settingPotionHandler, this);\r\n        glGame.emitter.on(MESSAGE.UI.CHANGE_SCENE_COMPLE, this.onChangeSceneComple, this);\r\n        this.data = null;\r\n        glGame.coinArral = this;\r\n    },\r\n    start() {\r\n        this.node.active = false;\r\n    },\r\n    onCoinChangedHandler(res) {\r\n        let msg = res;\r\n        if (this == undefined || this.node == undefined) {\r\n            console.warn(\"可能会出现无法弹出 金币到账界面\");\r\n            return;\r\n        }\r\n        //抛弃保险柜的取和存的消息，已在原有回包中做自增自减\r\n        if (msg.type == \"bankSave\" || msg.type == \"bankOut\") return;\r\n        if (msg.type == 'bindPhoneReceive') {\r\n            glGame.user.set('is_receive_register_phone_coin', 1);\r\n            glGame.emitter.emit(\"updatePlazaSwitch\");\r\n        }\r\n        glGame.user.reqGetCoin()\r\n        let arrvalCoin = glGame.user.GoldTemp(msg.offset)\r\n        if (msg.type == \"recharge\") {\r\n            glGame.audio.playSoundEffect(this.audio_succeed);\r\n            //充值之后将首冲设为状态取消设置为1；\r\n            glGame.user.set(\"userRecharge\", {\r\n                discount: glGame.user.get(\"userRecharge\").discount,\r\n                discount_max: glGame.user.get(\"userRecharge\").discount_max,\r\n                exists: 1\r\n            })\r\n\r\n            if (this.node.active == true) {\r\n                let changeCoin = Number(res.offset)\r\n                let arrvalCoin = this.getFixNumber(changeCoin)\r\n                this.settingPotionHandler({ pos: 3, coin: arrvalCoin });\r\n            } else {\r\n                this.scheduleOnce(() => {\r\n                    if (!this.data) {//如果子游戏没有处理\r\n                        let changeCoin = Number(res.offset)\r\n                        let arrvalCoin = this.getFixNumber(changeCoin)\r\n                        this.settingPotionHandler({ pos: 3, coin: arrvalCoin });\r\n                    }\r\n                }, 0.3);\r\n            }\r\n        }\r\n\r\n    },\r\n    settingPotionHandler(res) {\r\n        this.data = res;\r\n        this.showAniHandler();\r\n        this.updatePostion();\r\n    },\r\n    //场景切换的时候\r\n    onChangeSceneComple(sceneName) {\r\n        if (this.node && this.node.active) {\r\n            this.updatePostion();\r\n        }\r\n    },\r\n    updatePostion() {\r\n        if (!this.data) return;\r\n        //红包红屏专用\r\n        if (this.data.pos == 5) this.node_frame.angle = 90;\r\n        else this.node_frame.angle = 0;\r\n\r\n        let pos = this.node.getChildByName(\"pos\" + this.data.pos);\r\n        pos.getComponent(cc.Widget).updateAlignment();\r\n        if (pos) {\r\n            this.node_frame.position = pos;\r\n        }\r\n        this.node_frame.scale = glGame.systemclass.convertInterface();\r\n        if (this.node_frame.scale < 1) {\r\n            this.node_frame.x = this.node_frame.x;// * this.node_frame.scale;\r\n            this.node_frame.y = this.node_frame.y;// * this.node_frame.scale;\r\n        }\r\n    },\r\n\r\n    showAniHandler() {\r\n        if (!this.data) {\r\n            return;\r\n        }\r\n        this.actionEnd();\r\n        let coin = this.data.coin + \"\";\r\n        this.node.zIndex = cc.macro.MAX_ZINDEX;\r\n        this.node.active = true;\r\n        this.node.getComponent(cc.Widget).updateAlignment();\r\n        this.node.stopAllActions();\r\n        this.lab_money.active = true;\r\n        this.node_alltip.active = true;\r\n        this.lab_money.string = `<color=#ffffff>您充值的</color><color=#FFC200>${coin}</color><color=#ffffff>金币已到账!</color>`\r\n        this.node.runAction(cc.sequence(cc.delayTime(30), cc.callFunc(() => {\r\n            this.data = null;\r\n            this.node.active = false;\r\n            this.lab_money.active = false;\r\n            this.node_alltip.active = false;\r\n        })));\r\n    },\r\n\r\n    actionEnd() {\r\n        this.caishen_spine.setAnimation(0, \"looping\", true);\r\n        this.caishen_spine.setCompleteListener(() => { });\r\n    },\r\n    touchstart(event) {\r\n    },\r\n    touchend(event) {\r\n        this.data = null;\r\n        this.node.active = false;\r\n        this.lab_money.active = false;\r\n        this.node_alltip.active = false;\r\n        this.node.active = false\r\n    },\r\n    //返回保留两位小数的数值\r\n    getFixNumber(value) {\r\n        return (Number(value).div(100)).toString();\r\n    },\r\n    OnDestroy() {\r\n        glGame.emitter.off('onCoinChanged', this);\r\n        glGame.emitter.off(glGame.showGodOfWealth, this);\r\n        glGame.emitter.off(MESSAGE.UI.CHANGE_SCENE_COMPLE, this);\r\n    }\r\n});\r\n"]}