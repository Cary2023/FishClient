
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/frames/base/animation.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '2db5dQ9ka5GyZCjOOmz3iaL', 'animation');
// frames/base/animation.js

"use strict";

var Animation = function Animation() {
  this.resetData();
},
    animation = Animation.prototype,
    g_instance = null;

animation.MOVE_TO = 0;
animation.MOVE_DOWN = 1;
animation.MOVE_LEFT = 2;
animation.MOVE_RIGHT = 3;

animation.resetData = function () {
  //配置需要做一级界面的滚动的动画 
  //[个人中心,全民推广,活动,余额宝,返水,消息,任务,客服,提现,充值,幸运夺宝,排行榜]
  this.oneStairLisr = ["userinfo", "popularize", "announce", "yubao", "backWater", "email", "Task", "withdrawal", "shop", "luckDraw", "rank", 'setting', 'settings'];
  this.twoStairLisr = ['rule', 'help', 'record', 'setting']; //包含这些关键字的加入动效 1 （记录，帮助）详情不算内 预制体 必须带 _
  // TODO 后续游戏统一可使用关键字排查（目前命名相冲突 百人牛牛）

  this.threeStairList = ["hh_trendChartPop", "hh_playerList", "bjl_playerList", "bjl_trendChartPop"]; //子游戏内需要播放动画效果的预支

  this.oneStairTime = 0.4;
  this.twoStairTime = 0.2;
};

animation.checkInterface = function (nowNode) {
  var bolStair = false; //排查第二级动画播放预支

  this.twoStairLisr.forEach(function (element) {
    if (nowNode.name.toLowerCase().indexOf("detail") == -1) {
      if (nowNode.name.toLowerCase().indexOf(element) != -1 && nowNode.name.indexOf("_") != -1) bolStair = true;
    }
  });
  return this.oneStairLisr.find(function (name) {
    return name == nowNode.name;
  }) || this.threeStairList.find(function (name) {
    return name == nowNode.name;
  }) || bolStair;
};
/**
 * @param {object} nowNode 界面是否执行动画效果
 * @param {object} maskNode 遮罩界面传递
 * @exports 校验通用一级界面是否成功播放
 */


animation.openInterface = function (nowNode, maskNode) {
  // 校验通用一级界面是否成功播放
  if (this.openOneStairList(nowNode, maskNode)) return true;
  if (maskNode) maskNode.destroy();
  return false;
};
/**
 * @param {object} nowNode 界面是否执行动画效果
 * @param {object} maskNode 遮罩界面传递
 * @returns {boolean} 是否属于一级界面
 */


animation.openOneStairList = function (nowNode, maskNode) {
  var bolStair = this.checkInterface(nowNode);

  if (bolStair) {
    // 动画开始准备
    nowNode.scale = glGame.systemclass.convertInterface(cc.size(nowNode.width, nowNode.height));
    var nodeMask = nowNode.getChildByName("mask");
    var old = 0;

    if (nodeMask) {
      old = nodeMask.opacity + "";
      nodeMask.opacity = 0;
    }

    if (nowNode.getComponent(cc.Widget)) {
      nowNode.getComponent(cc.Widget).enabled = false;
    }

    nowNode.x = nowNode.width;
    var visibleSize = cc.view.getVisibleSize(); // 进入动画环节

    var cutAct = [],
        moveNum = 100;
    var spawnAct = cc.spawn(cc.moveTo(this.oneStairTime / 10 * 3, visibleSize.width / 2 - moveNum, visibleSize.height / 2), cc.fadeIn(this.oneStairTime / 5));
    cutAct.push(spawnAct);
    cutAct.push(cc.moveTo(this.oneStairTime / 10 * 7, visibleSize.width / 2, visibleSize.height / 2).easing(cc.easeElasticOut(2.0)));
    cutAct.push(cc.delayTime(0.15));
    cutAct.push(cc.callFunc(function () {
      if (nowNode.getComponent(cc.Widget)) {
        nowNode.getComponent(cc.Widget).enabled = true;
        nowNode.getComponent(cc.Widget).updateAlignment();
      }

      if (nodeMask) {
        nodeMask.opacity = Number(old);
        nodeMask.getComponent(cc.Widget).left = 0;
        nodeMask.getComponent(cc.Widget).right = 0;
        nodeMask.getComponent(cc.Widget).top = 0;
        nodeMask.getComponent(cc.Widget).bottom = 0;
        nodeMask.getComponent(cc.Widget).enabled = true;
        nodeMask.getComponent(cc.Widget).updateAlignment();
      }

      if (maskNode) maskNode.destroy();
      glGame.emitter.emit("".concat(nowNode.name).concat(MESSAGE.UI.ACTION_END));
    }));

    if (nodeMask) {
      nodeMask.opacity = Number(old);
      nodeMask.getComponent(cc.Widget).left -= moveNum * 2;
      nodeMask.getComponent(cc.Widget).right -= moveNum * 2;
      nodeMask.getComponent(cc.Widget).enabled = true;
      nodeMask.getComponent(cc.Widget).updateAlignment();
    }

    nowNode.runAction(cc.sequence(cutAct));
  }

  return !!bolStair;
};
/**
 * @param {object} nowNode 界面是否执行动画效果
 * @param {object} maskNode 遮罩界面传递
 * @param {object} moveType 界面出现方向
 * @returns {boolean} 是否属于一级界面
 */


animation.moveInterface = function (nowNode, maskNode, moveType) {
  // 动画开始准备
  nowNode.scale = glGame.systemclass.convertInterface(cc.size(nowNode.width, nowNode.height));
  var nodeMask = nowNode.getChildByName("mask");
  var old = 0;

  if (nodeMask) {
    old = nodeMask.opacity + "";
    nodeMask.opacity = 0;
  }

  if (nowNode.getComponent(cc.Widget)) {
    nowNode.getComponent(cc.Widget).enabled = false;
  }

  this._posBegin(nowNode, moveType);

  var visibleSize = cc.view.getVisibleSize(); // 进入动画环节

  var cutAct = [],
      moveNum = 100;
  var spawnAct = cc.spawn(this._actionBegin(moveType, moveNum), cc.fadeIn(this.oneStairTime / 5));
  cutAct.push(spawnAct);
  cutAct.push(cc.moveTo(this.oneStairTime / 10 * 7, visibleSize.width / 2, visibleSize.height / 2).easing(cc.easeElasticOut(2.0)));
  cutAct.push(cc.delayTime(0.15));
  cutAct.push(cc.callFunc(function () {
    if (nowNode.getComponent(cc.Widget)) {
      nowNode.getComponent(cc.Widget).enabled = true;
      nowNode.getComponent(cc.Widget).updateAlignment();
    }

    if (nodeMask) {
      nodeMask.opacity = Number(old);
      nodeMask.getComponent(cc.Widget).left = 0;
      nodeMask.getComponent(cc.Widget).right = 0;
      nodeMask.getComponent(cc.Widget).top = 0;
      nodeMask.getComponent(cc.Widget).bottom = 0;
      nodeMask.getComponent(cc.Widget).enabled = true;
      nodeMask.getComponent(cc.Widget).updateAlignment();
    }

    if (maskNode) maskNode.destroy();
    glGame.emitter.emit("".concat(nowNode.name).concat(MESSAGE.UI.ACTION_END));
  }));
  nowNode.runAction(cc.sequence(cutAct));

  if (nodeMask) {
    nodeMask.opacity = Number(old);
    nodeMask.getComponent(cc.Widget).left -= moveNum * 2;
    nodeMask.getComponent(cc.Widget).right -= moveNum * 2;
    nodeMask.getComponent(cc.Widget).top -= moveNum * 2;
    nodeMask.getComponent(cc.Widget).bottom -= moveNum * 2;
    nodeMask.getComponent(cc.Widget).enabled = true;
    nodeMask.getComponent(cc.Widget).updateAlignment();
  }
};
/**
 * 获取界面坐标初始化位置
 * @param {number} moveType 移动类型
 * 
 */


animation._posBegin = function (nowNode, moveType) {
  switch (moveType) {
    case this.MOVE_TO:
      nowNode.y = nowNode.height;
      break;

    case this.MOVE_DOWN:
      nowNode.y = -nowNode.height;
      break;

    case this.MOVE_LEFT:
      nowNode.x = -nowNode.width;
      break;

    case this.MOVE_RIGHT:
      nowNode.x = nowNode.width;
      break;

    default:
      console.error("moveType error");
      break;
  }
};
/**
 * 获取初始化抖动位置
 * @param {number} moveType 移动类型
 * @param {number} moveNum  移动距离
 */


animation._actionBegin = function (moveType, moveNum) {
  var movex = 0,
      movey = 0;

  switch (moveType) {
    case this.MOVE_TO:
      movey -= moveNum;
      break;

    case this.MOVE_DOWN:
      movey += moveNum;
      break;

    case this.MOVE_LEFT:
      movex += moveNum;
      break;

    case this.MOVE_RIGHT:
      movex -= moveNum;
      break;

    default:
      console.error("moveType error");
      break;
  }

  var visibleSize = cc.view.getVisibleSize();
  return cc.moveTo(this.oneStairTime / 10 * 3, visibleSize.width / 2 + movex, visibleSize.height / 2 + movey);
};

module.exports = function () {
  if (!g_instance) {
    g_instance = new Animation();
  }

  return g_instance;
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZnJhbWVzXFxiYXNlXFxhbmltYXRpb24uanMiXSwibmFtZXMiOlsiQW5pbWF0aW9uIiwicmVzZXREYXRhIiwiYW5pbWF0aW9uIiwicHJvdG90eXBlIiwiZ19pbnN0YW5jZSIsIk1PVkVfVE8iLCJNT1ZFX0RPV04iLCJNT1ZFX0xFRlQiLCJNT1ZFX1JJR0hUIiwib25lU3RhaXJMaXNyIiwidHdvU3RhaXJMaXNyIiwidGhyZWVTdGFpckxpc3QiLCJvbmVTdGFpclRpbWUiLCJ0d29TdGFpclRpbWUiLCJjaGVja0ludGVyZmFjZSIsIm5vd05vZGUiLCJib2xTdGFpciIsImZvckVhY2giLCJlbGVtZW50IiwibmFtZSIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsImZpbmQiLCJvcGVuSW50ZXJmYWNlIiwibWFza05vZGUiLCJvcGVuT25lU3RhaXJMaXN0IiwiZGVzdHJveSIsInNjYWxlIiwiZ2xHYW1lIiwic3lzdGVtY2xhc3MiLCJjb252ZXJ0SW50ZXJmYWNlIiwiY2MiLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJub2RlTWFzayIsImdldENoaWxkQnlOYW1lIiwib2xkIiwib3BhY2l0eSIsImdldENvbXBvbmVudCIsIldpZGdldCIsImVuYWJsZWQiLCJ4IiwidmlzaWJsZVNpemUiLCJ2aWV3IiwiZ2V0VmlzaWJsZVNpemUiLCJjdXRBY3QiLCJtb3ZlTnVtIiwic3Bhd25BY3QiLCJzcGF3biIsIm1vdmVUbyIsImZhZGVJbiIsInB1c2giLCJlYXNpbmciLCJlYXNlRWxhc3RpY091dCIsImRlbGF5VGltZSIsImNhbGxGdW5jIiwidXBkYXRlQWxpZ25tZW50IiwiTnVtYmVyIiwibGVmdCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwiZW1pdHRlciIsImVtaXQiLCJNRVNTQUdFIiwiVUkiLCJBQ1RJT05fRU5EIiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJtb3ZlSW50ZXJmYWNlIiwibW92ZVR5cGUiLCJfcG9zQmVnaW4iLCJfYWN0aW9uQmVnaW4iLCJ5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S0FBSyxHQUFHLENBQXZCOztBQUNBLFVBQVFQLFFBQVI7QUFDSSxTQUFLLEtBQUtsRSxPQUFWO0FBQ0l5RSxNQUFBQSxLQUFLLElBQUkvQixPQUFUO0FBQ0E7O0FBQ0osU0FBSyxLQUFLekMsU0FBVjtBQUNJd0UsTUFBQUEsS0FBSyxJQUFJL0IsT0FBVDtBQUNBOztBQUNKLFNBQUssS0FBS3hDLFNBQVY7QUFDSXNFLE1BQUFBLEtBQUssSUFBSTlCLE9BQVQ7QUFDQTs7QUFDSixTQUFLLEtBQUt2QyxVQUFWO0FBQ0lxRSxNQUFBQSxLQUFLLElBQUk5QixPQUFUO0FBQ0E7O0FBQ0o7QUFBUzRCLE1BQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjLGdCQUFkO0FBQWlDO0FBYjlDOztBQWVBLE1BQUlqQyxXQUFXLEdBQUdaLEVBQUUsQ0FBQ2EsSUFBSCxDQUFRQyxjQUFSLEVBQWxCO0FBQ0EsU0FBT2QsRUFBRSxDQUFDbUIsTUFBSCxDQUFVLEtBQUt0QyxZQUFMLEdBQW9CLEVBQXBCLEdBQXlCLENBQW5DLEVBQXNDK0IsV0FBVyxDQUFDVixLQUFaLEdBQW9CLENBQXBCLEdBQXdCNEMsS0FBOUQsRUFBcUVsQyxXQUFXLENBQUNULE1BQVosR0FBcUIsQ0FBckIsR0FBeUI0QyxLQUE5RixDQUFQO0FBQ0gsQ0FuQkQ7O0FBc0JBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsWUFBWTtBQUN6QixNQUFJLENBQUM1RSxVQUFMLEVBQWlCO0FBQ2JBLElBQUFBLFVBQVUsR0FBRyxJQUFJSixTQUFKLEVBQWI7QUFDSDs7QUFDRCxTQUFPSSxVQUFQO0FBQ0gsQ0FMRCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsibGV0XHJcbiAgICBBbmltYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5yZXNldERhdGEoKTtcclxuICAgIH0sXHJcbiAgICBhbmltYXRpb24gPSBBbmltYXRpb24ucHJvdG90eXBlLFxyXG4gICAgZ19pbnN0YW5jZSA9IG51bGw7XHJcblxyXG5hbmltYXRpb24uTU9WRV9UTyA9IDA7XHJcbmFuaW1hdGlvbi5NT1ZFX0RPV04gPSAxO1xyXG5hbmltYXRpb24uTU9WRV9MRUZUID0gMjtcclxuYW5pbWF0aW9uLk1PVkVfUklHSFQgPSAzO1xyXG5cclxuYW5pbWF0aW9uLnJlc2V0RGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIC8v6YWN572u6ZyA6KaB5YGa5LiA57qn55WM6Z2i55qE5rua5Yqo55qE5Yqo55S7IFxyXG4gICAgLy9b5Liq5Lq65Lit5b+DLOWFqOawkeaOqOW5vyzmtLvliqgs5L2Z6aKd5a6dLOi/lOawtCzmtojmga8s5Lu75YqhLOWuouacjSzmj5DnjrAs5YWF5YC8LOW5uOi/kOWkuuWunSzmjpLooYzmppxdXHJcbiAgICB0aGlzLm9uZVN0YWlyTGlzciA9IFtcInVzZXJpbmZvXCIsIFwicG9wdWxhcml6ZVwiLCBcImFubm91bmNlXCIsXHJcbiAgICAgICAgXCJ5dWJhb1wiLCBcImJhY2tXYXRlclwiLCBcImVtYWlsXCIsIFwiVGFza1wiLFxyXG4gICAgICAgIFwid2l0aGRyYXdhbFwiLCBcInNob3BcIiwgXCJsdWNrRHJhd1wiLCBcInJhbmtcIiwgJ3NldHRpbmcnLCAnc2V0dGluZ3MnXTtcclxuICAgIHRoaXMudHdvU3RhaXJMaXNyID0gWydydWxlJywgJ2hlbHAnLCAncmVjb3JkJywgJ3NldHRpbmcnXTsvL+WMheWQq+i/meS6m+WFs+mUruWtl+eahOWKoOWFpeWKqOaViCAxIO+8iOiusOW9le+8jOW4ruWKqe+8ieivpuaDheS4jeeul+WGhSDpooTliLbkvZMg5b+F6aG75bimIF9cclxuICAgIC8vIFRPRE8g5ZCO57ut5ri45oiP57uf5LiA5Y+v5L2/55So5YWz6ZSu5a2X5o6S5p+l77yI55uu5YmN5ZG95ZCN55u45Yay56qBIOeZvuS6uueJm+eJm++8iVxyXG4gICAgdGhpcy50aHJlZVN0YWlyTGlzdCA9IFtcImhoX3RyZW5kQ2hhcnRQb3BcIiwgXCJoaF9wbGF5ZXJMaXN0XCIsIFwiYmpsX3BsYXllckxpc3RcIiwgXCJiamxfdHJlbmRDaGFydFBvcFwiXTsgICAvL+WtkOa4uOaIj+WGhemcgOimgeaSreaUvuWKqOeUu+aViOaenOeahOmihOaUr1xyXG4gICAgdGhpcy5vbmVTdGFpclRpbWUgPSAwLjQ7XHJcbiAgICB0aGlzLnR3b1N0YWlyVGltZSA9IDAuMjtcclxufTtcclxuXHJcbmFuaW1hdGlvbi5jaGVja0ludGVyZmFjZSA9IGZ1bmN0aW9uIChub3dOb2RlKSB7XHJcbiAgICBsZXQgYm9sU3RhaXIgPSBmYWxzZTtcclxuICAgIC8v5o6S5p+l56ys5LqM57qn5Yqo55S75pKt5pS+6aKE5pSvXHJcbiAgICB0aGlzLnR3b1N0YWlyTGlzci5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgIGlmIChub3dOb2RlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiZGV0YWlsXCIpID09IC0xKSB7XHJcbiAgICAgICAgICAgIGlmIChub3dOb2RlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGVsZW1lbnQpICE9IC0xICYmIG5vd05vZGUubmFtZS5pbmRleE9mKFwiX1wiKSAhPSAtMSkgYm9sU3RhaXIgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICByZXR1cm4gdGhpcy5vbmVTdGFpckxpc3IuZmluZChuYW1lID0+IG5hbWUgPT0gbm93Tm9kZS5uYW1lKSB8fCB0aGlzLnRocmVlU3RhaXJMaXN0LmZpbmQobmFtZSA9PiBuYW1lID09IG5vd05vZGUubmFtZSkgfHwgYm9sU3RhaXI7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQHBhcmFtIHtvYmplY3R9IG5vd05vZGUg55WM6Z2i5piv5ZCm5omn6KGM5Yqo55S75pWI5p6cXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBtYXNrTm9kZSDpga7nvannlYzpnaLkvKDpgJJcclxuICogQGV4cG9ydHMg5qCh6aqM6YCa55So5LiA57qn55WM6Z2i5piv5ZCm5oiQ5Yqf5pKt5pS+XHJcbiAqL1xyXG5hbmltYXRpb24ub3BlbkludGVyZmFjZSA9IGZ1bmN0aW9uIChub3dOb2RlLCBtYXNrTm9kZSkge1xyXG4gICAgLy8g5qCh6aqM6YCa55So5LiA57qn55WM6Z2i5piv5ZCm5oiQ5Yqf5pKt5pS+XHJcbiAgICBpZiAodGhpcy5vcGVuT25lU3RhaXJMaXN0KG5vd05vZGUsIG1hc2tOb2RlKSkgcmV0dXJuIHRydWU7XHJcbiAgICBpZiAobWFza05vZGUpIG1hc2tOb2RlLmRlc3Ryb3koKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBub3dOb2RlIOeVjOmdouaYr+WQpuaJp+ihjOWKqOeUu+aViOaenFxyXG4gKiBAcGFyYW0ge29iamVjdH0gbWFza05vZGUg6YGu572p55WM6Z2i5Lyg6YCSXHJcbiAqIEByZXR1cm5zIHtib29sZWFufSDmmK/lkKblsZ7kuo7kuIDnuqfnlYzpnaJcclxuICovXHJcbmFuaW1hdGlvbi5vcGVuT25lU3RhaXJMaXN0ID0gZnVuY3Rpb24gKG5vd05vZGUsIG1hc2tOb2RlKSB7XHJcbiAgICBsZXQgYm9sU3RhaXIgPSB0aGlzLmNoZWNrSW50ZXJmYWNlKG5vd05vZGUpO1xyXG4gICAgaWYgKGJvbFN0YWlyKSB7XHJcbiAgICAgICAgLy8g5Yqo55S75byA5aeL5YeG5aSHXHJcbiAgICAgICAgbm93Tm9kZS5zY2FsZSA9IGdsR2FtZS5zeXN0ZW1jbGFzcy5jb252ZXJ0SW50ZXJmYWNlKGNjLnNpemUobm93Tm9kZS53aWR0aCwgbm93Tm9kZS5oZWlnaHQpKTtcclxuICAgICAgICBsZXQgbm9kZU1hc2sgPSBub3dOb2RlLmdldENoaWxkQnlOYW1lKFwibWFza1wiKTtcclxuICAgICAgICBsZXQgb2xkID0gMDtcclxuICAgICAgICBpZiAobm9kZU1hc2spIHtcclxuICAgICAgICAgICAgb2xkID0gbm9kZU1hc2sub3BhY2l0eSArIFwiXCI7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobm93Tm9kZS5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KSkge1xyXG4gICAgICAgICAgICBub3dOb2RlLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmVuYWJsZWQgPSBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgICBub3dOb2RlLnggPSBub3dOb2RlLndpZHRoO1xyXG4gICAgICAgIGxldCB2aXNpYmxlU2l6ZSA9IGNjLnZpZXcuZ2V0VmlzaWJsZVNpemUoKTtcclxuICAgICAgICAvLyDov5vlhaXliqjnlLvnjq/oioJcclxuICAgICAgICBsZXQgY3V0QWN0ID0gW10sIG1vdmVOdW0gPSAxMDA7XHJcbiAgICAgICAgbGV0IHNwYXduQWN0ID0gY2Muc3Bhd24oY2MubW92ZVRvKHRoaXMub25lU3RhaXJUaW1lIC8gMTAgKiAzLCB2aXNpYmxlU2l6ZS53aWR0aCAvIDIgLSBtb3ZlTnVtLCB2aXNpYmxlU2l6ZS5oZWlnaHQgLyAyKSwgY2MuZmFkZUluKHRoaXMub25lU3RhaXJUaW1lIC8gNSkpXHJcbiAgICAgICAgY3V0QWN0LnB1c2goc3Bhd25BY3QpO1xyXG4gICAgICAgIGN1dEFjdC5wdXNoKGNjLm1vdmVUbyh0aGlzLm9uZVN0YWlyVGltZSAvIDEwICogNywgdmlzaWJsZVNpemUud2lkdGggLyAyLCB2aXNpYmxlU2l6ZS5oZWlnaHQgLyAyKS5lYXNpbmcoY2MuZWFzZUVsYXN0aWNPdXQoMi4wKSkpO1xyXG4gICAgICAgIGN1dEFjdC5wdXNoKGNjLmRlbGF5VGltZSgwLjE1KSk7XHJcbiAgICAgICAgY3V0QWN0LnB1c2goY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobm93Tm9kZS5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgbm93Tm9kZS5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG5vd05vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkudXBkYXRlQWxpZ25tZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5vZGVNYXNrKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlTWFzay5vcGFjaXR5ID0gTnVtYmVyKG9sZCk7XHJcbiAgICAgICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS5sZWZ0ID0gMDtcclxuICAgICAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLnJpZ2h0ID0gMDtcclxuICAgICAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLnRvcCA9IDA7XHJcbiAgICAgICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS5ib3R0b20gPSAwO1xyXG4gICAgICAgICAgICAgICAgbm9kZU1hc2suZ2V0Q29tcG9uZW50KGNjLldpZGdldCkuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS51cGRhdGVBbGlnbm1lbnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobWFza05vZGUpIG1hc2tOb2RlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgZ2xHYW1lLmVtaXR0ZXIuZW1pdChgJHtub3dOb2RlLm5hbWV9JHtNRVNTQUdFLlVJLkFDVElPTl9FTkR9YClcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgaWYgKG5vZGVNYXNrKSB7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLm9wYWNpdHkgPSBOdW1iZXIob2xkKTtcclxuICAgICAgICAgICAgbm9kZU1hc2suZ2V0Q29tcG9uZW50KGNjLldpZGdldCkubGVmdCAtPSBtb3ZlTnVtICogMjtcclxuICAgICAgICAgICAgbm9kZU1hc2suZ2V0Q29tcG9uZW50KGNjLldpZGdldCkucmlnaHQgLT0gbW92ZU51bSAqIDI7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS51cGRhdGVBbGlnbm1lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbm93Tm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY3V0QWN0KSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gISFib2xTdGFpcjtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gbm93Tm9kZSDnlYzpnaLmmK/lkKbmiafooYzliqjnlLvmlYjmnpxcclxuICogQHBhcmFtIHtvYmplY3R9IG1hc2tOb2RlIOmBrue9qeeVjOmdouS8oOmAklxyXG4gKiBAcGFyYW0ge29iamVjdH0gbW92ZVR5cGUg55WM6Z2i5Ye6546w5pa55ZCRXHJcbiAqIEByZXR1cm5zIHtib29sZWFufSDmmK/lkKblsZ7kuo7kuIDnuqfnlYzpnaJcclxuICovXHJcbmFuaW1hdGlvbi5tb3ZlSW50ZXJmYWNlID0gZnVuY3Rpb24gKG5vd05vZGUsIG1hc2tOb2RlLCBtb3ZlVHlwZSkge1xyXG4gICAgLy8g5Yqo55S75byA5aeL5YeG5aSHXHJcbiAgICBub3dOb2RlLnNjYWxlID0gZ2xHYW1lLnN5c3RlbWNsYXNzLmNvbnZlcnRJbnRlcmZhY2UoY2Muc2l6ZShub3dOb2RlLndpZHRoLCBub3dOb2RlLmhlaWdodCkpO1xyXG4gICAgbGV0IG5vZGVNYXNrID0gbm93Tm9kZS5nZXRDaGlsZEJ5TmFtZShcIm1hc2tcIik7XHJcbiAgICBsZXQgb2xkID0gMDtcclxuICAgIGlmIChub2RlTWFzaykge1xyXG4gICAgICAgIG9sZCA9IG5vZGVNYXNrLm9wYWNpdHkgKyBcIlwiO1xyXG4gICAgICAgIG5vZGVNYXNrLm9wYWNpdHkgPSAwO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vd05vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkpIHtcclxuICAgICAgICBub3dOb2RlLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmVuYWJsZWQgPSBmYWxzZVxyXG4gICAgfVxyXG4gICAgdGhpcy5fcG9zQmVnaW4obm93Tm9kZSwgbW92ZVR5cGUpO1xyXG4gICAgbGV0IHZpc2libGVTaXplID0gY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpO1xyXG4gICAgLy8g6L+b5YWl5Yqo55S7546v6IqCXHJcbiAgICBsZXQgY3V0QWN0ID0gW10sIG1vdmVOdW0gPSAxMDA7XHJcbiAgICBsZXQgc3Bhd25BY3QgPSBjYy5zcGF3bih0aGlzLl9hY3Rpb25CZWdpbihtb3ZlVHlwZSwgbW92ZU51bSksIGNjLmZhZGVJbih0aGlzLm9uZVN0YWlyVGltZSAvIDUpKVxyXG4gICAgY3V0QWN0LnB1c2goc3Bhd25BY3QpO1xyXG4gICAgY3V0QWN0LnB1c2goY2MubW92ZVRvKHRoaXMub25lU3RhaXJUaW1lIC8gMTAgKiA3LCB2aXNpYmxlU2l6ZS53aWR0aCAvIDIsIHZpc2libGVTaXplLmhlaWdodCAvIDIpLmVhc2luZyhjYy5lYXNlRWxhc3RpY091dCgyLjApKSk7XHJcbiAgICBjdXRBY3QucHVzaChjYy5kZWxheVRpbWUoMC4xNSkpO1xyXG4gICAgY3V0QWN0LnB1c2goY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgIGlmIChub3dOb2RlLmdldENvbXBvbmVudChjYy5XaWRnZXQpKSB7XHJcbiAgICAgICAgICAgIG5vd05vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkuZW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIG5vd05vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkudXBkYXRlQWxpZ25tZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChub2RlTWFzaykge1xyXG4gICAgICAgICAgICBub2RlTWFzay5vcGFjaXR5ID0gTnVtYmVyKG9sZCk7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmxlZnQgPSAwO1xyXG4gICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS5yaWdodCA9IDA7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLnRvcCA9IDA7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmJvdHRvbSA9IDA7XHJcbiAgICAgICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS51cGRhdGVBbGlnbm1lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1hc2tOb2RlKSBtYXNrTm9kZS5kZXN0cm95KCk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIuZW1pdChgJHtub3dOb2RlLm5hbWV9JHtNRVNTQUdFLlVJLkFDVElPTl9FTkR9YClcclxuICAgIH0pKTtcclxuICAgIG5vd05vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGN1dEFjdCkpO1xyXG4gICAgaWYgKG5vZGVNYXNrKSB7XHJcbiAgICAgICAgbm9kZU1hc2sub3BhY2l0eSA9IE51bWJlcihvbGQpO1xyXG4gICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmxlZnQgLT0gbW92ZU51bSAqIDI7XHJcbiAgICAgICAgbm9kZU1hc2suZ2V0Q29tcG9uZW50KGNjLldpZGdldCkucmlnaHQgLT0gbW92ZU51bSAqIDI7XHJcbiAgICAgICAgbm9kZU1hc2suZ2V0Q29tcG9uZW50KGNjLldpZGdldCkudG9wIC09IG1vdmVOdW0gKiAyO1xyXG4gICAgICAgIG5vZGVNYXNrLmdldENvbXBvbmVudChjYy5XaWRnZXQpLmJvdHRvbSAtPSBtb3ZlTnVtICogMjtcclxuICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICBub2RlTWFzay5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KS51cGRhdGVBbGlnbm1lbnQoKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPlueVjOmdouWdkOagh+WIneWni+WMluS9jee9rlxyXG4gKiBAcGFyYW0ge251bWJlcn0gbW92ZVR5cGUg56e75Yqo57G75Z6LXHJcbiAqIFxyXG4gKi9cclxuYW5pbWF0aW9uLl9wb3NCZWdpbiA9IGZ1bmN0aW9uIChub3dOb2RlLCBtb3ZlVHlwZSkge1xyXG4gICAgc3dpdGNoIChtb3ZlVHlwZSkge1xyXG4gICAgICAgIGNhc2UgdGhpcy5NT1ZFX1RPOlxyXG4gICAgICAgICAgICBub3dOb2RlLnkgPSBub3dOb2RlLmhlaWdodDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSB0aGlzLk1PVkVfRE9XTjpcclxuICAgICAgICAgICAgbm93Tm9kZS55ID0gLW5vd05vZGUuaGVpZ2h0O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIHRoaXMuTU9WRV9MRUZUOlxyXG4gICAgICAgICAgICBub3dOb2RlLnggPSAtbm93Tm9kZS53aWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSB0aGlzLk1PVkVfUklHSFQ6XHJcbiAgICAgICAgICAgIG5vd05vZGUueCA9IG5vd05vZGUud2lkdGg7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6IGNvbnNvbGUuZXJyb3IoXCJtb3ZlVHlwZSBlcnJvclwiKTsgYnJlYWs7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDojrflj5bliJ3lp4vljJbmipbliqjkvY3nva5cclxuICogQHBhcmFtIHtudW1iZXJ9IG1vdmVUeXBlIOenu+WKqOexu+Wei1xyXG4gKiBAcGFyYW0ge251bWJlcn0gbW92ZU51bSAg56e75Yqo6Led56a7XHJcbiAqL1xyXG5hbmltYXRpb24uX2FjdGlvbkJlZ2luID0gZnVuY3Rpb24gKG1vdmVUeXBlLCBtb3ZlTnVtKSB7XHJcbiAgICBsZXQgbW92ZXggPSAwLCBtb3ZleSA9IDA7XHJcbiAgICBzd2l0Y2ggKG1vdmVUeXBlKSB7XHJcbiAgICAgICAgY2FzZSB0aGlzLk1PVkVfVE86XHJcbiAgICAgICAgICAgIG1vdmV5IC09IG1vdmVOdW07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgdGhpcy5NT1ZFX0RPV046XHJcbiAgICAgICAgICAgIG1vdmV5ICs9IG1vdmVOdW07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgdGhpcy5NT1ZFX0xFRlQ6XHJcbiAgICAgICAgICAgIG1vdmV4ICs9IG1vdmVOdW07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgdGhpcy5NT1ZFX1JJR0hUOlxyXG4gICAgICAgICAgICBtb3ZleCAtPSBtb3ZlTnVtO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OiBjb25zb2xlLmVycm9yKFwibW92ZVR5cGUgZXJyb3JcIik7IGJyZWFrO1xyXG4gICAgfVxyXG4gICAgbGV0IHZpc2libGVTaXplID0gY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpO1xyXG4gICAgcmV0dXJuIGNjLm1vdmVUbyh0aGlzLm9uZVN0YWlyVGltZSAvIDEwICogMywgdmlzaWJsZVNpemUud2lkdGggLyAyICsgbW92ZXgsIHZpc2libGVTaXplLmhlaWdodCAvIDIgKyBtb3ZleSk7XHJcbn1cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICghZ19pbnN0YW5jZSkge1xyXG4gICAgICAgIGdfaW5zdGFuY2UgPSBuZXcgQW5pbWF0aW9uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ19pbnN0YW5jZTtcclxufTsiXX0=