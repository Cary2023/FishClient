
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/frames/base/loader.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7f630Nmh49C2ZgqKHn+pLMy', 'loader');
// frames/base/loader.js

"use strict";

/**
 * resources 目录资源加载管理
 */
var Loader = function Loader() {},
    loader = Loader.prototype,
    g_instance = null;
/**
 * 资源释放
 * @param {String} path
 * @param {String} type
 */


loader.releaseRes = function (path, type) {
  cc.loader.releaseRes(path, type);
};
/**
 * 资源释放
 * @param {Object} obj
 */


loader.releaseAsset = function (obj) {
  cc.loader.releaseAsset(obj);
};

loader.remoteLoad = function (url) {
  return new Promise(function (resolve, reject) {
    cc.loader.load(url, function (err, data) {
      if (err) {
        reject("加载远程资源失败");
        return console.error(err);
      }

      resolve(new cc.SpriteFrame(data));
    });
  });
};
/**
 * 单一资源加载
 * @param path
 * @returns {Promise<any>}
 */


loader.loadRes = function (path) {
  return new Promise(function (resolve, reject) {
    cc.loader.loadRes(path, function (err, res) {
      if (err) {
        reject("单一资源加载失败");
        return console.error(err);
      }

      resolve(res);
    });
  });
};
/**
 * 加载 SpriteAtlas 图集
 * @param {String} AtlasPath
 * @returns {Promise}
 */


loader.loadSpriteAtlas = function (AtlasPath) {
  return new Promise(function (resolve, reject) {
    cc.loader.loadRes(AtlasPath, cc.SpriteAtlas, function (err, atlas) {
      if (err) {
        reject("加载 SpriteAtlas 图集失败");
        return cc.error(err);
      } // resolve(atlas.getSpriteFrame(ImageName));


      resolve(atlas);
    });
  });
};
/**
 * 加载独立的 SpriteFrame
 * @param {String} ImagePath
 * @returns {Promise}
 */


loader.loadSpriteFrame = function (ImagePath) {
  return new Promise(function (resolve, reject) {
    cc.loader.loadRes(ImagePath, cc.SpriteFrame, function (err, spriteFrame) {
      if (err) {
        reject("加载独立的 SpriteFrame 失败");
        return cc.error(err);
      }

      resolve(spriteFrame);
    });
  });
};
/**
 * 资源批量加载
 * @param {String} loadPath
 * @returns {Promise}
 */


loader.loadResDir = function (loadPath) {
  return new Promise(function (resolve, reject) {
    cc.loader.loadResDir(loadPath, function (err, data) {
      if (err) {
        reject("资源批量加载失败");
        return console.error(err);
      }

      resolve(data);
    });
  });
};
/**
 * 获取图标本地地址
 * @param {String} loadPath
 */


loader.iconFile = function (loadPath) {
  var filepath = "";
  var loadList = loadPath.split('/'),
      pngName = loadList[loadList.length - 1],
      base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + "master/res/raw-assets/icon";

  if (!jsb.fileUtils.isDirectoryExist(base_path)) {
    jsb.fileUtils.createDirectory(base_path);
  }

  filepath = "".concat(base_path, "/").concat(pngName);
  if (jsb.fileUtils.isFileExist(filepath)) return filepath;
  return "";
};
/**
 * 添加远程端的图片地址
 * @param {String} loadPath
 */


loader.iconPush = function (loadPath, arraybuffer) {
  var filepath = "";
  var loadList = loadPath.split('/'),
      pngName = loadList[loadList.length - 1],
      base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + "master/res/raw-assets/icon";

  if (!jsb.fileUtils.isDirectoryExist(base_path)) {
    jsb.fileUtils.createDirectory(base_path);
  }

  filepath = "".concat(base_path, "/").concat(pngName);

  if (typeof arraybuffer !== 'undefined') {
    if (!jsb.fileUtils.isDirectoryExist(base_path)) {
      jsb.fileUtils.createDirectory(base_path);
    }

    if (jsb.fileUtils.writeDataToFile(new Uint8Array(arraybuffer), filepath)) {
      return filepath;
    } else {
      console.error('Remote write file failed.');
    }
  } else {
    console.error('Remote download file failed.');
  }

  return "";
};
/**
 * 下载远程端的文件保存在本地并返回相关地址（已有文件直接返回地址）
 * @param {String} loadPath
 * @returns {Promise}
 */


loader.loadUrlpic = function (loadPath) {
  return new Promise(function (resolve, reject) {
    var filepath = glGame.loader.iconFile(loadPath);
    if (filepath !== "") resolve(filepath);else {
      var xhr = cc.loader.getXMLHttpRequest();
      xhr.responseType = "arraybuffer";

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
          var arraybuffer = xhr.response;
          filepath = glGame.loader.iconPush(loadPath, arraybuffer);
          if (filepath !== "") resolve(filepath);else reject();
        }
      };

      xhr.timeout = 20000;
      xhr.open("GET", loadPath, true);

      xhr.onerror = function (error) {
        console.error("icon url error fail!");
        reject();
      };

      xhr.ontimeout = function (self) {
        self.send();
      };

      xhr.send();
    }
  });
};
/**
 * 添加远程端的图片地址
 * @param {String} loadPath
 */


loader.audioPush = function (loadPath, arraybuffer) {
  var filepath = "";
  var loadList = loadPath.split('/'),
      pngName = loadList[loadList.length - 1],
      base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + "master/res/raw-assets/audio";

  if (!jsb.fileUtils.isDirectoryExist(base_path)) {
    jsb.fileUtils.createDirectory(base_path);
  }

  filepath = "".concat(base_path, "/").concat(pngName);

  if (typeof arraybuffer !== 'undefined') {
    if (!jsb.fileUtils.isDirectoryExist(base_path)) {
      jsb.fileUtils.createDirectory(base_path);
    }

    if (jsb.fileUtils.writeDataToFile(new Uint8Array(arraybuffer), filepath)) {
      return filepath;
    } else {
      console.error('Remote write file failed.');
    }
  } else {
    console.error('Remote download file failed.');
  }

  return "";
};
/**
 * 下载远程端的文件保存在本地并返回相关地址（已有文件直接返回地址）
 * @param {String} loadPath
 * @returns {Promise}
 */


loader.loadUrlaudio = function (loadPath) {
  return new Promise(function (resolve, reject) {
    var filepath = glGame.loader.iconFile(loadPath);
    if (filepath !== "") resolve(filepath);else {
      var xhr = cc.loader.downloader();
      xhr.responseType = "arraybuffer";

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
          var arraybuffer = xhr.response;
          filepath = glGame.loader.audioPush(loadPath, arraybuffer);
          if (filepath !== "") resolve(filepath);else reject();
        }
      };

      xhr.timeout = 20000;
      xhr.open("GET", loadPath, true);

      xhr.onerror = function (error) {
        console.error("icon url error fail!");
        reject();
      };

      xhr.ontimeout = function (self) {
        self.send();
      };

      xhr.send();
    }
  });
};

module.exports = function () {
  if (!g_instance) {
    g_instance = new Loader();
  }

  return g_instance;
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZnJhbWVzXFxiYXNlXFxsb2FkZXIuanMiXSwibmFtZXMiOlsiTG9hZGVyIiwibG9hZGVyIiwicHJvdG90eXBlIiwiZ19pbnN0YW5jZSIsInJlbGVhc2VSZXMiLCJwYXRoIiwidHlwZSIsImNjIiwicmVsZWFzZUFzc2V0Iiwib2JqIiwicmVtb3RlTG9hZCIsInVybCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwibG9hZCIsImVyciIsImRhdGEiLCJjb25zb2xlIiwiZXJyb3IiLCJTcHJpdGVGcmFtZSIsImxvYWRSZXMiLCJyZXMiLCJsb2FkU3ByaXRlQXRsYXMiLCJBdGxhc1BhdGgiLCJTcHJpdGVBdGxhcyIsImF0bGFzIiwibG9hZFNwcml0ZUZyYW1lIiwiSW1hZ2VQYXRoIiwic3ByaXRlRnJhbWUiLCJsb2FkUmVzRGlyIiwibG9hZFBhdGgiLCJpY29uRmlsZSIsImZpbGVwYXRoIiwibG9hZExpc3QiLCJzcGxpdCIsInBuZ05hbWUiLCJsZW5ndGgiLCJiYXNlX3BhdGgiLCJqc2IiLCJmaWxlVXRpbHMiLCJnZXRXcml0YWJsZVBhdGgiLCJpc0RpcmVjdG9yeUV4aXN0IiwiY3JlYXRlRGlyZWN0b3J5IiwiaXNGaWxlRXhpc3QiLCJpY29uUHVzaCIsImFycmF5YnVmZmVyIiwid3JpdGVEYXRhVG9GaWxlIiwiVWludDhBcnJheSIsImxvYWRVcmxwaWMiLCJnbEdhbWUiLCJ4aHIiLCJnZXRYTUxIdHRwUmVxdWVzdCIsInJlc3BvbnNlVHlwZSIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZSIsInRpbWVvdXQiLCJvcGVuIiwib25lcnJvciIsIm9udGltZW91dCIsInNlbGYiLCJzZW5kIiwiYXVkaW9QdXNoIiwibG9hZFVybGF1ZGlvIiwiZG93bmxvYWRlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7OztBQUdBLElBQ0lBLE1BQU0sR0FB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LENBQUNLLE1BQUosSUFBYyxHQUFkLElBQXFCTCxHQUFHLENBQUNLLE1BQUosR0FBYSxHQUEvRCxFQUFxRTtBQUNqRSxjQUFJVixXQUFXLEdBQUdLLEdBQUcsQ0FBQ00sUUFBdEI7QUFDQXhCLFVBQUFBLFFBQVEsR0FBR2lCLE1BQU0sQ0FBQ2pELE1BQVAsQ0FBYytELFNBQWQsQ0FBd0JqQyxRQUF4QixFQUFrQ2UsV0FBbEMsQ0FBWDtBQUNBLGNBQUliLFFBQVEsS0FBSyxFQUFqQixFQUFxQnBCLE9BQU8sQ0FBQ29CLFFBQUQsQ0FBUCxDQUFyQixLQUNLbkIsTUFBTTtBQUNkO0FBQ0osT0FQRDs7QUFRQXFDLE1BQUFBLEdBQUcsQ0FBQ08sT0FBSixHQUFjLEtBQWQ7QUFDQVAsTUFBQUEsR0FBRyxDQUFDUSxJQUFKLENBQVMsS0FBVCxFQUFnQjVCLFFBQWhCLEVBQTBCLElBQTFCOztBQUNBb0IsTUFBQUEsR0FBRyxDQUFDUyxPQUFKLEdBQWMsVUFBQ3pDLEtBQUQsRUFBVztBQUFFRCxRQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYyxzQkFBZDtBQUF1Q0wsUUFBQUEsTUFBTTtBQUFLLE9BQTdFOztBQUNBcUMsTUFBQUEsR0FBRyxDQUFDVSxTQUFKLEdBQWdCLFVBQUNDLElBQUQsRUFBVTtBQUFFQSxRQUFBQSxJQUFJLENBQUNDLElBQUw7QUFBYyxPQUExQzs7QUFDQVosTUFBQUEsR0FBRyxDQUFDWSxJQUFKO0FBQ0g7QUFDSixHQXBCTSxDQUFQO0FBcUJILENBdEJEOztBQXdCQUksTUFBTSxDQUFDQyxPQUFQLEdBQWlCLFlBQVk7QUFDekIsTUFBSSxDQUFDakUsVUFBTCxFQUFpQjtBQUNiQSxJQUFBQSxVQUFVLEdBQUcsSUFBSUgsTUFBSixFQUFiO0FBQ0g7O0FBQ0QsU0FBT0csVUFBUDtBQUNILENBTEQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiByZXNvdXJjZXMg55uu5b2V6LWE5rqQ5Yqg6L29566h55CGXHJcbiAqL1xyXG5sZXRcclxuICAgIExvYWRlciA9IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgIGxvYWRlciA9IExvYWRlci5wcm90b3R5cGUsXHJcbiAgICBnX2luc3RhbmNlID0gbnVsbDtcclxuXHJcbi8qKlxyXG4gKiDotYTmupDph4rmlL5cclxuICogQHBhcmFtIHtTdHJpbmd9IHBhdGhcclxuICogQHBhcmFtIHtTdHJpbmd9IHR5cGVcclxuICovXHJcbmxvYWRlci5yZWxlYXNlUmVzID0gZnVuY3Rpb24gKHBhdGgsIHR5cGUpIHtcclxuICAgIGNjLmxvYWRlci5yZWxlYXNlUmVzKHBhdGgsIHR5cGUpO1xyXG59O1xyXG4vKipcclxuICog6LWE5rqQ6YeK5pS+XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmpcclxuICovXHJcbmxvYWRlci5yZWxlYXNlQXNzZXQgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICBjYy5sb2FkZXIucmVsZWFzZUFzc2V0KG9iaik7XHJcbn07XHJcbmxvYWRlci5yZW1vdGVMb2FkID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBjYy5sb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KFwi5Yqg6L296L+c56iL6LWE5rqQ5aSx6LSlXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihlcnIpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzb2x2ZShuZXcgY2MuU3ByaXRlRnJhbWUoZGF0YSkpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59O1xyXG4vKipcclxuICog5Y2V5LiA6LWE5rqQ5Yqg6L29XHJcbiAqIEBwYXJhbSBwYXRoXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59XHJcbiAqL1xyXG5sb2FkZXIubG9hZFJlcyA9IGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKHBhdGgsIGZ1bmN0aW9uIChlcnIsIHJlcykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoXCLljZXkuIDotYTmupDliqDovb3lpLHotKVcIilcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVycilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKHJlcyk7XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn07XHJcbi8qKlxyXG4gKiDliqDovb0gU3ByaXRlQXRsYXMg5Zu+6ZuGXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBBdGxhc1BhdGhcclxuICogQHJldHVybnMge1Byb21pc2V9XHJcbiAqL1xyXG5sb2FkZXIubG9hZFNwcml0ZUF0bGFzID0gZnVuY3Rpb24gKEF0bGFzUGF0aCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBjYy5sb2FkZXIubG9hZFJlcyhBdGxhc1BhdGgsIGNjLlNwcml0ZUF0bGFzLCBmdW5jdGlvbiAoZXJyLCBhdGxhcykge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoXCLliqDovb0gU3ByaXRlQXRsYXMg5Zu+6ZuG5aSx6LSlXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcmVzb2x2ZShhdGxhcy5nZXRTcHJpdGVGcmFtZShJbWFnZU5hbWUpKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShhdGxhcyk7XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn07XHJcbi8qKlxyXG4gKiDliqDovb3ni6znq4vnmoQgU3ByaXRlRnJhbWVcclxuICogQHBhcmFtIHtTdHJpbmd9IEltYWdlUGF0aFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICovXHJcbmxvYWRlci5sb2FkU3ByaXRlRnJhbWUgPSBmdW5jdGlvbiAoSW1hZ2VQYXRoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKEltYWdlUGF0aCwgY2MuU3ByaXRlRnJhbWUsIGZ1bmN0aW9uIChlcnIsIHNwcml0ZUZyYW1lKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChcIuWKoOi9veeLrOeri+eahCBTcHJpdGVGcmFtZSDlpLHotKVcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2MuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKHNwcml0ZUZyYW1lKVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59O1xyXG4vKipcclxuICog6LWE5rqQ5om56YeP5Yqg6L29XHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2FkUGF0aFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICovXHJcbmxvYWRlci5sb2FkUmVzRGlyID0gZnVuY3Rpb24gKGxvYWRQYXRoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzRGlyKGxvYWRQYXRoLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChcIui1hOa6kOaJuemHj+WKoOi9veWksei0pVwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzb2x2ZShkYXRhKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxufTtcclxuXHJcblxyXG4vKipcclxuICog6I635Y+W5Zu+5qCH5pys5Zyw5Zyw5Z2AXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2FkUGF0aFxyXG4gKi9cclxubG9hZGVyLmljb25GaWxlID0gZnVuY3Rpb24gKGxvYWRQYXRoKSB7XHJcbiAgICBsZXQgZmlsZXBhdGggPSBcIlwiO1xyXG4gICAgbGV0IGxvYWRMaXN0ID0gbG9hZFBhdGguc3BsaXQoJy8nKSxcclxuICAgICAgICBwbmdOYW1lID0gbG9hZExpc3RbbG9hZExpc3QubGVuZ3RoIC0gMV0sXHJcbiAgICAgICAgYmFzZV9wYXRoID0gKGpzYi5maWxlVXRpbHMgPyBqc2IuZmlsZVV0aWxzLmdldFdyaXRhYmxlUGF0aCgpIDogJy8nKSArIFwibWFzdGVyL3Jlcy9yYXctYXNzZXRzL2ljb25cIjtcclxuICAgIGlmICghanNiLmZpbGVVdGlscy5pc0RpcmVjdG9yeUV4aXN0KGJhc2VfcGF0aCkpIHtcclxuICAgICAgICBqc2IuZmlsZVV0aWxzLmNyZWF0ZURpcmVjdG9yeShiYXNlX3BhdGgpO1xyXG4gICAgfVxyXG4gICAgZmlsZXBhdGggPSBgJHtiYXNlX3BhdGh9LyR7cG5nTmFtZX1gO1xyXG4gICAgaWYgKGpzYi5maWxlVXRpbHMuaXNGaWxlRXhpc3QoZmlsZXBhdGgpKVxyXG4gICAgICAgIHJldHVybiBmaWxlcGF0aDtcclxuICAgIHJldHVybiBcIlwiO1xyXG59XHJcblxyXG4vKipcclxuICog5re75Yqg6L+c56iL56uv55qE5Zu+54mH5Zyw5Z2AXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2FkUGF0aFxyXG4gKi9cclxubG9hZGVyLmljb25QdXNoID0gZnVuY3Rpb24gKGxvYWRQYXRoLCBhcnJheWJ1ZmZlcikge1xyXG4gICAgbGV0IGZpbGVwYXRoID0gXCJcIjtcclxuICAgIGxldCBsb2FkTGlzdCA9IGxvYWRQYXRoLnNwbGl0KCcvJyksXHJcbiAgICAgICAgcG5nTmFtZSA9IGxvYWRMaXN0W2xvYWRMaXN0Lmxlbmd0aCAtIDFdLFxyXG4gICAgICAgIGJhc2VfcGF0aCA9IChqc2IuZmlsZVV0aWxzID8ganNiLmZpbGVVdGlscy5nZXRXcml0YWJsZVBhdGgoKSA6ICcvJykgKyBcIm1hc3Rlci9yZXMvcmF3LWFzc2V0cy9pY29uXCI7XHJcbiAgICBpZiAoIWpzYi5maWxlVXRpbHMuaXNEaXJlY3RvcnlFeGlzdChiYXNlX3BhdGgpKSB7XHJcbiAgICAgICAganNiLmZpbGVVdGlscy5jcmVhdGVEaXJlY3RvcnkoYmFzZV9wYXRoKTtcclxuICAgIH1cclxuICAgIGZpbGVwYXRoID0gYCR7YmFzZV9wYXRofS8ke3BuZ05hbWV9YDtcclxuICAgIGlmICh0eXBlb2YgYXJyYXlidWZmZXIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaWYgKCFqc2IuZmlsZVV0aWxzLmlzRGlyZWN0b3J5RXhpc3QoYmFzZV9wYXRoKSkge1xyXG4gICAgICAgICAgICBqc2IuZmlsZVV0aWxzLmNyZWF0ZURpcmVjdG9yeShiYXNlX3BhdGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGpzYi5maWxlVXRpbHMud3JpdGVEYXRhVG9GaWxlKG5ldyBVaW50OEFycmF5KGFycmF5YnVmZmVyKSwgZmlsZXBhdGgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmaWxlcGF0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZW1vdGUgd3JpdGUgZmlsZSBmYWlsZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdSZW1vdGUgZG93bmxvYWQgZmlsZSBmYWlsZWQuJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gXCJcIjtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiDkuIvovb3ov5znqIvnq6/nmoTmlofku7bkv53lrZjlnKjmnKzlnLDlubbov5Tlm57nm7jlhbPlnLDlnYDvvIjlt7LmnInmlofku7bnm7TmjqXov5Tlm57lnLDlnYDvvIlcclxuICogQHBhcmFtIHtTdHJpbmd9IGxvYWRQYXRoXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gKi9cclxubG9hZGVyLmxvYWRVcmxwaWMgPSBmdW5jdGlvbiAobG9hZFBhdGgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgbGV0IGZpbGVwYXRoID0gZ2xHYW1lLmxvYWRlci5pY29uRmlsZShsb2FkUGF0aCk7XHJcbiAgICAgICAgaWYgKGZpbGVwYXRoICE9PSBcIlwiKSByZXNvbHZlKGZpbGVwYXRoKTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHhociA9IGNjLmxvYWRlci5nZXRYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xyXG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhcnJheWJ1ZmZlciA9IHhoci5yZXNwb25zZTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlcGF0aCA9IGdsR2FtZS5sb2FkZXIuaWNvblB1c2gobG9hZFBhdGgsIGFycmF5YnVmZmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXBhdGggIT09IFwiXCIpIHJlc29sdmUoZmlsZXBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgcmVqZWN0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHhoci50aW1lb3V0ID0gMjAwMDA7XHJcbiAgICAgICAgICAgIHhoci5vcGVuKFwiR0VUXCIsIGxvYWRQYXRoLCB0cnVlKTtcclxuICAgICAgICAgICAgeGhyLm9uZXJyb3IgPSAoZXJyb3IpID0+IHsgY29uc29sZS5lcnJvcihcImljb24gdXJsIGVycm9yIGZhaWwhXCIpOyByZWplY3QoKTsgfVxyXG4gICAgICAgICAgICB4aHIub250aW1lb3V0ID0gKHNlbGYpID0+IHsgc2VsZi5zZW5kKCk7IH07XHJcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufTtcclxuXHJcblxyXG4vKipcclxuICog5re75Yqg6L+c56iL56uv55qE5Zu+54mH5Zyw5Z2AXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBsb2FkUGF0aFxyXG4gKi9cclxubG9hZGVyLmF1ZGlvUHVzaCA9IGZ1bmN0aW9uIChsb2FkUGF0aCwgYXJyYXlidWZmZXIpIHtcclxuICAgIGxldCBmaWxlcGF0aCA9IFwiXCI7XHJcbiAgICBsZXQgbG9hZExpc3QgPSBsb2FkUGF0aC5zcGxpdCgnLycpLFxyXG4gICAgICAgIHBuZ05hbWUgPSBsb2FkTGlzdFtsb2FkTGlzdC5sZW5ndGggLSAxXSxcclxuICAgICAgICBiYXNlX3BhdGggPSAoanNiLmZpbGVVdGlscyA/IGpzYi5maWxlVXRpbHMuZ2V0V3JpdGFibGVQYXRoKCkgOiAnLycpICsgXCJtYXN0ZXIvcmVzL3Jhdy1hc3NldHMvYXVkaW9cIjtcclxuICAgIGlmICghanNiLmZpbGVVdGlscy5pc0RpcmVjdG9yeUV4aXN0KGJhc2VfcGF0aCkpIHtcclxuICAgICAgICBqc2IuZmlsZVV0aWxzLmNyZWF0ZURpcmVjdG9yeShiYXNlX3BhdGgpO1xyXG4gICAgfVxyXG4gICAgZmlsZXBhdGggPSBgJHtiYXNlX3BhdGh9LyR7cG5nTmFtZX1gO1xyXG4gICAgaWYgKHR5cGVvZiBhcnJheWJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBpZiAoIWpzYi5maWxlVXRpbHMuaXNEaXJlY3RvcnlFeGlzdChiYXNlX3BhdGgpKSB7XHJcbiAgICAgICAgICAgIGpzYi5maWxlVXRpbHMuY3JlYXRlRGlyZWN0b3J5KGJhc2VfcGF0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoanNiLmZpbGVVdGlscy53cml0ZURhdGFUb0ZpbGUobmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBmaWxlcGF0aCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbGVwYXRoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbW90ZSB3cml0ZSBmaWxlIGZhaWxlZC4nKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbW90ZSBkb3dubG9hZCBmaWxlIGZhaWxlZC4nKTtcclxuICAgIH1cclxuICAgIHJldHVybiBcIlwiO1xyXG59XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiDkuIvovb3ov5znqIvnq6/nmoTmlofku7bkv53lrZjlnKjmnKzlnLDlubbov5Tlm57nm7jlhbPlnLDlnYDvvIjlt7LmnInmlofku7bnm7TmjqXov5Tlm57lnLDlnYDvvIlcclxuICogQHBhcmFtIHtTdHJpbmd9IGxvYWRQYXRoXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gKi9cclxubG9hZGVyLmxvYWRVcmxhdWRpbyA9IGZ1bmN0aW9uIChsb2FkUGF0aCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBsZXQgZmlsZXBhdGggPSBnbEdhbWUubG9hZGVyLmljb25GaWxlKGxvYWRQYXRoKTtcclxuICAgICAgICBpZiAoZmlsZXBhdGggIT09IFwiXCIpIHJlc29sdmUoZmlsZXBhdGgpO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgeGhyID0gY2MubG9hZGVyLmRvd25sb2FkZXIoKTtcclxuICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcclxuICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYXJyYXlidWZmZXIgPSB4aHIucmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZXBhdGggPSBnbEdhbWUubG9hZGVyLmF1ZGlvUHVzaChsb2FkUGF0aCwgYXJyYXlidWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlcGF0aCAhPT0gXCJcIikgcmVzb2x2ZShmaWxlcGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSByZWplY3QoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgeGhyLnRpbWVvdXQgPSAyMDAwMDtcclxuICAgICAgICAgICAgeGhyLm9wZW4oXCJHRVRcIiwgbG9hZFBhdGgsIHRydWUpO1xyXG4gICAgICAgICAgICB4aHIub25lcnJvciA9IChlcnJvcikgPT4geyBjb25zb2xlLmVycm9yKFwiaWNvbiB1cmwgZXJyb3IgZmFpbCFcIik7IHJlamVjdCgpOyB9XHJcbiAgICAgICAgICAgIHhoci5vbnRpbWVvdXQgPSAoc2VsZikgPT4geyBzZWxmLnNlbmQoKTsgfTtcclxuICAgICAgICAgICAgeGhyLnNlbmQoKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoIWdfaW5zdGFuY2UpIHtcclxuICAgICAgICBnX2luc3RhbmNlID0gbmV3IExvYWRlcigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdfaW5zdGFuY2U7XHJcbn07Il19