
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/frames/model/servercfg.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '2e10c0at6hImbapndxqVrrL', 'servercfg');
// frames/model/servercfg.js

"use strict";

/**
 * 连接服务器数据模块
 */
var Server = function Server() {
  this.localTag = null;
  this.servercfg = null;
  this.b_enableHotUpdate = cc.sys.isNative && cc.sys.isMobile;
},
    server = Server.prototype,
    g_instance = null;

server.loadSetting = function () {
  var _this = this;

  if (glGame.gamecfg.gameProxy == 0) {
    glGame.fileutil.readJSON("config/localsetting").then(function (data) {
      if (data.logenable) {
        _this.loadSettingCB(data);
      } else {
        _this.loadServer(data);
      }
    });
  } else this.getProxyUrl();
};

server.ProxySucceed = function (data) {
  ProxyO.stop();
  this.loadServer({
    cfgurl: data.url
  });
};

server.getProxyUrl = function () {
  ProxyO.on('succeed', this.ProxySucceed, this);
  ProxyO.start();
};

server.repetitionSend = function () {
  if (this.localTag) this.loadServer(this.localTag);else this.loadSetting();
};

server.loadServer = function (data) {
  var _this2 = this;

  this.localTag = data;
  var xhr = cc.loader.getXMLHttpRequest();

  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
      var respone = xhr.responseText;
      var resp = JSON.parse(respone);
      var head = resp.head;
      var body = resp.body;
      if (head.key) body = glGame.encrypt.getDecodeUrl(body, head.key);
      if (head.code != null && typeof code == "string") head.code = parseInt(head.code);else head.code = 0;

      if (head && head.code == 0) {
        _this2.servercfg = body;
        glGame.user.setUrl(body);
        glGame.emitter.emit(MESSAGE.UPDATE_SERVER_CFG);
      }
    } else if (xhr.readyState === 4) {
      xhr.onreadystatechange = function () {};

      setTimeout(function () {
        glGame.servercfg.repetitionSend();
      }, 5000);
    }
  };

  xhr.timeout = 15000;

  xhr.onerror = function (error) {
    setTimeout(function () {
      glGame.servercfg.repetitionSend();
    }, 5000);
  };

  var wholeurl = "".concat(data.cfgurl);
  var route = "http.reqUrl";
  var msg = {
    head: {
      route: route,
      msgindex: 0,
      firstReq: 1
    },
    body: {}
  };

  if (msg.body && !msg.head.key) {
    var _data = {};
    _data = glGame.encrypt.getEncodeUrl(msg.body);
    msg.body = _data["data"];
    msg.head.key = _data["dataKey"];
  }

  xhr.open("POST", wholeurl, true);
  xhr.setRequestHeader("Content-Type", "application/json;charset=utf-8");
  xhr.send(JSON.stringify(msg));
};

server.loadSettingCB = function (data) {
  var _this3 = this;

  this.localTag = data;
  var xhr = cc.loader.getXMLHttpRequest();

  xhr.onreadystatechange = function () {
    cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);

    if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
      var respone = xhr.responseText;
      _this3.servercfg = JSON.parse(respone); // this.servercfg.platSvrPort = 8081;
      // this.servercfg.platSvrHost = 'http://192.168.2.15';

      console.log("获取的servercfg  loadSettingCB", _this3.servercfg);
      glGame.emitter.emit(MESSAGE.UPDATE_SERVER_CFG);
    }
  };

  xhr.timeout = 5000;

  xhr.onerror = function (error) {
    setTimeout(function () {
      if (_this3.localTag) glGame.servercfg.loadSettingCB(glGame.servercfg.localTag);else glGame.servercfg.loadSetting();
    }, 5000);
  };

  var URLProducttag = data.producttag;

  if (!cc.sys.isNative && window && window.location && window.location.href) {
    URLProducttag = this.analysisURLParameter(window.location.href).args.producttag;
  }

  var wholeurl = "".concat(data.cfgurl, "/products/").concat(URLProducttag || data.producttag, ".json");
  console.log("wholeurl=", wholeurl);
  xhr.open("GET", wholeurl, true);
  xhr.send();
}; //跳转到QQ对话框/社交软件界面


server.turnOtherApp = function (type) {
  var QQNumber = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var host = this.servercfg["platSvrHost"];
  var port = this.servercfg["platSvrPort"];

  if (QQNumber) {
    cc.sys.openURL("http://".concat(host, ":").concat(port, "/openApp.html?type=").concat(type, "&url=").concat(QQNumber));
  } else {
    cc.sys.openURL("http://".concat(host, ":").concat(port, "/openApp.html?type=").concat(type));
  }
}; // 解析URL是否带调试参数


server.analysisURLParameter = function (URL) {
  var arr = URL.split("?");
  var obj = {
    url: null,
    args: {}
  };
  obj.url = arr[0]; // 拆分后如果长度小于2说明URL是不带参数的

  if (arr.length < 2) return obj;
  var mapArr = arr[1].split("&");

  for (var i = 0; i < mapArr.length; i++) {
    var parameter = mapArr[i].split("=");
    obj.args[parameter[0]] = parameter[1];
  }

  return obj;
};

server.getLocalTag = function () {
  return this.localTag;
};

server.isEnableHotUpdate = function () {
  return this.b_enableHotUpdate;
};

server.getServerCfg = function () {
  return this.servercfg;
};
/**
 * 获取分享二维码图片地址
 */


server.getQRCodeURL = function () {
  var host = this.servercfg["platSvrHost"];
  var port = this.servercfg["platSvrPort"];
  return "".concat(host, ":").concat(port, "/shareimg/code.png");
};
/**
 * 获取当前游戏规则
 * @param tag 标签页编号
 * @param gameName 指定游戏名字
 */


server.getGameRuleURL = function (tag, gameName) {
  var host = this.servercfg["platSvrHost"];
  var port = this.servercfg["platSvrPort"];
  var curGameID = glGame.room.get("curEnterGameID");
  if (!gameName) gameName = glGame.scene.getSceneNameByID(curGameID);
  return "http://".concat(host, ":").concat(port, "/gamerule/").concat(gameName, "/").concat(tag, ".html");
};
/**
 * 获取当前游戏热更地址
 */


server.getHotupdateVersionUrl = function () {
  var hotUpdateURL = this.servercfg["hotUrl"];
  var strdiagonal = hotUpdateURL[hotUpdateURL.length - 1] === "/" ? "" : "/";
  return hotUpdateURL + strdiagonal;
};
/**
 * 开启下载地址
 */


server.openDownLoad = function () {
  cc.sys.openURL(this.servercfg["downLoadPage"]);
};
/**
 * 获取当前游戏热更地址
 */


server.getHotDownVersion = function () {
  return this.servercfg["downVersion"];
};
/**
 * 获取紧急公告开关
 */


server.getBolMaintaining = function () {
  return this.servercfg["emergencyMaintenanceSwitch"];
};
/**
 * 获取紧急公告内容
 */


server.getMaintainingContent = function () {
  return this.servercfg["emergencyMaintenanceContent"];
};

module.exports = function () {
  if (!g_instance) {
    g_instance = new Server();
  }

  return g_instance;
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZnJhbWVzXFxtb2RlbFxcc2VydmVyY2ZnLmpzIl0sIm5hbWVzIjpbIlNlcnZlciIsImxvY2FsVGFnIiwic2VydmVyY2ZnIiwiYl9lbmFibGVIb3RVcGRhdGUiLCJjYyIsInN5cyIsImlzTmF0aXZlIiwiaXNNb2JpbGUiLCJzZXJ2ZXIiLCJwcm90b3R5cGUiLCJnX2luc3RhbmNlIiwibG9hZFNldHRpbmciLCJnbEdhbWUiLCJnYW1lY2ZnIiwiZ2FtZVByb3h5IiwiZmlsZXV0aWwiLCJyZWFkSlNPTiIsInRoZW4iLCJkYXRhIiwibG9nZW5hYmxlIiwibG9hZFNldHRpbmdDQiIsImxvYWRTZXJ2ZXIiLCJnZXRQcm94eVVybCIsIlByb3h5U3VjY2VlZCIsIlByb3h5TyIsInN0b3AiLCJjZmd1cmwiLCJ1cmwiLCJvbiIsInN0YXJ0IiwicmVwZXRpdGlvblNlbmQiLCJ4aHIiLCJsb2FkZXIiLCJnZXRYTUxIdHRwUmVxdWVzdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25lIiwicmVzcG9uc2VUZXh0IiwicmVzcCIsIkpTT04iLCJwYXJzZSIsImhlYWQiLCJib2R5Iiwia2V5IiwiZW5jcnlwdCIsImdldERlY29kZVVybCIsImNvZGUiLCJwYXJzZUludCIsInVzZXIiLCJzZXRVcmwiLCJlbWl0dGVyIiwiZW1pdCIsIk1FU1NBR0UiLCJVUERBVEVfU0VSVkVSX0NGRyIsInNldFRpbWVvdXQiLCJ0aW1lb3V0Iiwib25lcnJvciIsImVycm9yIiwid2hvbGV1cmwiLCJyb3V0ZSIsIm1zZyIsIm1zZ2luZGV4IiwiZmlyc3RSZXEiLCJnZXRFbmNvZGVVcmwiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInNlbmQiLCJzdHJpbmdpZnkiLCJsb2ciLCJjb25zb2xlIiwiVVJMUHJvZHVjdHRhZyIsInByb2R1Y3R0YWciLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJhbmFseXNpc1VSTFBhcmFtZXRlciIsImFyZ3MiLCJ0dXJuT3RoZXJBcHAiLCJ0eXBlIiwiUVFOdW1iZXIiLCJob3N0IiwicG9ydCIsIm9wZW5VUkwiLCJVUkwiLCJhcnIiLCJzcGxpdCIsIm9iaiIsImxlbmd0aCIsIm1hcEFyciIsImkiLCJwYXJhbWV0ZXIiLCJnZXRMb2NhbFRhZyIsImlzRW5hYmxlSG90VXBkYXRlIiwiZ2V0U2VydmVyQ2ZnIiwiZ2V0UVJDb2RlVVJMIiwiZ2V0R2FtZVJ1bGVVUkwiLCJ0YWciLCJnYW1lTmFtZSIsImN1ckdhbWVJRCIsInJvb20iLCJnZXQiLCJzY2VuZSIsImdldFNjZW5lTmFtZUJ5SUQiLCJnZXRIb3R1cGRhdGVWZXJzaW9uVXJsIiwiaG90VXBkYXRlVVJMIiwic3RyZGlhZ29uYWwiLCJvcGVuRG93bkxvYWQiLCJnZXRIb3REb3duVmVyc2lvbiIsImdldEJvbE1haW50YWluaW5nIiwiZ2V0TWFpbnRhaW5pbmdDb250ZW50IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7O0FBR0EsSUFDSUEsTUFBTSxHQUFHLFNBQVRBLE1BQVMsR0FBWTtBQUNqQixPQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsT0FBS0MsU0FBTCxHQUFpQixJQUFqQjtBQUNBLE9BQUtDLGlCQUFMLEdBQXlCQyxFQUFFLENBQUNDLEdBQUgsQ0FBT0MsUUFBUCxJQUFtQkYsRUFBRSxDQUFDQyxHQUFILENBQU9FLFFBQW5EO0FBQ0gsQ0FMTDtBQUFBLElBTUlDLE1BQU0sR0FBR1IsTUFBTSxDQUFDUyxTQU5wQjtBQUFBLElBT0lDLFVBQVUsR0FBRyxJQVBqQjs7QUFRQUYsTUFBTSxDQUFDRyxXQUFQLEdBQXFCLFlBQVk7QUFBQTs7QUFDN0IsTUFBSUMsTUFBTSxDQUFDQyxPQUFQLENBQWVDLFNBQWYsSUFBNEIsQ0FBaEMsRUFBbUM7QUFDL0JGLElBQUFBLE1BQU0sQ0FBQ0csUUFBUCxDQUFnQkMsUUFBaEIsQ0FBeUIscUJBQXpCLEVBQWdEQyxJQUFoRCxDQUFxRCxVQUFBQyxJQUFJLEVB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WSxHQUFHQyxXQUF0QjtBQUNILENBSkQ7QUFNQTs7Ozs7QUFHQWxHLE1BQU0sQ0FBQ21HLFlBQVAsR0FBc0IsWUFBWTtBQUM5QnZHLEVBQUFBLEVBQUUsQ0FBQ0MsR0FBSCxDQUFPOEUsT0FBUCxDQUFlLEtBQUtqRixTQUFMLENBQWUsY0FBZixDQUFmO0FBQ0gsQ0FGRDtBQUlBOzs7OztBQUdBTSxNQUFNLENBQUNvRyxpQkFBUCxHQUEyQixZQUFZO0FBQ25DLFNBQU8sS0FBSzFHLFNBQUwsQ0FBZSxhQUFmLENBQVA7QUFDSCxDQUZEO0FBSUE7Ozs7O0FBR0FNLE1BQU0sQ0FBQ3FHLGlCQUFQLEdBQTJCLFlBQVk7QUFDbkMsU0FBTyxLQUFLM0csU0FBTCxDQUFlLDRCQUFmLENBQVA7QUFDSCxDQUZEO0FBSUE7Ozs7O0FBR0FNLE1BQU0sQ0FBQ3NHLHFCQUFQLEdBQStCLFlBQVk7QUFDdkMsU0FBTyxLQUFLNUcsU0FBTCxDQUFlLDZCQUFmLENBQVA7QUFDSCxDQUZEOztBQUlBNkcsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLFlBQVk7QUFDekIsTUFBSSxDQUFDdEcsVUFBTCxFQUFpQjtBQUNiQSxJQUFBQSxVQUFVLEdBQUcsSUFBSVYsTUFBSixFQUFiO0FBQ0g7O0FBQ0QsU0FBT1UsVUFBUDtBQUNILENBTEQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDov57mjqXmnI3liqHlmajmlbDmja7mqKHlnZdcclxuICovXHJcbmxldFxyXG4gICAgU2VydmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMubG9jYWxUYWcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2VydmVyY2ZnID0gbnVsbDtcclxuICAgICAgICB0aGlzLmJfZW5hYmxlSG90VXBkYXRlID0gY2Muc3lzLmlzTmF0aXZlICYmIGNjLnN5cy5pc01vYmlsZTtcclxuICAgIH0sXHJcbiAgICBzZXJ2ZXIgPSBTZXJ2ZXIucHJvdG90eXBlLFxyXG4gICAgZ19pbnN0YW5jZSA9IG51bGw7XHJcbnNlcnZlci5sb2FkU2V0dGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmIChnbEdhbWUuZ2FtZWNmZy5nYW1lUHJveHkgPT0gMCkge1xyXG4gICAgICAgIGdsR2FtZS5maWxldXRpbC5yZWFkSlNPTihcImNvbmZpZy9sb2NhbHNldHRpbmdcIikudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgaWYgKGRhdGEubG9nZW5hYmxlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRTZXR0aW5nQ0IoZGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRTZXJ2ZXIoZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB0aGlzLmdldFByb3h5VXJsKCk7XHJcbn1cclxuXHJcbnNlcnZlci5Qcm94eVN1Y2NlZWQgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgUHJveHlPLnN0b3AoKTtcclxuICAgIHRoaXMubG9hZFNlcnZlcih7IGNmZ3VybDogZGF0YS51cmwgfSk7XHJcbn1cclxuXHJcbnNlcnZlci5nZXRQcm94eVVybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIFByb3h5Ty5vbignc3VjY2VlZCcsIHRoaXMuUHJveHlTdWNjZWVkLCB0aGlzKTtcclxuICAgIFByb3h5Ty5zdGFydCgpO1xyXG59XHJcblxyXG5zZXJ2ZXIucmVwZXRpdGlvblNlbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAodGhpcy5sb2NhbFRhZykgdGhpcy5sb2FkU2VydmVyKHRoaXMubG9jYWxUYWcpO1xyXG4gICAgZWxzZSB0aGlzLmxvYWRTZXR0aW5nKCk7XHJcbn1cclxuXHJcbnNlcnZlci5sb2FkU2VydmVyID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIHRoaXMubG9jYWxUYWcgPSBkYXRhO1xyXG4gICAgbGV0IHhociA9IGNjLmxvYWRlci5nZXRYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcclxuICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApKSB7XHJcbiAgICAgICAgICAgIGxldCByZXNwb25lID0geGhyLnJlc3BvbnNlVGV4dDtcclxuICAgICAgICAgICAgbGV0IHJlc3AgPSBKU09OLnBhcnNlKHJlc3BvbmUpO1xyXG4gICAgICAgICAgICBsZXQgaGVhZCA9IHJlc3AuaGVhZDtcclxuICAgICAgICAgICAgbGV0IGJvZHkgPSByZXNwLmJvZHk7XHJcbiAgICAgICAgICAgIGlmIChoZWFkLmtleSkgYm9keSA9IGdsR2FtZS5lbmNyeXB0LmdldERlY29kZVVybChib2R5LCBoZWFkLmtleSk7XHJcbiAgICAgICAgICAgIGlmIChoZWFkLmNvZGUgIT0gbnVsbCAmJiB0eXBlb2YgY29kZSA9PSBcInN0cmluZ1wiKSBoZWFkLmNvZGUgPSBwYXJzZUludChoZWFkLmNvZGUpO1xyXG4gICAgICAgICAgICBlbHNlIGhlYWQuY29kZSA9IDA7XHJcbiAgICAgICAgICAgIGlmIChoZWFkICYmIGhlYWQuY29kZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlcmNmZyA9IGJvZHk7XHJcbiAgICAgICAgICAgICAgICBnbEdhbWUudXNlci5zZXRVcmwoYm9keSk7XHJcbiAgICAgICAgICAgICAgICBnbEdhbWUuZW1pdHRlci5lbWl0KE1FU1NBR0UuVVBEQVRFX1NFUlZFUl9DRkcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xyXG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4geyB9O1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGdsR2FtZS5zZXJ2ZXJjZmcucmVwZXRpdGlvblNlbmQoKTtcclxuICAgICAgICAgICAgfSwgNTAwMClcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgeGhyLnRpbWVvdXQgPSAxNTAwMDtcclxuICAgIHhoci5vbmVycm9yID0gKGVycm9yKSA9PiB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGdsR2FtZS5zZXJ2ZXJjZmcucmVwZXRpdGlvblNlbmQoKTtcclxuICAgICAgICB9LCA1MDAwKVxyXG4gICAgfVxyXG4gICAgbGV0IHdob2xldXJsID0gYCR7ZGF0YS5jZmd1cmx9YDtcclxuICAgIGxldCByb3V0ZSA9IFwiaHR0cC5yZXFVcmxcIjtcclxuICAgIGxldCBtc2cgPSB7XHJcbiAgICAgICAgaGVhZDoge1xyXG4gICAgICAgICAgICByb3V0ZTogcm91dGUsXHJcbiAgICAgICAgICAgIG1zZ2luZGV4OiAwLFxyXG4gICAgICAgICAgICBmaXJzdFJlcTogMVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYm9keToge31cclxuICAgIH07XHJcbiAgICBpZiAobXNnLmJvZHkgJiYgIW1zZy5oZWFkLmtleSkge1xyXG4gICAgICAgIGxldCBkYXRhID0ge307XHJcbiAgICAgICAgZGF0YSA9IGdsR2FtZS5lbmNyeXB0LmdldEVuY29kZVVybChtc2cuYm9keSk7XHJcbiAgICAgICAgbXNnLmJvZHkgPSBkYXRhW1wiZGF0YVwiXTtcclxuICAgICAgICBtc2cuaGVhZC5rZXkgPSBkYXRhW1wiZGF0YUtleVwiXTtcclxuICAgIH1cclxuICAgIHhoci5vcGVuKFwiUE9TVFwiLCB3aG9sZXVybCwgdHJ1ZSk7XHJcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOFwiKTtcclxuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KG1zZykpO1xyXG59O1xyXG5cclxuc2VydmVyLmxvYWRTZXR0aW5nQ0IgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgdGhpcy5sb2NhbFRhZyA9IGRhdGE7XHJcbiAgICBsZXQgeGhyID0gY2MubG9hZGVyLmdldFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgIGNjLmxvZygneGhyLnJlYWR5U3RhdGU9JyArIHhoci5yZWFkeVN0YXRlICsgJyAgeGhyLnN0YXR1cz0nICsgeGhyLnN0YXR1cyk7XHJcbiAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSkge1xyXG4gICAgICAgICAgICBsZXQgcmVzcG9uZSA9IHhoci5yZXNwb25zZVRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmVyY2ZnID0gSlNPTi5wYXJzZShyZXNwb25lKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5zZXJ2ZXJjZmcucGxhdFN2clBvcnQgPSA4MDgxO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnNlcnZlcmNmZy5wbGF0U3ZySG9zdCA9ICdodHRwOi8vMTkyLjE2OC4yLjE1JztcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCLojrflj5bnmoRzZXJ2ZXJjZmcgIGxvYWRTZXR0aW5nQ0JcIiwgdGhpcy5zZXJ2ZXJjZmcpO1xyXG4gICAgICAgICAgICBnbEdhbWUuZW1pdHRlci5lbWl0KE1FU1NBR0UuVVBEQVRFX1NFUlZFUl9DRkcpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB4aHIudGltZW91dCA9IDUwMDA7XHJcbiAgICB4aHIub25lcnJvciA9IChlcnJvcikgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sb2NhbFRhZykgZ2xHYW1lLnNlcnZlcmNmZy5sb2FkU2V0dGluZ0NCKGdsR2FtZS5zZXJ2ZXJjZmcubG9jYWxUYWcpO1xyXG4gICAgICAgICAgICBlbHNlIGdsR2FtZS5zZXJ2ZXJjZmcubG9hZFNldHRpbmcoKTtcclxuICAgICAgICB9LCA1MDAwKVxyXG4gICAgfVxyXG4gICAgbGV0IFVSTFByb2R1Y3R0YWcgPSBkYXRhLnByb2R1Y3R0YWc7XHJcbiAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSAmJiB3aW5kb3cgJiYgd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmKSB7XHJcbiAgICAgICAgVVJMUHJvZHVjdHRhZyA9IHRoaXMuYW5hbHlzaXNVUkxQYXJhbWV0ZXIod2luZG93LmxvY2F0aW9uLmhyZWYpLmFyZ3MucHJvZHVjdHRhZztcclxuICAgIH1cclxuICAgIGxldCB3aG9sZXVybCA9IGAke2RhdGEuY2ZndXJsfS9wcm9kdWN0cy8ke1VSTFByb2R1Y3R0YWcgfHwgZGF0YS5wcm9kdWN0dGFnfS5qc29uYDtcclxuICAgIGNvbnNvbGUubG9nKFwid2hvbGV1cmw9XCIsIHdob2xldXJsKTtcclxuICAgIHhoci5vcGVuKFwiR0VUXCIsIHdob2xldXJsLCB0cnVlKTtcclxuICAgIHhoci5zZW5kKCk7XHJcbn07XHJcblxyXG4vL+i3s+i9rOWIsFFR5a+56K+d5qGGL+ekvuS6pOi9r+S7tueVjOmdolxyXG5zZXJ2ZXIudHVybk90aGVyQXBwID0gZnVuY3Rpb24gKHR5cGUsIFFRTnVtYmVyID0gbnVsbCkge1xyXG4gICAgbGV0IGhvc3QgPSB0aGlzLnNlcnZlcmNmZ1tcInBsYXRTdnJIb3N0XCJdO1xyXG4gICAgbGV0IHBvcnQgPSB0aGlzLnNlcnZlcmNmZ1tcInBsYXRTdnJQb3J0XCJdO1xyXG4gICAgaWYgKFFRTnVtYmVyKSB7XHJcbiAgICAgICAgY2Muc3lzLm9wZW5VUkwoYGh0dHA6Ly8ke2hvc3R9OiR7cG9ydH0vb3BlbkFwcC5odG1sP3R5cGU9JHt0eXBlfSZ1cmw9JHtRUU51bWJlcn1gKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2Muc3lzLm9wZW5VUkwoYGh0dHA6Ly8ke2hvc3R9OiR7cG9ydH0vb3BlbkFwcC5odG1sP3R5cGU9JHt0eXBlfWApO1xyXG4gICAgfVxyXG59XHJcbi8vIOino+aekFVSTOaYr+WQpuW4puiwg+ivleWPguaVsFxyXG5zZXJ2ZXIuYW5hbHlzaXNVUkxQYXJhbWV0ZXIgPSBmdW5jdGlvbiAoVVJMKSB7XHJcbiAgICBsZXQgYXJyID0gVVJMLnNwbGl0KFwiP1wiKTtcclxuICAgIGxldCBvYmogPSB7XHJcbiAgICAgICAgdXJsOiBudWxsLFxyXG4gICAgICAgIGFyZ3M6IHt9XHJcbiAgICB9O1xyXG4gICAgb2JqLnVybCA9IGFyclswXTtcclxuICAgIC8vIOaLhuWIhuWQjuWmguaenOmVv+W6puWwj+S6jjLor7TmmI5VUkzmmK/kuI3luKblj4LmlbDnmoRcclxuICAgIGlmIChhcnIubGVuZ3RoIDwgMikgcmV0dXJuIG9iajtcclxuICAgIGxldCBtYXBBcnIgPSBhcnJbMV0uc3BsaXQoXCImXCIpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXBBcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgcGFyYW1ldGVyID0gbWFwQXJyW2ldLnNwbGl0KFwiPVwiKTtcclxuICAgICAgICBvYmouYXJnc1twYXJhbWV0ZXJbMF1dID0gcGFyYW1ldGVyWzFdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9ialxyXG59O1xyXG5zZXJ2ZXIuZ2V0TG9jYWxUYWcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5sb2NhbFRhZztcclxufTtcclxuc2VydmVyLmlzRW5hYmxlSG90VXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuYl9lbmFibGVIb3RVcGRhdGU7XHJcbn07XHJcbnNlcnZlci5nZXRTZXJ2ZXJDZmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zZXJ2ZXJjZmc7XHJcbn07XHJcbi8qKlxyXG4gKiDojrflj5bliIbkuqvkuoznu7TnoIHlm77niYflnLDlnYBcclxuICovXHJcbnNlcnZlci5nZXRRUkNvZGVVUkwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgaG9zdCA9IHRoaXMuc2VydmVyY2ZnW1wicGxhdFN2ckhvc3RcIl07XHJcbiAgICBsZXQgcG9ydCA9IHRoaXMuc2VydmVyY2ZnW1wicGxhdFN2clBvcnRcIl07XHJcbiAgICByZXR1cm4gYCR7aG9zdH06JHtwb3J0fS9zaGFyZWltZy9jb2RlLnBuZ2BcclxufTtcclxuLyoqXHJcbiAqIOiOt+WPluW9k+WJjea4uOaIj+inhOWImVxyXG4gKiBAcGFyYW0gdGFnIOagh+etvumhtee8luWPt1xyXG4gKiBAcGFyYW0gZ2FtZU5hbWUg5oyH5a6a5ri45oiP5ZCN5a2XXHJcbiAqL1xyXG5zZXJ2ZXIuZ2V0R2FtZVJ1bGVVUkwgPSBmdW5jdGlvbiAodGFnLCBnYW1lTmFtZSkge1xyXG4gICAgbGV0IGhvc3QgPSB0aGlzLnNlcnZlcmNmZ1tcInBsYXRTdnJIb3N0XCJdO1xyXG4gICAgbGV0IHBvcnQgPSB0aGlzLnNlcnZlcmNmZ1tcInBsYXRTdnJQb3J0XCJdO1xyXG4gICAgbGV0IGN1ckdhbWVJRCA9IGdsR2FtZS5yb29tLmdldChcImN1ckVudGVyR2FtZUlEXCIpO1xyXG4gICAgaWYgKCFnYW1lTmFtZSkgZ2FtZU5hbWUgPSBnbEdhbWUuc2NlbmUuZ2V0U2NlbmVOYW1lQnlJRChjdXJHYW1lSUQpO1xyXG4gICAgcmV0dXJuIGBodHRwOi8vJHtob3N0fToke3BvcnR9L2dhbWVydWxlLyR7Z2FtZU5hbWV9LyR7dGFnfS5odG1sYFxyXG59O1xyXG5cclxuLyoqXHJcbiAqIOiOt+WPluW9k+WJjea4uOaIj+eDreabtOWcsOWdgFxyXG4gKi9cclxuc2VydmVyLmdldEhvdHVwZGF0ZVZlcnNpb25VcmwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgaG90VXBkYXRlVVJMID0gdGhpcy5zZXJ2ZXJjZmdbXCJob3RVcmxcIl07XHJcbiAgICBsZXQgc3RyZGlhZ29uYWwgPSBob3RVcGRhdGVVUkxbaG90VXBkYXRlVVJMLmxlbmd0aCAtIDFdID09PSBcIi9cIiA/IFwiXCIgOiBcIi9cIjtcclxuICAgIHJldHVybiBob3RVcGRhdGVVUkwgKyBzdHJkaWFnb25hbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIOW8gOWQr+S4i+i9veWcsOWdgFxyXG4gKi9cclxuc2VydmVyLm9wZW5Eb3duTG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGNjLnN5cy5vcGVuVVJMKHRoaXMuc2VydmVyY2ZnW1wiZG93bkxvYWRQYWdlXCJdKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPluW9k+WJjea4uOaIj+eDreabtOWcsOWdgFxyXG4gKi9cclxuc2VydmVyLmdldEhvdERvd25WZXJzaW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VydmVyY2ZnW1wiZG93blZlcnNpb25cIl07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDojrflj5bntKfmgKXlhazlkYrlvIDlhbNcclxuICovXHJcbnNlcnZlci5nZXRCb2xNYWludGFpbmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnNlcnZlcmNmZ1tcImVtZXJnZW5jeU1haW50ZW5hbmNlU3dpdGNoXCJdO1xyXG59XHJcblxyXG4vKipcclxuICog6I635Y+W57Sn5oCl5YWs5ZGK5YaF5a65XHJcbiAqL1xyXG5zZXJ2ZXIuZ2V0TWFpbnRhaW5pbmdDb250ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VydmVyY2ZnW1wiZW1lcmdlbmN5TWFpbnRlbmFuY2VDb250ZW50XCJdO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICghZ19pbnN0YW5jZSkge1xyXG4gICAgICAgIGdfaW5zdGFuY2UgPSBuZXcgU2VydmVyKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ19pbnN0YW5jZTtcclxufTsiXX0=