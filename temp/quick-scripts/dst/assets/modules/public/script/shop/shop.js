
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/public/script/shop/shop.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5b3b8tsl9tGoK/ZiaKJsH9+', 'shop');
// modules/public/script/shop/shop.js

"use strict";

glGame.baseclass.extend({
  properties: {
    audio: {
      type: cc.AudioClip,
      "default": null
    },
    shopNomalPanel: cc.Prefab,
    shopFastPanel: cc.Prefab,
    shopAgencyPanel: cc.Prefab,
    shoprecord: cc.Prefab,
    content: cc.Node,
    selecttoggle: cc.Node,
    spineAnim: cc.Node,
    audio_recharge: {
      type: cc.AudioClip,
      "default": null
    }
  },
  onLoad: function onLoad() {
    this.currBtn = null;
    this.publicList = {};
    this.publicList[glGame.pay.AGENCYPAY] = "agencypay"; // 1 '代理充值',

    this.publicList[glGame.pay.EXCLUSIVE] = "exclusivepay"; // 2 '专享闪付',

    this.publicList[glGame.pay.FASTPAY] = "fastpay"; // 3 '公司入款',

    this.publicList[glGame.pay.ALIPAY] = "alipay"; // 4 '支付宝充值',

    this.publicList[glGame.pay.WECHATPAY] = "wechatpay"; // 5 '微信充值',

    this.publicList[glGame.pay.BANKCARDPAY] = "bankcardpay"; // 6 '银行卡充值',

    this.publicList[glGame.pay.CLOUDPAY] = "cloudpay"; // 7 '云闪付充值',

    this.publicList[glGame.pay.JINGDONGPAY] = "jingdongpay"; // 8 '京东支付',

    this.publicList[glGame.pay.QQPAY] = "qqpay"; // 9 'QQ支付',

    this.PrefabList = {
      "agencypay": this.shopAgencyPanel,
      "alipay": this.shopNomalPanel,
      "wechatpay": this.shopNomalPanel,
      "bankcardpay": this.shopNomalPanel,
      "fastpay": this.shopNomalPanel,
      "cloudpay": this.shopNomalPanel,
      "jingdongpay": this.shopNomalPanel,
      "qqpay": this.shopNomalPanel
    };
    this.RecordData = {};
    glGame.audio.closeCurEffect();
    glGame.audio.playSoundEffect(this.audio, true);
    glGame.emitter.on("showShopUI", this.showUI, this);
    glGame.emitter.on("showSuccessAnim", this.showSuccessAnim, this);
    glGame.emitter.on("".concat(this.node.name).concat(MESSAGE.UI.ACTION_END), this.shopActionEnd, this);
    glGame.emitter.on("saveCodeToLocalShop", this.saveCodeToLocalShop, this);
    glGame.emitter.on("showrechargeRecord", this.btn_recordCB, this);
    glGame.panel.showEffectPariticle(this.node);
  },
  showUI: function showUI() {},
  showSuccessAnim: function showSuccessAnim(msg) {
    this.spineAnim.active = true;
    glGame.audio.playSoundEffect(this.audio_recharge);
    var skeleton = this.spineAnim.getChildByName("skeleton").getComponent(sp.Skeleton);
    skeleton.setAnimation(0, "appears", false);
    skeleton.setCompleteListener(function (trackEntry, loopCount) {
      var name = trackEntry.animation ? trackEntry.animation.name : '';

      if (name === 'appears' || name === 'looping') {
        skeleton.setAnimation(0, "looping", true);
      }
    });
  },
  shopActionEnd: function shopActionEnd() {
    var _this = this;

    glGame.gameNet.send_msg('http.ReqPayClassList', {}, function (route, msg) {
      _this.PayTypeList = msg.result.data;
      _this.complaint = msg.result.complaint;

      _this.setOrder();
    });
  },
  saveCodeToLocalShop: function saveCodeToLocalShop() {},
  setOrder: function setOrder() {
    var iFirst = true;
    var btnList = this.node.getChildByName("btnList");

    for (var i = 0; i < this.PayTypeList.length; i++) {
      var object = cc.instantiate(btnList.getChildByName(this.publicList[this.PayTypeList[i].id]));
      if (!object) continue;
      object.parent = this.selecttoggle;
      object.x = 0;
      object.active = false;

      if (iFirst) {
        this.currBtn = object;
        this.currBtn.getChildByName("checkmark").active = true;
        this.click_Type(this.publicList[this.PayTypeList[i].id]);
      }

      iFirst = false;
      object.setSiblingIndex(i);
      object.getChildByName("recommend").active = this.PayTypeList[i].recommend != 0;
      object.getChildByName("freestaff").active = this.PayTypeList[i].giveProportion != 0;
      object.getChildByName("freestaff").getChildByName("num").getComponent(cc.Label).string = Number(this.PayTypeList[i].giveProportion).div(100) + "%";
    }

    glGame.panel.showEffectNode(this, this.selecttoggle, 0.02, true);
  },
  getFloat: function getFloat(value) {
    return Number(value).div(100).toString();
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "close_eff":
        this.click_close();
        break;

      case "wechatpay":
      case "alipay":
      case "fastpay":
      case "exclusivepay":
      case "agencypay":
      case "bankcardpay":
      case "cloudpay":
      case "jingdongpay":
      case "qqpay":
        this.currBtn.getChildByName("checkmark").active = false;
        this.currBtn = node;
        this.currBtn.getChildByName("checkmark").active = true;
        this.click_Type(name);
        break;

      case "btn_fanhuishouye":
        this.btn_fanhuishouyeCB();
        break;

      case "btn_zaichongyici":
        this.btn_zaichongyiciCB();
        break;

      case "btn_record":
        this.btn_recordCB();
        break;

      case "btn_closeAni":
        this.spineAnim.active = false;
        break;

      default:
        console.error("no find button name -> %s", name);
    }
  },
  ReqPayType: function ReqPayType(typeId, name) {
    var _this2 = this;

    var Prefab = this.PrefabList[name];

    if (this.RecordData[typeId]) {
      var panel = glGame.panel.showChildPanel(Prefab, this.content);
      var script = panel.getComponent(Prefab.name);
      script.initUI(this.RecordData[typeId].result);
      return;
    }

    glGame.gameNet.send_msg('http.ReqPayClass', {
      typeId: typeId
    }, function (route, msg) {
      var panel = glGame.panel.showChildPanel(Prefab, _this2.content);
      var script = panel.getComponent(Prefab.name);

      if (typeId == 1) {
        msg.result.complaint = _this2.complaint;
      }

      script.initUI(msg.result);
      _this2.RecordData[typeId] = msg;
    });
  },
  btn_recordCB: function btn_recordCB() {
    glGame.panel.showChildPanel(this.shoprecord, this.node);
  },
  btn_fanhuishouyeCB: function btn_fanhuishouyeCB() {
    this.remove();
  },
  btn_zaichongyiciCB: function btn_zaichongyiciCB() {
    this.spineAnim.active = false;
    this.spineAnim.getChildByName("img_czcg").active = false;
    this.spineAnim.getChildByName("img_rycp").active = false;
  },
  click_close: function click_close() {
    this.remove();
  },
  click_Type: function click_Type(name) {
    this.content.destroyAllChildren();
    this.content.removeAllChildren();
    var index = this.getIndex(name);
    var id = this.PayTypeList[index].id;
    this.ReqPayType(id, name);
  },
  getIndex: function getIndex(name) {
    var payid = 0;

    for (var id in this.publicList) {
      if (this.publicList[id] == name) {
        payid = id;
        break;
      }
    }

    for (var index in this.PayTypeList) {
      if (this.PayTypeList[index].id == payid) {
        return index;
      }
    }
  },
  OnDestroy: function OnDestroy() {
    glGame.emitter.off("showShopUI", this);
    glGame.emitter.off("showSuccessAnim", this);
    glGame.emitter.off("".concat(this.node.name).concat(MESSAGE.UI.ACTION_END), this);
    glGame.emitter.off("saveCodeToLocalShop", this);
    glGame.emitter.off("showrechargeRecord", this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccHVibGljXFxzY3JpcHRcXHNob3BcXHNob3AuanMiXSwibmFtZXMiOlsiZ2xHYW1lIiwiYmFzZWNsYXNzIiwiZXh0ZW5kIiwicHJvcGVydGllcyIsImF1ZGlvIiwidHlwZSIsImNjIiwiQXVkaW9DbGlwIiwic2hvcE5vbWFsUGFuZWwiLCJQcmVmYWIiLCJzaG9wRmFzdFBhbmVsIiwic2hvcEFnZW5jeVBhbmVsIiwic2hvcHJlY29yZCIsImNvbnRlbnQiLCJOb2RlIiwic2VsZWN0dG9nZ2xlIiwic3BpbmVBbmltIiwiYXVkaW9fcmVjaGFyZ2UiLCJvbkxvYWQiLCJjdXJyQnRuIiwicHVibGljTGlzdCIsInBheSIsIkFHRU5DWVBBWSIsIkVYQ0xVU0lWRSIsIkZBU1RQQVkiLCJBTElQQVkiLCJXRUNIQVRQQVkiLCJCQU5LQ0FSRFBBWSIsIkNMT1VEUEFZIiwiSklOR0RPTkdQQVkiLCJRUVBBWSIsIlByZWZhYkxpc3QiLCJSZWNvcmREYXRhIiwiY2xvc2VDdXJFZmZlY3QiLCJwbGF5U291bmRFZmZlY3QiLCJlbWl0dGVyIiwib24iLCJzaG93VUkiLCJzaG93U3VjY2Vzc0FuaW0iLCJub2RlIiwibmFtZSIsIk1FU1NBR0UiLCJVSSIsIkFDVElPTl9FTkQiLCJzaG9wQWN0aW9uRW5kIiwic2F2ZUNvZGVUb0xvY2FsU2hvcCIsImJ0bl9yZWNvcmRDQiIsInBhbmVsIiwic2hvd0VmZmVjdFBhcml0aWNsZSIsIm1zZyIsImFjdGl2ZSIsInNrZWxldG9uIiwiZ2V0Q2hpbGRCeU5hbWUiLCJnZXRDb21wb25lbnQiLCJzcCIsIlNrZWxldG9uIiwic2V0QW5pbWF0aW9uIiwic2V0Q29tcGxldGVMaXN0ZW5lciIsInRyYWNrRW50cnkiLCJsb29wQ291bnQiLCJhbmltYXRpb24iLCJnYW1lTmV0Iiwic2VuZF9tc2ciLCJyb3V0ZSIsIlBheVR5cGVMaXN0IiwicmVzdWx0IiwiZGF0YSIsImNvbXBsYWludCIsInNldE9yZGVyIiwiaUZpcnN0IiwiYnRuTGlzdCIsImkiLCJsZW5ndGgiLCJvYmplY3QiLCJpbnN0YW50aWF0ZSIsImlkIiwicGFyZW50IiwieCIsImNsaWNrX1R5cGUiLCJzZXRTaWJsaW5nSW5kZXgiLCJyZWNvbW1lbmQiLCJnaXZlUHJvcG9ydGlvbiIsIkxhYmVsIiwic3RyaW5nIiwiTnVtYmVyIiwiZGl2Iiwic2hvd0VmZmVjdE5vZGUiLCJnZXRGbG9hdCIsInZhbHVlIiwidG9TdHJpbmciLCJvbkNsaWNrIiwiY2xpY2tfY2xvc2UiLCJidG5fZmFuaHVpc2hvdXllQ0IiLCJidG5femFpY2hvbmd5aWNpQ0IiLCJjb25zb2xlIiwiZXJyb3IiLCJSZXFQYXlUeXBlIiwidHlwZUlkIiwic2hvd0NoaWxkUGFuZWwiLCJzY3JpcHQiLCJpbml0VUkiLCJyZW1vdmUiLCJkZXN0cm95QWxsQ2hpbGRyZW4iLCJyZW1vdmVBbGxDaGlsZHJlbiIsImluZGV4IiwiZ2V0SW5kZXgiLCJwYXlpZCIsIk9uRGVzdHJveSIsIm9mZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxNQUFqQixDQUF3QjtBQUNwQkMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLEtBQUssRUFBRTtBQUNIQyxNQUFBQSxJQUFJLEVBQUVDLEVBQUUsQ0FBQ0MsU0FETjtBQUVILGlCQUFTO0FBRk4sS0FEQztBQUtSQyxJQUFBQSxjQUFjLEVBQUVGLEVBQUUsQ0FBQ0csTUFMWDtBQU1SQyxJQUFBQSxhQUFhLEVBQUVKLEVBQUUsQ0FBQ0csTUFOVjtBQU9SRSxJQUFBQSxlQUFlLEVBQUVMLEVBQUUsQ0FBQ0csTUFQWjtBQVFSRyxJQUFBQSxVQUFVLEVBQUVOLEVBQUUsQ0FBQ0csTUFSUDtBQVNSSSxJQUFBQSxPQUFPLEVBQUVQLEVBQUUsQ0FBQ1EsSUFUSjtBQVVSQyxJQUFBQSxZQUFZLEVBQUVULEVBQUUsQ0FBQ1EsSUFWVDtBQVdSRSxJQUFBQSxTQUFTLEVBQUVWLEVBQUUsQ0FBQ1EsSUFYTjtBQVlSRyxJQUFBQSxj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dUNDLE9BQU8sQ0FBQ0MsRUFBUixDQUFXQyxVQUFsRCxHQUFnRSxJQUFoRTtBQUNBM0MsSUFBQUEsTUFBTSxDQUFDbUMsT0FBUCxDQUFleUUsR0FBZixDQUFtQixxQkFBbkIsRUFBMEMsSUFBMUM7QUFDQTVHLElBQUFBLE1BQU0sQ0FBQ21DLE9BQVAsQ0FBZXlFLEdBQWYsQ0FBbUIsb0JBQW5CLEVBQXlDLElBQXpDO0FBQ0g7QUEzTG1CLENBQXhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJnbEdhbWUuYmFzZWNsYXNzLmV4dGVuZCh7XHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgYXVkaW86IHtcclxuICAgICAgICAgICAgdHlwZTogY2MuQXVkaW9DbGlwLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzaG9wTm9tYWxQYW5lbDogY2MuUHJlZmFiLFxyXG4gICAgICAgIHNob3BGYXN0UGFuZWw6IGNjLlByZWZhYixcclxuICAgICAgICBzaG9wQWdlbmN5UGFuZWw6IGNjLlByZWZhYixcclxuICAgICAgICBzaG9wcmVjb3JkOiBjYy5QcmVmYWIsXHJcbiAgICAgICAgY29udGVudDogY2MuTm9kZSxcclxuICAgICAgICBzZWxlY3R0b2dnbGU6IGNjLk5vZGUsXHJcbiAgICAgICAgc3BpbmVBbmltOiBjYy5Ob2RlLFxyXG4gICAgICAgIGF1ZGlvX3JlY2hhcmdlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGNjLkF1ZGlvQ2xpcCxcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMuY3VyckJ0biA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wdWJsaWNMaXN0ID0ge31cclxuICAgICAgICB0aGlzLnB1YmxpY0xpc3RbZ2xHYW1lLnBheS5BR0VOQ1lQQVldID0gXCJhZ2VuY3lwYXlcIjsgICAgICAgICAvLyAxICfku6PnkIblhYXlgLwnLFxyXG4gICAgICAgIHRoaXMucHVibGljTGlzdFtnbEdhbWUucGF5LkVYQ0xVU0lWRV0gPSBcImV4Y2x1c2l2ZXBheVwiOyAgICAgIC8vIDIgJ+S4k+S6q+mXquS7mCcsXHJcbiAgICAgICAgdGhpcy5wdWJsaWNMaXN0W2dsR2FtZS5wYXkuRkFTVFBBWV0gPSBcImZhc3RwYXlcIjsgICAgICAgICAgICAgLy8gMyAn5YWs5Y+45YWl5qy+JyxcclxuICAgICAgICB0aGlzLnB1YmxpY0xpc3RbZ2xHYW1lLnBheS5BTElQQVldID0gXCJhbGlwYXlcIjsgICAgICAgICAgICAgICAvLyA0ICfmlK/ku5jlrp3lhYXlgLwnLFxyXG4gICAgICAgIHRoaXMucHVibGljTGlzdFtnbEdhbWUucGF5LldFQ0hBVFBBWV0gPSBcIndlY2hhdHBheVwiOyAgICAgICAgIC8vIDUgJ+W+ruS/oeWFheWAvCcsXHJcbiAgICAgICAgdGhpcy5wdWJsaWNMaXN0W2dsR2FtZS5wYXkuQkFOS0NBUkRQQVldID0gXCJiYW5rY2FyZHBheVwiOyAgICAgLy8gNiAn6ZO26KGM5Y2h5YWF5YC8JyxcclxuICAgICAgICB0aGlzLnB1YmxpY0xpc3RbZ2xHYW1lLnBheS5DTE9VRFBBWV0gPSBcImNsb3VkcGF5XCI7ICAgICAgICAgICAvLyA3ICfkupHpl6rku5jlhYXlgLwnLFxyXG4gICAgICAgIHRoaXMucHVibGljTGlzdFtnbEdhbWUucGF5LkpJTkdET05HUEFZXSA9IFwiamluZ2RvbmdwYXlcIjsgICAgICAvLyA4ICfkuqzkuJzmlK/ku5gnLFxyXG4gICAgICAgIHRoaXMucHVibGljTGlzdFtnbEdhbWUucGF5LlFRUEFZXSA9IFwicXFwYXlcIjsgICAgICAgICAgICAgICAgIC8vIDkgJ1FR5pSv5LuYJyxcclxuXHJcbiAgICAgICAgdGhpcy5QcmVmYWJMaXN0ID0ge1xyXG4gICAgICAgICAgICBcImFnZW5jeXBheVwiOiB0aGlzLnNob3BBZ2VuY3lQYW5lbCxcclxuICAgICAgICAgICAgXCJhbGlwYXlcIjogdGhpcy5zaG9wTm9tYWxQYW5lbCxcclxuICAgICAgICAgICAgXCJ3ZWNoYXRwYXlcIjogdGhpcy5zaG9wTm9tYWxQYW5lbCxcclxuICAgICAgICAgICAgXCJiYW5rY2FyZHBheVwiOiB0aGlzLnNob3BOb21hbFBhbmVsLFxyXG4gICAgICAgICAgICBcImZhc3RwYXlcIjogdGhpcy5zaG9wTm9tYWxQYW5lbCxcclxuICAgICAgICAgICAgXCJjbG91ZHBheVwiOiB0aGlzLnNob3BOb21hbFBhbmVsLFxyXG4gICAgICAgICAgICBcImppbmdkb25ncGF5XCI6IHRoaXMuc2hvcE5vbWFsUGFuZWwsXHJcbiAgICAgICAgICAgIFwicXFwYXlcIjogdGhpcy5zaG9wTm9tYWxQYW5lbCxcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5SZWNvcmREYXRhID0ge307XHJcbiAgICAgICAgZ2xHYW1lLmF1ZGlvLmNsb3NlQ3VyRWZmZWN0KCk7XHJcbiAgICAgICAgZ2xHYW1lLmF1ZGlvLnBsYXlTb3VuZEVmZmVjdCh0aGlzLmF1ZGlvLCB0cnVlKTtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vbihcInNob3dTaG9wVUlcIiwgdGhpcy5zaG93VUksIHRoaXMpXHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub24oXCJzaG93U3VjY2Vzc0FuaW1cIiwgdGhpcy5zaG93U3VjY2Vzc0FuaW0sIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9uKGAke3RoaXMubm9kZS5uYW1lfSR7TUVTU0FHRS5VSS5BQ1RJT05fRU5EfWAsIHRoaXMuc2hvcEFjdGlvbkVuZCwgdGhpcyk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub24oXCJzYXZlQ29kZVRvTG9jYWxTaG9wXCIsIHRoaXMuc2F2ZUNvZGVUb0xvY2FsU2hvcCwgdGhpcyk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub24oXCJzaG93cmVjaGFyZ2VSZWNvcmRcIiwgdGhpcy5idG5fcmVjb3JkQ0IsIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5wYW5lbC5zaG93RWZmZWN0UGFyaXRpY2xlKHRoaXMubm9kZSk7XHJcbiAgICB9LFxyXG4gICAgc2hvd1VJKCkge1xyXG5cclxuICAgIH0sXHJcbiAgICBzaG93U3VjY2Vzc0FuaW0obXNnKSB7XHJcbiAgICAgICAgdGhpcy5zcGluZUFuaW0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICBnbEdhbWUuYXVkaW8ucGxheVNvdW5kRWZmZWN0KHRoaXMuYXVkaW9fcmVjaGFyZ2UpO1xyXG4gICAgICAgIGxldCBza2VsZXRvbiA9IHRoaXMuc3BpbmVBbmltLmdldENoaWxkQnlOYW1lKFwic2tlbGV0b25cIikuZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKVxyXG4gICAgICAgIHNrZWxldG9uLnNldEFuaW1hdGlvbigwLCBcImFwcGVhcnNcIiwgZmFsc2UpO1xyXG4gICAgICAgIHNrZWxldG9uLnNldENvbXBsZXRlTGlzdGVuZXIoKHRyYWNrRW50cnksIGxvb3BDb3VudCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbmFtZSA9IHRyYWNrRW50cnkuYW5pbWF0aW9uID8gdHJhY2tFbnRyeS5hbmltYXRpb24ubmFtZSA6ICcnO1xyXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2FwcGVhcnMnIHx8IG5hbWUgPT09ICdsb29waW5nJykge1xyXG4gICAgICAgICAgICAgICAgc2tlbGV0b24uc2V0QW5pbWF0aW9uKDAsIFwibG9vcGluZ1wiLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBzaG9wQWN0aW9uRW5kKCkge1xyXG4gICAgICAgIGdsR2FtZS5nYW1lTmV0LnNlbmRfbXNnKCdodHRwLlJlcVBheUNsYXNzTGlzdCcsIHt9LCAocm91dGUsIG1zZykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLlBheVR5cGVMaXN0ID0gbXNnLnJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBsYWludCA9IG1zZy5yZXN1bHQuY29tcGxhaW50O1xyXG4gICAgICAgICAgICB0aGlzLnNldE9yZGVyKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBzYXZlQ29kZVRvTG9jYWxTaG9wKCkge1xyXG5cclxuICAgIH0sXHJcbiAgICBzZXRPcmRlcigpIHtcclxuICAgICAgICBsZXQgaUZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICBsZXQgYnRuTGlzdCA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcImJ0bkxpc3RcIik7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLlBheVR5cGVMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBvYmplY3QgPSBjYy5pbnN0YW50aWF0ZShidG5MaXN0LmdldENoaWxkQnlOYW1lKHRoaXMucHVibGljTGlzdFt0aGlzLlBheVR5cGVMaXN0W2ldLmlkXSkpO1xyXG4gICAgICAgICAgICBpZiAoIW9iamVjdCkgY29udGludWU7XHJcbiAgICAgICAgICAgIG9iamVjdC5wYXJlbnQgPSB0aGlzLnNlbGVjdHRvZ2dsZTtcclxuICAgICAgICAgICAgb2JqZWN0LnggPSAwO1xyXG4gICAgICAgICAgICBvYmplY3QuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKGlGaXJzdCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJCdG4gPSBvYmplY3Q7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJCdG4uZ2V0Q2hpbGRCeU5hbWUoXCJjaGVja21hcmtcIikuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tfVHlwZSh0aGlzLnB1YmxpY0xpc3RbdGhpcy5QYXlUeXBlTGlzdFtpXS5pZF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBvYmplY3Quc2V0U2libGluZ0luZGV4KGkpO1xyXG4gICAgICAgICAgICBvYmplY3QuZ2V0Q2hpbGRCeU5hbWUoXCJyZWNvbW1lbmRcIikuYWN0aXZlID0gdGhpcy5QYXlUeXBlTGlzdFtpXS5yZWNvbW1lbmQgIT0gMFxyXG4gICAgICAgICAgICBvYmplY3QuZ2V0Q2hpbGRCeU5hbWUoXCJmcmVlc3RhZmZcIikuYWN0aXZlID0gdGhpcy5QYXlUeXBlTGlzdFtpXS5naXZlUHJvcG9ydGlvbiAhPSAwXHJcbiAgICAgICAgICAgIG9iamVjdC5nZXRDaGlsZEJ5TmFtZShcImZyZWVzdGFmZlwiKS5nZXRDaGlsZEJ5TmFtZShcIm51bVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IE51bWJlcih0aGlzLlBheVR5cGVMaXN0W2ldLmdpdmVQcm9wb3J0aW9uKS5kaXYoMTAwKSArIFwiJVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbEdhbWUucGFuZWwuc2hvd0VmZmVjdE5vZGUodGhpcyx0aGlzLnNlbGVjdHRvZ2dsZSwwLjAyLHRydWUpO1xyXG5cclxuICAgIH0sXHJcbiAgICBnZXRGbG9hdCh2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAoTnVtYmVyKHZhbHVlKS5kaXYoMTAwKSkudG9TdHJpbmcoKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25DbGljayhuYW1lLCBub2RlKSB7XHJcbiAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJjbG9zZV9lZmZcIjogdGhpcy5jbGlja19jbG9zZSgpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIndlY2hhdHBheVwiOiBcclxuICAgICAgICAgICAgY2FzZSBcImFsaXBheVwiOiBcclxuICAgICAgICAgICAgY2FzZSBcImZhc3RwYXlcIjpcclxuICAgICAgICAgICAgY2FzZSBcImV4Y2x1c2l2ZXBheVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwiYWdlbmN5cGF5XCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJiYW5rY2FyZHBheVwiOlxyXG4gICAgICAgICAgICBjYXNlIFwiY2xvdWRwYXlcIjpcclxuICAgICAgICAgICAgY2FzZSBcImppbmdkb25ncGF5XCI6XHJcbiAgICAgICAgICAgIGNhc2UgXCJxcXBheVwiOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyQnRuLmdldENoaWxkQnlOYW1lKFwiY2hlY2ttYXJrXCIpLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyQnRuID0gbm9kZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VyckJ0bi5nZXRDaGlsZEJ5TmFtZShcImNoZWNrbWFya1wiKS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGlja19UeXBlKG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJidG5fZmFuaHVpc2hvdXllXCI6IHRoaXMuYnRuX2Zhbmh1aXNob3V5ZUNCKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiYnRuX3phaWNob25neWljaVwiOiB0aGlzLmJ0bl96YWljaG9uZ3lpY2lDQigpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9yZWNvcmRcIjogdGhpcy5idG5fcmVjb3JkQ0IoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJidG5fY2xvc2VBbmlcIjogdGhpcy5zcGluZUFuaW0uYWN0aXZlID0gZmFsc2U7IGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBjb25zb2xlLmVycm9yKFwibm8gZmluZCBidXR0b24gbmFtZSAtPiAlc1wiLCBuYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgUmVxUGF5VHlwZSh0eXBlSWQsIG5hbWUpIHtcclxuICAgICAgICBsZXQgUHJlZmFiID0gdGhpcy5QcmVmYWJMaXN0W25hbWVdXHJcbiAgICAgICAgaWYgKHRoaXMuUmVjb3JkRGF0YVt0eXBlSWRdKSB7XHJcbiAgICAgICAgICAgIGxldCBwYW5lbCA9IGdsR2FtZS5wYW5lbC5zaG93Q2hpbGRQYW5lbChQcmVmYWIsIHRoaXMuY29udGVudCk7XHJcbiAgICAgICAgICAgIGxldCBzY3JpcHQgPSBwYW5lbC5nZXRDb21wb25lbnQoUHJlZmFiLm5hbWUpO1xyXG4gICAgICAgICAgICBzY3JpcHQuaW5pdFVJKHRoaXMuUmVjb3JkRGF0YVt0eXBlSWRdLnJlc3VsdClcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGdsR2FtZS5nYW1lTmV0LnNlbmRfbXNnKCdodHRwLlJlcVBheUNsYXNzJywgeyB0eXBlSWQ6IHR5cGVJZCB9LCAocm91dGUsIG1zZykgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcGFuZWwgPSBnbEdhbWUucGFuZWwuc2hvd0NoaWxkUGFuZWwoUHJlZmFiLCB0aGlzLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICBsZXQgc2NyaXB0ID0gcGFuZWwuZ2V0Q29tcG9uZW50KFByZWZhYi5uYW1lKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVJZCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBtc2cucmVzdWx0LmNvbXBsYWludCA9IHRoaXMuY29tcGxhaW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNjcmlwdC5pbml0VUkobXNnLnJlc3VsdClcclxuICAgICAgICAgICAgdGhpcy5SZWNvcmREYXRhW3R5cGVJZF0gPSBtc2c7XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBidG5fcmVjb3JkQ0IoKSB7XHJcbiAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dDaGlsZFBhbmVsKHRoaXMuc2hvcHJlY29yZCwgdGhpcy5ub2RlKTtcclxuICAgIH0sXHJcbiAgICBidG5fZmFuaHVpc2hvdXllQ0IoKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmUoKVxyXG4gICAgfSxcclxuICAgIGJ0bl96YWljaG9uZ3lpY2lDQigpIHtcclxuICAgICAgICB0aGlzLnNwaW5lQW5pbS5hY3RpdmUgPSBmYWxzZVxyXG4gICAgICAgIHRoaXMuc3BpbmVBbmltLmdldENoaWxkQnlOYW1lKFwiaW1nX2N6Y2dcIikuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zcGluZUFuaW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfcnljcFwiKS5hY3RpdmUgPSBmYWxzZTtcclxuICAgIH0sXHJcbiAgICBjbGlja19jbG9zZSgpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZSgpXHJcbiAgICB9LFxyXG4gICAgY2xpY2tfVHlwZShuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZW50LmRlc3Ryb3lBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMuY29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMuZ2V0SW5kZXgobmFtZSlcclxuICAgICAgICBsZXQgaWQgPSB0aGlzLlBheVR5cGVMaXN0W2luZGV4XS5pZDtcclxuICAgICAgICB0aGlzLlJlcVBheVR5cGUoaWQsIG5hbWUpXHJcbiAgICB9LFxyXG4gICAgZ2V0SW5kZXgobmFtZSkge1xyXG4gICAgICAgIGxldCBwYXlpZCA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgaWQgaW4gdGhpcy5wdWJsaWNMaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnB1YmxpY0xpc3RbaWRdID09IG5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHBheWlkID0gaWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpbmRleCBpbiB0aGlzLlBheVR5cGVMaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLlBheVR5cGVMaXN0W2luZGV4XS5pZCA9PSBwYXlpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIE9uRGVzdHJveSgpIHtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoXCJzaG93U2hvcFVJXCIsIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9mZihcInNob3dTdWNjZXNzQW5pbVwiLCB0aGlzKTtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoYCR7dGhpcy5ub2RlLm5hbWV9JHtNRVNTQUdFLlVJLkFDVElPTl9FTkR9YCwgdGhpcyk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub2ZmKFwic2F2ZUNvZGVUb0xvY2FsU2hvcFwiLCB0aGlzKTtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoXCJzaG93cmVjaGFyZ2VSZWNvcmRcIiwgdGhpcyk7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=