
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/public/script/coinArrvalTip/coinArrvalTip.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '1b7a4busdJNy54xeAECsiXw', 'coinArrvalTip');
// modules/public/script/coinArrvalTip/coinArrvalTip.js

"use strict";

glGame.showGodOfWealth = "showGodOfWealth"; //财神到账 统一处理 入口

glGame.baseclass.extend({
  properties: {
    caishen_spine: sp.Skeleton,
    lab_money: cc.RichText,
    node_frame: cc.Node,
    node_alltip: cc.Node,
    node_tip2: cc.Node,
    audio_succeed: {
      type: cc.AudioClip,
      "default": null
    }
  },
  onLoad: function onLoad() {
    cc.game.addPersistRootNode(this.node);
    this.node.on('touchstart', this.touchstart, this);
    this.node.on('touchend', this.touchend, this);
    glGame.emitter.on('onCoinChanged', this.onCoinChangedHandler, this);
    glGame.emitter.on(glGame.showGodOfWealth, this.settingPotionHandler, this);
    glGame.emitter.on(MESSAGE.UI.CHANGE_SCENE_COMPLE, this.onChangeSceneComple, this);
    this.data = null;
    glGame.coinArral = this;
  },
  start: function start() {
    this.node.active = false;
  },
  onCoinChangedHandler: function onCoinChangedHandler(res) {
    var _this = this;

    var msg = res;

    if (this == undefined || this.node == undefined) {
      console.warn("可能会出现无法弹出 金币到账界面");
      return;
    } //抛弃保险柜的取和存的消息，已在原有回包中做自增自减


    if (msg.type == "bankSave" || msg.type == "bankOut") return;

    if (msg.type == 'bindPhoneReceive') {
      glGame.user.set('is_receive_register_phone_coin', 1);
      glGame.emitter.emit("updatePlazaSwitch");
    }

    glGame.user.reqGetCoin();
    var arrvalCoin = glGame.user.GoldTemp(msg.offset);

    if (msg.type == "recharge") {
      glGame.audio.playSoundEffect(this.audio_succeed); //充值之后将首冲设为状态取消设置为1；

      glGame.user.set("userRecharge", {
        discount: glGame.user.get("userRecharge").discount,
        discount_max: glGame.user.get("userRecharge").discount_max,
        exists: 1
      });

      if (this.node.active == true) {
        var changeCoin = Number(res.offset);

        var _arrvalCoin = this.getFixNumber(changeCoin);

        this.settingPotionHandler({
          pos: 3,
          coin: _arrvalCoin
        });
      } else {
        this.scheduleOnce(function () {
          if (!_this.data) {
            //如果子游戏没有处理
            var _changeCoin = Number(res.offset);

            var _arrvalCoin2 = _this.getFixNumber(_changeCoin);

            _this.settingPotionHandler({
              pos: 3,
              coin: _arrvalCoin2
            });
          }
        }, 0.3);
      }
    }
  },
  settingPotionHandler: function settingPotionHandler(res) {
    this.data = res;
    this.showAniHandler();
    this.updatePostion();
  },
  //场景切换的时候
  onChangeSceneComple: function onChangeSceneComple(sceneName) {
    if (this.node && this.node.active) {
      this.updatePostion();
    }
  },
  updatePostion: function updatePostion() {
    if (!this.data) return; //红包红屏专用

    if (this.data.pos == 5) this.node_frame.angle = 90;else this.node_frame.angle = 0;
    var pos = this.node.getChildByName("pos" + this.data.pos);
    pos.getComponent(cc.Widget).updateAlignment();

    if (pos) {
      this.node_frame.position = pos;
    }

    this.node_frame.scale = glGame.systemclass.convertInterface();

    if (this.node_frame.scale < 1) {
      this.node_frame.x = this.node_frame.x; // * this.node_frame.scale;

      this.node_frame.y = this.node_frame.y; // * this.node_frame.scale;
    }
  },
  showAniHandler: function showAniHandler() {
    var _this2 = this;

    if (!this.data) {
      return;
    }

    this.actionEnd();
    var coin = this.data.coin + "";
    this.node.zIndex = cc.macro.MAX_ZINDEX;
    this.node.active = true;
    this.node.getComponent(cc.Widget).updateAlignment();
    this.node.stopAllActions();
    this.lab_money.active = true;
    this.node_alltip.active = true;
    this.lab_money.string = "<color=#ffffff>\u60A8\u5145\u503C\u7684</color><color=#FFC200>".concat(coin, "</color><color=#ffffff>\u91D1\u5E01\u5DF2\u5230\u8D26!</color>");
    this.node.runAction(cc.sequence(cc.delayTime(30), cc.callFunc(function () {
      _this2.data = null;
      _this2.node.active = false;
      _this2.lab_money.active = false;
      _this2.node_alltip.active = false;
    })));
  },
  actionEnd: function actionEnd() {
    this.caishen_spine.setAnimation(0, "looping", true);
    this.caishen_spine.setCompleteListener(function () {});
  },
  touchstart: function touchstart(event) {},
  touchend: function touchend(event) {
    this.data = null;
    this.node.active = false;
    this.lab_money.active = false;
    this.node_alltip.active = false;
    this.node.active = false;
  },
  //返回保留两位小数的数值
  getFixNumber: function getFixNumber(value) {
    return Number(value).div(100).toString();
  },
  OnDestroy: function OnDestroy() {
    glGame.emitter.off('onCoinChanged', this);
    glGame.emitter.off(glGame.showGodOfWealth, this);
    glGame.emitter.off(MESSAGE.UI.CHANGE_SCENE_COMPLE, this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccHVibGljXFxzY3JpcHRcXGNvaW5BcnJ2YWxUaXBcXGNvaW5BcnJ2YWxUaXAuanMiXSwibmFtZXMiOlsiZ2xHYW1lIiwic2hvd0dvZE9mV2VhbHRoIiwiYmFzZWNsYXNzIiwiZXh0ZW5kIiwicHJvcGVydGllcyIsImNhaXNoZW5fc3BpbmUiLCJzcCIsIlNrZWxldG9uIiwibGFiX21vbmV5IiwiY2MiLCJSaWNoVGV4dCIsIm5vZGVfZnJhbWUiLCJOb2RlIiwibm9kZV9hbGx0aXAiLCJub2RlX3RpcDIiLCJhdWRpb19zdWNjZWVkIiwidHlwZSIsIkF1ZGlvQ2xpcCIsIm9uTG9hZCIsImdhbWUiLCJhZGRQZXJzaXN0Um9vdE5vZGUiLCJub2RlIiwib24iLCJ0b3VjaHN0YXJ0IiwidG91Y2hlbmQiLCJlbWl0dGVyIiwib25Db2luQ2hhbmdlZEhhbmRsZXIiLCJzZXR0aW5nUG90aW9uSGFuZGxlciIsIk1FU1NBR0UiLCJVSSIsIkNIQU5HRV9TQ0VORV9DT01QTEUiLCJvbkNoYW5nZVNjZW5lQ29tcGxlIiwiZGF0YSIsImNvaW5BcnJhbCIsInN0YXJ0IiwiYWN0aXZlIiwicmVzIiwibXNnIiwidW5kZWZpbmVkIiwiY29uc29sZSIsIndhcm4iLCJ1c2VyIiwic2V0IiwiZW1pdCIsInJlcUdldENvaW4iLCJhcnJ2YWxDb2luIiwiR29sZFRlbXAiLCJvZmZzZXQiLCJhdWRpbyIsInBsYXlTb3VuZEVmZmVjdCIsImRpc2NvdW50IiwiZ2V0IiwiZGlzY291bnRfbWF4IiwiZXhpc3RzIiwiY2hhbmdlQ29pbiIsIk51bWJlciIsImdldEZpeE51bWJlciIsInBvcyIsImNvaW4iLCJzY2hlZHVsZU9uY2UiLCJzaG93QW5pSGFuZGxlciIsInVwZGF0ZVBvc3Rpb24iLCJzY2VuZU5hbWUiLCJhbmdsZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50IiwiV2lkZ2V0IiwidXBkYXRlQWxpZ25tZW50IiwicG9zaXRpb24iLCJzY2FsZSIsInN5c3RlbWNsYXNzIiwiY29udmVydEludGVyZmFjZSIsIngiLCJ5IiwiYWN0aW9uRW5kIiwiekluZGV4IiwibWFjcm8iLCJNQVhfWklOREVYIiwic3RvcEFsbEFjdGlvbnMiLCJzdHJpbmciLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsImNhbGxGdW5jIiwic2V0QW5pbWF0aW9uIiwic2V0Q29tcGxldGVMaXN0ZW5lciIsImV2ZW50IiwidmFsdWUiLCJkaXYiLCJ0b1N0cmluZyIsIk9uRGVzdHJveSIsIm9mZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsTUFBTSxDQUFDQyxlQUFQLEdBQXlCLGlCQUF6QixFQUNBOztBQUNBRCxNQUFNLENBQUNFLFNBQVAsQ0FBaUJDLE1BQWpCLENBQXdCO0FBQ3BCQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsYUFBYSxFQUFFQyxFQUFFLENBQUNDLFFBRFY7QUFFUkMsSUFBQUEsU0FBUyxFQUFFQyxFQUFFLENBQUNDLFFBRk47QUFHUkMsSUFBQUEsVUFBVSxFQUFFRixFQUFFLENBQUNHLElBSFA7QUFJUkMsSUFBQUEsV0FBVyxFQUFFSixFQUFFLENBQUNHLElBSlI7QUFLUkUsSUFBQUEsU0FBUyxFQUFFTCxFQUFFLENBQUNHLElBTE47QUFNUkcsSUFBQUEsYUFBYSxFQUFFO0FBQ1hDLE1BQUFBLElBQUksRUFBRVAsRUFBRSxDQUFDUSxTQURFO0FBRVgsaUJBQVM7QUFGRTtBQU5QLEdBRFE7QUFZcEJDLEVBQUFBLE1BWm9CLG9CQVlYO0FBQ0xULElBQUFBLEVBQUUsQ0FBQ1UsSUFBSCxDQUFRQyxrQkFBUixDQUEyQixLQUFLQyxJQUFoQztBQUNBLFNBQUtBLElBQUwsQ0FBVUMsRUFBVixDQUFhLFlBQWIsRUFBMkIsS0FBS0MsVUFBaEMsRUFBNEMsSUFBNUM7QUFDQSxTQUFLRixJQUFMLENBQVVDLEVBQVYsQ0FBYSxVQUFiLEVBQXlCLEtBQUtFLFFBQTlCLEVBQXdDLElBQXhDO0FBQ0F4QixJQUFBQSxNQUFNLENBQUN5QixPQUFQLENBQWVILEVBQWYsQ0FBa0IsZUFBbEIsRUFBbUMsS0FBS0ksb0JBQXhDLEVBQThELElBQTlEO0FBQ0ExQixJQUFBQSxNQUFNLENBQUN5QixPQUFQLENBQWVILEVBQWYsQ0FBa0J0QixNQUFNLENBQUNDLGVBQXpCLEVBQTBDLEtBQUswQixvQkFBL0MsRUFBcUUsSUFBckU7QUFDQTNCLElBQUFBLE1BQU0sQ0FBQ3lCLE9BQVAsQ0FBZUgsRUFBZixDQUFrQk0sT0FBTyxDQUFDQyxFQUFSLENBQVdDLG1CQUE3QixFQUFrRCxLQUFLQyxtQkFBdkQsRUFBNEUsSUFBNUU7QUFDQSxTQUFLQyxJQUFMLEdBQVksSUFBWjtBQUNBaEMsSUFBQUEsTUFBTSxDQUFDaUMsU0FBUCxHQUFtQixJQUFuQjtBQUNILEdBckJtQjtBQXNCcEJDLEVBQUFBLEtBdEJvQixtQkFzQlo7QUFDSixTQUFLYixJQUFMLENBQVVjLE1BQVYsR0FBbUIsS0FBbkI7QUFDSCxHQXhCbUI7QUF5QnBCVCxFQUFBQSxvQkF6Qm9CLGdDQXlCQ1UsR0F6QkQsRUF5Qk07QUFBQTs7QUFDdEIsUUFBSUMsR0FBRyxHQUFHRCxHQUFWOztBQUNBLFFBQUksUUFBUUUsU0FBUixJQUFxQixLQUFLakIsSUFBTCxJQUFhaUIsU0FBdEMsRUFBaUQ7QUFDN0NDLE1BQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLGtCQUFiO0FBQ0E7QUFDSCxLQUxxQixDQU10Qjs7O0FBQ0EsUUFBSUgsR0FBRyxDQUFDckIsSUFBSixJQUFZLFVBQVosSUFBMEJxQixHQUFHLENBQUNyQixJQUFKLElBQVksU0FBMUMsRUFBcUQ7O0FBQ3JELFFBQUlxQixHQUFHLENBQUNyQixJQUFKLElBQVksa0JBQWhCLEVBQW9DO0FBQ2hDaEIsTUFBQUEsTUFBTSxDQUFDeUMsSUFBUCxDQUFZQyxHQUFaLENBQWdCLGdDQUFoQixFQUFrRCxDQUFsRDtBQUNBMUMsTUFBQUEsTUFBTSxDQUFDeUIsT0FBUCxDQUFla0IsSUFBZixDQUFvQixtQkFBcEI7QUFDSDs7QUFDRDNDLElBQUFBLE1BQU0sQ0FBQ3lDLElBQVAsQ0FBWUcsVUFBWjtBQUNBLFFBQUlDLFVBQVUsR0FBRzdDLE1BQU0sQ0FBQ3lDLElBQVAsQ0FBWUssUUFBWixDQUFxQlQsR0FBRyxDQUFDVSxNQUF6QixDQUFqQjs7QUFDQSxRQUFJVixHQUFHLENBQUNyQixJQUFKLElBQVksVUFBaEIsRUFBNEI7QUFDeEJoQixNQUFBQSxNQUFNLENBQUNnRCxLQUFQLENBQWFDLGVBQWIsQ0FBNkIsS0FBS2xDLGFBQWxDLEVBRHdCLENBRXhCOztBQUNBZixNQUFBQSxNQUFNLENBQUN5QyxJQUFQLENBQVlDLEdBQVosQ0FBZ0IsY0FBaEIsRUFBZ0M7QUFDNUJRLFFBQUFBLFFBQVEsRUFBRWxELE1BQU0sQ0FBQ3lDLElBQVAsQ0FBWVUsR0FBWixDQUFnQixjQUFoQixFQUFnQ0QsUUFEZDtBQUU1QkUsUUFBQUEsWUFBWSxFQUFFcEQsTUFBTSxDQUFDeUMsSUFBUCxDQUFZVSxHQUFaLENBQWdCLGNBQWhCLEVBQWdDQyxZQUZsQjtBQUc1QkMsUUFBQUEsTUFBTSxFQUFFO0FBSG9CLE9BQWhDOztBQU1BLFVBQUksS0FBS2hDLElBQUwsQ0FBVWMsTUFBVixJQUFvQixJQUF4QixFQUE4QjtBQUMxQixZQUFJbUIsVUFBVSxHQUFHQyxNQUFNLENBQUNuQixHQUFHLENBQUNXLE1BQUwsQ0FBdkI7O0FBQ0EsWUFBSUYsV0FBVSxHQUFHLEtBQUtXLFlBQUwsQ0FBa0JGLFVBQWxCLENBQWpCOztBQUNBLGFBQUszQixvQkFBTCxDQUEwQjtBQUFFOEIsVUFBQUEsR0FBRyxFQUFFLENBQVA7QUFBVUMsVUFBQUEsSUFBSSxFQUFFYjtBQUFoQixTQUExQjtBQUNILE9BSkQsTUFJTztBQUNILGFBQUtjLFlBQUwsQ0FBa0IsWUFBTTtBQUNwQixjQUFJLENBQUMsS0FBSSxDQUFDM0IsSUFBVixFQUFnQjtBQUFDO0FBQ2IsZ0JBQUlzQixXQUFVLEdBQUdDLE1BQU0sQ0FBQ25CLEdBQUcsQ0FBQ1csTUFBTCxDQUF2Qjs7QUFDQSxnQkFBSUYsWUFBVSxHQUFHLEtBQUksQ0FBQ1csWUFBTCxDQUFrQkYsV0FBbEIsQ0FBakI7O0FBQ0EsWUFBQSxLQUFJLENBQUMzQixvQkFBTCxDQUEwQjtBQUFFOEIsY0FBQUEsR0FBRyxFQUFFLENBQVA7QUFBVUMsY0FBQUEsSUFBSSxFQUFFYjtBQUFoQixhQUExQjtBQUNIO0FBQ0osU0FORCxFQU1HLEdBTkg7QUFPSDtBQUNKO0FBRUosR0EvRG1CO0FBZ0VwQmxCLEVBQUFBLG9CQWhFb0IsZ0NBZ0VDUyxHQWhFRCxFQWdFTTtBQUN0QixTQUFLSixJQUFMLEdBQVlJLEdBQVo7QUFDQSxTQUFLd0IsY0FBTDtBQUNBLFNBQUtDLGFBQUw7QUFDSCxHQXBFbUI7QUFxRXBCO0FBQ0E5QixFQUFBQSxtQkF0RW9CLCtCQXNFQStCLFNBdEVBLEVBc0VXO0FBQzNCLFFBQUksS0FBS3pDLElBQUwsSUFBYSxLQUFLQSxJQUFMLENBQVVjLE1BQTNCLEVBQW1DO0FBQy9CLFdBQUswQixhQUFMO0FBQ0g7QUFDSixHQTFFbUI7QUEyRXBCQSxFQUFBQSxhQTNFb0IsMkJBMkVKO0FBQ1osUUFBSSxDQUFDLEtBQUs3QixJQUFWLEVBQWdCLE9BREosQ0FFWjs7QUFDQSxRQUFJLEtBQUtBLElBQUwsQ0FBVXlCLEdBQVYsSUFBaUIsQ0FBckIsRUFBd0IsS0FBSzlDLFVBQUwsQ0FBZ0JvRCxLQUFoQixHQUF3QixFQUF4QixDQUF4QixLQUNLLEtBQUtwRCxVQUFMLENBQWdCb0QsS0FBaEIsR0FBd0IsQ0FBeEI7QUFFTCxRQUFJTixHQUFHLEdBQUcsS0FBS3BDLElBQUwsQ0FBVTJDLGNBQVYsQ0FBeUIsUUFBUSxLQUFLaEMsSUFBTCxDQUFVeUIsR0FBM0MsQ0FBVjtBQUNBQSxJQUFBQSxHQUFHLENBQUNRLFlBQUosQ0FBaUJ4RCxFQUFFLENBQUN5RCxNQUFwQixFQUE0QkMsZUFBNUI7O0FBQ0EsUUFBSVYsR0FBSixFQUFTO0FBQ0wsV0FBSzlDLFVBQUwsQ0FBZ0J5RCxRQUFoQixHQUEyQlgsR0FBM0I7QUFDSDs7QUFDRCxTQUFLOUMsVUFBTCxDQUFnQjBELEtBQWhCLEdBQXdCckUsTUFBTSxDQUFDc0UsV0FBUCxDQUFtQkMsZ0JBQW5CLEVBQXhCOztBQUNBLFFBQUksS0FBSzVELFVBQUwsQ0FBZ0IwRCxLQUFoQixHQUF3QixDQUE1QixFQUErQjtBQUMzQixXQUFLMUQsVUFBTCxDQUFnQjZELENBQWhCLEdBQW9CLEtBQUs3RCxVQUFMLENBQWdCNkQsQ0FBcEMsQ0FEMkIsQ0FDVzs7QUFDdEMsV0FBSzdELFVBQUwsQ0FBZ0I4RCxDQUFoQixHQUFvQixLQUFLOUQsVUFBTCxDQUFnQjhELENBQXBDLENBRjJCLENBRVc7QUFDekM7QUFDSixHQTNGbUI7QUE2RnBCYixFQUFBQSxjQTdGb0IsNEJBNkZIO0FBQUE7O0FBQ2IsUUFBSSxDQUFDLEtBQUs1QixJQUFWLEVBQWdCO0FBQ1o7QUFDSDs7QUFDRCxTQUFLMEMsU0FBTDtBQUNBLFFBQUloQixJQUFJLEdBQUcsS0FBSzFCLElBQUwsQ0FBVTBCLElBQVYsR0FBaUIsRUFBNUI7QUFDQSxTQUFLckMsSUFBTCxDQUFVc0QsTUFBVixHQUFtQmxFLEVBQUUsQ0FBQ21FLEtBQUgsQ0FBU0MsVUFBNUI7QUFDQSxTQUFLeEQsSUFBTCxDQUFVYyxNQUFWLEdBQW1CLElBQW5CO0FBQ0EsU0FBS2QsSUFBTCxDQUFVNEMsWUFBVixDQUF1QnhELEVBQUUsQ0FBQ3lELE1BQTFCLEVBQWtDQyxlQUFsQztBQUNBLFNBQUs5QyxJQUFMLENBQVV5RCxjQUFWO0FBQ0EsU0FBS3RFLFNBQUwsQ0FBZTJCLE1BQWYsR0FBd0IsSUFBeEI7QUFDQSxTQUFLdEIsV0FBTCxDQUFpQnNCLE1BQWpCLEdBQTBCLElBQTFCO0FBQ0EsU0FBSzNCLFNBQUwsQ0FBZXVFLE1BQWYsMkVBQXFFckIsSUFBckU7QUFDQSxTQUFLckMsSUFBTCxDQUFVMkQsU0FBVixDQUFvQnZFLEVBQUUsQ0FBQ3dFLFFBQUgsQ0FBWXhFLEVBQUUsQ0FBQ3lFLFNBQUgsQ0FBYSxFQUFiLENBQVosRUFBOEJ6RSxFQUFFLENBQUMwRSxRQUFILENBQVksWUFBTTtBQUNoRSxNQUFBLE1BQUksQ0FBQ25ELElBQUwsR0FBWSxJQUFaO0FBQ0EsTUFBQSxNQUFJLENBQUNYLElBQUwsQ0FBVWMsTUFBVixHQUFtQixLQUFuQjtBQUNBLE1BQUEsTUFBSSxDQUFDM0IsU0FBTCxDQUFlMkIsTUFBZixHQUF3QixLQUF4QjtBQUNBLE1BQUEsTUFBSSxDQUFDdEIsV0FBTCxDQUFpQnNCLE1BQWpCLEdBQTBCLEtBQTFCO0FBQ0gsS0FMaUQsQ0FBOUIsQ0FBcEI7QUFNSCxHQWhIbUI7QUFrSHBCdUMsRUFBQUEsU0FsSG9CLHVCQWtIUjtBQUNSLFNBQUtyRSxhQUFMLENBQW1CK0UsWUFBbkIsQ0FBZ0MsQ0FBaEMsRUFBbUMsU0FBbkMsRUFBOEMsSUFBOUM7QUFDQSxTQUFLL0UsYUFBTCxDQUFtQmdGLG1CQUFuQixDQUF1QyxZQUFNLENBQUcsQ0FBaEQ7QUFDSCxHQXJIbUI7QUFzSHBCOUQsRUFBQUEsVUF0SG9CLHNCQXNIVCtELEtBdEhTLEVBc0hGLENBQ2pCLENBdkhtQjtBQXdIcEI5RCxFQUFBQSxRQXhIb0Isb0JBd0hYOEQsS0F4SFcsRUF3SEo7QUFDWixTQUFLdEQsSUFBTCxHQUFZLElBQVo7QUFDQSxTQUFLWCxJQUFMLENBQVVjLE1BQVYsR0FBbUIsS0FBbkI7QUFDQSxTQUFLM0IsU0FBTCxDQUFlMkIsTUFBZixHQUF3QixLQUF4QjtBQUNBLFNBQUt0QixXQUFMLENBQWlCc0IsTUFBakIsR0FBMEIsS0FBMUI7QUFDQSxTQUFLZCxJQUFMLENBQVVjLE1BQVYsR0FBbUIsS0FBbkI7QUFDSCxHQTlIbUI7QUErSHBCO0FBQ0FxQixFQUFBQSxZQWhJb0Isd0JBZ0lQK0IsS0FoSU8sRUFnSUE7QUFDaEIsV0FBUWhDLE1BQU0sQ0FBQ2dDLEtBQUQsQ0FBTixDQUFjQyxHQUFkLENBQWtCLEdBQWxCLENBQUQsQ0FBeUJDLFFBQXpCLEVBQVA7QUFDSCxHQWxJbUI7QUFtSXBCQyxFQUFBQSxTQW5Jb0IsdUJBbUlSO0FBQ1IxRixJQUFBQSxNQUFNLENBQUN5QixPQUFQLENBQWVrRSxHQUFmLENBQW1CLGVBQW5CLEVBQW9DLElBQXBDO0FBQ0EzRixJQUFBQSxNQUFNLENBQUN5QixPQUFQLENBQWVrRSxHQUFmLENBQW1CM0YsTUFBTSxDQUFDQyxlQUExQixFQUEyQyxJQUEzQztBQUNBRCxJQUFBQSxNQUFNLENBQUN5QixPQUFQLENBQWVrRSxHQUFmLENBQW1CL0QsT0FBTyxDQUFDQyxFQUFSLENBQVdDLG1CQUE5QixFQUFtRCxJQUFuRDtBQUNIO0FBdkltQixDQUF4QiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiZ2xHYW1lLnNob3dHb2RPZldlYWx0aCA9IFwic2hvd0dvZE9mV2VhbHRoXCI7XHJcbi8v6LSi56We5Yiw6LSmIOe7n+S4gOWkhOeQhiDlhaXlj6NcclxuZ2xHYW1lLmJhc2VjbGFzcy5leHRlbmQoe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGNhaXNoZW5fc3BpbmU6IHNwLlNrZWxldG9uLFxyXG4gICAgICAgIGxhYl9tb25leTogY2MuUmljaFRleHQsXHJcbiAgICAgICAgbm9kZV9mcmFtZTogY2MuTm9kZSxcclxuICAgICAgICBub2RlX2FsbHRpcDogY2MuTm9kZSxcclxuICAgICAgICBub2RlX3RpcDI6IGNjLk5vZGUsXHJcbiAgICAgICAgYXVkaW9fc3VjY2VlZDoge1xyXG4gICAgICAgICAgICB0eXBlOiBjYy5BdWRpb0NsaXAsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgY2MuZ2FtZS5hZGRQZXJzaXN0Um9vdE5vZGUodGhpcy5ub2RlKTtcclxuICAgICAgICB0aGlzLm5vZGUub24oJ3RvdWNoc3RhcnQnLCB0aGlzLnRvdWNoc3RhcnQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbigndG91Y2hlbmQnLCB0aGlzLnRvdWNoZW5kLCB0aGlzKTtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vbignb25Db2luQ2hhbmdlZCcsIHRoaXMub25Db2luQ2hhbmdlZEhhbmRsZXIsIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9uKGdsR2FtZS5zaG93R29kT2ZXZWFsdGgsIHRoaXMuc2V0dGluZ1BvdGlvbkhhbmRsZXIsIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9uKE1FU1NBR0UuVUkuQ0hBTkdFX1NDRU5FX0NPTVBMRSwgdGhpcy5vbkNoYW5nZVNjZW5lQ29tcGxlLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmRhdGEgPSBudWxsO1xyXG4gICAgICAgIGdsR2FtZS5jb2luQXJyYWwgPSB0aGlzO1xyXG4gICAgfSxcclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5hY3RpdmUgPSBmYWxzZTtcclxuICAgIH0sXHJcbiAgICBvbkNvaW5DaGFuZ2VkSGFuZGxlcihyZXMpIHtcclxuICAgICAgICBsZXQgbXNnID0gcmVzO1xyXG4gICAgICAgIGlmICh0aGlzID09IHVuZGVmaW5lZCB8fCB0aGlzLm5vZGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIuWPr+iDveS8muWHuueOsOaXoOazleW8ueWHuiDph5HluIHliLDotKbnlYzpnaJcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy/mipvlvIPkv53pmanmn5znmoTlj5blkozlrZjnmoTmtojmga/vvIzlt7LlnKjljp/mnInlm57ljIXkuK3lgZroh6rlop7oh6rlh49cclxuICAgICAgICBpZiAobXNnLnR5cGUgPT0gXCJiYW5rU2F2ZVwiIHx8IG1zZy50eXBlID09IFwiYmFua091dFwiKSByZXR1cm47XHJcbiAgICAgICAgaWYgKG1zZy50eXBlID09ICdiaW5kUGhvbmVSZWNlaXZlJykge1xyXG4gICAgICAgICAgICBnbEdhbWUudXNlci5zZXQoJ2lzX3JlY2VpdmVfcmVnaXN0ZXJfcGhvbmVfY29pbicsIDEpO1xyXG4gICAgICAgICAgICBnbEdhbWUuZW1pdHRlci5lbWl0KFwidXBkYXRlUGxhemFTd2l0Y2hcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGdsR2FtZS51c2VyLnJlcUdldENvaW4oKVxyXG4gICAgICAgIGxldCBhcnJ2YWxDb2luID0gZ2xHYW1lLnVzZXIuR29sZFRlbXAobXNnLm9mZnNldClcclxuICAgICAgICBpZiAobXNnLnR5cGUgPT0gXCJyZWNoYXJnZVwiKSB7XHJcbiAgICAgICAgICAgIGdsR2FtZS5hdWRpby5wbGF5U291bmRFZmZlY3QodGhpcy5hdWRpb19zdWNjZWVkKTtcclxuICAgICAgICAgICAgLy/lhYXlgLzkuYvlkI7lsIbpppblhrLorr7kuLrnirbmgIHlj5bmtojorr7nva7kuLox77ybXHJcbiAgICAgICAgICAgIGdsR2FtZS51c2VyLnNldChcInVzZXJSZWNoYXJnZVwiLCB7XHJcbiAgICAgICAgICAgICAgICBkaXNjb3VudDogZ2xHYW1lLnVzZXIuZ2V0KFwidXNlclJlY2hhcmdlXCIpLmRpc2NvdW50LFxyXG4gICAgICAgICAgICAgICAgZGlzY291bnRfbWF4OiBnbEdhbWUudXNlci5nZXQoXCJ1c2VyUmVjaGFyZ2VcIikuZGlzY291bnRfbWF4LFxyXG4gICAgICAgICAgICAgICAgZXhpc3RzOiAxXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlLmFjdGl2ZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2hhbmdlQ29pbiA9IE51bWJlcihyZXMub2Zmc2V0KVxyXG4gICAgICAgICAgICAgICAgbGV0IGFycnZhbENvaW4gPSB0aGlzLmdldEZpeE51bWJlcihjaGFuZ2VDb2luKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nUG90aW9uSGFuZGxlcih7IHBvczogMywgY29pbjogYXJydmFsQ29pbiB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPbmNlKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGF0YSkgey8v5aaC5p6c5a2Q5ri45oiP5rKh5pyJ5aSE55CGXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaGFuZ2VDb2luID0gTnVtYmVyKHJlcy5vZmZzZXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhcnJ2YWxDb2luID0gdGhpcy5nZXRGaXhOdW1iZXIoY2hhbmdlQ29pbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nUG90aW9uSGFuZGxlcih7IHBvczogMywgY29pbjogYXJydmFsQ29pbiB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCAwLjMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICBzZXR0aW5nUG90aW9uSGFuZGxlcihyZXMpIHtcclxuICAgICAgICB0aGlzLmRhdGEgPSByZXM7XHJcbiAgICAgICAgdGhpcy5zaG93QW5pSGFuZGxlcigpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUG9zdGlvbigpO1xyXG4gICAgfSxcclxuICAgIC8v5Zy65pmv5YiH5o2i55qE5pe25YCZXHJcbiAgICBvbkNoYW5nZVNjZW5lQ29tcGxlKHNjZW5lTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLm5vZGUgJiYgdGhpcy5ub2RlLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvc3Rpb24oKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlUG9zdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGF0YSkgcmV0dXJuO1xyXG4gICAgICAgIC8v57qi5YyF57qi5bGP5LiT55SoXHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5wb3MgPT0gNSkgdGhpcy5ub2RlX2ZyYW1lLmFuZ2xlID0gOTA7XHJcbiAgICAgICAgZWxzZSB0aGlzLm5vZGVfZnJhbWUuYW5nbGUgPSAwO1xyXG5cclxuICAgICAgICBsZXQgcG9zID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwicG9zXCIgKyB0aGlzLmRhdGEucG9zKTtcclxuICAgICAgICBwb3MuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkudXBkYXRlQWxpZ25tZW50KCk7XHJcbiAgICAgICAgaWYgKHBvcykge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVfZnJhbWUucG9zaXRpb24gPSBwb3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubm9kZV9mcmFtZS5zY2FsZSA9IGdsR2FtZS5zeXN0ZW1jbGFzcy5jb252ZXJ0SW50ZXJmYWNlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMubm9kZV9mcmFtZS5zY2FsZSA8IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlX2ZyYW1lLnggPSB0aGlzLm5vZGVfZnJhbWUueDsvLyAqIHRoaXMubm9kZV9mcmFtZS5zY2FsZTtcclxuICAgICAgICAgICAgdGhpcy5ub2RlX2ZyYW1lLnkgPSB0aGlzLm5vZGVfZnJhbWUueTsvLyAqIHRoaXMubm9kZV9mcmFtZS5zY2FsZTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHNob3dBbmlIYW5kbGVyKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5kYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hY3Rpb25FbmQoKTtcclxuICAgICAgICBsZXQgY29pbiA9IHRoaXMuZGF0YS5jb2luICsgXCJcIjtcclxuICAgICAgICB0aGlzLm5vZGUuekluZGV4ID0gY2MubWFjcm8uTUFYX1pJTkRFWDtcclxuICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkudXBkYXRlQWxpZ25tZW50KCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnN0b3BBbGxBY3Rpb25zKCk7XHJcbiAgICAgICAgdGhpcy5sYWJfbW9uZXkuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm5vZGVfYWxsdGlwLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sYWJfbW9uZXkuc3RyaW5nID0gYDxjb2xvcj0jZmZmZmZmPuaCqOWFheWAvOeahDwvY29sb3I+PGNvbG9yPSNGRkMyMDA+JHtjb2lufTwvY29sb3I+PGNvbG9yPSNmZmZmZmY+6YeR5biB5bey5Yiw6LSmITwvY29sb3I+YFxyXG4gICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDMwKSwgY2MuY2FsbEZ1bmMoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGFiX21vbmV5LmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVfYWxsdGlwLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIH0pKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGFjdGlvbkVuZCgpIHtcclxuICAgICAgICB0aGlzLmNhaXNoZW5fc3BpbmUuc2V0QW5pbWF0aW9uKDAsIFwibG9vcGluZ1wiLCB0cnVlKTtcclxuICAgICAgICB0aGlzLmNhaXNoZW5fc3BpbmUuc2V0Q29tcGxldGVMaXN0ZW5lcigoKSA9PiB7IH0pO1xyXG4gICAgfSxcclxuICAgIHRvdWNoc3RhcnQoZXZlbnQpIHtcclxuICAgIH0sXHJcbiAgICB0b3VjaGVuZChldmVudCkge1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubGFiX21vbmV5LmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubm9kZV9hbGx0aXAuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgLy/ov5Tlm57kv53nlZnkuKTkvY3lsI/mlbDnmoTmlbDlgLxcclxuICAgIGdldEZpeE51bWJlcih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAoTnVtYmVyKHZhbHVlKS5kaXYoMTAwKSkudG9TdHJpbmcoKTtcclxuICAgIH0sXHJcbiAgICBPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub2ZmKCdvbkNvaW5DaGFuZ2VkJywgdGhpcyk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub2ZmKGdsR2FtZS5zaG93R29kT2ZXZWFsdGgsIHRoaXMpO1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9mZihNRVNTQUdFLlVJLkNIQU5HRV9TQ0VORV9DT01QTEUsIHRoaXMpO1xyXG4gICAgfVxyXG59KTtcclxuIl19