
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/plaza/script/prefab/userInfo/userinfoaccount.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '189ca8BQXdACIz1oq2eORaz', 'userinfoaccount');
// modules/plaza/script/prefab/userInfo/userinfoaccount.js

"use strict";

glGame.baseclass.extend({
  properties: {
    accountContent: cc.Node,
    accountItem: cc.Node,
    typeContent: cc.Node,
    typeItem: cc.Node,
    typeScr: cc.Node,
    mask: cc.Node,
    type_lab: cc.Label,
    noitem: cc.Node,
    lab_pageIndex: cc.Label,
    safebox_lab: cc.Label,
    coin_lab: cc.Label,
    infonode: cc.Node
  },
  onLoad: function onLoad() {
    this.endTime = null;
    this.startTime = null;
    this.type = null;
    this.is_first = true;
    this.PageIndex = 1;
    this.summary = {};
    this.registerEvent();
    this.initCoin();
  },
  // 注册界面监听事件
  registerEvent: function registerEvent() {
    glGame.emitter.on("updateUserData", this.initCoin, this);
    glGame.emitter.on("userinfo_switchFace", this.closeDown, this);
  },
  // 销毁界面监听事件
  unRegisterEvent: function unRegisterEvent() {
    glGame.emitter.off("updateUserData", this);
    glGame.emitter.off("userinfo_switchFace", this);
  },
  closeDown: function closeDown() {
    this.typeScr.active = false;
  },
  start: function start() {
    this.reqCapitalFlow(this.type, this.startTime, this.endTime, this.is_first);
  },
  initCoin: function initCoin() {
    this.safebox_lab.string = this.cutFloat(glGame.user.get("bank_coin"));
    this.coin_lab.string = this.cutFloat(glGame.user.get("coin"));
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "btn_selectType":
        this.selectType_cb();
        break;

      case "mask":
        this.mask_cb();
        break;

      case "btn_lastPage":
        this.lastPage_cb();
        break;

      case "btn_nextPage":
        this.nextPage_cb();
        break;

      default:
        if (name.indexOf("itemTime") > -1) return this.click_itemTime(name);
        if (name.indexOf("typeItem") > -1) return this.click_typeItem(name);
        break;
    }
  },
  lastPage_cb: function lastPage_cb() {
    if (this.PageIndex == 1 || this.PageIndex == 0) return glGame.panel.showTip("已经是第一页了！");
    this.PageIndex--;
    this.reqCapitalFlow();
  },
  nextPage_cb: function nextPage_cb() {
    if (this.PageIndex >= this.pageCount || this.PageIndex == 0) return glGame.panel.showTip("已经是最后一页了！");
    this.PageIndex++;
    this.reqCapitalFlow();
  },
  click_typeItem: function click_typeItem(name) {
    this.PageIndex = 1;
    var string = name.substring(8);
    this.type_lab.string = Number(string) == 0 ? "全部" : this.Alltype[Number(string)];
    this.typeScr.active = this.mask.active = false;
    this.type = Number(string) == 0 ? null : Number(string); //全部游戏不传这个字段就OK

    this.reqCapitalFlow(this.type);
  },
  initTypeUI: function initTypeUI(data) {
    var typeItem = cc.instantiate(this.typeItem);
    typeItem.name = "typeItem".concat(0);
    typeItem.getChildByName("label").getComponent(cc.Label).string = "全部";
    typeItem.parent = this.typeContent;
    typeItem.active = true;

    for (var key in data) {
      typeItem = cc.instantiate(this.typeItem);
      typeItem.name = "typeItem".concat(key);
      typeItem.getChildByName("label").getComponent(cc.Label).string = data[key];
      typeItem.parent = this.typeContent;
      typeItem.active = true;
    }

    if (typeItem) {
      typeItem.getChildByName("img_xialafengexian").active = false;
    } //需求：需要直接展示所有的类型
    // let length = Object.keys(data).length, height = typeItem.height;
    // this.typeContent.parent.parent.height = height * (length + 1);
    // this.typeContent.parent.height = height * (length + 1);

  },
  initRecordUI: function initRecordUI(list) {
    this.accountContent.removeAllChildren();

    if (list.length == 0) {
      this.lab_pageIndex.string = '第0/0页';
      this.noitem.active = true;
      this.infonode.active = false;
      return;
    }

    this.noitem.active = false;
    this.infonode.active = true;
    this.lab_pageIndex.string = "\u7B2C".concat(this.PageIndex, "/").concat(this.pageCount, "\u9875");

    for (var i = 0; i < list.length; i++) {
      var item = cc.instantiate(this.accountItem);
      item.parent = this.accountContent;
      item.getChildByName("bg").active = i % 2 == 0;
      var time = item.getChildByName("time");
      var timeStamp = new Date(list[i].rechargeTimeStamp * 1000);
      var strTime = "".concat(timeStamp.getFullYear(), "/").concat(timeStamp.getMonth() + 1 >= 10 ? timeStamp.getMonth() + 1 : "0" + (timeStamp.getMonth() + 1), "/").concat(timeStamp.getDate() >= 10 ? timeStamp.getDate() : '0' + timeStamp.getDate());
      strTime += "\uFF08".concat(glGame.tips.WEEKNAME[timeStamp.getDay()], "\uFF09");
      strTime += "".concat(timeStamp.getHours() >= 10 ? timeStamp.getHours() : "0" + timeStamp.getHours(), ":");
      strTime += "".concat(timeStamp.getMinutes() >= 10 ? timeStamp.getMinutes() : "0" + timeStamp.getMinutes(), ":");
      strTime += "".concat(timeStamp.getSeconds() >= 10 ? timeStamp.getSeconds() : "0" + timeStamp.getSeconds());
      time.getComponent(cc.Label).string = strTime;
      item.getChildByName("type").getComponent(cc.Label).string = list[i].type;
      item.getChildByName("coin").getComponent(cc.Label).string = list[i].coin < 0 ? this.cutFloat(list[i].coin) : "+" + this.cutFloat(list[i].coin);
      glGame.panel.settingTableLabelColor(item.getChildByName("coin"));
      item.active = false;
    }

    glGame.panel.showEffectNode(this, this.accountContent, 0.02, true);
  },
  selectType_cb: function selectType_cb() {
    this.typeScr.active = !this.typeScr.active;
    if (this.typeScr.active) this.mask.active = true;
  },
  mask_cb: function mask_cb() {
    this.typeScr.active = this.mask.active = false;
  },
  reqCapitalFlow: function reqCapitalFlow(type, start, end, is_first) {
    var _this = this;

    var msg = {};
    if (type || this.type) msg.type = type ? type : this.type;
    if (start || this.startTime) msg.start = start ? start : this.startTime;
    if (end || this.endTime) msg.end = end ? end : this.endTime;
    if (is_first || this.is_first) msg.is_first = is_first ? is_first : this.is_first;
    msg.page = this.PageIndex;
    msg.pagesize = 6;
    glGame.gameNet.send_msg('http.reqCapitalFlow', msg, function (route, data) {
      var result = data.result;

      if (result.current_page == 1) {
        _this.summary = result.summary;
      }

      _this.pageCount = result.total_page;

      if (is_first) {
        _this.is_first = null;
        _this.Alltype = result.summary.type;
        if (_this.Alltype) _this.initTypeUI(_this.Alltype);
      }

      _this.initRecordUI(result.list);
    });
  },
  OnDestroy: function OnDestroy() {
    this.unRegisterEvent();
  },
  //浮点型运算取俩位
  cutFloat: function cutFloat(value) {
    var value1 = Number(value).div(10);
    value = Number(value).div(100);
    if (isNaN(value)) return;

    if (~~value === value) {
      return value.toString();
    } else if (~~value1 === value1) {
      return value.toFixed(1);
    } else {
      return value.toFixed(2);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccGxhemFcXHNjcmlwdFxccHJlZmFiXFx1c2VySW5mb1xcdXNlcmluZm9hY2NvdW50LmpzIl0sIm5hbWVzIjpbImdsR2FtZSIsImJhc2VjbGFzcyIsImV4dGVuZCIsInByb3BlcnRpZXMiLCJhY2NvdW50Q29udGVudCIsImNjIiwiTm9kZSIsImFjY291bnRJdGVtIiwidHlwZUNvbnRlbnQiLCJ0eXBlSXRlbSIsInR5cGVTY3IiLCJtYXNrIiwidHlwZV9sYWIiLCJMYWJlbCIsIm5vaXRlbSIsImxhYl9wYWdlSW5kZXgiLCJzYWZlYm94X2xhYiIsImNvaW5fbGFiIiwiaW5mb25vZGUiLCJvbkxvYWQiLCJlbmRUaW1lIiwic3RhcnRUaW1lIiwidHlwZSIsImlzX2ZpcnN0IiwiUGFnZUluZGV4Iiwic3VtbWFyeSIsInJlZ2lzdGVyRXZlbnQiLCJpbml0Q29pbiIsImVtaXR0ZXIiLCJvbiIsImNsb3NlRG93biIsInVuUmVnaXN0ZXJFdmVudCIsIm9mZiIsImFjdGl2ZSIsInN0YXJ0IiwicmVxQ2FwaXRhbEZsb3ciLCJzdHJpbmciLCJjdXRGbG9hdCIsInVzZXIiLCJnZXQiLCJvbkNsaWNrIiwibmFtZSIsIm5vZGUiLCJzZWxlY3RUeXBlX2NiIiwibWFza19jYiIsImxhc3RQYWdlX2NiIiwibmV4dFBhZ2VfY2IiLCJpbmRleE9mIiwiY2xpY2tfaXRlbVRpbWUiLCJjbGlja190eXBlSXRlbSIsInBhbmVsIiwic2hvd1RpcCIsInBhZ2VDb3VudCIsInN1YnN0cmluZyIsIk51bWJlciIsIkFsbHR5cGUiLCJpbml0VHlwZVVJIiwiZGF0YSIsImluc3RhbnRpYXRlIiwiZ2V0Q2hpbGRCeU5hbWUiLCJnZXRDb21wb25lbnQiLCJwYXJlbnQiLCJrZXkiLCJpbml0UmVjb3JkVUkiLCJsaXN0IiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJsZW5ndGgiLCJpIiwiaXRlbSIsInRpbWUiLCJ0aW1lU3RhbXAiLCJEYXRlIiwicmVjaGFyZ2VUaW1lU3RhbXAiLCJzdHJUaW1lIiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImdldERhdGUiLCJ0aXBzIiwiV0VFS05BTUUiLCJnZXREYXkiLCJnZXRIb3VycyIsImdldE1pbnV0ZXMiLCJnZXRTZWNvbmRzIiwiY29pbiIsInNldHRpbmdUYWJsZUxhYmVsQ29sb3IiLCJzaG93RWZmZWN0Tm9kZSIsImVuZCIsIm1zZyIsInBhZ2UiLCJwYWdlc2l6ZSIsImdhbWVOZXQiLCJzZW5kX21zZyIsInJvdXRlIiwicmVzdWx0IiwiY3VycmVudF9wYWdlIiwidG90YWxfcGFnZSIsIk9uRGVzdHJveSIsInZhbHVlIiwidmFsdWUxIiwiZGl2IiwiaXNOYU4iLCJ0b1N0cmluZyIsInRvRml4ZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsTUFBakIsQ0FBd0I7QUFDcEJDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxjQUFjLEVBQUVDLEVBQUUsQ0FBQ0MsSUFEWDtBQUVSQyxJQUFBQSxXQUFXLEVBQUVGLEVBQUUsQ0FBQ0MsSUFGUjtBQUlSRSxJQUFBQSxXQUFXLEVBQUVILEVBQUUsQ0FBQ0MsSUFKUjtBQUtSRyxJQUFBQSxRQUFRLEVBQUVKLEVBQUUsQ0FBQ0MsSUFMTDtBQU1SSSxJQUFBQSxPQUFPLEVBQUVMLEVBQUUsQ0FBQ0MsSUFOSjtBQVFSSyxJQUFBQSxJQUFJLEVBQUVOLEVBQUUsQ0FBQ0MsSUFSRDtBQVNSTSxJQUFBQSxRQUFRLEVBQUVQLEVBQUUsQ0FBQ1EsS0FUTDtBQVVSQyxJQUFBQSxNQUFNLEVBQUVULEVBQUUsQ0FBQ0MsSUFWSDtBQVlSUyxJQUFBQSxhQUFhLEVBQUVWLEVBQUUsQ0FBQ1EsS0FaVjtBQWNSRyxJQUFBQSxXQUFXLEVBQUVYLEVBQUUsQ0FBQ1EsS0FkUjtBQWVSSSxJQUFBQSxRQUFRLEVBQUVaLEVBQUUsQ0FBQ1EsS0FmTDtBQWdCUkssSUFBQUEsUUFBUSxFQUFFYixFQUFFLENBQUNDO0FBaEJMLEdBRFE7QUFtQnBCYSxFQUFB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QUFDQUYsSUFBQUEsS0FBSyxHQUFHM0MsTUFBTSxDQUFDMkMsS0FBRCxDQUFOLENBQWNFLEdBQWQsQ0FBa0IsR0FBbEIsQ0FBUjtBQUNBLFFBQUlDLEtBQUssQ0FBQ0gsS0FBRCxDQUFULEVBQWtCOztBQUNsQixRQUFJLENBQUMsQ0FBQ0EsS0FBRixLQUFZQSxLQUFoQixFQUF1QjtBQUNuQixhQUFPQSxLQUFLLENBQUNJLFFBQU4sRUFBUDtBQUNILEtBRkQsTUFFTyxJQUFJLENBQUMsQ0FBQ0gsTUFBRixLQUFhQSxNQUFqQixFQUF5QjtBQUM1QixhQUFPRCxLQUFLLENBQUNLLE9BQU4sQ0FBYyxDQUFkLENBQVA7QUFDSCxLQUZNLE1BRUE7QUFDSCxhQUFPTCxLQUFLLENBQUNLLE9BQU4sQ0FBYyxDQUFkLENBQVA7QUFDSDtBQUNKO0FBbk1tQixDQUF4QiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiZ2xHYW1lLmJhc2VjbGFzcy5leHRlbmQoe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGFjY291bnRDb250ZW50OiBjYy5Ob2RlLFxyXG4gICAgICAgIGFjY291bnRJdGVtOiBjYy5Ob2RlLFxyXG5cclxuICAgICAgICB0eXBlQ29udGVudDogY2MuTm9kZSxcclxuICAgICAgICB0eXBlSXRlbTogY2MuTm9kZSxcclxuICAgICAgICB0eXBlU2NyOiBjYy5Ob2RlLFxyXG5cclxuICAgICAgICBtYXNrOiBjYy5Ob2RlLFxyXG4gICAgICAgIHR5cGVfbGFiOiBjYy5MYWJlbCxcclxuICAgICAgICBub2l0ZW06IGNjLk5vZGUsXHJcblxyXG4gICAgICAgIGxhYl9wYWdlSW5kZXg6IGNjLkxhYmVsLFxyXG5cclxuICAgICAgICBzYWZlYm94X2xhYjogY2MuTGFiZWwsXHJcbiAgICAgICAgY29pbl9sYWI6IGNjLkxhYmVsLFxyXG4gICAgICAgIGluZm9ub2RlOiBjYy5Ob2RlLFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLmVuZFRpbWUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbnVsbDtcclxuICAgICAgICB0aGlzLnR5cGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNfZmlyc3QgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuUGFnZUluZGV4ID0gMTtcclxuICAgICAgICB0aGlzLnN1bW1hcnkgPSB7fTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICAgICAgICB0aGlzLmluaXRDb2luKCk7XHJcbiAgICB9LFxyXG5cclxuICAgICAvLyDms6jlhoznlYzpnaLnm5HlkKzkuovku7ZcclxuICAgICByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9uKFwidXBkYXRlVXNlckRhdGFcIiwgdGhpcy5pbml0Q29pbiwgdGhpcyk7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub24oXCJ1c2VyaW5mb19zd2l0Y2hGYWNlXCIsIHRoaXMuY2xvc2VEb3duLCB0aGlzKTtcclxuICAgIH0sXHJcbiAgICAvLyDplIDmr4HnlYzpnaLnm5HlkKzkuovku7ZcclxuICAgIHVuUmVnaXN0ZXJFdmVudCgpIHtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoXCJ1cGRhdGVVc2VyRGF0YVwiLCB0aGlzKTtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoXCJ1c2VyaW5mb19zd2l0Y2hGYWNlXCIsdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgY2xvc2VEb3duKCl7XHJcbiAgICAgICAgdGhpcy50eXBlU2NyLmFjdGl2ZSA9IGZhbHNlXHJcbiAgICB9LFxyXG4gICBcclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMucmVxQ2FwaXRhbEZsb3codGhpcy50eXBlLCB0aGlzLnN0YXJ0VGltZSwgdGhpcy5lbmRUaW1lLCB0aGlzLmlzX2ZpcnN0KTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdENvaW4oKSB7XHJcbiAgICAgICAgdGhpcy5zYWZlYm94X2xhYi5zdHJpbmcgPSB0aGlzLmN1dEZsb2F0KGdsR2FtZS51c2VyLmdldChcImJhbmtfY29pblwiKSk7XHJcbiAgICAgICAgdGhpcy5jb2luX2xhYi5zdHJpbmcgPSB0aGlzLmN1dEZsb2F0KGdsR2FtZS51c2VyLmdldChcImNvaW5cIikpO1xyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25DbGljayhuYW1lLCBub2RlKSB7XHJcbiAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJidG5fc2VsZWN0VHlwZVwiOiB0aGlzLnNlbGVjdFR5cGVfY2IoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJtYXNrXCI6IHRoaXMubWFza19jYigpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9sYXN0UGFnZVwiOiB0aGlzLmxhc3RQYWdlX2NiKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiYnRuX25leHRQYWdlXCI6IHRoaXMubmV4dFBhZ2VfY2IoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmRleE9mKFwiaXRlbVRpbWVcIikgPiAtMSkgcmV0dXJuIHRoaXMuY2xpY2tfaXRlbVRpbWUobmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmRleE9mKFwidHlwZUl0ZW1cIikgPiAtMSkgcmV0dXJuIHRoaXMuY2xpY2tfdHlwZUl0ZW0obmFtZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGxhc3RQYWdlX2NiKCkge1xyXG4gICAgICAgIGlmICh0aGlzLlBhZ2VJbmRleCA9PSAxIHx8IHRoaXMuUGFnZUluZGV4ID09IDApIHJldHVybiBnbEdhbWUucGFuZWwuc2hvd1RpcChcIuW3sue7j+aYr+esrOS4gOmhteS6hu+8gVwiKVxyXG4gICAgICAgIHRoaXMuUGFnZUluZGV4LS07XHJcbiAgICAgICAgdGhpcy5yZXFDYXBpdGFsRmxvdygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBuZXh0UGFnZV9jYigpIHtcclxuICAgICAgICBpZiAodGhpcy5QYWdlSW5kZXggPj0gdGhpcy5wYWdlQ291bnQgfHwgdGhpcy5QYWdlSW5kZXggPT0gMCkgcmV0dXJuIGdsR2FtZS5wYW5lbC5zaG93VGlwKFwi5bey57uP5piv5pyA5ZCO5LiA6aG15LqG77yBXCIpXHJcbiAgICAgICAgdGhpcy5QYWdlSW5kZXgrKztcclxuICAgICAgICB0aGlzLnJlcUNhcGl0YWxGbG93KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGNsaWNrX3R5cGVJdGVtKG5hbWUpIHtcclxuICAgICAgICB0aGlzLlBhZ2VJbmRleCA9IDE7XHJcbiAgICAgICAgbGV0IHN0cmluZyA9IG5hbWUuc3Vic3RyaW5nKDgpO1xyXG4gICAgICAgIHRoaXMudHlwZV9sYWIuc3RyaW5nID0gTnVtYmVyKHN0cmluZykgPT0gMCA/IFwi5YWo6YOoXCIgOiB0aGlzLkFsbHR5cGVbTnVtYmVyKHN0cmluZyldO1xyXG4gICAgICAgIHRoaXMudHlwZVNjci5hY3RpdmUgPSB0aGlzLm1hc2suYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy50eXBlID0gTnVtYmVyKHN0cmluZykgPT0gMCA/IG51bGwgOiBOdW1iZXIoc3RyaW5nKTsgICAgICAvL+WFqOmDqOa4uOaIj+S4jeS8oOi/meS4quWtl+auteWwsU9LXHJcbiAgICAgICAgdGhpcy5yZXFDYXBpdGFsRmxvdyh0aGlzLnR5cGUpO1xyXG4gICAgfSxcclxuXHJcbiAgICBpbml0VHlwZVVJKGRhdGEpIHtcclxuICAgICAgICBsZXQgdHlwZUl0ZW0gPSBjYy5pbnN0YW50aWF0ZSh0aGlzLnR5cGVJdGVtKTtcclxuICAgICAgICB0eXBlSXRlbS5uYW1lID0gYHR5cGVJdGVtJHswfWBcclxuICAgICAgICB0eXBlSXRlbS5nZXRDaGlsZEJ5TmFtZShcImxhYmVsXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gXCLlhajpg6hcIlxyXG4gICAgICAgIHR5cGVJdGVtLnBhcmVudCA9IHRoaXMudHlwZUNvbnRlbnQ7XHJcbiAgICAgICAgdHlwZUl0ZW0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gZGF0YSkge1xyXG4gICAgICAgICAgICB0eXBlSXRlbSA9IGNjLmluc3RhbnRpYXRlKHRoaXMudHlwZUl0ZW0pO1xyXG4gICAgICAgICAgICB0eXBlSXRlbS5uYW1lID0gYHR5cGVJdGVtJHtrZXl9YFxyXG4gICAgICAgICAgICB0eXBlSXRlbS5nZXRDaGlsZEJ5TmFtZShcImxhYmVsXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gZGF0YVtrZXldO1xyXG4gICAgICAgICAgICB0eXBlSXRlbS5wYXJlbnQgPSB0aGlzLnR5cGVDb250ZW50O1xyXG4gICAgICAgICAgICB0eXBlSXRlbS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodHlwZUl0ZW0pIHtcclxuICAgICAgICAgICAgdHlwZUl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfeGlhbGFmZW5nZXhpYW5cIikuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+mcgOaxgu+8mumcgOimgeebtOaOpeWxleekuuaJgOacieeahOexu+Wei1xyXG4gICAgICAgIC8vIGxldCBsZW5ndGggPSBPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGgsIGhlaWdodCA9IHR5cGVJdGVtLmhlaWdodDtcclxuICAgICAgICAvLyB0aGlzLnR5cGVDb250ZW50LnBhcmVudC5wYXJlbnQuaGVpZ2h0ID0gaGVpZ2h0ICogKGxlbmd0aCArIDEpO1xyXG4gICAgICAgIC8vIHRoaXMudHlwZUNvbnRlbnQucGFyZW50LmhlaWdodCA9IGhlaWdodCAqIChsZW5ndGggKyAxKTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdFJlY29yZFVJKGxpc3QpIHtcclxuICAgICAgICB0aGlzLmFjY291bnRDb250ZW50LnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcbiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5sYWJfcGFnZUluZGV4LnN0cmluZyA9ICfnrKwwLzDpobUnO1xyXG4gICAgICAgICAgICB0aGlzLm5vaXRlbS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmluZm9ub2RlLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm5vaXRlbS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmluZm9ub2RlLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sYWJfcGFnZUluZGV4LnN0cmluZyA9IGDnrKwke3RoaXMuUGFnZUluZGV4fS8ke3RoaXMucGFnZUNvdW50femhtWA7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYWNjb3VudEl0ZW0pO1xyXG4gICAgICAgICAgICBpdGVtLnBhcmVudCA9IHRoaXMuYWNjb3VudENvbnRlbnQ7XHJcbiAgICAgICAgICAgIGl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJiZ1wiKS5hY3RpdmUgPSBpICUgMiA9PSAwO1xyXG5cclxuICAgICAgICAgICAgbGV0IHRpbWUgPSBpdGVtLmdldENoaWxkQnlOYW1lKFwidGltZVwiKTtcclxuICAgICAgICAgICAgbGV0IHRpbWVTdGFtcCA9IG5ldyBEYXRlKGxpc3RbaV0ucmVjaGFyZ2VUaW1lU3RhbXAgKiAxMDAwKTtcclxuICAgICAgICAgICAgbGV0IHN0clRpbWUgPSBgJHt0aW1lU3RhbXAuZ2V0RnVsbFllYXIoKX0vJHt0aW1lU3RhbXAuZ2V0TW9udGgoKSArIDEgPj0gMTAgPyB0aW1lU3RhbXAuZ2V0TW9udGgoKSArIDEgOiBcIjBcIiArICh0aW1lU3RhbXAuZ2V0TW9udGgoKSArIDEpfS8ke3RpbWVTdGFtcC5nZXREYXRlKCkgPj0gMTAgPyB0aW1lU3RhbXAuZ2V0RGF0ZSgpIDogJzAnICsgdGltZVN0YW1wLmdldERhdGUoKX1gXHJcbiAgICAgICAgICAgIHN0clRpbWUgKz0gYO+8iCR7Z2xHYW1lLnRpcHMuV0VFS05BTUVbdGltZVN0YW1wLmdldERheSgpXX3vvIlgXHJcbiAgICAgICAgICAgIHN0clRpbWUgKz0gYCR7dGltZVN0YW1wLmdldEhvdXJzKCkgPj0gMTAgP3RpbWVTdGFtcC5nZXRIb3VycygpOiBcIjBcIiArIHRpbWVTdGFtcC5nZXRIb3VycygpfTpgXHJcbiAgICAgICAgICAgIHN0clRpbWUgKz0gYCR7dGltZVN0YW1wLmdldE1pbnV0ZXMoKSA+PSAxMCA/dGltZVN0YW1wLmdldE1pbnV0ZXMoKTogXCIwXCIgKyB0aW1lU3RhbXAuZ2V0TWludXRlcygpfTpgXHJcbiAgICAgICAgICAgIHN0clRpbWUgKz0gYCR7dGltZVN0YW1wLmdldFNlY29uZHMoKSA+PSAxMCA/dGltZVN0YW1wLmdldFNlY29uZHMoKTogXCIwXCIgKyB0aW1lU3RhbXAuZ2V0U2Vjb25kcygpfWBcclxuICAgICAgICAgICAgdGltZS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHN0clRpbWU7XHJcbiAgICAgICAgICAgIGl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJ0eXBlXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbGlzdFtpXS50eXBlO1xyXG4gICAgICAgICAgICBpdGVtLmdldENoaWxkQnlOYW1lKFwiY29pblwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGxpc3RbaV0uY29pbiA8IDAgPyB0aGlzLmN1dEZsb2F0KGxpc3RbaV0uY29pbikgOiBcIitcIiArIHRoaXMuY3V0RmxvYXQobGlzdFtpXS5jb2luKTtcclxuICAgICAgICAgICAgZ2xHYW1lLnBhbmVsLnNldHRpbmdUYWJsZUxhYmVsQ29sb3IoaXRlbS5nZXRDaGlsZEJ5TmFtZShcImNvaW5cIikpO1xyXG4gICAgICAgICAgICBpdGVtLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dFZmZlY3ROb2RlKHRoaXMsdGhpcy5hY2NvdW50Q29udGVudCwwLjAyLHRydWUpO1xyXG4gICAgfSxcclxuICAgIHNlbGVjdFR5cGVfY2IoKSB7XHJcbiAgICAgICAgdGhpcy50eXBlU2NyLmFjdGl2ZSA9ICF0aGlzLnR5cGVTY3IuYWN0aXZlO1xyXG4gICAgICAgIGlmICh0aGlzLnR5cGVTY3IuYWN0aXZlKSB0aGlzLm1hc2suYWN0aXZlID0gdHJ1ZTtcclxuICAgIH0sXHJcbiAgICBtYXNrX2NiKCkge1xyXG4gICAgICAgIHRoaXMudHlwZVNjci5hY3RpdmUgPSB0aGlzLm1hc2suYWN0aXZlID0gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlcUNhcGl0YWxGbG93KHR5cGUsIHN0YXJ0LCBlbmQsIGlzX2ZpcnN0KSB7XHJcbiAgICAgICAgbGV0IG1zZyA9IHt9O1xyXG4gICAgICAgIGlmICh0eXBlIHx8IHRoaXMudHlwZSkgbXNnLnR5cGUgPSB0eXBlID8gdHlwZSA6IHRoaXMudHlwZTtcclxuICAgICAgICBpZiAoc3RhcnQgfHwgdGhpcy5zdGFydFRpbWUpIG1zZy5zdGFydCA9IHN0YXJ0ID8gc3RhcnQgOiB0aGlzLnN0YXJ0VGltZTtcclxuICAgICAgICBpZiAoZW5kIHx8IHRoaXMuZW5kVGltZSkgbXNnLmVuZCA9IGVuZCA/IGVuZCA6IHRoaXMuZW5kVGltZTtcclxuICAgICAgICBpZiAoaXNfZmlyc3QgfHwgdGhpcy5pc19maXJzdCkgbXNnLmlzX2ZpcnN0ID0gaXNfZmlyc3QgPyBpc19maXJzdCA6IHRoaXMuaXNfZmlyc3Q7XHJcbiAgICAgICAgbXNnLnBhZ2UgPSB0aGlzLlBhZ2VJbmRleDtcclxuICAgICAgICBtc2cucGFnZXNpemUgPSA2O1xyXG4gICAgICAgIGdsR2FtZS5nYW1lTmV0LnNlbmRfbXNnKCdodHRwLnJlcUNhcGl0YWxGbG93JywgbXNnLCAocm91dGUsIGRhdGEpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBkYXRhLnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuY3VycmVudF9wYWdlID09IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IHJlc3VsdC5zdW1tYXJ5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUNvdW50ID0gcmVzdWx0LnRvdGFsX3BhZ2U7XHJcbiAgICAgICAgICAgIGlmIChpc19maXJzdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc19maXJzdCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLkFsbHR5cGUgPSByZXN1bHQuc3VtbWFyeS50eXBlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuQWxsdHlwZSkgdGhpcy5pbml0VHlwZVVJKHRoaXMuQWxsdHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pbml0UmVjb3JkVUkocmVzdWx0Lmxpc3QpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG5cclxuICAgIE9uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLnVuUmVnaXN0ZXJFdmVudCgpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvL+a1rueCueWei+i/kOeul+WPluS/qeS9jVxyXG4gICAgY3V0RmxvYXQodmFsdWUpIHtcclxuICAgICAgICBsZXQgdmFsdWUxID0gTnVtYmVyKHZhbHVlKS5kaXYoMTApO1xyXG4gICAgICAgIHZhbHVlID0gTnVtYmVyKHZhbHVlKS5kaXYoMTAwKTtcclxuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSByZXR1cm47XHJcbiAgICAgICAgaWYgKH5+dmFsdWUgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAofn52YWx1ZTEgPT09IHZhbHVlMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgyKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59KTtcclxuIl19