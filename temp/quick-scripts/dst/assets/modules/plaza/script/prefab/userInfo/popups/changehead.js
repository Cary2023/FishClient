
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/plaza/script/prefab/userInfo/popups/changehead.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '05e8en7gO5Izb9JEk/QpaVH', 'changehead');
// modules/plaza/script/prefab/userInfo/popups/changehead.js

"use strict";

/**
 * 更新头像面板
 */
glGame.baseclass.extend({
  properties: {
    scrollview: cc.ScrollView,
    listview: cc.Node,
    // 头像滑动列表
    headItem: cc.Node,
    // 头像Item Node
    node_re: cc.Node,
    man: cc.Node,
    woman: cc.Node
  },
  onLoad: function onLoad() {
    this.sex = glGame.user.get("userSex");
    this.isLock = false;
    this.resetData();
    this.headMax = 20;
    glGame.emitter.on("upheadlist", this.showUI, this);

    if (glGame.user.get("headList")[this.sex]) {
      this.showUI(this.sex);
    } else {
      glGame.user.reqGetHeadList(this.sex, this.headMax);
    }
  },
  // 初始化界面数据
  resetData: function resetData() {
    this.clickHeadItemID = null;

    if (glGame.user.get("userSex") == 1) {
      this.man.getComponent(cc.Toggle).isChecked = true;
      this.woman.getComponent(cc.Toggle).isChecked = false;
    } else if (glGame.user.get("userSex") == 2) {
      this.man.getComponent(cc.Toggle).isChecked = false;
      this.woman.getComponent(cc.Toggle).isChecked = true;
    }

    this.man.on("toggle", this.OnClickToggle, this);
    this.woman.on("toggle", this.OnClickToggle, this);
  },
  // 显示可替换头像
  showUI: function showUI(index) {
    var headObj = glGame.user.get("headList")[index];
    var keys = Object.keys(headObj);
    var count = keys.length > this.headMax ? this.headMax : keys.length;
    this.listview.removeAllChildren();
    cc.log("头像", headObj, count);

    for (var i = 0; i < count; i++) {
      var panel = cc.instantiate(this.headItem);
      panel.active = true;
      panel.name = "head_".concat(keys[i]);
      panel.parent = this.listview;
      glGame.panel.showHeadImage(panel.getChildByName("mask").getChildByName("image"), headObj[keys[i]]);
      if (i == 0) this.clickHeadItemID = keys[i];
    }
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "close":
        this.click_close();
        break;

      case "confirm":
        this.click_confirm();
        break;

      case "refresh":
        this.click_refresh();
        break;

      case "head":
        this.click_headItem(node);
        break;

      case "man":
        this.click_sex(1);
        break;

      case "woman":
        this.click_sex(2);
        break;

      default:
        if (name.indexOf("head") > -1) {
          var index = name.split("_")[1];
          this.click_headItem(index);
        }

        break;
    }
  },
  click_sex: function click_sex(index) {
    this.sex = index;

    if (glGame.user.get("headList")[index]) {
      this.showUI(index);
    } else {
      glGame.user.reqGetHeadList(index, this.headMax);
    }
  },
  click_close: function click_close() {
    this.remove();
  },
  click_refresh: function click_refresh() {
    var _this = this;

    if (!this.isLock) {
      this.isLock = true;
      this.node_re.color = cc.color(165, 139, 139); //this.node_re.children[0].color = cc.color(165, 139, 139);

      glGame.user.reqGetHeadList(this.sex, this.headMax);
      var dty = cc.delayTime(3);
      var cb = cc.callFunc(function () {
        _this.isLock = false;
        _this.node_re.color = cc.color(255, 255, 255); //this.node_re.children[0].color = cc.color(255, 255, 255);
      });
      this.node.runAction(cc.sequence(dty, cb));
    } else {
      glGame.panel.showErrorTip("刷新太频繁，请稍后重试！");
    }
  },
  // 确认更换头像
  click_confirm: function click_confirm() {
    var _this2 = this;

    if (!this.clickHeadItemID) {
      return glGame.panel.showErrorTip(glGame.tips.USER.CHANGEHEAD.FAIL);
    }

    cc.log("确认更换头像", this.clickHeadItemID);
    glGame.user.reqEditHead(this.clickHeadItemID, function () {
      var headObj = glGame.user.get("headList")[_this2.sex];

      glGame.user.headURL = headObj[_this2.clickHeadItemID];

      if (_this2.sex != glGame.user.get("userSex")) {
        var msg = {
          "sex": _this2.sex
        };
        glGame.gameNet.send_msg('http.reqEditMyInfo', msg, function (route, data) {
          glGame.user.userSex = _this2.sex;
          glGame.emitter.emit("updateUserData");
        });
      } else glGame.emitter.emit("updateUserData");

      _this2.remove();
    });
  },
  // 选择头像
  click_headItem: function click_headItem(index) {
    this.clickHeadItemID = Number(index);
  },
  OnDestroy: function OnDestroy() {
    glGame.emitter.off("upheadlist", this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccGxhemFcXHNjcmlwdFxccHJlZmFiXFx1c2VySW5mb1xccG9wdXBzXFxjaGFuZ2VoZWFkLmpzIl0sIm5hbWVzIjpbImdsR2FtZSIsImJhc2VjbGFzcyIsImV4dGVuZCIsInByb3BlcnRpZXMiLCJzY3JvbGx2aWV3IiwiY2MiLCJTY3JvbGxWaWV3IiwibGlzdHZpZXciLCJOb2RlIiwiaGVhZEl0ZW0iLCJub2RlX3JlIiwibWFuIiwid29tYW4iLCJvbkxvYWQiLCJzZXgiLCJ1c2VyIiwiZ2V0IiwiaXNMb2NrIiwicmVzZXREYXRhIiwiaGVhZE1heCIsImVtaXR0ZXIiLCJvbiIsInNob3dVSSIsInJlcUdldEhlYWRMaXN0IiwiY2xpY2tIZWFkSXRlbUlEIiwiZ2V0Q29tcG9uZW50IiwiVG9nZ2xlIiwiaXNDaGVja2VkIiwiT25DbGlja1RvZ2dsZSIsImluZGV4IiwiaGVhZE9iaiIsImtleXMiLCJPYmplY3QiLCJjb3VudCIsImxlbmd0aCIsInJlbW92ZUFsbENoaWxkcmVuIiwibG9nIiwiaSIsInBhbmVsIiwiaW5zdGFudGlhdGUiLCJhY3RpdmUiLCJuYW1lIiwicGFyZW50Iiwic2hvd0hlYWRJbWFnZSIsImdldENoaWxkQnlOYW1lIiwib25DbGljayIsIm5vZGUiLCJjbGlja19jbG9zZSIsImNsaWNrX2NvbmZpcm0iLCJjbGlja19yZWZyZXNoIiwiY2xpY2tfaGVhZEl0ZW0iLCJjbGlja19zZXgiLCJpbmRleE9mIiwic3BsaXQiLCJyZW1vdmUiLCJjb2xvciIsImR0eSIsImRlbGF5VGltZSIsImNiIiwiY2FsbEZ1bmMiLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsInNob3dFcnJvclRpcCIsInRpcHMiLCJVU0VSIiwiQ0hBTkdFSEVBRCIsIkZBSUwiLCJyZXFFZGl0SGVhZCIsImhlYWRVUkwiLCJtc2ciLCJnYW1lTmV0Iiwic2VuZF9tc2ciLCJyb3V0ZSIsImRhdGEiLCJ1c2VyU2V4IiwiZW1pdCIsIk51bWJlciIsIk9uRGVzdHJv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TSxDQUFDZSxJQUFQLENBQVlDLEdBQVosQ0FBZ0IsU0FBaEIsQ0FBaEIsRUFBNEM7QUFDeEMsWUFBSXFELEdBQUcsR0FBRztBQUFFLGlCQUFPLE1BQUksQ0FBQ3ZEO0FBQWQsU0FBVjtBQUNBZCxRQUFBQSxNQUFNLENBQUNzRSxPQUFQLENBQWVDLFFBQWYsQ0FBd0Isb0JBQXhCLEVBQThDRixHQUE5QyxFQUFtRCxVQUFDRyxLQUFELEVBQVFDLElBQVIsRUFBaUI7QUFDaEV6RSxVQUFBQSxNQUFNLENBQUNlLElBQVAsQ0FBWTJELE9BQVosR0FBc0IsTUFBSSxDQUFDNUQsR0FBM0I7QUFDQWQsVUFBQUEsTUFBTSxDQUFDb0IsT0FBUCxDQUFldUQsSUFBZixDQUFvQixnQkFBcEI7QUFDSCxTQUhEO0FBSUgsT0FORCxNQU1PM0UsTUFBTSxDQUFDb0IsT0FBUCxDQUFldUQsSUFBZixDQUFvQixnQkFBcEI7O0FBQ1AsTUFBQSxNQUFJLENBQUNyQixNQUFMO0FBQ0gsS0FYRDtBQVlILEdBbkhtQjtBQW9IcEI7QUFDQUosRUFBQUEsY0FySG9CLDBCQXFITHJCLEtBckhLLEVBcUhFO0FBQ2xCLFNBQUtMLGVBQUwsR0FBdUJvRCxNQUFNLENBQUMvQyxLQUFELENBQTdCO0FBQ0gsR0F2SG1CO0FBeUhwQmdELEVBQUFBLFNBekhvQix1QkF5SFI7QUFDUjdFLElBQUFBLE1BQU0sQ0FBQ29CLE9BQVAsQ0FBZTBELEdBQWYsQ0FBbUIsWUFBbkIsRUFBaUMsSUFBakM7QUFDSDtBQTNIbUIsQ0FBeEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDmm7TmlrDlpLTlg4/pnaLmnb9cclxuICovXHJcbmdsR2FtZS5iYXNlY2xhc3MuZXh0ZW5kKHtcclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBzY3JvbGx2aWV3OiBjYy5TY3JvbGxWaWV3LFxyXG4gICAgICAgIGxpc3R2aWV3OiBjYy5Ob2RlLCAgICAgIC8vIOWktOWDj+a7keWKqOWIl+ihqFxyXG4gICAgICAgIGhlYWRJdGVtOiBjYy5Ob2RlLCAgICAvLyDlpLTlg49JdGVtIE5vZGVcclxuICAgICAgICBub2RlX3JlOiBjYy5Ob2RlLFxyXG5cclxuICAgICAgICBtYW46IGNjLk5vZGUsXHJcbiAgICAgICAgd29tYW46IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMuc2V4ID0gZ2xHYW1lLnVzZXIuZ2V0KFwidXNlclNleFwiKTtcclxuICAgICAgICB0aGlzLmlzTG9jayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVzZXREYXRhKCk7XHJcbiAgICAgICAgdGhpcy5oZWFkTWF4ID0gMjA7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub24oXCJ1cGhlYWRsaXN0XCIsIHRoaXMuc2hvd1VJLCB0aGlzKTtcclxuICAgICAgICBpZiAoZ2xHYW1lLnVzZXIuZ2V0KFwiaGVhZExpc3RcIilbdGhpcy5zZXhdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1VJKHRoaXMuc2V4KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGdsR2FtZS51c2VyLnJlcUdldEhlYWRMaXN0KHRoaXMuc2V4LCB0aGlzLmhlYWRNYXgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvLyDliJ3lp4vljJbnlYzpnaLmlbDmja5cclxuICAgIHJlc2V0RGF0YSgpIHtcclxuICAgICAgICB0aGlzLmNsaWNrSGVhZEl0ZW1JRCA9IG51bGw7XHJcbiAgICAgICAgaWYgKGdsR2FtZS51c2VyLmdldChcInVzZXJTZXhcIikgPT0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hbi5nZXRDb21wb25lbnQoY2MuVG9nZ2xlKS5pc0NoZWNrZWQgPSB0cnVlXHJcbiAgICAgICAgICAgIHRoaXMud29tYW4uZ2V0Q29tcG9uZW50KGNjLlRvZ2dsZSkuaXNDaGVja2VkID0gZmFsc2VcclxuICAgICAgICB9IGVsc2UgaWYgKGdsR2FtZS51c2VyLmdldChcInVzZXJTZXhcIikgPT0gMikge1xyXG4gICAgICAgICAgICB0aGlzLm1hbi5nZXRDb21wb25lbnQoY2MuVG9nZ2xlKS5pc0NoZWNrZWQgPSBmYWxzZVxyXG4gICAgICAgICAgICB0aGlzLndvbWFuLmdldENvbXBvbmVudChjYy5Ub2dnbGUpLmlzQ2hlY2tlZCA9IHRydWVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubWFuLm9uKFwidG9nZ2xlXCIsIHRoaXMuT25DbGlja1RvZ2dsZSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy53b21hbi5vbihcInRvZ2dsZVwiLCB0aGlzLk9uQ2xpY2tUb2dnbGUsIHRoaXMpO1xyXG4gICAgfSxcclxuICAgIC8vIOaYvuekuuWPr+abv+aNouWktOWDj1xyXG4gICAgc2hvd1VJKGluZGV4KSB7XHJcbiAgICAgICAgbGV0IGhlYWRPYmogPSBnbEdhbWUudXNlci5nZXQoXCJoZWFkTGlzdFwiKVtpbmRleF07XHJcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhoZWFkT2JqKTtcclxuICAgICAgICBsZXQgY291bnQgPSBrZXlzLmxlbmd0aCA+IHRoaXMuaGVhZE1heCA/IHRoaXMuaGVhZE1heCA6IGtleXMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMubGlzdHZpZXcucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICBjYy5sb2coXCLlpLTlg49cIiwgaGVhZE9iaiwgY291bnQpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgcGFuZWwgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmhlYWRJdGVtKTtcclxuICAgICAgICAgICAgcGFuZWwuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgcGFuZWwubmFtZSA9IGBoZWFkXyR7a2V5c1tpXX1gO1xyXG4gICAgICAgICAgICBwYW5lbC5wYXJlbnQgPSB0aGlzLmxpc3R2aWV3O1xyXG4gICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd0hlYWRJbWFnZShwYW5lbC5nZXRDaGlsZEJ5TmFtZShcIm1hc2tcIikuZ2V0Q2hpbGRCeU5hbWUoXCJpbWFnZVwiKSwgaGVhZE9ialtrZXlzW2ldXSk7XHJcbiAgICAgICAgICAgIGlmIChpID09IDApIHRoaXMuY2xpY2tIZWFkSXRlbUlEID0ga2V5c1tpXTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2xpY2sobmFtZSwgbm9kZSkge1xyXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiY2xvc2VcIjogdGhpcy5jbGlja19jbG9zZSgpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImNvbmZpcm1cIjogdGhpcy5jbGlja19jb25maXJtKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicmVmcmVzaFwiOiB0aGlzLmNsaWNrX3JlZnJlc2goKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJoZWFkXCI6IHRoaXMuY2xpY2tfaGVhZEl0ZW0obm9kZSk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwibWFuXCI6IHRoaXMuY2xpY2tfc2V4KDEpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcIndvbWFuXCI6IHRoaXMuY2xpY2tfc2V4KDIpOyBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoXCJoZWFkXCIpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSBuYW1lLnNwbGl0KFwiX1wiKVsxXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrX2hlYWRJdGVtKGluZGV4KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY2xpY2tfc2V4KGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5zZXggPSBpbmRleDtcclxuICAgICAgICBpZiAoZ2xHYW1lLnVzZXIuZ2V0KFwiaGVhZExpc3RcIilbaW5kZXhdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1VJKGluZGV4KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBnbEdhbWUudXNlci5yZXFHZXRIZWFkTGlzdChpbmRleCwgdGhpcy5oZWFkTWF4KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY2xpY2tfY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmUoKTtcclxuICAgIH0sXHJcbiAgICBjbGlja19yZWZyZXNoKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0xvY2spIHtcclxuICAgICAgICAgICAgdGhpcy5pc0xvY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGVfcmUuY29sb3IgPSBjYy5jb2xvcigxNjUsIDEzOSwgMTM5KTtcclxuICAgICAgICAgICAgLy90aGlzLm5vZGVfcmUuY2hpbGRyZW5bMF0uY29sb3IgPSBjYy5jb2xvcigxNjUsIDEzOSwgMTM5KTtcclxuICAgICAgICAgICAgZ2xHYW1lLnVzZXIucmVxR2V0SGVhZExpc3QodGhpcy5zZXgsIHRoaXMuaGVhZE1heCk7XHJcbiAgICAgICAgICAgIGxldCBkdHkgPSBjYy5kZWxheVRpbWUoMyk7XHJcbiAgICAgICAgICAgIGxldCBjYiA9IGNjLmNhbGxGdW5jKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2NrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVfcmUuY29sb3IgPSBjYy5jb2xvcigyNTUsIDI1NSwgMjU1KTtcclxuICAgICAgICAgICAgICAgIC8vdGhpcy5ub2RlX3JlLmNoaWxkcmVuWzBdLmNvbG9yID0gY2MuY29sb3IoMjU1LCAyNTUsIDI1NSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoZHR5LCBjYikpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGdsR2FtZS5wYW5lbC5zaG93RXJyb3JUaXAoXCLliLfmlrDlpKrpopHnuYHvvIzor7fnqI3lkI7ph43or5XvvIFcIilcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgLy8g56Gu6K6k5pu05o2i5aS05YOPXHJcbiAgICBjbGlja19jb25maXJtKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jbGlja0hlYWRJdGVtSUQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdsR2FtZS5wYW5lbC5zaG93RXJyb3JUaXAoZ2xHYW1lLnRpcHMuVVNFUi5DSEFOR0VIRUFELkZBSUwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYy5sb2coXCLnoa7orqTmm7TmjaLlpLTlg49cIiwgdGhpcy5jbGlja0hlYWRJdGVtSUQpO1xyXG4gICAgICAgIGdsR2FtZS51c2VyLnJlcUVkaXRIZWFkKHRoaXMuY2xpY2tIZWFkSXRlbUlELCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBoZWFkT2JqID0gZ2xHYW1lLnVzZXIuZ2V0KFwiaGVhZExpc3RcIilbdGhpcy5zZXhdO1xyXG4gICAgICAgICAgICBnbEdhbWUudXNlci5oZWFkVVJMID0gaGVhZE9ialt0aGlzLmNsaWNrSGVhZEl0ZW1JRF1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V4ICE9IGdsR2FtZS51c2VyLmdldChcInVzZXJTZXhcIikpIHtcclxuICAgICAgICAgICAgICAgIGxldCBtc2cgPSB7IFwic2V4XCI6IHRoaXMuc2V4IH07XHJcbiAgICAgICAgICAgICAgICBnbEdhbWUuZ2FtZU5ldC5zZW5kX21zZygnaHR0cC5yZXFFZGl0TXlJbmZvJywgbXNnLCAocm91dGUsIGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBnbEdhbWUudXNlci51c2VyU2V4ID0gdGhpcy5zZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2xHYW1lLmVtaXR0ZXIuZW1pdChcInVwZGF0ZVVzZXJEYXRhXCIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSBlbHNlIGdsR2FtZS5lbWl0dGVyLmVtaXQoXCJ1cGRhdGVVc2VyRGF0YVwiKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICAvLyDpgInmi6nlpLTlg49cclxuICAgIGNsaWNrX2hlYWRJdGVtKGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5jbGlja0hlYWRJdGVtSUQgPSBOdW1iZXIoaW5kZXgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgZ2xHYW1lLmVtaXR0ZXIub2ZmKFwidXBoZWFkbGlzdFwiLCB0aGlzKTtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=