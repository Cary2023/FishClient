
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/plaza/script/prefab/room/exchangeDiamond.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ef7ffifK0FCVqGfQoP1Rdan', 'exchangeDiamond');
// modules/plaza/script/prefab/room/exchangeDiamond.js

"use strict";

glGame.baseclass.extend({
  properties: {
    exchangeBox: cc.Prefab,
    labCoin: cc.Label,
    labDiamonds: cc.Label,
    content: cc.Node,
    item: cc.Node,
    iconList: [cc.SpriteFrame]
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    this.diamondList = [];
    this.registerEvent();
    this.updataInfo();
    this.ReqDiamondShop();
  },
  start: function start() {},
  // 注册界面监听事件
  registerEvent: function registerEvent() {
    glGame.emitter.on("updateUserData", this.updataInfo, this);
  },
  // 销毁界面监听事件
  unRegisterEvent: function unRegisterEvent() {
    glGame.emitter.off("updateUserData", this);
  },
  //刷新钻石数量
  updataInfo: function updataInfo() {
    this.labCoin.string = this.getFixNumber(glGame.user.get("coin"));
    this.labDiamonds.string = this.getFixNumber(glGame.user.get("diamond"));
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "btn_close":
        this.remove();
        break;

      case "btn_shop":
        this.click_shop();
        break;

      case "btn_record":
        this.click_record();
        break;

      default:
        if (name.indexOf("item_") > -1) return this.click_item(name);
        break;
    }
  },
  click_shop: function click_shop() {
    if (glGame.user.isTourist()) {
      glGame.panel.showRegisteredGift(true);
      return;
    }

    if (glGame.panel.showSuspicious("recharge")) {
      return;
    }

    glGame.panel.showShop();
  },
  click_record: function click_record() {
    glGame.panel.showPanelByName("diamondRecord");
  },
  click_item: function click_item(name) {
    var _this = this;

    var string = name.substring(5),
        index = Number(string);
    var data = this.diamondList[index];
    var panel = glGame.panel.showPanel(this.exchangeBox);
    var str = '';

    if (data.extraGift > 0) {
      str = "\u4F7F\u7528<color=#f4c404> ".concat(this.getFixNumber(data.coin), " \u91D1\u5E01</color>\u53EF\u5151\u6362<color=#cf62fe> ").concat(this.getFixNumber(data.diamond), " \u94BB\u77F3</color>,\u5E76\u4E14\u83B7\u5F97<color=#cf62fe> ").concat(this.getFixNumber(data.extraGift), " \u94BB\u77F3</color>\u8D60\u793C\uFF0C\u603B\u8BA1<color=#cf62fe> ").concat(this.getFixNumber(data.diamond + data.extraGift), " \u94BB\u77F3</color>\uFF0C\u662F\u5426\u786E\u5B9A\u5151\u6362\uFF1F");
    } else {
      str = "\u4F7F\u7528<color=#f4c404> ".concat(this.getFixNumber(data.coin), " \u91D1\u5E01</color>\u53EF\u5151\u6362<color=#cf62fe> ").concat(this.getFixNumber(data.diamond), " \u94BB\u77F3</color>\uFF0C\u662F\u5426\u786E\u5B9A\u5151\u6362\uFF1F");
    }

    panel.getComponent(panel.name).showMsg(str, function () {
      _this.ReqBuyDiamond(data);
    });
  },
  refreshUi: function refreshUi() {
    this.content.removeAllChildren();

    for (var index in this.diamondList) {
      var data = this.diamondList[index];
      if (!data) continue;
      var diamondItem = cc.instantiate(this.item);
      diamondItem.active = true;
      diamondItem.name = "item_".concat(index);
      diamondItem.getChildByName("img_zuanshidaban").getChildByName("img_icon").getComponent(cc.Sprite).spriteFrame = this.iconList[Math.min(index, this.iconList.length - 1)];
      diamondItem.getChildByName("diamond").getComponent(cc.Label).string = this.getFixNumber(data.diamond) + "钻石";
      diamondItem.getChildByName("coinLayout").getChildByName("coin").getComponent(cc.Label).string = this.getFixNumber(data.coin);
      diamondItem.getChildByName("img_zuanshiredban").active = data.extraGift > 0;
      diamondItem.getChildByName("img_zuanshiredban").getChildByName("extraGift").getComponent(cc.Label).string = "\u989D\u5916\u8D60\u9001".concat(this.getFixNumber(data.extraGift), "\u94BB\u77F3");
      this.content.addChild(diamondItem);
    }
  },
  ReqDiamondShop: function ReqDiamondShop() {
    var _this2 = this;

    glGame.gameNet.send_msg("http.ReqDiamondShop", {}, function (route, msg) {
      _this2.diamondList = msg.result;

      _this2.refreshUi();
    });
  },
  ReqBuyDiamond: function ReqBuyDiamond(data) {
    var _this3 = this;

    if (data.coin > glGame.user.get("coin")) {
      glGame.panel.showTip(glGame.tips.ROOM.GOLDNOTENOUGH);
      return;
    }

    glGame.gameNet.send_msg("http.ReqBuyDiamond", {
      diamondId: data.id,
      diamond: data.diamond,
      coin: data.coin,
      extraGift: data.extraGift
    }, function (route, msg) {
      if (msg.result.diamond > 0) {
        var addDiamond = 0;
        addDiamond = msg.result.diamond - glGame.user.diamond;
        glGame.user.diamond = msg.result.diamond;
        glGame.panel.showAwardBox("成功获得", [{
          type: glGame.awardtype.DIAMOND,
          value: _this3.getFixNumber(addDiamond)
        }]);

        _this3.updataInfo();
      } else glGame.panel.showErrorTip(glGame.tips.ROOM.EXCHANGEFAIL);
    });
  },
  getFixNumber: function getFixNumber(value) {
    var value1 = Number(value).div(10);
    value = Number(value).div(100);
    if (isNaN(value)) return;

    if (~~value === value) {
      return value.toString();
    } else if (~~value1 === value1) {
      return value.toFixed(1);
    } else {
      return value.toFixed(2);
    }
  },
  OnDestroy: function OnDestroy() {
    this.unRegisterEvent();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccGxhemFcXHNjcmlwdFxccHJlZmFiXFxyb29tXFxleGNoYW5nZURpYW1vbmQuanMiXSwibmFtZXMiOlsiZ2xHYW1lIiwiYmFzZWNsYXNzIiwiZXh0ZW5kIiwicHJvcGVydGllcyIsImV4Y2hhbmdlQm94IiwiY2MiLCJQcmVmYWIiLCJsYWJDb2luIiwiTGFiZWwiLCJsYWJEaWFtb25kcyIsImNvbnRlbnQiLCJOb2RlIiwiaXRlbSIsImljb25MaXN0IiwiU3ByaXRlRnJhbWUiLCJvbkxvYWQiLCJkaWFtb25kTGlzdCIsInJlZ2lzdGVyRXZlbnQiLCJ1cGRhdGFJbmZvIiwiUmVxRGlhbW9uZFNob3AiLCJzdGFydCIsImVtaXR0ZXIiLCJvbiIsInVuUmVnaXN0ZXJFdmVudCIsIm9mZiIsInN0cmluZyIsImdldEZpeE51bWJlciIsInVzZXIiLCJnZXQiLCJvbkNsaWNrIiwibmFtZSIsIm5vZGUiLCJyZW1vdmUiLCJjbGlja19zaG9wIiwiY2xpY2tfcmVjb3JkIiwiaW5kZXhPZiIsImNsaWNrX2l0ZW0iLCJpc1RvdXJpc3QiLCJwYW5lbCIsInNob3dSZWdpc3RlcmVkR2lmdCIsInNob3dTdXNwaWNpb3VzIiwic2hvd1Nob3AiLCJzaG93UGFuZWxCeU5hbWUiLCJzdWJzdHJpbmciLCJpbmRleCIsIk51bWJlciIsImRhdGEiLCJzaG93UGFuZWwiLCJzdHIiLCJleHRyYUdpZnQiLCJjb2luIiwiZGlhbW9uZCIsImdldENvbXBvbmVudCIsInNob3dNc2ciLCJSZXFCdXlEaWFtb25kIiwicmVmcmVzaFVpIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJkaWFtb25kSXRlbSIsImluc3RhbnRpYXRlIiwiYWN0aXZlIiwiZ2V0Q2hpbGRCeU5hbWUiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsIk1hdGgiLCJtaW4iLCJsZW5ndGgiLCJhZGRDaGlsZCIsImdhbWVOZXQiLCJzZW5kX21zZyIsInJvdXRlIiwibXNnIiwicmVzdWx0Iiwic2hvd1RpcCIsInRpcHMiLCJST09NIiwiR09MRE5PVEVOT1VHSCIsImRpYW1vbmRJZCIsImlkIiwiYWRkRGlhbW9uZCIsInNob3dBd2FyZEJveCIsInR5cGUiLCJhd2FyZHR5cGUiLCJESUFNT05EIiwidmFsdWUiLCJzaG93RXJyb3JUaXAiLCJFWENIQU5HRUZBSUwiLCJ2YWx1ZTEiLCJkaXYiLCJpc05hTiIsInRvU3RyaW5nIiwidG9GaXhlZCIsIk9uRGVzdHJveSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxNQUFqQixDQUF3QjtBQUVwQkMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLFdBQVcsRUFBRUMsRUFBRSxDQUFDQyxNQURSO0FBRVJDLElBQUFBLE9BQU8sRUFBRUYsRUFBRSxDQUFDRyxLQUZKO0FBR1JDLElBQUFBLFdBQVcsRUFBRUosRUFBRSxDQUFDRyxLQUhSO0FBSVJFLElBQUFBLE9BQU8sRUFBRUwsRUFBRSxDQUFDTSxJQUpKO0FBS1JDLElBQUFBLElBQUksRUFBRVAsRUFBRSxDQUFDTSxJQUxEO0FBTVJFLElBQUFBLFFBQVEsRUFBRSxDQUFDUixFQUFFLENBQUNTLFdBQUo7QUFORixHQUZRO0FBV3BCO0FBQ0FDLEVBQUFBLE1BWm9CLG9CQVlYO0FBQ0wsU0FBS0MsV0FBTCxHQUFtQixFQUFuQjtBQUNBLFNBQUtDLGFBQUw7QUFDQSxTQUFLQyxVQUFMO0FBQ0EsU0FBS0MsY0FBTDtBQUNILEdBakJtQjtBQWtCcEJDLEVBQUFBLEtBbEJvQixtQkFrQlosQ0FDUCxDQW5CbUI7QUFxQnBCO0FBQ0FILEVBQUFBLGFBdEJvQiwyQkFzQko7QUFDWmpCLElBQUFBLE1BQU0sQ0FBQ3FCLE9BQVAsQ0FBZUMsRUFBZixDQUFrQixnQkFBbEIsRUFBb0MsS0FBS0osVUFBekMsRUFBcUQsSUFBckQ7QUFDSCxHQXhCbUI7QUF5QnBCO0FBQ0FLLEVBQUFBLGVBMUJvQiw2QkEwQkY7QUFDZHZCLElBQUFBLE1BQU0sQ0FBQ3FCLE9BQVAsQ0FBZUcsR0FBZixD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QUFBQSxLQUFLLEdBQUd0QyxNQUFNLENBQUNzQyxLQUFELENBQU4sQ0FBY0ksR0FBZCxDQUFrQixHQUFsQixDQUFSO0FBQ0EsUUFBSUMsS0FBSyxDQUFDTCxLQUFELENBQVQsRUFBa0I7O0FBQ2xCLFFBQUksQ0FBQyxDQUFDQSxLQUFGLEtBQVlBLEtBQWhCLEVBQXVCO0FBQ25CLGFBQU9BLEtBQUssQ0FBQ00sUUFBTixFQUFQO0FBQ0gsS0FGRCxNQUVPLElBQUksQ0FBQyxDQUFDSCxNQUFGLEtBQWFBLE1BQWpCLEVBQXlCO0FBQzVCLGFBQU9ILEtBQUssQ0FBQ08sT0FBTixDQUFjLENBQWQsQ0FBUDtBQUNILEtBRk0sTUFFQTtBQUNILGFBQU9QLEtBQUssQ0FBQ08sT0FBTixDQUFjLENBQWQsQ0FBUDtBQUNIO0FBQ0osR0FuSW1CO0FBcUlwQkMsRUFBQUEsU0FySW9CLHVCQXFJUjtBQUNSLFNBQUtwRSxlQUFMO0FBQ0g7QUF2SW1CLENBQXhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJnbEdhbWUuYmFzZWNsYXNzLmV4dGVuZCh7XHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGV4Y2hhbmdlQm94OiBjYy5QcmVmYWIsXHJcbiAgICAgICAgbGFiQ29pbjogY2MuTGFiZWwsXHJcbiAgICAgICAgbGFiRGlhbW9uZHM6IGNjLkxhYmVsLFxyXG4gICAgICAgIGNvbnRlbnQ6IGNjLk5vZGUsXHJcbiAgICAgICAgaXRlbTogY2MuTm9kZSxcclxuICAgICAgICBpY29uTGlzdDogW2NjLlNwcml0ZUZyYW1lXSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5kaWFtb25kTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCgpO1xyXG4gICAgICAgIHRoaXMudXBkYXRhSW5mbygpO1xyXG4gICAgICAgIHRoaXMuUmVxRGlhbW9uZFNob3AoKTtcclxuICAgIH0sXHJcbiAgICBzdGFydCgpIHtcclxuICAgIH0sXHJcblxyXG4gICAgLy8g5rOo5YaM55WM6Z2i55uR5ZCs5LqL5Lu2XHJcbiAgICByZWdpc3RlckV2ZW50KCkge1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9uKFwidXBkYXRlVXNlckRhdGFcIiwgdGhpcy51cGRhdGFJbmZvLCB0aGlzKTtcclxuICAgIH0sXHJcbiAgICAvLyDplIDmr4HnlYzpnaLnm5HlkKzkuovku7ZcclxuICAgIHVuUmVnaXN0ZXJFdmVudCgpIHtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vZmYoXCJ1cGRhdGVVc2VyRGF0YVwiLCB0aGlzKTtcclxuICAgIH0sXHJcblxyXG4gICAgLy/liLfmlrDpkrvnn7PmlbDph49cclxuICAgIHVwZGF0YUluZm8oKSB7XHJcbiAgICAgICAgdGhpcy5sYWJDb2luLnN0cmluZyA9IHRoaXMuZ2V0Rml4TnVtYmVyKGdsR2FtZS51c2VyLmdldChcImNvaW5cIikpO1xyXG4gICAgICAgIHRoaXMubGFiRGlhbW9uZHMuc3RyaW5nID0gdGhpcy5nZXRGaXhOdW1iZXIoZ2xHYW1lLnVzZXIuZ2V0KFwiZGlhbW9uZFwiKSk7XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBvbkNsaWNrKG5hbWUsIG5vZGUpIHtcclxuICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9jbG9zZVwiOiB0aGlzLnJlbW92ZSgpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9zaG9wXCI6IHRoaXMuY2xpY2tfc2hvcCgpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9yZWNvcmRcIjogdGhpcy5jbGlja19yZWNvcmQoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmRleE9mKFwiaXRlbV9cIikgPiAtMSkgcmV0dXJuIHRoaXMuY2xpY2tfaXRlbShuYW1lKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgY2xpY2tfc2hvcCgpIHtcclxuICAgICAgICBpZiAoZ2xHYW1lLnVzZXIuaXNUb3VyaXN0KCkpIHtcclxuICAgICAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dSZWdpc3RlcmVkR2lmdCh0cnVlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZ2xHYW1lLnBhbmVsLnNob3dTdXNwaWNpb3VzKFwicmVjaGFyZ2VcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbEdhbWUucGFuZWwuc2hvd1Nob3AoKTtcclxuICAgIH0sXHJcblxyXG4gICAgY2xpY2tfcmVjb3JkKCkge1xyXG4gICAgICAgIGdsR2FtZS5wYW5lbC5zaG93UGFuZWxCeU5hbWUoXCJkaWFtb25kUmVjb3JkXCIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBjbGlja19pdGVtKG5hbWUpIHtcclxuICAgICAgICBsZXQgc3RyaW5nID0gbmFtZS5zdWJzdHJpbmcoNSksIGluZGV4ID0gTnVtYmVyKHN0cmluZyk7XHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmRpYW1vbmRMaXN0W2luZGV4XTtcclxuICAgICAgICBsZXQgcGFuZWwgPSBnbEdhbWUucGFuZWwuc2hvd1BhbmVsKHRoaXMuZXhjaGFuZ2VCb3gpO1xyXG4gICAgICAgIGxldCBzdHIgPSAnJztcclxuICAgICAgICBpZiAoZGF0YS5leHRyYUdpZnQgPiAwKSB7XHJcbiAgICAgICAgICAgIHN0ciA9IGDkvb/nlKg8Y29sb3I9I2Y0YzQwND4gJHt0aGlzLmdldEZpeE51bWJlcihkYXRhLmNvaW4pfSDph5HluIE8L2NvbG9yPuWPr+WFkeaNojxjb2xvcj0jY2Y2MmZlPiAke3RoaXMuZ2V0Rml4TnVtYmVyKGRhdGEuZGlhbW9uZCl9IOmSu+efszwvY29sb3I+LOW5tuS4lOiOt+W+lzxjb2xvcj0jY2Y2MmZlPiAke3RoaXMuZ2V0Rml4TnVtYmVyKGRhdGEuZXh0cmFHaWZ0KX0g6ZK755+zPC9jb2xvcj7otaDnpLzvvIzmgLvorqE8Y29sb3I9I2NmNjJmZT4gJHt0aGlzLmdldEZpeE51bWJlcihkYXRhLmRpYW1vbmQgKyBkYXRhLmV4dHJhR2lmdCl9IOmSu+efszwvY29sb3I+77yM5piv5ZCm56Gu5a6a5YWR5o2i77yfYDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdHIgPSBg5L2/55SoPGNvbG9yPSNmNGM0MDQ+ICR7dGhpcy5nZXRGaXhOdW1iZXIoZGF0YS5jb2luKX0g6YeR5biBPC9jb2xvcj7lj6/lhZHmjaI8Y29sb3I9I2NmNjJmZT4gJHt0aGlzLmdldEZpeE51bWJlcihkYXRhLmRpYW1vbmQpfSDpkrvnn7M8L2NvbG9yPu+8jOaYr+WQpuehruWumuWFkeaNou+8n2A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhbmVsLmdldENvbXBvbmVudChwYW5lbC5uYW1lKS5zaG93TXNnKHN0ciwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLlJlcUJ1eURpYW1vbmQoZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcblxyXG4gICAgcmVmcmVzaFVpKCkge1xyXG4gICAgICAgIHRoaXMuY29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGZvciAobGV0IGluZGV4IGluIHRoaXMuZGlhbW9uZExpc3QpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmRpYW1vbmRMaXN0W2luZGV4XTtcclxuICAgICAgICAgICAgaWYgKCFkYXRhKSBjb250aW51ZTtcclxuICAgICAgICAgICAgbGV0IGRpYW1vbmRJdGVtID0gY2MuaW5zdGFudGlhdGUodGhpcy5pdGVtKTtcclxuICAgICAgICAgICAgZGlhbW9uZEl0ZW0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgZGlhbW9uZEl0ZW0ubmFtZSA9IGBpdGVtXyR7aW5kZXh9YDtcclxuICAgICAgICAgICAgZGlhbW9uZEl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfenVhbnNoaWRhYmFuXCIpLmdldENoaWxkQnlOYW1lKFwiaW1nX2ljb25cIikuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmljb25MaXN0W01hdGgubWluKGluZGV4LCB0aGlzLmljb25MaXN0Lmxlbmd0aCAtIDEpXVxyXG4gICAgICAgICAgICBkaWFtb25kSXRlbS5nZXRDaGlsZEJ5TmFtZShcImRpYW1vbmRcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0aGlzLmdldEZpeE51bWJlcihkYXRhLmRpYW1vbmQpK1wi6ZK755+zXCI7XHJcbiAgICAgICAgICAgIGRpYW1vbmRJdGVtLmdldENoaWxkQnlOYW1lKFwiY29pbkxheW91dFwiKS5nZXRDaGlsZEJ5TmFtZShcImNvaW5cIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0aGlzLmdldEZpeE51bWJlcihkYXRhLmNvaW4pO1xyXG4gICAgICAgICAgICBkaWFtb25kSXRlbS5nZXRDaGlsZEJ5TmFtZShcImltZ196dWFuc2hpcmVkYmFuXCIpLmFjdGl2ZSA9IGRhdGEuZXh0cmFHaWZ0ID4gMDtcclxuICAgICAgICAgICAgZGlhbW9uZEl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfenVhbnNoaXJlZGJhblwiKS5nZXRDaGlsZEJ5TmFtZShcImV4dHJhR2lmdFwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGDpop3lpJbotaDpgIEke3RoaXMuZ2V0Rml4TnVtYmVyKGRhdGEuZXh0cmFHaWZ0KX3pkrvnn7NgO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuYWRkQ2hpbGQoZGlhbW9uZEl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgUmVxRGlhbW9uZFNob3AoKSB7XHJcbiAgICAgICAgZ2xHYW1lLmdhbWVOZXQuc2VuZF9tc2coXCJodHRwLlJlcURpYW1vbmRTaG9wXCIsIHt9LCAocm91dGUsIG1zZykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRpYW1vbmRMaXN0ID0gbXNnLnJlc3VsdDtcclxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoVWkoKTtcclxuICAgICAgICB9KVxyXG4gICAgfSxcclxuXHJcbiAgICBSZXFCdXlEaWFtb25kKGRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YS5jb2luID4gZ2xHYW1lLnVzZXIuZ2V0KFwiY29pblwiKSkge1xyXG4gICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd1RpcChnbEdhbWUudGlwcy5ST09NLkdPTEROT1RFTk9VR0gpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgXHJcbiAgICAgICAgZ2xHYW1lLmdhbWVOZXQuc2VuZF9tc2coXCJodHRwLlJlcUJ1eURpYW1vbmRcIiwgeyBkaWFtb25kSWQ6IGRhdGEuaWQsZGlhbW9uZDpkYXRhLmRpYW1vbmQsY29pbjpkYXRhLmNvaW4sIGV4dHJhR2lmdDpkYXRhLmV4dHJhR2lmdH0sIChyb3V0ZSwgbXNnKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChtc2cucmVzdWx0LmRpYW1vbmQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYWRkRGlhbW9uZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBhZGREaWFtb25kID0gbXNnLnJlc3VsdC5kaWFtb25kIC0gZ2xHYW1lLnVzZXIuZGlhbW9uZFxyXG4gICAgICAgICAgICAgICAgZ2xHYW1lLnVzZXIuZGlhbW9uZCA9IG1zZy5yZXN1bHQuZGlhbW9uZDtcclxuICAgICAgICAgICAgICAgIGdsR2FtZS5wYW5lbC5zaG93QXdhcmRCb3goXCLmiJDlip/ojrflvpdcIiwgW3sgdHlwZTogZ2xHYW1lLmF3YXJkdHlwZS5ESUFNT05ELCB2YWx1ZTogdGhpcy5nZXRGaXhOdW1iZXIoYWRkRGlhbW9uZCkgfV0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGFJbmZvKCk7XHJcbiAgICAgICAgICAgIH1lbHNlIGdsR2FtZS5wYW5lbC5zaG93RXJyb3JUaXAoZ2xHYW1lLnRpcHMuUk9PTS5FWENIQU5HRUZBSUwpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBnZXRGaXhOdW1iZXIodmFsdWUpIHtcclxuICAgICAgICBsZXQgdmFsdWUxID0gTnVtYmVyKHZhbHVlKS5kaXYoMTApO1xyXG4gICAgICAgIHZhbHVlID0gTnVtYmVyKHZhbHVlKS5kaXYoMTAwKTtcclxuICAgICAgICBpZiAoaXNOYU4odmFsdWUpKSByZXR1cm47XHJcbiAgICAgICAgaWYgKH5+dmFsdWUgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAofn52YWx1ZTEgPT09IHZhbHVlMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgyKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIE9uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLnVuUmVnaXN0ZXJFdmVudCgpO1xyXG4gICAgfSxcclxuXHJcbn0pIl19