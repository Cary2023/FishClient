
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/plaza/script/prefab/bindPhone/bindPhone.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e29e1tXqjVD57xFiv+QqsEZ', 'bindPhone');
// modules/plaza/script/prefab/bindPhone/bindPhone.js

"use strict";

glGame.baseclass.extend({
  properties: {
    //绑定手机
    edit_bindPhoneNumber: cc.EditBox,
    edit_bindPhoneCode: cc.EditBox,
    btn_send: cc.Button,
    pic_send: cc.Node,
    lab_phoneCd: cc.Label,
    audio: {
      type: cc.AudioClip,
      "default": null
    }
  },
  onLoad: function onLoad() {
    this.registerEvent();
    glGame.audio.playSoundEffect(this.audio);
    if (glGame.user.bindPhoneCodeState && glGame.user.bindPhoneVerifiCD > 0) this.bindPhoneCodeCD(glGame.user.bindPhoneVerifiCD);
  },
  start: function start() {},
  registerEvent: function registerEvent() {
    glGame.emitter.on("bindPhoneCodeCD", this.bindPhoneCodeCD, this);
  },
  unRegisterEvent: function unRegisterEvent() {
    glGame.emitter.off("bindPhoneCodeCD", this);
  },
  OnDestroy: function OnDestroy() {
    this.unRegisterEvent();
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "btn_bindPhoneSend":
        this.click_sendVerfic();
        break;

      case "btn_bindPhoneSure":
        this.bindPhoneSure_cb();
        break;

      case "close":
        this.remove();
        break;

      default:
        break;
    }
  },
  click_sendVerfic: function click_sendVerfic() {
    var phone = this.checkPhone(this.edit_bindPhoneNumber.string);
    if (!phone) return;
    glGame.user.reqBindPhoneCode({
      phone: phone,
      type: 1
    });
  },
  bindPhoneCodeCD: function bindPhoneCodeCD(msg) {
    if (glGame.user.get("bindPhoneCodeState") && msg > 0) {
      //绑定手机验证码倒计时
      this.btn_send.interactable = false;
      this.btn_send.node.getChildByName("img_liang").active = false;
      this.btn_send.node.getChildByName("img_an").active = true;
      this.pic_send.active = false;
      this.lab_phoneCd.node.active = true;
      this.lab_phoneCd.string = "".concat(msg, "\u79D2");
    } else {
      this.btn_send.node.getChildByName("img_liang").active = true;
      this.btn_send.node.getChildByName("img_an").active = false;
      this.btn_send.interactable = true;
      this.pic_send.active = true;
      this.lab_phoneCd.node.active = false;
    }
  },
  bindPhoneSure_cb: function bindPhoneSure_cb() {
    var _this = this;

    var phone = this.checkPhone(this.edit_bindPhoneNumber.string); //绑定手机确定

    if (!phone) return;
    if (this.edit_bindPhoneCode.string == "") return glGame.panel.showErrorTip(glGame.tips.REGISTRATION.VERIFICAEMPTY);
    var code = this.edit_bindPhoneCode.string;
    var reg = /^[0-9]{0,6}$/; //验证规则

    var verif = reg.test(Number(this.edit_bindPhoneCode.string));

    if (!verif) {
      return glGame.panel.showErrorTip(glGame.tips.REGISTRATION.VERIFICA);
    } // this.edit_untiedCode.string='';


    glGame.gameNet.send_msg('http.reqBindPhone', {
      phone: phone,
      code: code
    }, function (route, msg) {
      if (msg.result) {
        glGame.user.phone = phone;

        if (msg.isReceive == true && glGame.user.is_receive_register_phone_coin == 0 && Number(glGame.user.get('bind_phone_gold')) > 0) {
          glGame.user.is_receive_register_phone_coin = 1;
          glGame.panel.showAwardBox(glGame.tips.USER.BIND.CONGRATULATE, [{
            type: glGame.awardtype.COIN,
            value: _this.cutFloat(Number(glGame.user.get('bind_phone_gold')))
          }]);
        }

        glGame.user.bindPhoneFirst = 1;
        glGame.emitter.emit("updateUserData");
        glGame.emitter.emit('updatePlazaSwitch');

        _this.bindPhoneCodeCD(0);

        glGame.panel.showTip(glGame.tips.USER.BIND.PHONE);

        _this.remove();
      }
    });
  },
  // 手机号码检查
  checkPhone: function checkPhone(acc) {
    if (!acc) {
      glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONENULL);
      return null;
    }

    if (acc.length != 11) {
      glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONETYPE);
      return false;
    } //let reg = /^\d{11}$/; //验证规则


    var reg = /^134[0-8]\d{7}$|^13[^4]\d{8}$|^14[5-9]\d{8}$|^15[^4]\d{8}$|^16[6]\d{8}$|^17[0-8]\d{8}$|^18[\d]{9}$|^19[0-9]\d{8}$/;
    var isacc_matcher = reg.test(acc);

    if (!isacc_matcher) {
      glGame.panel.showErrorTip(glGame.tips.USER.BIND.INVALIDPHONE);
      return false;
    }

    return acc;
  },
  //浮点型运算取俩位
  cutFloat: function cutFloat(num) {
    return Number(num).div(100).toString();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccGxhemFcXHNjcmlwdFxccHJlZmFiXFxiaW5kUGhvbmVcXGJpbmRQaG9uZS5qcyJdLCJuYW1lcyI6WyJnbEdhbWUiLCJiYXNlY2xhc3MiLCJleHRlbmQiLCJwcm9wZXJ0aWVzIiwiZWRpdF9iaW5kUGhvbmVOdW1iZXIiLCJjYyIsIkVkaXRCb3giLCJlZGl0X2JpbmRQaG9uZUNvZGUiLCJidG5fc2VuZCIsIkJ1dHRvbiIsInBpY19zZW5kIiwiTm9kZSIsImxhYl9waG9uZUNkIiwiTGFiZWwiLCJhdWRpbyIsInR5cGUiLCJBdWRpb0NsaXAiLCJvbkxvYWQiLCJyZWdpc3RlckV2ZW50IiwicGxheVNvdW5kRWZmZWN0IiwidXNlciIsImJpbmRQaG9uZUNvZGVTdGF0ZSIsImJpbmRQaG9uZVZlcmlmaUNEIiwiYmluZFBob25lQ29kZUNEIiwic3RhcnQiLCJlbWl0dGVyIiwib24iLCJ1blJlZ2lzdGVyRXZlbnQiLCJvZmYiLCJPbkRlc3Ryb3kiLCJvbkNsaWNrIiwibmFtZSIsIm5vZGUiLCJjbGlja19zZW5kVmVyZmljIiwiYmluZFBob25lU3VyZV9jYiIsInJlbW92ZSIsInBob25lIiwiY2hlY2tQaG9uZSIsInN0cmluZyIsInJlcUJpbmRQaG9uZUNvZGUiLCJtc2ciLCJnZXQiLCJpbnRlcmFjdGFibGUiLCJnZXRDaGlsZEJ5TmFtZSIsImFjdGl2ZSIsInBhbmVsIiwic2hvd0Vycm9yVGlwIiwidGlwcyIsIlJFR0lTVFJBVElPTiIsIlZFUklGSUNBRU1QVFkiLCJjb2RlIiwicmVnIiwidmVyaWYiLCJ0ZXN0IiwiTnVtYmVyIiwiVkVSSUZJQ0EiLCJnYW1lTmV0Iiwic2VuZF9tc2ciLCJyb3V0ZSIsInJlc3VsdCIsImlzUmVjZWl2ZSIsImlzX3JlY2VpdmVfcmVnaXN0ZXJfcGhvbmVfY29pbiIsInNob3dBd2FyZEJveCIsIlVTRVIiLCJCSU5EIiwiQ09OR1JBVFVMQVRFIiwiYXdhcmR0eXBlIiwiQ09JTiIsInZhbHVlIiwiY3V0RmxvYXQiLCJiaW5kUGhvbmVGaXJzdCIsImVtaXQiLCJzaG93VGlwIiwiUEhPTkUiLCJhY2MiLCJQSE9ORU5VTEwiLCJsZW5ndGgiLCJQSE9ORVRZUEUiLCJpc2FjY19tYXRjaGVyIiwiSU5WQUxJRFBIT05FIiwibnVtIiwiZGl2IiwidG9TdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsTUFBakIsQ0FBd0I7QUFDcEJDLEVBQUFBLFVBQVUsRUFBRTtBQUNSO0FBQ0FDLElBQUFBLG9CQUFvQixFQUFFQyxFQUFFLENBQUNDLE9BRmpCO0FBR1JDLElBQUFBLGtCQUFrQixFQUFFRixFQUFFLENBQUNDLE9BSGY7QUFLUkUsSUFBQUEsUUFBUSxFQUFFSCxFQUFFLENBQUNJLE1BTEw7QUFNUkMsSUFBQUEsUUFBUSxFQUFFTCxFQUFFLENBQUNNLElBTkw7QUFPUkMsSUFBQUEsV0FBVyxFQUFFUCxFQUFFLENBQUNRLEtBUFI7QUFRUkMsSUFBQUEsS0FBSyxFQUFFO0FBQ0hDLE1BQUFBLElBQUksRUFBRVYsRUFBRSxDQUFDVyxTQUROO0FBRUgsaUJBQVM7QUFGTjtBQVJDLEdBRFE7QUFjcEJDLEVBQUFBLE1BZG9CLG9CQWNYO0FBQ0wsU0FBS0MsYUFBTDtBQUNBbEIsSUFBQUEsTUFBTSxDQUFDYyxLQUFQLENBQWFLLGVBQWIsQ0FBNkIsS0FBS0wsS0FBbEM7QUFDQSxRQUFJZCxNQUFNLENBQUNvQixJQUFQLENBQVlDLGtCQUFaLElBQWtDckIsTUFBTSxDQUFDb0IsSUFBUCxDQUFZRSxpQkFBWixHQUFnQyxDQUF0RSxFQUF5RSxLQUFLQyxlQUFMLENBQXFCdkIsTUFBTSxDQUFDb0IsSUFBUCxDQUFZRSxpQkFBakM7QUFDNUUsR0FsQm1CO0FBb0JwQkUsRUFBQUEsS0FwQm9CLG1CQW9CWixDQUNQLENBckJtQjtBQXNCcEJOLEVBQUFBLGFBdEJvQiwyQkFzQko7QUFDWmxCLElBQUFBLE1BQU0sQ0FBQ3lCLE9BQVAsQ0FBZUMsRUFBZixDQUFrQixpQkFB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LEdBQUcsR0FBRyxtSEFBVjtBQUNBLFFBQUkyQixhQUFhLEdBQUczQixHQUFHLENBQUNFLElBQUosQ0FBU3FCLEdBQVQsQ0FBcEI7O0FBQ0EsUUFBSSxDQUFDSSxhQUFMLEVBQW9CO0FBQ2hCOUUsTUFBQUEsTUFBTSxDQUFDNkMsS0FBUCxDQUFhQyxZQUFiLENBQTBCOUMsTUFBTSxDQUFDK0MsSUFBUCxDQUFZZ0IsSUFBWixDQUFpQkMsSUFBakIsQ0FBc0JlLFlBQWhEO0FBQ0EsYUFBTyxLQUFQO0FBQ0g7O0FBQ0QsV0FBT0wsR0FBUDtBQUNILEdBbEhtQjtBQXFIcEI7QUFDQUwsRUFBQUEsUUF0SG9CLG9CQXNIWFcsR0F0SFcsRUFzSE47QUFDVixXQUFRMUIsTUFBTSxDQUFDMEIsR0FBRCxDQUFOLENBQVlDLEdBQVosQ0FBZ0IsR0FBaEIsQ0FBRCxDQUF1QkMsUUFBdkIsRUFBUDtBQUNIO0FBeEhtQixDQUF4QiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiZ2xHYW1lLmJhc2VjbGFzcy5leHRlbmQoe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIC8v57uR5a6a5omL5py6XHJcbiAgICAgICAgZWRpdF9iaW5kUGhvbmVOdW1iZXI6IGNjLkVkaXRCb3gsXHJcbiAgICAgICAgZWRpdF9iaW5kUGhvbmVDb2RlOiBjYy5FZGl0Qm94LFxyXG5cclxuICAgICAgICBidG5fc2VuZDogY2MuQnV0dG9uLFxyXG4gICAgICAgIHBpY19zZW5kOiBjYy5Ob2RlLFxyXG4gICAgICAgIGxhYl9waG9uZUNkOiBjYy5MYWJlbCxcclxuICAgICAgICBhdWRpbzoge1xyXG4gICAgICAgICAgICB0eXBlOiBjYy5BdWRpb0NsaXAsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoKTtcclxuICAgICAgICBnbEdhbWUuYXVkaW8ucGxheVNvdW5kRWZmZWN0KHRoaXMuYXVkaW8pXHJcbiAgICAgICAgaWYgKGdsR2FtZS51c2VyLmJpbmRQaG9uZUNvZGVTdGF0ZSAmJiBnbEdhbWUudXNlci5iaW5kUGhvbmVWZXJpZmlDRCA+IDApIHRoaXMuYmluZFBob25lQ29kZUNEKGdsR2FtZS51c2VyLmJpbmRQaG9uZVZlcmlmaUNEKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICB9LFxyXG4gICAgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vbihcImJpbmRQaG9uZUNvZGVDRFwiLCB0aGlzLmJpbmRQaG9uZUNvZGVDRCwgdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgdW5SZWdpc3RlckV2ZW50KCkge1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9mZihcImJpbmRQaG9uZUNvZGVDRFwiLCB0aGlzKTtcclxuICAgIH0sXHJcblxyXG4gICAgT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMudW5SZWdpc3RlckV2ZW50KCk7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICBvbkNsaWNrKG5hbWUsIG5vZGUpIHtcclxuICAgICAgICBzd2l0Y2ggKG5hbWUpIHtcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9iaW5kUGhvbmVTZW5kXCI6IHRoaXMuY2xpY2tfc2VuZFZlcmZpYygpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImJ0bl9iaW5kUGhvbmVTdXJlXCI6IHRoaXMuYmluZFBob25lU3VyZV9jYigpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImNsb3NlXCI6IHRoaXMucmVtb3ZlKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNsaWNrX3NlbmRWZXJmaWMoKSB7XHJcbiAgICAgICAgbGV0IHBob25lID0gdGhpcy5jaGVja1Bob25lKHRoaXMuZWRpdF9iaW5kUGhvbmVOdW1iZXIuc3RyaW5nKVxyXG4gICAgICAgIGlmICghcGhvbmUpIHJldHVybjtcclxuICAgICAgICBnbEdhbWUudXNlci5yZXFCaW5kUGhvbmVDb2RlKHsgcGhvbmU6IHBob25lLCB0eXBlOiAxIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBiaW5kUGhvbmVDb2RlQ0QobXNnKSB7XHJcbiAgICAgICAgaWYgKGdsR2FtZS51c2VyLmdldChcImJpbmRQaG9uZUNvZGVTdGF0ZVwiKSAmJiBtc2cgPiAwKSB7ICAgICAgICAgICAgICAvL+e7keWumuaJi+acuumqjOivgeeggeWAkuiuoeaXtlxyXG4gICAgICAgICAgICB0aGlzLmJ0bl9zZW5kLmludGVyYWN0YWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmJ0bl9zZW5kLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfbGlhbmdcIikuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuYnRuX3NlbmQubm9kZS5nZXRDaGlsZEJ5TmFtZShcImltZ19hblwiKS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnBpY19zZW5kLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmxhYl9waG9uZUNkLm5vZGUuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5sYWJfcGhvbmVDZC5zdHJpbmcgPSBgJHttc2d956eSYDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJ0bl9zZW5kLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfbGlhbmdcIikuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5idG5fc2VuZC5ub2RlLmdldENoaWxkQnlOYW1lKFwiaW1nX2FuXCIpLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmJ0bl9zZW5kLmludGVyYWN0YWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMucGljX3NlbmQuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5sYWJfcGhvbmVDZC5ub2RlLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgYmluZFBob25lU3VyZV9jYigpIHtcclxuXHJcbiAgICAgICAgbGV0IHBob25lID0gdGhpcy5jaGVja1Bob25lKHRoaXMuZWRpdF9iaW5kUGhvbmVOdW1iZXIuc3RyaW5nKSAgICAgICAvL+e7keWumuaJi+acuuehruWumlxyXG4gICAgICAgIGlmICghcGhvbmUpIHJldHVybjtcclxuICAgICAgICBpZiAodGhpcy5lZGl0X2JpbmRQaG9uZUNvZGUuc3RyaW5nID09IFwiXCIpcmV0dXJuIGdsR2FtZS5wYW5lbC5zaG93RXJyb3JUaXAoZ2xHYW1lLnRpcHMuUkVHSVNUUkFUSU9OLlZFUklGSUNBRU1QVFkpO1xyXG4gICAgICAgIGxldCBjb2RlID0gdGhpcy5lZGl0X2JpbmRQaG9uZUNvZGUuc3RyaW5nO1xyXG4gICAgICAgIGxldCByZWcgPSAvXlswLTldezAsNn0kLzsvL+mqjOivgeinhOWImVxyXG4gICAgICAgIGxldCB2ZXJpZiA9IHJlZy50ZXN0KE51bWJlcih0aGlzLmVkaXRfYmluZFBob25lQ29kZS5zdHJpbmcpKTtcclxuICAgICAgICBpZiAoIXZlcmlmKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnbEdhbWUucGFuZWwuc2hvd0Vycm9yVGlwKGdsR2FtZS50aXBzLlJFR0lTVFJBVElPTi5WRVJJRklDQSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuZWRpdF91bnRpZWRDb2RlLnN0cmluZz0nJztcclxuICAgICAgICBnbEdhbWUuZ2FtZU5ldC5zZW5kX21zZygnaHR0cC5yZXFCaW5kUGhvbmUnLCB7IHBob25lOiBwaG9uZSwgY29kZTogY29kZSB9LCAocm91dGUsIG1zZykgPT4ge1xyXG4gICAgICAgICAgICBpZiAobXNnLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgZ2xHYW1lLnVzZXIucGhvbmUgPSBwaG9uZVxyXG4gICAgICAgICAgICAgICAgaWYgKG1zZy5pc1JlY2VpdmUgPT0gdHJ1ZSAmJiBnbEdhbWUudXNlci5pc19yZWNlaXZlX3JlZ2lzdGVyX3Bob25lX2NvaW4gPT0gMCAmJiBOdW1iZXIoZ2xHYW1lLnVzZXIuZ2V0KCdiaW5kX3Bob25lX2dvbGQnKSkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2xHYW1lLnVzZXIuaXNfcmVjZWl2ZV9yZWdpc3Rlcl9waG9uZV9jb2luID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd0F3YXJkQm94KGdsR2FtZS50aXBzLlVTRVIuQklORC5DT05HUkFUVUxBVEUsIFt7IHR5cGU6IGdsR2FtZS5hd2FyZHR5cGUuQ09JTiwgdmFsdWU6IHRoaXMuY3V0RmxvYXQoTnVtYmVyKGdsR2FtZS51c2VyLmdldCgnYmluZF9waG9uZV9nb2xkJykpKX1dKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGdsR2FtZS51c2VyLmJpbmRQaG9uZUZpcnN0ID0gMTtcclxuICAgICAgICAgICAgICAgIGdsR2FtZS5lbWl0dGVyLmVtaXQoXCJ1cGRhdGVVc2VyRGF0YVwiKTtcclxuICAgICAgICAgICAgICAgIGdsR2FtZS5lbWl0dGVyLmVtaXQoJ3VwZGF0ZVBsYXphU3dpdGNoJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRQaG9uZUNvZGVDRCgwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd1RpcChnbEdhbWUudGlwcy5VU0VSLkJJTkQuUEhPTkUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcblxyXG4gICAgLy8g5omL5py65Y+356CB5qOA5p+lXHJcbiAgICBjaGVja1Bob25lKGFjYykge1xyXG4gICAgICAgIGlmICghYWNjKSB7XHJcbiAgICAgICAgICAgIGdsR2FtZS5wYW5lbC5zaG93RXJyb3JUaXAoZ2xHYW1lLnRpcHMuUkVHSVNUUkFUSU9OLlBIT05FTlVMTCk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGFjYy5sZW5ndGggIT0gMTEpIHtcclxuICAgICAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dFcnJvclRpcChnbEdhbWUudGlwcy5SRUdJU1RSQVRJT04uUEhPTkVUWVBFKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vbGV0IHJlZyA9IC9eXFxkezExfSQvOyAvL+mqjOivgeinhOWImVxyXG4gICAgICAgIHZhciByZWcgPSAvXjEzNFswLThdXFxkezd9JHxeMTNbXjRdXFxkezh9JHxeMTRbNS05XVxcZHs4fSR8XjE1W140XVxcZHs4fSR8XjE2WzZdXFxkezh9JHxeMTdbMC04XVxcZHs4fSR8XjE4W1xcZF17OX0kfF4xOVswLTldXFxkezh9JC87XHJcbiAgICAgICAgbGV0IGlzYWNjX21hdGNoZXIgPSByZWcudGVzdChhY2MpO1xyXG4gICAgICAgIGlmICghaXNhY2NfbWF0Y2hlcikge1xyXG4gICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd0Vycm9yVGlwKGdsR2FtZS50aXBzLlVTRVIuQklORC5JTlZBTElEUEhPTkUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhY2M7XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICAvL+a1rueCueWei+i/kOeul+WPluS/qeS9jVxyXG4gICAgY3V0RmxvYXQobnVtKSB7XHJcbiAgICAgICAgcmV0dXJuIChOdW1iZXIobnVtKS5kaXYoMTAwKSkudG9TdHJpbmcoKTtcclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=