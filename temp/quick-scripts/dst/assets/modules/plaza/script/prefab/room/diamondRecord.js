
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/plaza/script/prefab/room/diamondRecord.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '91288GVVMtK6qQ6IzQVOX7h', 'diamondRecord');
// modules/plaza/script/prefab/room/diamondRecord.js

"use strict";

glGame.baseclass.extend({
  properties: {
    norecord: cc.Node,
    content: cc.Node,
    item: cc.Node,
    labPage: cc.Label
  },
  onLoad: function onLoad() {
    this.PageIndex = 1;
    this.pageCount = 1;
    this.recordList = {};
    this.registerEvent();
    this.reqDiamondTransactionRecord();
  },
  registerEvent: function registerEvent() {},
  unRegisterEvent: function unRegisterEvent() {},
  OnDestroy: function OnDestroy() {
    this.unRegisterEvent();
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "btn_close":
        this.remove();
        break;

      case "btn_lastPage":
        this.lastPage_cb();
        break;

      case "btn_nextPage":
        this.nextPage_cb();
        break;

      default:
        console.error("no find button name -> %s", name);
    }
  },
  lastPage_cb: function lastPage_cb() {
    if (this.PageIndex == 1 || this.PageIndex == 0) return glGame.panel.showTip("已经是第一页了！");
    this.PageIndex--;
    this.reqDiamondTransactionRecord();
  },
  nextPage_cb: function nextPage_cb() {
    if (this.PageIndex >= this.pageCount || this.PageIndex == 0) return glGame.panel.showTip("已经是最后一页了！");
    this.PageIndex++;
    this.reqDiamondTransactionRecord();
  },
  reqDiamondTransactionRecord: function reqDiamondTransactionRecord() {
    var _this = this;

    var msg = {};
    msg.page = this.PageIndex;
    msg.pageSize = 8;
    console.log(this.recordList, "this.recordList");

    if (this.recordList[this.PageIndex]) {
      this.initRecordUI(this.recordList[this.PageIndex]);
    } else {
      glGame.gameNet.send_msg('http.ReqDiamondTransactionRecord', msg, function (route, data) {
        var result = data.result;
        _this.pageCount = result.totalPage;
        _this.recordList ? null : _this.recordList = {};
        _this.recordList[_this.PageIndex] = result.data;

        _this.initRecordUI(result.data);
      });
    }
  },
  //渲染牌局记录
  initRecordUI: function initRecordUI(list) {
    this.content.removeAllChildren(); // if (list.length == 0) {
    //     this.labPage.string = '第0/0页';
    //     return;
    // }

    var count = list.length;

    if (count == 0) {
      this.norecord.active = true;
      return;
    }

    this.hiadShowNode(count > 0);
    this.labPage.string = "\u7B2C".concat(this.PageIndex, "/").concat(this.pageCount, "\u9875");

    for (var i = 0; i < list.length; i++) {
      var node = cc.instantiate(this.item);
      node.getChildByName("bg").active = i % 2 != 0;
      node.parent = this.content;
      node.active = true;
      var timeStamp = new Date(list[i].createTime * 1000);
      var strTime = "".concat(timeStamp.getFullYear(), "/").concat(timeStamp.getMonth() + 1 >= 10 ? timeStamp.getMonth() + 1 : "0" + (timeStamp.getMonth() + 1), "/").concat(timeStamp.getDate() >= 10 ? timeStamp.getDate() : '0' + timeStamp.getDate());
      strTime += "\uFF08".concat(glGame.tips.WEEKNAME[timeStamp.getDay()], "\uFF09");
      strTime += "".concat(timeStamp.getHours() >= 10 ? timeStamp.getHours() : "0" + timeStamp.getHours(), ":");
      strTime += "".concat(timeStamp.getMinutes() >= 10 ? timeStamp.getMinutes() : "0" + timeStamp.getMinutes(), ":");
      strTime += "".concat(timeStamp.getSeconds() >= 10 ? timeStamp.getSeconds() : "0" + timeStamp.getSeconds());
      node.getChildByName("time").getComponent(cc.Label).string = strTime;
      node.getChildByName("type").getComponent(cc.Label).string = list[i].typeDes;
      var diamondNum = 0;
      diamondNum += list[i].diamondIncome;
      diamondNum -= list[i].diamondExpenses;
      node.getChildByName("diamond").getComponent(cc.Label).string = this.getFixNumber(diamondNum);
      node.getChildByName("diamond").color = diamondNum > 0 ? cc.color(0x66, 0x90, 0xcc) : cc.color(0xf4, 0xc4, 0x04);
    }
  },
  getFixNumber: function getFixNumber(value) {
    var value1 = Number(value).div(10);
    value = Number(value).div(100);
    if (isNaN(value)) return;

    if (~~value === value) {
      return value.toString();
    } else if (~~value1 === value1) {
      return value.toFixed(1);
    } else {
      return value.toFixed(2);
    }
  },
  hiadShowNode: function hiadShowNode(isBool) {
    this.node.getChildByName("btn_lastPage").active = isBool;
    this.node.getChildByName("btn_nextPage").active = isBool;
    this.node.getChildByName("pageIndex").active = isBool;
    this.node.getChildByName("downtips").active = isBool;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xccGxhemFcXHNjcmlwdFxccHJlZmFiXFxyb29tXFxkaWFtb25kUmVjb3JkLmpzIl0sIm5hbWVzIjpbImdsR2FtZSIsImJhc2VjbGFzcyIsImV4dGVuZCIsInByb3BlcnRpZXMiLCJub3JlY29yZCIsImNjIiwiTm9kZSIsImNvbnRlbnQiLCJpdGVtIiwibGFiUGFnZSIsIkxhYmVsIiwib25Mb2FkIiwiUGFnZUluZGV4IiwicGFnZUNvdW50IiwicmVjb3JkTGlzdCIsInJlZ2lzdGVyRXZlbnQiLCJyZXFEaWFtb25kVHJhbnNhY3Rpb25SZWNvcmQiLCJ1blJlZ2lzdGVyRXZlbnQiLCJPbkRlc3Ryb3kiLCJvbkNsaWNrIiwibmFtZSIsIm5vZGUiLCJyZW1vdmUiLCJsYXN0UGFnZV9jYiIsIm5leHRQYWdlX2NiIiwiY29uc29sZSIsImVycm9yIiwicGFuZWwiLCJzaG93VGlwIiwibXNnIiwicGFnZSIsInBhZ2VTaXplIiwibG9nIiwiaW5pdFJlY29yZFVJIiwiZ2FtZU5ldCIsInNlbmRfbXNnIiwicm91dGUiLCJkYXRhIiwicmVzdWx0IiwidG90YWxQYWdlIiwibGlzdCIsInJlbW92ZUFsbENoaWxkcmVuIiwiY291bnQiLCJsZW5ndGgiLCJhY3RpdmUiLCJoaWFkU2hvd05vZGUiLCJzdHJpbmciLCJpIiwiaW5zdGFudGlhdGUiLCJnZXRDaGlsZEJ5TmFtZSIsInBhcmVudCIsInRpbWVTdGFtcCIsIkRhdGUiLCJjcmVhdGVUaW1lIiwic3RyVGltZSIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwidGlwcyIsIldFRUtOQU1FIiwiZ2V0RGF5IiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsImdldENvbXBvbmVudCIsInR5cGVEZXMiLCJkaWFtb25kTnVtIiwiZGlhbW9uZEluY29tZSIsImRpYW1vbmRFeHBlbnNlcyIsImdldEZpeE51bWJlciIsImNvbG9yIiwidmFsdWUiLCJ2YWx1ZTEiLCJOdW1i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QUFOLEVBQVA7QUFDSCxLQUZELE1BRU8sSUFBSSxDQUFDLENBQUNKLE1BQUYsS0FBYUEsTUFBakIsRUFBeUI7QUFDNUIsYUFBT0QsS0FBSyxDQUFDTSxPQUFOLENBQWMsQ0FBZCxDQUFQO0FBQ0gsS0FGTSxNQUVBO0FBQ0gsYUFBT04sS0FBSyxDQUFDTSxPQUFOLENBQWMsQ0FBZCxDQUFQO0FBQ0g7QUFDSixHQTdHbUI7QUE4R3BCaEMsRUFBQUEsWUE5R29CLHdCQThHUGlDLE1BOUdPLEVBOEdDO0FBQ2pCLFNBQUt6RCxJQUFMLENBQVU0QixjQUFWLENBQXlCLGNBQXpCLEVBQXlDTCxNQUF6QyxHQUFrRGtDLE1BQWxEO0FBQ0EsU0FBS3pELElBQUwsQ0FBVTRCLGNBQVYsQ0FBeUIsY0FBekIsRUFBeUNMLE1BQXpDLEdBQWtEa0MsTUFBbEQ7QUFDQSxTQUFLekQsSUFBTCxDQUFVNEIsY0FBVixDQUF5QixXQUF6QixFQUFzQ0wsTUFBdEMsR0FBK0NrQyxNQUEvQztBQUNBLFNBQUt6RCxJQUFMLENBQVU0QixjQUFWLENBQXlCLFVBQXpCLEVBQXFDTCxNQUFyQyxHQUE4Q2tDLE1BQTlDO0FBQ0g7QUFuSG1CLENBQXhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJnbEdhbWUuYmFzZWNsYXNzLmV4dGVuZCh7XHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgbm9yZWNvcmQ6IGNjLk5vZGUsXHJcbiAgICAgICAgY29udGVudDogY2MuTm9kZSxcclxuICAgICAgICBpdGVtOiBjYy5Ob2RlLFxyXG4gICAgICAgIGxhYlBhZ2U6IGNjLkxhYmVsLFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLlBhZ2VJbmRleCA9IDE7XHJcbiAgICAgICAgdGhpcy5wYWdlQ291bnQgPSAxO1xyXG4gICAgICAgIHRoaXMucmVjb3JkTGlzdCA9IHt9O1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCgpO1xyXG4gICAgICAgIHRoaXMucmVxRGlhbW9uZFRyYW5zYWN0aW9uUmVjb3JkKCk7XHJcbiAgICB9LFxyXG4gICAgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgIH0sXHJcbiAgICB1blJlZ2lzdGVyRXZlbnQoKSB7XHJcbiAgICB9LFxyXG4gICAgT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMudW5SZWdpc3RlckV2ZW50KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2xpY2sobmFtZSwgbm9kZSkge1xyXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiYnRuX2Nsb3NlXCI6IHRoaXMucmVtb3ZlKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiYnRuX2xhc3RQYWdlXCI6IHRoaXMubGFzdFBhZ2VfY2IoKTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJidG5fbmV4dFBhZ2VcIjogdGhpcy5uZXh0UGFnZV9jYigpOyBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDogY29uc29sZS5lcnJvcihcIm5vIGZpbmQgYnV0dG9uIG5hbWUgLT4gJXNcIiwgbmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBsYXN0UGFnZV9jYigpIHtcclxuICAgICAgICBpZiAodGhpcy5QYWdlSW5kZXggPT0gMSB8fCB0aGlzLlBhZ2VJbmRleCA9PSAwKSByZXR1cm4gZ2xHYW1lLnBhbmVsLnNob3dUaXAoXCLlt7Lnu4/mmK/nrKzkuIDpobXkuobvvIFcIilcclxuICAgICAgICB0aGlzLlBhZ2VJbmRleC0tO1xyXG4gICAgICAgIHRoaXMucmVxRGlhbW9uZFRyYW5zYWN0aW9uUmVjb3JkKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIG5leHRQYWdlX2NiKCkge1xyXG4gICAgICAgIGlmICh0aGlzLlBhZ2VJbmRleCA+PSB0aGlzLnBhZ2VDb3VudCB8fCB0aGlzLlBhZ2VJbmRleCA9PSAwKSByZXR1cm4gZ2xHYW1lLnBhbmVsLnNob3dUaXAoXCLlt7Lnu4/mmK/mnIDlkI7kuIDpobXkuobvvIFcIilcclxuICAgICAgICB0aGlzLlBhZ2VJbmRleCsrO1xyXG4gICAgICAgIHRoaXMucmVxRGlhbW9uZFRyYW5zYWN0aW9uUmVjb3JkKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlcURpYW1vbmRUcmFuc2FjdGlvblJlY29yZCgpIHtcclxuICAgICAgICBsZXQgbXNnID0ge307XHJcbiAgICAgICAgbXNnLnBhZ2UgPSB0aGlzLlBhZ2VJbmRleDtcclxuICAgICAgICBtc2cucGFnZVNpemUgPSA4O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucmVjb3JkTGlzdCwgXCJ0aGlzLnJlY29yZExpc3RcIik7XHJcbiAgICAgICAgaWYgKHRoaXMucmVjb3JkTGlzdFt0aGlzLlBhZ2VJbmRleF0pIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0UmVjb3JkVUkodGhpcy5yZWNvcmRMaXN0W3RoaXMuUGFnZUluZGV4XSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZ2xHYW1lLmdhbWVOZXQuc2VuZF9tc2coJ2h0dHAuUmVxRGlhbW9uZFRyYW5zYWN0aW9uUmVjb3JkJywgbXNnLCAocm91dGUsIGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBkYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZUNvdW50ID0gcmVzdWx0LnRvdGFsUGFnZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVjb3JkTGlzdCA/IG51bGwgOiB0aGlzLnJlY29yZExpc3QgPSB7fTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVjb3JkTGlzdFt0aGlzLlBhZ2VJbmRleF0gPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFJlY29yZFVJKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfSxcclxuXHJcbiAgICAvL+a4suafk+eJjOWxgOiusOW9lVxyXG4gICAgaW5pdFJlY29yZFVJKGxpc3QpIHtcclxuICAgICAgICB0aGlzLmNvbnRlbnQucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICAvLyBpZiAobGlzdC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgIC8vICAgICB0aGlzLmxhYlBhZ2Uuc3RyaW5nID0gJ+esrDAvMOmhtSc7XHJcbiAgICAgICAgLy8gICAgIHJldHVybjtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgbGV0IGNvdW50ID0gbGlzdC5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGNvdW50ID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5ub3JlY29yZC5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGlhZFNob3dOb2RlKGNvdW50ID4gMCk7XHJcblxyXG4gICAgICAgIHRoaXMubGFiUGFnZS5zdHJpbmcgPSBg56ysJHt0aGlzLlBhZ2VJbmRleH0vJHt0aGlzLnBhZ2VDb3VudH3pobVgO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgbm9kZSA9IGNjLmluc3RhbnRpYXRlKHRoaXMuaXRlbSk7XHJcbiAgICAgICAgICAgIG5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJiZ1wiKS5hY3RpdmUgPSBpICUgMiAhPSAwO1xyXG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IHRoaXMuY29udGVudDtcclxuICAgICAgICAgICAgbm9kZS5hY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgbGV0IHRpbWVTdGFtcCA9IG5ldyBEYXRlKGxpc3RbaV0uY3JlYXRlVGltZSAqIDEwMDApO1xyXG4gICAgICAgICAgICBsZXQgc3RyVGltZSA9IGAke3RpbWVTdGFtcC5nZXRGdWxsWWVhcigpfS8ke3RpbWVTdGFtcC5nZXRNb250aCgpICsgMSA+PSAxMCA/IHRpbWVTdGFtcC5nZXRNb250aCgpICsgMSA6IFwiMFwiICsgKHRpbWVTdGFtcC5nZXRNb250aCgpICsgMSl9LyR7dGltZVN0YW1wLmdldERhdGUoKSA+PSAxMCA/IHRpbWVTdGFtcC5nZXREYXRlKCkgOiAnMCcgKyB0aW1lU3RhbXAuZ2V0RGF0ZSgpfWBcclxuICAgICAgICAgICAgc3RyVGltZSArPSBg77yIJHtnbEdhbWUudGlwcy5XRUVLTkFNRVt0aW1lU3RhbXAuZ2V0RGF5KCldfe+8iWBcclxuICAgICAgICAgICAgc3RyVGltZSArPSBgJHt0aW1lU3RhbXAuZ2V0SG91cnMoKSA+PSAxMCA/dGltZVN0YW1wLmdldEhvdXJzKCk6IFwiMFwiICsgdGltZVN0YW1wLmdldEhvdXJzKCl9OmBcclxuICAgICAgICAgICAgc3RyVGltZSArPSBgJHt0aW1lU3RhbXAuZ2V0TWludXRlcygpID49IDEwID90aW1lU3RhbXAuZ2V0TWludXRlcygpOiBcIjBcIiArIHRpbWVTdGFtcC5nZXRNaW51dGVzKCl9OmBcclxuICAgICAgICAgICAgc3RyVGltZSArPSBgJHt0aW1lU3RhbXAuZ2V0U2Vjb25kcygpID49IDEwID90aW1lU3RhbXAuZ2V0U2Vjb25kcygpOiBcIjBcIiArIHRpbWVTdGFtcC5nZXRTZWNvbmRzKCl9YFxyXG4gICAgICAgICAgICBub2RlLmdldENoaWxkQnlOYW1lKFwidGltZVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHN0clRpbWU7XHJcbiAgICAgICAgICAgIG5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJ0eXBlXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbGlzdFtpXS50eXBlRGVzO1xyXG4gICAgICAgICAgICBsZXQgZGlhbW9uZE51bSA9IDA7XHJcbiAgICAgICAgICAgIGRpYW1vbmROdW0gKz0gbGlzdFtpXS5kaWFtb25kSW5jb21lO1xyXG4gICAgICAgICAgICBkaWFtb25kTnVtIC09IGxpc3RbaV0uZGlhbW9uZEV4cGVuc2VzO1xyXG4gICAgICAgICAgICBub2RlLmdldENoaWxkQnlOYW1lKFwiZGlhbW9uZFwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHRoaXMuZ2V0Rml4TnVtYmVyKGRpYW1vbmROdW0pO1xyXG4gICAgICAgICAgICBub2RlLmdldENoaWxkQnlOYW1lKFwiZGlhbW9uZFwiKS5jb2xvciA9IGRpYW1vbmROdW0gPiAwID8gY2MuY29sb3IoMHg2NiwgMHg5MCwgMHhjYykgOiBjYy5jb2xvcigweGY0LCAweGM0LCAweDA0KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZ2V0Rml4TnVtYmVyKHZhbHVlKSB7XHJcbiAgICAgICAgbGV0IHZhbHVlMSA9IE51bWJlcih2YWx1ZSkuZGl2KDEwKTtcclxuICAgICAgICB2YWx1ZSA9IE51bWJlcih2YWx1ZSkuZGl2KDEwMCk7XHJcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgcmV0dXJuO1xyXG4gICAgICAgIGlmICh+fnZhbHVlID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKH5+dmFsdWUxID09PSB2YWx1ZTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGhpYWRTaG93Tm9kZShpc0Jvb2wpIHtcclxuICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJidG5fbGFzdFBhZ2VcIikuYWN0aXZlID0gaXNCb29sO1xyXG4gICAgICAgIHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcImJ0bl9uZXh0UGFnZVwiKS5hY3RpdmUgPSBpc0Jvb2w7XHJcbiAgICAgICAgdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwicGFnZUluZGV4XCIpLmFjdGl2ZSA9IGlzQm9vbDtcclxuICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJkb3dudGlwc1wiKS5hY3RpdmUgPSBpc0Jvb2w7XHJcbiAgICB9LFxyXG59KTtcclxuIl19