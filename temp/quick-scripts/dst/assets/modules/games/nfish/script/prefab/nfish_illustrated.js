
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/games/nfish/script/prefab/nfish_illustrated.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'bd65a6zWplLpK2qB07E+5iN', 'nfish_illustrated');
// modules/games/nfish/script/prefab/nfish_illustrated.js

"use strict";

var TITLE_LIST = {
  "ordinary": 1,
  "fishdemon": 2,
  "specialfish": 3,
  "boss": 4
};
glGame.movieClip.extend({
  properties: {
    json_fishTable: {
      "default": null,
      displayName: "fish table",
      tooltip: "鱼表",
      type: cc.JsonAsset
    },
    fish_AtlaLists: {
      "default": [],
      displayName: "所有鱼",
      tooltip: "鱼",
      type: [cc.SpriteAtlas]
    },
    fish_unit: cc.Node,
    selectItem: cc.Node,
    content: cc.Node,
    iconAtlas: cc.SpriteAtlas,
    fishInfo: cc.Node,
    fishdesc: cc.Label,
    fishNode: cc.Node,
    bossInfo: [cc.Node],
    bossdesc: [cc.Label],
    bossNode: [cc.Node],
    baseView: cc.Node,
    bossView: cc.Node
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    var _this = this;

    this.json_fishTable = this.json_fishTable.json;
    this.curLevel = 1;
    glGame.gameNet.send_msg('http.ReqNewFishConfig', {
      gameid: glGame.scenetag.FISH2
    }, function (route, msg) {
      if (msg.result != null) {
        _this.fishMutipleCfg = msg.result;
      }

      _this.initSelectToggle();
    });
  },
  //初始化选择复选框
  initSelectToggle: function initSelectToggle() {
    this.content.destroyAllChildren();
    this.content.removeAllChildren();

    for (var key in this.fishMutipleCfg) {
      if (!this.json_fishTable[key] || !this.isCurLevel(this.json_fishTable[key].level)) continue;
      var selectItem = cc.instantiate(this.selectItem);
      var sprite = selectItem.getChildByName("icon").getComponent(cc.Sprite);
      sprite.spriteFrame = this.iconAtlas.getSpriteFrame("".concat(this.json_fishTable[key].resGroupId));
      selectItem.getChildByName("fishname").getComponent(cc.Label).string = this.json_fishTable[key].fishName;

      if (this.fishMutipleCfg[key] <= 0) {
        //图鉴中，螃蟹特殊处理，不显示倍数(小于等于0的情况不显示倍数)
        selectItem.getChildByName("times").active = false;
      } else {
        selectItem.getChildByName("times").active = true;
      }

      selectItem.getChildByName("times").getComponent(cc.Label).string = "".concat(this.fishMutipleCfg[key], "\u500D");
      selectItem.parent = this.content;
      selectItem.getChildByName("Background").name = "".concat(key);
      selectItem.active = true;
    }

    if (this.content.childrenCount == 0) return this.resetInfo();
    this.setInfo(this.content.children[0]);
  },
  //初始化选择复选框
  initSelectToggleBoss: function initSelectToggleBoss() {
    this.content.destroyAllChildren();
    this.content.removeAllChildren();
    var index = 0;

    for (var key in this.fishMutipleCfg) {
      if (!this.json_fishTable[key] || !this.isCurLevel(this.json_fishTable[key].level) || !this.bossInfo[index] || !this.bossdesc[index] || !this.bossNode[index]) continue;
      this.setFishInfo(this.bossInfo[index], this.bossdesc[index], key);
      this.setFishNode(this.bossNode[index], key);
      index++;
    }
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "btn_close":
        this.remove();
        break;

      case "selectItem":
        this.setInfo(node);
        break;

      case "fishdemon":
      case "specialfish":
      case "ordinary":
      case "boss":
        this.switchTitle(name);
        break;

      default:
        console.error("no find button name -> %s", name);
    }
  },
  // 策划配置的要求
  // 0~3属于第一档次的鱼  4 属于第二档次的鱼  7~8属于第三档次的鱼， d大于9等于第四档次的鱼
  isCurLevel: function isCurLevel(listLevel) {
    var draw = false;

    if (this.curLevel == 1 && listLevel >= 0 && listLevel <= 3) {
      //一档
      draw = true;
    } else if (this.curLevel == 2 && listLevel == 4) {
      //二挡
      draw = true;
    } else if (this.curLevel == 3 && listLevel >= 7 && listLevel <= 8) {
      //三挡
      draw = true;
    } else if (this.curLevel == 4 && listLevel >= 9) {
      //四挡
      draw = true;
    }

    return draw;
  },
  //切换标签
  switchTitle: function switchTitle(name) {
    var isShowBoosView = name === "boss";
    this.baseView.active = !isShowBoosView;
    this.bossView.active = isShowBoosView;
    this.curLevel = TITLE_LIST[name];

    if (isShowBoosView) {
      this.initSelectToggleBoss();
    } else {
      this.initSelectToggle();
    }
  },
  //设置页面上的详情
  setInfo: function setInfo(node) {
    var index = Number(node.children[0].name);
    this.setFishInfo(this.fishInfo, this.fishdesc, index);
    this.setFishNode(this.fishNode, index);
  },
  //设置鱼的详细信息
  setFishInfo: function setFishInfo(fishInfo, fishdesc, index) {
    fishInfo.getChildByName("fishname").getComponent(cc.Label).string = this.json_fishTable[index].fishName;
    fishdesc.string = this.json_fishTable[index].fishDesc;

    if (this.fishMutipleCfg[index] <= 0) {
      //图鉴中，螃蟹特殊处理，不显示倍数(小于等于0的情况不显示倍数)
      fishInfo.getChildByName("times").active = false;
    } else {
      fishInfo.getChildByName("times").active = true;
    }

    fishInfo.getChildByName("times").getComponent(cc.Label).string = "".concat(this.fishMutipleCfg[index], "\u500D");
  },
  //设置鱼帧图
  setFishNode: function setFishNode(fishNode, index) {
    fishNode.destroyAllChildren();
    fishNode.removeAllChildren();
    var fish_unit = cc.instantiate(this.fish_unit);
    fishNode.addChild(fish_unit);
    fish_unit.active = true;
    var script = fish_unit.getComponent("nfish_MovieClip");
    script.initFishMovieClip();
    script.initAtlas(this.fish_AtlaLists);
    script.updateFrequency(0.1);
    script.startFishRuning(this.json_fishTable[index].resGroupId);
    var fishRateMin = 4; //需要放大小鱼倍率

    var rateValue = 1.3;

    if (fish_unit.width > fishNode.width || fish_unit.height > fishNode.height) {
      var widthRate = fishNode.width / fish_unit.width,
          heightRate = fishNode.height / fish_unit.height,
          rate = widthRate > heightRate ? heightRate : widthRate;
      fish_unit.setScale(rate);
    } else if (fishNode.height / fish_unit.height > fishRateMin) {
      //添加小鱼的处理倍率
      fish_unit.setScale(rateValue);
    }
  },
  //重置初始化信息
  resetInfo: function resetInfo() {
    this.fishNode.destroyAllChildren();
    this.fishNode.removeAllChildren();
    this.fishInfo.getChildByName("fishname").getComponent(cc.Label).string = "";
    this.fishdesc.string = "";
    this.fishInfo.getChildByName("times").getComponent(cc.Label).string = "";
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xcZ2FtZXNcXG5maXNoXFxzY3JpcHRcXHByZWZhYlxcbmZpc2hfaWxsdXN0cmF0ZWQuanMiXSwibmFtZXMiOlsiVElUTEVfTElTVCIsImdsR2FtZSIsIm1vdmllQ2xpcCIsImV4dGVuZCIsInByb3BlcnRpZXMiLCJqc29uX2Zpc2hUYWJsZSIsImRpc3BsYXlOYW1lIiwidG9vbHRpcCIsInR5cGUiLCJjYyIsIkpzb25Bc3NldCIsImZpc2hfQXRsYUxpc3RzIiwiU3ByaXRlQXRsYXMiLCJmaXNoX3VuaXQiLCJOb2RlIiwic2VsZWN0SXRlbSIsImNvbnRlbnQiLCJpY29uQXRsYXMiLCJmaXNoSW5mbyIsImZpc2hkZXNjIiwiTGFiZWwiLCJmaXNoTm9kZSIsImJvc3NJbmZvIiwiYm9zc2Rlc2MiLCJib3NzTm9kZSIsImJhc2VWaWV3IiwiYm9zc1ZpZXciLCJvbkxvYWQiLCJqc29uIiwiY3VyTGV2ZWwiLCJnYW1lTmV0Iiwic2VuZF9tc2ciLCJnYW1laWQiLCJzY2VuZXRhZyIsIkZJU0gyIiwicm91dGUiLCJtc2ciLCJyZXN1bHQiLCJmaXNoTXV0aXBsZUNmZyIsImluaXRTZWxlY3RUb2dnbGUiLCJkZXN0cm95QWxsQ2hpbGRyZW4iLCJyZW1vdmVBbGxDaGlsZHJlbiIsImtleSIsImlzQ3VyTGV2ZWwiLCJsZXZlbCIsImluc3RhbnRpYXRlIiwic3ByaXRlIiwiZ2V0Q2hpbGRCeU5hbWUiLCJnZXRDb21wb25lbnQiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsImdldFNwcml0ZUZyYW1lIiwicmVzR3JvdXBJZCIsInN0cmluZyIsImZpc2hOYW1lIiwiYWN0aXZlIiwicGFyZW50IiwibmFtZSIsImNoaWxkcmVuQ291bnQiLCJyZXNldEluZm8iLCJzZXRJbmZvIiwiY2hpbGRyZW4iLCJpbml0U2VsZWN0VG9nZ2xlQm9zcyIsImluZGV4Iiwic2V0RmlzaEluZm8iLCJzZXRGaXNoTm9kZSIsIm9uQ2xpY2siLCJub2RlIiwicmVtb3ZlIiwic3dpdGNoVGl0bGUiLCJjb25zb2xlIiwiZXJyb3IiLCJsaXN0TGV2ZWwiLCJkcmF3IiwiaXNTaG93Qm9vc1ZpZXciLCJOdW1iZXIiLCJmaXNoRGVzYyIsImFkZENoaWxkIiwic2NyaXB0IiwiaW5pdEZpc2hNb3ZpZUNsaXAiLCJpbml0QXRsYXMiLCJ1cGRhdGVGcmVxdWVuY3kiLCJzdGFydEZpc2hSdW5pbmciLCJmaXNoUmF0ZU1pbiIsInJhdGVWYWx1ZSIsIndpZHRoIiwiaGVpZ2h0Iiwid2lkdGhSYXRlIiwiaGVpZ2h0UmF0ZSIsInJhdGUiLCJzZXRTY2FsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFNQSxVQUFVLEdBQUc7QUFDZixjQUFZLENBREc7QUFFZixlQUFhLENBRkU7QUFHZixpQkFBZSxDQUhBO0FBSWYsVUFBUTtBQUpPLENBQW5CO0FBT0FDLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsTUFBakIsQ0FBd0I7QUFDcEJDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxjQUFjLEVBQUU7QUFDWixpQkFBUyxJQURHO0FBRVpDLE1BQUFBLFdBQVcsRUFBRSxZQUZEO0FBR1pDLE1BQUFBLE9BQU8sRUFBRSxJQUhHO0FBSVpDLE1BQUFBLElBQUksRUFBRUMsRUFBRSxDQUFDQztBQUpHLEtBRFI7QUFPUkMsSUFBQUEsY0FBYyxFQUFFO0FBQ1osaUJBQVMsRUFERztBQUVaTCxNQUFBQSxXQUFXLEVBQUUsS0FGRDtBQUdaQyxNQUFBQSxPQUFPLEVBQUUsR0FIRztBQUlaQyxNQUFBQSxJQUFJLEVBQUUsQ0FBQ0MsRUFBRSxDQUFDRyxXQUFKO0FBSk0sS0FQUjtBQWFSQyxJQUFBQSxTQUFTLEVBQUVKLEVBQUUsQ0FBQ0ssSUFiTjtBQWNSQyxJQUFBQSxVQUFVLEVBQUVOLEVBQUUsQ0FBQ0ssSUFkUDtBQWVSRSxJQUFBQSxPQUFPLEVBQUVQLEVBQUUsQ0FBQ0ssSUFmSjtBQWdCUkcsSUFBQUEsU0FBUyxFQUFFUixFQUFFLENBQUNHLFdBaEJOO0FBa0JSTSxJQUFBQSxRQUFRLEVB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Q0F5S3BCOztBQXpLb0IsQ0FBeEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRJVExFX0xJU1QgPSB7XHJcbiAgICBcIm9yZGluYXJ5XCI6IDEsXHJcbiAgICBcImZpc2hkZW1vblwiOiAyLFxyXG4gICAgXCJzcGVjaWFsZmlzaFwiOiAzLFxyXG4gICAgXCJib3NzXCI6IDRcclxufVxyXG5cclxuZ2xHYW1lLm1vdmllQ2xpcC5leHRlbmQoe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGpzb25fZmlzaFRhYmxlOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcImZpc2ggdGFibGVcIixcclxuICAgICAgICAgICAgdG9vbHRpcDogXCLpsbzooahcIixcclxuICAgICAgICAgICAgdHlwZTogY2MuSnNvbkFzc2V0LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlzaF9BdGxhTGlzdHM6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogW10sXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIuaJgOaciemxvFwiLFxyXG4gICAgICAgICAgICB0b29sdGlwOiBcIumxvFwiLFxyXG4gICAgICAgICAgICB0eXBlOiBbY2MuU3ByaXRlQXRsYXNdLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlzaF91bml0OiBjYy5Ob2RlLFxyXG4gICAgICAgIHNlbGVjdEl0ZW06IGNjLk5vZGUsXHJcbiAgICAgICAgY29udGVudDogY2MuTm9kZSxcclxuICAgICAgICBpY29uQXRsYXM6IGNjLlNwcml0ZUF0bGFzLFxyXG5cclxuICAgICAgICBmaXNoSW5mbzogY2MuTm9kZSxcclxuICAgICAgICBmaXNoZGVzYzogY2MuTGFiZWwsXHJcbiAgICAgICAgZmlzaE5vZGU6IGNjLk5vZGUsXHJcblxyXG4gICAgICAgIGJvc3NJbmZvOiBbY2MuTm9kZV0sXHJcbiAgICAgICAgYm9zc2Rlc2M6IFtjYy5MYWJlbF0sXHJcbiAgICAgICAgYm9zc05vZGU6IFtjYy5Ob2RlXSxcclxuXHJcbiAgICAgICAgYmFzZVZpZXc6IGNjLk5vZGUsXHJcbiAgICAgICAgYm9zc1ZpZXc6IGNjLk5vZGVcclxuICAgIH0sXHJcblxyXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XHJcblxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMuanNvbl9maXNoVGFibGUgPSB0aGlzLmpzb25fZmlzaFRhYmxlLmpzb247XHJcbiAgICAgICAgdGhpcy5jdXJMZXZlbCA9IDE7XHJcbiAgICAgICAgZ2xHYW1lLmdhbWVOZXQuc2VuZF9tc2coJ2h0dHAuUmVxTmV3RmlzaENvbmZpZycsIHsgZ2FtZWlkOiBnbEdhbWUuc2NlbmV0YWcuRklTSDIgfSwgKHJvdXRlLCBtc2cpID0+IHtcclxuICAgICAgICAgICAgaWYgKG1zZy5yZXN1bHQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXNoTXV0aXBsZUNmZyA9IG1zZy5yZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pbml0U2VsZWN0VG9nZ2xlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgLy/liJ3lp4vljJbpgInmi6nlpI3pgInmoYZcclxuICAgIGluaXRTZWxlY3RUb2dnbGUoKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZW50LmRlc3Ryb3lBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMuY29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLmZpc2hNdXRpcGxlQ2ZnKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5qc29uX2Zpc2hUYWJsZVtrZXldIHx8ICF0aGlzLmlzQ3VyTGV2ZWwodGhpcy5qc29uX2Zpc2hUYWJsZVtrZXldLmxldmVsKSkgY29udGludWU7XHJcbiAgICAgICAgICAgIGxldCBzZWxlY3RJdGVtID0gY2MuaW5zdGFudGlhdGUodGhpcy5zZWxlY3RJdGVtKTtcclxuICAgICAgICAgICAgbGV0IHNwcml0ZSA9IHNlbGVjdEl0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpY29uXCIpLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgICAgICBzcHJpdGUuc3ByaXRlRnJhbWUgPSB0aGlzLmljb25BdGxhcy5nZXRTcHJpdGVGcmFtZShgJHt0aGlzLmpzb25fZmlzaFRhYmxlW2tleV0ucmVzR3JvdXBJZH1gKTtcclxuICAgICAgICAgICAgc2VsZWN0SXRlbS5nZXRDaGlsZEJ5TmFtZShcImZpc2huYW1lXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gdGhpcy5qc29uX2Zpc2hUYWJsZVtrZXldLmZpc2hOYW1lO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maXNoTXV0aXBsZUNmZ1trZXldIDw9IDApIHsvL+WbvumJtOS4re+8jOieg+ifueeJueauiuWkhOeQhu+8jOS4jeaYvuekuuWAjeaVsCjlsI/kuo7nrYnkuo4w55qE5oOF5Ya15LiN5pi+56S65YCN5pWwKVxyXG4gICAgICAgICAgICAgICAgc2VsZWN0SXRlbS5nZXRDaGlsZEJ5TmFtZShcInRpbWVzXCIpLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0SXRlbS5nZXRDaGlsZEJ5TmFtZShcInRpbWVzXCIpLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2VsZWN0SXRlbS5nZXRDaGlsZEJ5TmFtZShcInRpbWVzXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gYCR7dGhpcy5maXNoTXV0aXBsZUNmZ1trZXldfeWAjWA7XHJcbiAgICAgICAgICAgIHNlbGVjdEl0ZW0ucGFyZW50ID0gdGhpcy5jb250ZW50O1xyXG4gICAgICAgICAgICBzZWxlY3RJdGVtLmdldENoaWxkQnlOYW1lKFwiQmFja2dyb3VuZFwiKS5uYW1lID0gYCR7a2V5fWA7XHJcbiAgICAgICAgICAgIHNlbGVjdEl0ZW0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudC5jaGlsZHJlbkNvdW50ID09IDApIHJldHVybiB0aGlzLnJlc2V0SW5mbygpO1xyXG4gICAgICAgIHRoaXMuc2V0SW5mbyh0aGlzLmNvbnRlbnQuY2hpbGRyZW5bMF0pO1xyXG4gICAgfSxcclxuXHJcbiAgICAvL+WIneWni+WMlumAieaLqeWkjemAieahhlxyXG4gICAgaW5pdFNlbGVjdFRvZ2dsZUJvc3MoKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZW50LmRlc3Ryb3lBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMuY29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuZmlzaE11dGlwbGVDZmcpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmpzb25fZmlzaFRhYmxlW2tleV0gfHwgIXRoaXMuaXNDdXJMZXZlbCh0aGlzLmpzb25fZmlzaFRhYmxlW2tleV0ubGV2ZWwpIHx8XHJcbiAgICAgICAgICAgICAgICAhdGhpcy5ib3NzSW5mb1tpbmRleF0gfHwgIXRoaXMuYm9zc2Rlc2NbaW5kZXhdIHx8ICF0aGlzLmJvc3NOb2RlW2luZGV4XSkgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldEZpc2hJbmZvKHRoaXMuYm9zc0luZm9baW5kZXhdLCB0aGlzLmJvc3NkZXNjW2luZGV4XSwga2V5KTtcclxuICAgICAgICAgICAgdGhpcy5zZXRGaXNoTm9kZSh0aGlzLmJvc3NOb2RlW2luZGV4XSwga2V5KTtcclxuICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ2xpY2sobmFtZSwgbm9kZSkge1xyXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiYnRuX2Nsb3NlXCI6IHRoaXMucmVtb3ZlKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwic2VsZWN0SXRlbVwiOiB0aGlzLnNldEluZm8obm9kZSk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiZmlzaGRlbW9uXCI6IGNhc2UgXCJzcGVjaWFsZmlzaFwiOiBjYXNlIFwib3JkaW5hcnlcIjogY2FzZSBcImJvc3NcIjpcclxuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoVGl0bGUobmFtZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDogY29uc29sZS5lcnJvcihcIm5vIGZpbmQgYnV0dG9uIG5hbWUgLT4gJXNcIiwgbmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvLyDnrZbliJLphY3nva7nmoTopoHmsYJcclxuICAgIC8vIDB+M+WxnuS6juesrOS4gOaho+asoeeahOmxvCAgNCDlsZ7kuo7nrKzkuozmoaPmrKHnmoTpsbwgIDd+OOWxnuS6juesrOS4ieaho+asoeeahOmxvO+8jCBk5aSn5LqOOeetieS6juesrOWbm+aho+asoeeahOmxvFxyXG4gICAgaXNDdXJMZXZlbChsaXN0TGV2ZWwpIHtcclxuICAgICAgICBsZXQgZHJhdyA9IGZhbHNlXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1ckxldmVsID09IDEgJiYgbGlzdExldmVsID49IDAgJiYgbGlzdExldmVsIDw9IDMpIHsvL+S4gOaho1xyXG4gICAgICAgICAgICBkcmF3ID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY3VyTGV2ZWwgPT0gMiAmJiBsaXN0TGV2ZWwgPT0gNCkgey8v5LqM5oyhXHJcbiAgICAgICAgICAgIGRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJMZXZlbCA9PSAzICYmIGxpc3RMZXZlbCA+PSA3ICYmIGxpc3RMZXZlbCA8PSA4KSB7IC8v5LiJ5oyhXHJcbiAgICAgICAgICAgIGRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJMZXZlbCA9PSA0ICYmIGxpc3RMZXZlbCA+PSA5KSB7IC8v5Zub5oyhXHJcbiAgICAgICAgICAgIGRyYXcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZHJhdztcclxuICAgIH0sXHJcbiAgICAvL+WIh+aNouagh+etvlxyXG4gICAgc3dpdGNoVGl0bGUobmFtZSkge1xyXG4gICAgICAgIGxldCBpc1Nob3dCb29zVmlldyA9IG5hbWUgPT09IFwiYm9zc1wiO1xyXG4gICAgICAgIHRoaXMuYmFzZVZpZXcuYWN0aXZlID0gIWlzU2hvd0Jvb3NWaWV3O1xyXG4gICAgICAgIHRoaXMuYm9zc1ZpZXcuYWN0aXZlID0gaXNTaG93Qm9vc1ZpZXc7XHJcbiAgICAgICAgdGhpcy5jdXJMZXZlbCA9IFRJVExFX0xJU1RbbmFtZV07XHJcbiAgICAgICAgaWYgKGlzU2hvd0Jvb3NWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFNlbGVjdFRvZ2dsZUJvc3MoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRTZWxlY3RUb2dnbGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgLy/orr7nva7pobXpnaLkuIrnmoTor6bmg4VcclxuICAgIHNldEluZm8obm9kZSkge1xyXG4gICAgICAgIGxldCBpbmRleCA9IE51bWJlcihub2RlLmNoaWxkcmVuWzBdLm5hbWUpO1xyXG4gICAgICAgIHRoaXMuc2V0RmlzaEluZm8odGhpcy5maXNoSW5mbywgdGhpcy5maXNoZGVzYywgaW5kZXgpO1xyXG4gICAgICAgIHRoaXMuc2V0RmlzaE5vZGUodGhpcy5maXNoTm9kZSwgaW5kZXgpO1xyXG4gICAgfSxcclxuICAgIC8v6K6+572u6bG855qE6K+m57uG5L+h5oGvXHJcbiAgICBzZXRGaXNoSW5mbyhmaXNoSW5mbywgZmlzaGRlc2MsIGluZGV4KSB7XHJcbiAgICAgICAgZmlzaEluZm8uZ2V0Q2hpbGRCeU5hbWUoXCJmaXNobmFtZVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHRoaXMuanNvbl9maXNoVGFibGVbaW5kZXhdLmZpc2hOYW1lO1xyXG4gICAgICAgIGZpc2hkZXNjLnN0cmluZyA9IHRoaXMuanNvbl9maXNoVGFibGVbaW5kZXhdLmZpc2hEZXNjO1xyXG4gICAgICAgIGlmICh0aGlzLmZpc2hNdXRpcGxlQ2ZnW2luZGV4XSA8PSAwKSB7Ly/lm77pibTkuK3vvIzonoPon7nnibnmrorlpITnkIbvvIzkuI3mmL7npLrlgI3mlbAo5bCP5LqO562J5LqOMOeahOaDheWGteS4jeaYvuekuuWAjeaVsClcclxuICAgICAgICAgICAgZmlzaEluZm8uZ2V0Q2hpbGRCeU5hbWUoXCJ0aW1lc1wiKS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmaXNoSW5mby5nZXRDaGlsZEJ5TmFtZShcInRpbWVzXCIpLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpc2hJbmZvLmdldENoaWxkQnlOYW1lKFwidGltZXNcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBgJHt0aGlzLmZpc2hNdXRpcGxlQ2ZnW2luZGV4XX3lgI1gO1xyXG4gICAgfSxcclxuICAgIC8v6K6+572u6bG85bin5Zu+XHJcbiAgICBzZXRGaXNoTm9kZShmaXNoTm9kZSwgaW5kZXgpIHtcclxuICAgICAgICBmaXNoTm9kZS5kZXN0cm95QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICBmaXNoTm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGxldCBmaXNoX3VuaXQgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmZpc2hfdW5pdCk7XHJcbiAgICAgICAgZmlzaE5vZGUuYWRkQ2hpbGQoZmlzaF91bml0KTtcclxuICAgICAgICBmaXNoX3VuaXQuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICBsZXQgc2NyaXB0ID0gZmlzaF91bml0LmdldENvbXBvbmVudChcIm5maXNoX01vdmllQ2xpcFwiKTtcclxuICAgICAgICBzY3JpcHQuaW5pdEZpc2hNb3ZpZUNsaXAoKTtcclxuICAgICAgICBzY3JpcHQuaW5pdEF0bGFzKHRoaXMuZmlzaF9BdGxhTGlzdHMpO1xyXG4gICAgICAgIHNjcmlwdC51cGRhdGVGcmVxdWVuY3koMC4xKTtcclxuICAgICAgICBzY3JpcHQuc3RhcnRGaXNoUnVuaW5nKHRoaXMuanNvbl9maXNoVGFibGVbaW5kZXhdLnJlc0dyb3VwSWQpO1xyXG4gICAgICAgIGNvbnN0IGZpc2hSYXRlTWluID0gNDsgICAgICAgIC8v6ZyA6KaB5pS+5aSn5bCP6bG85YCN546HXHJcbiAgICAgICAgY29uc3QgcmF0ZVZhbHVlID0gMS4zO1xyXG4gICAgICAgIGlmIChmaXNoX3VuaXQud2lkdGggPiBmaXNoTm9kZS53aWR0aCB8fCBmaXNoX3VuaXQuaGVpZ2h0ID4gZmlzaE5vZGUuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGxldCB3aWR0aFJhdGUgPSBmaXNoTm9kZS53aWR0aCAvIGZpc2hfdW5pdC53aWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodFJhdGUgPSBmaXNoTm9kZS5oZWlnaHQgLyBmaXNoX3VuaXQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgcmF0ZSA9IHdpZHRoUmF0ZSA+IGhlaWdodFJhdGUgPyBoZWlnaHRSYXRlIDogd2lkdGhSYXRlO1xyXG4gICAgICAgICAgICBmaXNoX3VuaXQuc2V0U2NhbGUocmF0ZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChmaXNoTm9kZS5oZWlnaHQgLyBmaXNoX3VuaXQuaGVpZ2h0ID4gZmlzaFJhdGVNaW4pIHsgICAgIC8v5re75Yqg5bCP6bG855qE5aSE55CG5YCN546HXHJcbiAgICAgICAgICAgIGZpc2hfdW5pdC5zZXRTY2FsZShyYXRlVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvL+mHjee9ruWIneWni+WMluS/oeaBr1xyXG4gICAgcmVzZXRJbmZvKCkge1xyXG4gICAgICAgIHRoaXMuZmlzaE5vZGUuZGVzdHJveUFsbENoaWxkcmVuKCk7XHJcbiAgICAgICAgdGhpcy5maXNoTm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMuZmlzaEluZm8uZ2V0Q2hpbGRCeU5hbWUoXCJmaXNobmFtZVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5maXNoZGVzYy5zdHJpbmcgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuZmlzaEluZm8uZ2V0Q2hpbGRCeU5hbWUoXCJ0aW1lc1wiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwiXCI7XHJcbiAgICB9XHJcbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcclxufSk7XHJcbiJdfQ==