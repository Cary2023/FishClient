
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/modules/games/nfish/script/prefab/nfish_record.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '43f63ZUxUVOZ57X1WHzMbdF', 'nfish_record');
// modules/games/nfish/script/prefab/nfish_record.js

"use strict";

//捕鱼：记录
glGame.baseclass.extend({
  properties: {
    recorditem: cc.Node,
    recordview: cc.Node,
    norecord: cc.Node,
    tip: cc.Node,
    title: cc.Node,
    lab_page: cc.Label,
    down_frame: cc.Node,
    pre_detail: cc.Prefab
  },
  onLoad: function onLoad() {
    this.node.scale = glGame.systemclass.convertInterface();
    this.node.x = this.node.x * glGame.systemclass.convertInterface();
    this.node.y = this.node.y * glGame.systemclass.convertInterface();
    glGame.panel.showRoomJuHua();
    this.pageIndex = 1;
    this.pageSize = 7;
    this.pageCount = 0;
    this.gameID = glGame.scenetag.FISH2;
    this.gameLevel = glGame.room.getRoomType(this.gameID);
    this.gameRecord = null;
    this.isLoadingData = false;
    this.registerEvent();
  },
  recordActionEnd: function recordActionEnd() {
    glGame.gameNet.send_msg('http.ReqUserFishingHandRecords', {
      gameid: this.gameID,
      page_size: this.pageSize,
      page: this.pageIndex
    }, this.resetPanelData.bind(this));
  },
  registerEvent: function registerEvent() {
    glGame.emitter.on("".concat(this.node.name).concat(MESSAGE.UI.ACTION_END), this.recordActionEnd, this);
  },
  unRegisterEvent: function unRegisterEvent() {
    glGame.emitter.off("".concat(this.node.name).concat(MESSAGE.UI.ACTION_END), this);
  },
  //接收牌局详情数据
  resetPanelData: function resetPanelData(route, msg) {
    if (this.recordview == null) return;
    this.isLoadingData = false;
    this.recordview.destroyAllChildren();
    this.pageIndex = msg.current_page;
    this.pageCount = msg.total_page;
    this.lab_page.string = "\u7B2C".concat(msg.current_page, "/").concat(msg.total_page, "\u9875");
    this.gameRecord = msg.list;
    glGame.panel.closeRoomJuHua();
    var count = this.gameRecord ? this.gameRecord.length : 0;

    for (var i = 0; i < count; i++) {
      var panel = cc.instantiate(this.recorditem);
      panel.name = "detail_".concat(i);
      var recordData = this.gameRecord[i];
      var hand_number = recordData["hand_number"]; //牌局编号

      var profit = Number(recordData["number"]); //结算

      var gainFee = Number(this.cutDownNum(recordData["gainFee"])); //抽水

      var bet_coin = this.cutDownNum(Number(recordData["bet_coin"])); //炮弹金额

      var coin = Number(Number(this.cutDownNum(profit)) + gainFee + Number(bet_coin)).toFixed(2); //捕获金额

      var roomStr = this.gameLevel[recordData["bettype"]]; //房间

      panel.getChildByName("img_tiao").active = i % 2 != 0;
      panel.getChildByName("lab_no").getComponent(cc.Label).string = hand_number + "";
      panel.getChildByName("lab_room").getComponent(cc.Label).string = roomStr + "";
      panel.getChildByName("lab_bullteCoin").getComponent(cc.Label).string = bet_coin + "";
      panel.getChildByName("lab_coin").getComponent(cc.Label).string = coin + "";
      var number = panel.getChildByName(profit > 0 ? "lab_win" : "lab_lost");
      number.getComponent(cc.Label).string = profit > 0 ? "+".concat(this.cutDownNum(profit)) : this.cutDownNum(profit);
      panel.getChildByName("lab_endTime").getComponent(cc.Label).string = recordData["end_time"];
      number.active = true;
      panel.active = false;
      panel.parent = this.recordview;
      panel.recordData = recordData;
      panel.getChildByName("btn_zidananniu").on(cc.Node.EventType.TOUCH_START, this.showBulletDetailHandler, this);
      panel.getChildByName("btn_fishanniu").on(cc.Node.EventType.TOUCH_START, this.showFishDetail2Handler, this);
    }

    glGame.panel.showEffectNode(this, this.recordview, 0.02, true);
    this.norecord.active = count < 1;
    this.down_frame.active = count > 0;
  },
  showBulletDetailHandler: function showBulletDetailHandler(evt) {
    this.viewtype = 1;
    this.showDetailHandler(evt);
  },
  showFishDetail2Handler: function showFishDetail2Handler(evt) {
    this.viewtype = 2;
    this.showDetailHandler(evt);
  },
  showDetailHandler: function showDetailHandler(evt) {
    var _this = this;

    var hand_number = evt.currentTarget.parent.getChildByName("lab_no").getComponent(cc.Label).string;
    glGame.gameNet.send_msg('http.ReqUserFishingInfoHandRecords', {
      gameid: this.gameID,
      hand_number: hand_number
    }, function (route, msg) {
      if (msg.record == "" || msg.record == undefined) {
        return;
      }

      var list = JSON.parse(msg.record);
      var detailsNode = cc.instantiate(_this.pre_detail);
      detailsNode.getComponent("nfish_recordDetails").initDetView(evt.currentTarget.parent.recordData, list, _this.viewtype);

      var recordDetails = _this.node.getChildByName("recordDetails");

      recordDetails.active = true;
      detailsNode.parent = recordDetails;
    });
  },
  onClick: function onClick(name, node) {
    switch (name) {
      case "ui_BtnClose":
        this.remove();
        break;

      case 'btn_last':
        this.pageIndex--;
        this.submit();
        break;

      case 'btn_next':
        this.pageIndex++;
        this.submit();
        break;

      default:
        break;
    }
  },
  submit: function submit() {
    if (this.isLoadingData) return;
    this.isLoadingData = true;

    if (this.pageIndex < 1) {
      glGame.panel.showTip('当前已经是第一页！');
      this.pageIndex = 1;
      this.isLoadingData = false;
      return;
    }

    if (this.pageIndex > this.pageCount) {
      glGame.panel.showTip('当前已经是最后一页！');
      this.pageIndex = this.pageCount;
      this.isLoadingData = false;
      return;
    }

    glGame.panel.showRoomJuHua(); //获取用户的牌局记录

    glGame.gameNet.send_msg('http.ReqUserFishingHandRecords', {
      gameid: this.gameID,
      page_size: this.pageSize,
      page: this.pageIndex
    }, this.resetPanelData.bind(this));
  },
  //截取小数点后两位
  cutDownNum: function cutDownNum(value) {
    var num = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;
    if (isNaN(value)) return;

    if (~~value === value) {
      return value.div(100).toString();
    } else {
      value = Number(value).div(100);
      return (Math.floor(value * 100) / 100).toFixed(num);
    }
  },
  OnDestroy: function OnDestroy() {
    this.unRegisterEvent();
    this.gameRecord = null;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcbW9kdWxlc1xcZ2FtZXNcXG5maXNoXFxzY3JpcHRcXHByZWZhYlxcbmZpc2hfcmVjb3JkLmpzIl0sIm5hbWVzIjpbImdsR2FtZSIsImJhc2VjbGFzcyIsImV4dGVuZCIsInByb3BlcnRpZXMiLCJyZWNvcmRpdGVtIiwiY2MiLCJOb2RlIiwicmVjb3JkdmlldyIsIm5vcmVjb3JkIiwidGlwIiwidGl0bGUiLCJsYWJfcGFnZSIsIkxhYmVsIiwiZG93bl9mcmFtZSIsInByZV9kZXRhaWwiLCJQcmVmYWIiLCJvbkxvYWQiLCJub2RlIiwic2NhbGUiLCJzeXN0ZW1jbGFzcyIsImNvbnZlcnRJbnRlcmZhY2UiLCJ4IiwieSIsInBhbmVsIiwic2hvd1Jvb21KdUh1YSIsInBhZ2VJbmRleCIsInBhZ2VTaXplIiwicGFnZUNvdW50IiwiZ2FtZUlEIiwic2NlbmV0YWciLCJGSVNIMiIsImdhbWVMZXZlbCIsInJvb20iLCJnZXRSb29tVHlwZSIsImdhbWVSZWNvcmQiLCJpc0xvYWRpbmdEYXRhIiwicmVnaXN0ZXJFdmVudCIsInJlY29yZEFjdGlvbkVuZCIsImdhbWVOZXQiLCJzZW5kX21zZyIsImdhbWVpZCIsInBhZ2Vfc2l6ZSIsInBhZ2UiLCJyZXNldFBhbmVsRGF0YSIsImJpbmQiLCJlbWl0dGVyIiwib24iLCJuYW1lIiwiTUVTU0FHRSIsIlVJIiwiQUNUSU9OX0VORCIsInVuUmVnaXN0ZXJFdmVudCIsIm9mZiIsInJvdXRlIiwibXNnIiwiZGVzdHJveUFsbENoaWxkcmVuIiwiY3VycmVudF9wYWdlIiwidG90YWxfcGFnZSIsInN0cmluZyIsImxpc3QiLCJjbG9zZVJvb21KdUh1YSIsImNvdW50IiwibGVuZ3RoIiwiaSIsImluc3RhbnRpYXRlIiwicmVjb3JkRGF0YSIsImhhbmRfbnVtYmVyIiwicHJvZml0IiwiTnVtYmVyIiwiZ2FpbkZlZSIsImN1dERvd25OdW0iLCJiZXRfY29pbiIsImNvaW4iLCJ0b0ZpeGVkIiwicm9vbVN0ciIsImdldENoaWxkQnlOYW1lIiwiYWN0aXZlIiwiZ2V0Q29tcG9uZW50IiwibnVtYmVyIiwicGFyZW50IiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJzaG93QnVsbGV0RGV0YWlsSGFuZGxlciIsInNob3dGaXNoRGV0YWlsMkhhbmRsZXIiLCJzaG93RWZmZWN0Tm9kZSIsImV2dCIsInZpZXd0eXBlIiwic2hvd0RldGFpbEhhbmRsZXIiLCJjdXJyZW50VGFyZ2V0IiwicmVjb3JkIiwidW5kZWZpbmVkIiwiSlNPTiIsInBhcnNlIiwiZGV0YWlsc05vZGUiLCJpbml0RGV0VmlldyIsInJlY29yZERldGFpbHMiLCJvbkNsaWNrIiwicmVtb3ZlIiwic3VibWl0Iiwic2hvd1RpcCIsInZhbHVlIiwibnVtIiwiaXNOYU4iLCJkaXYiLCJ0b1N0cmluZyIsIk1hdGgiLCJmbG9vciIsIk9uRGVzdHJveSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBQSxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLE1BQWpCLENBQXdCO0FBQ3BCQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsVUFBVSxFQUFFQyxFQUFFLENBQUNDLElBRFA7QUFFUkMsSUFBQUEsVUFBVSxFQUFFRixFQUFFLENBQUNDLElBRlA7QUFHUkUsSUFBQUEsUUFBUSxFQUFFSCxFQUFFLENBQUNDLElBSEw7QUFJUkcsSUFBQUEsR0FBRyxFQUFFSixFQUFFLENBQUNDLElBSkE7QUFLUkksSUFBQUEsS0FBSyxFQUFFTCxFQUFFLENBQUNDLElBTEY7QUFNUkssSUFBQUEsUUFBUSxFQUFFTixFQUFFLENBQUNPLEtBTkw7QUFPUkMsSUFBQUEsVUFBVSxFQUFFUixFQUFFLENBQUNDLElBUFA7QUFRUlEsSUFBQUEsVUFBVSxFQUFFVCxFQUFFLENBQUNVO0FBUlAsR0FEUTtBQVdwQkMsRUFBQUEsTUFYb0Isb0JBV1g7QUFDTCxTQUFLQyxJQUFMLENBQVVDLEtBQVYsR0FBa0JsQixNQUFNLENBQUNtQixXQUFQLENBQW1CQyxnQkFBbkIsRUFBbEI7QUFDQSxT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ZixFQUFQO0FBQ0gsS0FGRCxNQUVPO0FBQ0hKLE1BQUFBLEtBQUssR0FBR2hDLE1BQU0sQ0FBQ2dDLEtBQUQsQ0FBTixDQUFjRyxHQUFkLENBQWtCLEdBQWxCLENBQVI7QUFDQSxhQUFPLENBQUNFLElBQUksQ0FBQ0MsS0FBTCxDQUFXTixLQUFLLEdBQUcsR0FBbkIsSUFBMEIsR0FBM0IsRUFBZ0MzQixPQUFoQyxDQUF3QzRCLEdBQXhDLENBQVA7QUFDSDtBQUNKLEdBOUltQjtBQStJcEJNLEVBQUFBLFNBL0lvQix1QkErSVI7QUFDUixTQUFLeEQsZUFBTDtBQUNBLFNBQUtqQixVQUFMLEdBQWtCLElBQWxCO0FBQ0g7QUFsSm1CLENBQXhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvL+aNlemxvO+8muiusOW9lVxyXG5nbEdhbWUuYmFzZWNsYXNzLmV4dGVuZCh7XHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgcmVjb3JkaXRlbTogY2MuTm9kZSxcclxuICAgICAgICByZWNvcmR2aWV3OiBjYy5Ob2RlLFxyXG4gICAgICAgIG5vcmVjb3JkOiBjYy5Ob2RlLFxyXG4gICAgICAgIHRpcDogY2MuTm9kZSxcclxuICAgICAgICB0aXRsZTogY2MuTm9kZSxcclxuICAgICAgICBsYWJfcGFnZTogY2MuTGFiZWwsXHJcbiAgICAgICAgZG93bl9mcmFtZTogY2MuTm9kZSxcclxuICAgICAgICBwcmVfZGV0YWlsOiBjYy5QcmVmYWIsXHJcbiAgICB9LFxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMubm9kZS5zY2FsZSA9IGdsR2FtZS5zeXN0ZW1jbGFzcy5jb252ZXJ0SW50ZXJmYWNlKCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnggPSB0aGlzLm5vZGUueCAqIGdsR2FtZS5zeXN0ZW1jbGFzcy5jb252ZXJ0SW50ZXJmYWNlKCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnkgPSB0aGlzLm5vZGUueSAqIGdsR2FtZS5zeXN0ZW1jbGFzcy5jb252ZXJ0SW50ZXJmYWNlKCk7XHJcbiAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dSb29tSnVIdWEoKTtcclxuICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IDE7XHJcbiAgICAgICAgdGhpcy5wYWdlU2l6ZSA9IDc7XHJcbiAgICAgICAgdGhpcy5wYWdlQ291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMuZ2FtZUlEID0gZ2xHYW1lLnNjZW5ldGFnLkZJU0gyO1xyXG4gICAgICAgIHRoaXMuZ2FtZUxldmVsID0gZ2xHYW1lLnJvb20uZ2V0Um9vbVR5cGUodGhpcy5nYW1lSUQpO1xyXG4gICAgICAgIHRoaXMuZ2FtZVJlY29yZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc0xvYWRpbmdEYXRhID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgICB9LFxyXG4gICAgcmVjb3JkQWN0aW9uRW5kKCkge1xyXG4gICAgICAgIGdsR2FtZS5nYW1lTmV0LnNlbmRfbXNnKCdodHRwLlJlcVVzZXJGaXNoaW5nSGFuZFJlY29yZHMnLCB7IGdhbWVpZDogdGhpcy5nYW1lSUQsIHBhZ2Vfc2l6ZTogdGhpcy5wYWdlU2l6ZSwgcGFnZTogdGhpcy5wYWdlSW5kZXggfSwgdGhpcy5yZXNldFBhbmVsRGF0YS5iaW5kKHRoaXMpKTtcclxuICAgIH0sXHJcblxyXG4gICAgcmVnaXN0ZXJFdmVudCgpIHtcclxuICAgICAgICBnbEdhbWUuZW1pdHRlci5vbihgJHt0aGlzLm5vZGUubmFtZX0ke01FU1NBR0UuVUkuQUNUSU9OX0VORH1gLCB0aGlzLnJlY29yZEFjdGlvbkVuZCwgdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgdW5SZWdpc3RlckV2ZW50KCkge1xyXG4gICAgICAgIGdsR2FtZS5lbWl0dGVyLm9mZihgJHt0aGlzLm5vZGUubmFtZX0ke01FU1NBR0UuVUkuQUNUSU9OX0VORH1gLCB0aGlzKTtcclxuICAgIH0sXHJcbiAgICAvL+aOpeaUtueJjOWxgOivpuaDheaVsOaNrlxyXG4gICAgcmVzZXRQYW5lbERhdGEocm91dGUsIG1zZykge1xyXG4gICAgICAgIGlmICh0aGlzLnJlY29yZHZpZXcgPT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuaXNMb2FkaW5nRGF0YSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVjb3Jkdmlldy5kZXN0cm95QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IG1zZy5jdXJyZW50X3BhZ2U7XHJcbiAgICAgICAgdGhpcy5wYWdlQ291bnQgPSBtc2cudG90YWxfcGFnZTtcclxuICAgICAgICB0aGlzLmxhYl9wYWdlLnN0cmluZyA9IGDnrKwke21zZy5jdXJyZW50X3BhZ2V9LyR7bXNnLnRvdGFsX3BhZ2V96aG1YDtcclxuICAgICAgICB0aGlzLmdhbWVSZWNvcmQgPSBtc2cubGlzdDtcclxuICAgICAgICBnbEdhbWUucGFuZWwuY2xvc2VSb29tSnVIdWEoKTtcclxuICAgICAgICBsZXQgY291bnQgPSB0aGlzLmdhbWVSZWNvcmQgPyB0aGlzLmdhbWVSZWNvcmQubGVuZ3RoIDogMDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHBhbmVsID0gY2MuaW5zdGFudGlhdGUodGhpcy5yZWNvcmRpdGVtKTtcclxuICAgICAgICAgICAgcGFuZWwubmFtZSA9IGBkZXRhaWxfJHtpfWA7XHJcbiAgICAgICAgICAgIGxldCByZWNvcmREYXRhID0gdGhpcy5nYW1lUmVjb3JkW2ldO1xyXG5cclxuICAgICAgICAgICAgbGV0IGhhbmRfbnVtYmVyID0gcmVjb3JkRGF0YVtcImhhbmRfbnVtYmVyXCJdOy8v54mM5bGA57yW5Y+3XHJcbiAgICAgICAgICAgIGxldCBwcm9maXQgPSBOdW1iZXIocmVjb3JkRGF0YVtcIm51bWJlclwiXSk7Ly/nu5PnrpdcclxuICAgICAgICAgICAgbGV0IGdhaW5GZWUgPSBOdW1iZXIodGhpcy5jdXREb3duTnVtKHJlY29yZERhdGFbXCJnYWluRmVlXCJdKSk7Ly/mir3msLRcclxuICAgICAgICAgICAgbGV0IGJldF9jb2luID0gdGhpcy5jdXREb3duTnVtKE51bWJlcihyZWNvcmREYXRhW1wiYmV0X2NvaW5cIl0pKTsvL+eCruW8uemHkeminVxyXG4gICAgICAgICAgICBsZXQgY29pbiA9IE51bWJlcihOdW1iZXIodGhpcy5jdXREb3duTnVtKHByb2ZpdCkpICsgZ2FpbkZlZSArIE51bWJlcihiZXRfY29pbikpLnRvRml4ZWQoMik7Ly/mjZXojrfph5Hpop1cclxuICAgICAgICAgICAgbGV0IHJvb21TdHIgPSB0aGlzLmdhbWVMZXZlbFtyZWNvcmREYXRhW1wiYmV0dHlwZVwiXV07Ly/miL/pl7RcclxuXHJcbiAgICAgICAgICAgIHBhbmVsLmdldENoaWxkQnlOYW1lKFwiaW1nX3RpYW9cIikuYWN0aXZlID0gaSAlIDIgIT0gMDtcclxuICAgICAgICAgICAgcGFuZWwuZ2V0Q2hpbGRCeU5hbWUoXCJsYWJfbm9cIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBoYW5kX251bWJlciArIFwiXCI7XHJcbiAgICAgICAgICAgIHBhbmVsLmdldENoaWxkQnlOYW1lKFwibGFiX3Jvb21cIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSByb29tU3RyICsgXCJcIjtcclxuICAgICAgICAgICAgcGFuZWwuZ2V0Q2hpbGRCeU5hbWUoXCJsYWJfYnVsbHRlQ29pblwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGJldF9jb2luICsgXCJcIjtcclxuICAgICAgICAgICAgcGFuZWwuZ2V0Q2hpbGRCeU5hbWUoXCJsYWJfY29pblwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGNvaW4gKyBcIlwiO1xyXG4gICAgICAgICAgICBsZXQgbnVtYmVyID0gcGFuZWwuZ2V0Q2hpbGRCeU5hbWUocHJvZml0ID4gMCA/IFwibGFiX3dpblwiIDogXCJsYWJfbG9zdFwiKTtcclxuICAgICAgICAgICAgbnVtYmVyLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gcHJvZml0ID4gMCA/IGArJHt0aGlzLmN1dERvd25OdW0ocHJvZml0KX1gIDogdGhpcy5jdXREb3duTnVtKHByb2ZpdCk7XHJcbiAgICAgICAgICAgIHBhbmVsLmdldENoaWxkQnlOYW1lKFwibGFiX2VuZFRpbWVcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSByZWNvcmREYXRhW1wiZW5kX3RpbWVcIl07XHJcbiAgICAgICAgICAgIG51bWJlci5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBwYW5lbC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgcGFuZWwucGFyZW50ID0gdGhpcy5yZWNvcmR2aWV3O1xyXG4gICAgICAgICAgICBwYW5lbC5yZWNvcmREYXRhID0gcmVjb3JkRGF0YTtcclxuICAgICAgICAgICAgcGFuZWwuZ2V0Q2hpbGRCeU5hbWUoXCJidG5femlkYW5hbm5pdVwiKS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy5zaG93QnVsbGV0RGV0YWlsSGFuZGxlciwgdGhpcyk7XHJcbiAgICAgICAgICAgIHBhbmVsLmdldENoaWxkQnlOYW1lKFwiYnRuX2Zpc2hhbm5pdVwiKS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy5zaG93RmlzaERldGFpbDJIYW5kbGVyLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dFZmZlY3ROb2RlKHRoaXMsIHRoaXMucmVjb3JkdmlldywgMC4wMiwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5ub3JlY29yZC5hY3RpdmUgPSBjb3VudCA8IDE7XHJcbiAgICAgICAgdGhpcy5kb3duX2ZyYW1lLmFjdGl2ZSA9IGNvdW50ID4gMDtcclxuICAgIH0sXHJcbiAgICBzaG93QnVsbGV0RGV0YWlsSGFuZGxlcihldnQpIHtcclxuICAgICAgICB0aGlzLnZpZXd0eXBlID0gMTtcclxuICAgICAgICB0aGlzLnNob3dEZXRhaWxIYW5kbGVyKGV2dCk7XHJcbiAgICB9LFxyXG4gICAgc2hvd0Zpc2hEZXRhaWwySGFuZGxlcihldnQpIHtcclxuICAgICAgICB0aGlzLnZpZXd0eXBlID0gMjtcclxuICAgICAgICB0aGlzLnNob3dEZXRhaWxIYW5kbGVyKGV2dCk7XHJcbiAgICB9LFxyXG4gICAgc2hvd0RldGFpbEhhbmRsZXIoZXZ0KSB7XHJcbiAgICAgICAgbGV0IGhhbmRfbnVtYmVyID0gZXZ0LmN1cnJlbnRUYXJnZXQucGFyZW50LmdldENoaWxkQnlOYW1lKFwibGFiX25vXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nO1xyXG4gICAgICAgIGdsR2FtZS5nYW1lTmV0LnNlbmRfbXNnKCdodHRwLlJlcVVzZXJGaXNoaW5nSW5mb0hhbmRSZWNvcmRzJywgeyBnYW1laWQ6IHRoaXMuZ2FtZUlELCBoYW5kX251bWJlcjogaGFuZF9udW1iZXIgfSwgKHJvdXRlLCBtc2cpID0+IHtcclxuICAgICAgICAgICAgaWYgKG1zZy5yZWNvcmQgPT0gXCJcIiB8fCBtc2cucmVjb3JkID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBsaXN0ID0gSlNPTi5wYXJzZShtc2cucmVjb3JkKTtcclxuICAgICAgICAgICAgbGV0IGRldGFpbHNOb2RlID0gY2MuaW5zdGFudGlhdGUodGhpcy5wcmVfZGV0YWlsKTtcclxuICAgICAgICAgICAgZGV0YWlsc05vZGUuZ2V0Q29tcG9uZW50KFwibmZpc2hfcmVjb3JkRGV0YWlsc1wiKS5pbml0RGV0VmlldyhldnQuY3VycmVudFRhcmdldC5wYXJlbnQucmVjb3JkRGF0YSwgbGlzdCwgdGhpcy52aWV3dHlwZSk7XHJcbiAgICAgICAgICAgIGxldCByZWNvcmREZXRhaWxzID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwicmVjb3JkRGV0YWlsc1wiKTtcclxuICAgICAgICAgICAgcmVjb3JkRGV0YWlscy5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBkZXRhaWxzTm9kZS5wYXJlbnQgPSByZWNvcmREZXRhaWxzO1xyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgb25DbGljayhuYW1lLCBub2RlKSB7XHJcbiAgICAgICAgc3dpdGNoIChuYW1lKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ1aV9CdG5DbG9zZVwiOiB0aGlzLnJlbW92ZSgpOyBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYnRuX2xhc3QnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSW5kZXgtLTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYnRuX25leHQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSW5kZXgrKztcclxuICAgICAgICAgICAgICAgIHRoaXMuc3VibWl0KCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzdWJtaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNMb2FkaW5nRGF0YSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuaXNMb2FkaW5nRGF0YSA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMucGFnZUluZGV4IDwgMSkge1xyXG4gICAgICAgICAgICBnbEdhbWUucGFuZWwuc2hvd1RpcCgn5b2T5YmN5bey57uP5piv56ys5LiA6aG177yBJyk7XHJcbiAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gMTtcclxuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmdEYXRhID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMucGFnZUluZGV4ID4gdGhpcy5wYWdlQ291bnQpIHtcclxuICAgICAgICAgICAgZ2xHYW1lLnBhbmVsLnNob3dUaXAoJ+W9k+WJjeW3sue7j+aYr+acgOWQjuS4gOmhte+8gScpO1xyXG4gICAgICAgICAgICB0aGlzLnBhZ2VJbmRleCA9IHRoaXMucGFnZUNvdW50O1xyXG4gICAgICAgICAgICB0aGlzLmlzTG9hZGluZ0RhdGEgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnbEdhbWUucGFuZWwuc2hvd1Jvb21KdUh1YSgpO1xyXG4gICAgICAgIC8v6I635Y+W55So5oi355qE54mM5bGA6K6w5b2VXHJcbiAgICAgICAgZ2xHYW1lLmdhbWVOZXQuc2VuZF9tc2coJ2h0dHAuUmVxVXNlckZpc2hpbmdIYW5kUmVjb3JkcycsIHsgZ2FtZWlkOiB0aGlzLmdhbWVJRCwgcGFnZV9zaXplOiB0aGlzLnBhZ2VTaXplLCBwYWdlOiB0aGlzLnBhZ2VJbmRleCB9LCB0aGlzLnJlc2V0UGFuZWxEYXRhLmJpbmQodGhpcykpO1xyXG4gICAgfSxcclxuICAgIC8v5oiq5Y+W5bCP5pWw54K55ZCO5Lik5L2NXHJcbiAgICBjdXREb3duTnVtKHZhbHVlLCBudW0gPSAyKSB7XHJcbiAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgcmV0dXJuO1xyXG4gICAgICAgIGlmICh+fnZhbHVlID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuZGl2KDEwMCkudG9TdHJpbmcoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IE51bWJlcih2YWx1ZSkuZGl2KDEwMCk7XHJcbiAgICAgICAgICAgIHJldHVybiAoTWF0aC5mbG9vcih2YWx1ZSAqIDEwMCkgLyAxMDApLnRvRml4ZWQobnVtKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMudW5SZWdpc3RlckV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5nYW1lUmVjb3JkID0gbnVsbDtcclxuICAgIH0sXHJcbn0pOyJdfQ==