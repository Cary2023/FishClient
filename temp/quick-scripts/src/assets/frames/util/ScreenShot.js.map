{"version":3,"sources":["assets\\frames\\util\\ScreenShot.js"],"names":["module","exports","captureScreenshot","filename","node","isBrowser","callback","base64","cc","game","canvas","toDataURL","director","off","Director","EVENT_AFTER_DRAW","href","replace","alink","document","createElement","download","click","active","glGame","panel","showTip","tips","COMMON","SAVEQRCODE","on","size","getWinSize","fullPath","jsb","fileUtils","getWritablePath","isFileExist","removeFile","renderTexture","RenderTexture","create","width","height","Texture2D","PIXEL_FORMAT_RGBA8888","gl","DEPTH24_STENCIL8_OES","begin","getScene","_sgNode","visit","end","saveToFile","ImageFormat","PNG"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACAA,MAAM,CAACC,OAAP,CAAeC,iBAAf,GAAmC,UAASC,QAAT,EAAmBC,IAAnB,EAAwB;AACvD,MAAIC,SAAJ,EAAe;AACX,QAAIC,QAAQ,GAAG,SAAXA,QAAW,GAAI;AACf,UAAIC,MAAM,GAAGC,EAAE,CAACC,IAAH,CAAQC,MAAR,CAAeC,SAAf,CAAyB,YAAzB,CAAb,CADe,CACqC;;AACpDH,MAAAA,EAAE,CAACI,QAAH,CAAYC,GAAZ,CAAgBL,EAAE,CAACM,QAAH,CAAYC,gBAA5B;AACA,UAAIC,IAAI,GAAGT,MAAM,CAACU,OAAP,CAAe,kBAAf,EAAmC,yBAAnC,CAAX;AACA,UAAIC,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAZ;AACAF,MAAAA,KAAK,CAACF,IAAN,GAAaA,IAAb;AACAE,MAAAA,KAAK,CAACG,QAAN,aAAoBlB,QAApB;AACAe,MAAAA,KAAK,CAACI,KAAN;AACAlB,MAAAA,IAAI,CAACmB,MAAL,GAAc,KAAd;AACAC,MAAAA,MAAM,CAACC,KAAP,CAAaC,OAAb,CAAqBF,MAAM,CAACG,IAAP,CAAYC,MAAZ,CAAmBC,UAAxC;AACH,KAVD;;AAWArB,IAAAA,EAAE,CAACI,QAAH,CAAYkB,EAAZ,CAAetB,EAAE,CAACM,QAAH,CAAYC,gBAA3B,EAA6CT,QAA7C;AACH,GAbD,MAaO;AACH,QAAIyB,IAAI,GAAGvB,EAAE,CAACI,QAAH,CAAYoB,UAAZ,EAAX;AACA,QAAIC,QAAQ,GAAGC,GAAG,CAACC,SAAJ,CAAcC,eAAd,KAAkCjC,QAAjD;;AACA,QAAG+B,GAAG,CAACC,SAAJ,CAAcE,WAAd,CAA0BJ,QAA1B,CAAH,EAAuC;AACnCC,MAAAA,GAAG,CAACC,SAAJ,CAAcG,UAAd,CAAyBL,QAAzB;AACH;;AACD,QAAIM,aAAa,GAAG/B,EAAE,CAACgC,aAAH,CAAiBC,MAAjB,CAChBV,IAAI,CAACW,KADW,EAEhBX,IAAI,CAACY,MAFW,EAGhBnC,EAAE,CAACoC,SAAH,CAAaC,qBAHG,EAIhBC,EAAE,CAACC,oBAJa,CAApB,CANG,CAYH;;AACAR,IAAAA,aAAa,CAACS,KAAd;;AACAxC,IAAAA,EAAE,CAACI,QAAH,CAAYqC,QAAZ,GAAuBC,OAAvB,CAA+BC,KAA/B;;AACAZ,IAAAA,aAAa,CAACa,GAAd;AACAb,IAAAA,aAAa,CAACc,UAAd,CAAyBlD,QAAzB,EAAmCK,EAAE,CAAC8C,WAAH,CAAeC,GAAlD,EAAuD,IAAvD,EAA6D,YAAY;AACrE/B,MAAAA,MAAM,CAACC,KAAP,CAAaC,OAAb,CAAqBF,MAAM,CAACG,IAAP,CAAYC,MAAZ,CAAmBC,UAAxC;AACH,KAFD;AAGH;AACJ,CAlCD","sourceRoot":"/","sourcesContent":["//1.web为将图片转换成base64并下载到本地；2.截取节点的图片保存到本地\r\n//filename: string;\r\n//accountCode: string;\r\n//node: cc.Node; 二维码的渲染节点\r\nmodule.exports.captureScreenshot = function(filename, node){\r\n    if (isBrowser) {\r\n        var callback = ()=>{\r\n            var base64 = cc.game.canvas.toDataURL(\"imagea/png\");//getBase64Image(img);//canvas.toDataURL(\"imagea/png\")//;\r\n            cc.director.off(cc.Director.EVENT_AFTER_DRAW);\r\n            var href = base64.replace(/^data:image[^;]*/, \"data:image/octet-stream\");\r\n            var alink = document.createElement(\"a\")\r\n            alink.href = href;\r\n            alink.download = `${filename}.png`;\r\n            alink.click()\r\n            node.active = false;\r\n            glGame.panel.showTip(glGame.tips.COMMON.SAVEQRCODE);\r\n        }\r\n        cc.director.on(cc.Director.EVENT_AFTER_DRAW, callback);\r\n    } else {\r\n        var size = cc.director.getWinSize();\r\n        var fullPath = jsb.fileUtils.getWritablePath() + filename;\r\n        if(jsb.fileUtils.isFileExist(fullPath)){\r\n            jsb.fileUtils.removeFile(fullPath);\r\n        }\r\n        let renderTexture = cc.RenderTexture.create(\r\n            size.width,\r\n            size.height,\r\n            cc.Texture2D.PIXEL_FORMAT_RGBA8888,\r\n            gl.DEPTH24_STENCIL8_OES\r\n        );\r\n        //renderTexture.setPosition(cc.v2(size.width/2, size.height/2));\r\n        renderTexture.begin();\r\n        cc.director.getScene()._sgNode.visit();\r\n        renderTexture.end();\r\n        renderTexture.saveToFile(filename, cc.ImageFormat.PNG, true, function () {\r\n            glGame.panel.showTip(glGame.tips.COMMON.SAVEQRCODE);\r\n        });\r\n    }\r\n}\r\n"]}