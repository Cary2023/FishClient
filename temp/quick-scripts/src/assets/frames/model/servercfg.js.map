{"version":3,"sources":["assets\\frames\\model\\servercfg.js"],"names":["Server","localTag","servercfg","b_enableHotUpdate","cc","sys","isNative","isMobile","server","prototype","g_instance","loadSetting","glGame","gamecfg","gameProxy","fileutil","readJSON","then","data","logenable","loadSettingCB","loadServer","getProxyUrl","ProxySucceed","ProxyO","stop","cfgurl","url","on","start","repetitionSend","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","respone","responseText","resp","JSON","parse","head","body","key","encrypt","getDecodeUrl","code","parseInt","user","setUrl","emitter","emit","MESSAGE","UPDATE_SERVER_CFG","setTimeout","timeout","onerror","error","wholeurl","route","msg","msgindex","firstReq","getEncodeUrl","open","setRequestHeader","send","stringify","log","console","URLProducttag","producttag","window","location","href","analysisURLParameter","args","turnOtherApp","type","QQNumber","host","port","openURL","URL","arr","split","obj","length","mapArr","i","parameter","getLocalTag","isEnableHotUpdate","getServerCfg","getQRCodeURL","getGameRuleURL","tag","gameName","curGameID","room","get","scene","getSceneNameByID","getHotupdateVersionUrl","hotUpdateURL","strdiagonal","openDownLoad","getHotDownVersion","getBolMaintaining","getMaintainingContent","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 连接服务器数据模块\r\n */\r\nlet\r\n    Server = function () {\r\n        this.localTag = null;\r\n        this.servercfg = null;\r\n        this.b_enableHotUpdate = cc.sys.isNative && cc.sys.isMobile;\r\n    },\r\n    server = Server.prototype,\r\n    g_instance = null;\r\nserver.loadSetting = function () {\r\n    if (glGame.gamecfg.gameProxy == 0) {\r\n        glGame.fileutil.readJSON(\"config/localsetting\").then(data => {\r\n            if (data.logenable) {\r\n                this.loadSettingCB(data);\r\n            } else {\r\n                this.loadServer(data);\r\n            }\r\n        });\r\n    } else this.getProxyUrl();\r\n}\r\n\r\nserver.ProxySucceed = function (data) {\r\n    ProxyO.stop();\r\n    this.loadServer({ cfgurl: data.url });\r\n}\r\n\r\nserver.getProxyUrl = function () {\r\n    ProxyO.on('succeed', this.ProxySucceed, this);\r\n    ProxyO.start();\r\n}\r\n\r\nserver.repetitionSend = function () {\r\n    if (this.localTag) this.loadServer(this.localTag);\r\n    else this.loadSetting();\r\n}\r\n\r\nserver.loadServer = function (data) {\r\n    this.localTag = data;\r\n    let xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.onreadystatechange = () => {\r\n        if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n            let respone = xhr.responseText;\r\n            let resp = JSON.parse(respone);\r\n            let head = resp.head;\r\n            let body = resp.body;\r\n            if (head.key) body = glGame.encrypt.getDecodeUrl(body, head.key);\r\n            if (head.code != null && typeof code == \"string\") head.code = parseInt(head.code);\r\n            else head.code = 0;\r\n            if (head && head.code == 0) {\r\n                this.servercfg = body;\r\n                glGame.user.setUrl(body);\r\n                glGame.emitter.emit(MESSAGE.UPDATE_SERVER_CFG);\r\n            }\r\n        } else if (xhr.readyState === 4) {\r\n            xhr.onreadystatechange = () => { };\r\n            setTimeout(() => {\r\n                glGame.servercfg.repetitionSend();\r\n            }, 5000)\r\n        }\r\n    };\r\n    xhr.timeout = 15000;\r\n    xhr.onerror = (error) => {\r\n        setTimeout(() => {\r\n            glGame.servercfg.repetitionSend();\r\n        }, 5000)\r\n    }\r\n    let wholeurl = `${data.cfgurl}`;\r\n    let route = \"http.reqUrl\";\r\n    let msg = {\r\n        head: {\r\n            route: route,\r\n            msgindex: 0,\r\n            firstReq: 1\r\n        },\r\n        body: {}\r\n    };\r\n    if (msg.body && !msg.head.key) {\r\n        let data = {};\r\n        data = glGame.encrypt.getEncodeUrl(msg.body);\r\n        msg.body = data[\"data\"];\r\n        msg.head.key = data[\"dataKey\"];\r\n    }\r\n    xhr.open(\"POST\", wholeurl, true);\r\n    xhr.setRequestHeader(\"Content-Type\", \"application/json;charset=utf-8\");\r\n    xhr.send(JSON.stringify(msg));\r\n};\r\n\r\nserver.loadSettingCB = function (data) {\r\n    this.localTag = data;\r\n    let xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.onreadystatechange = () => {\r\n        cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);\r\n        if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n            let respone = xhr.responseText;\r\n            this.servercfg = JSON.parse(respone);\r\n            // this.servercfg.platSvrPort = 8081;\r\n            // this.servercfg.platSvrHost = 'http://192.168.2.15';\r\n            console.log(\"获取的servercfg  loadSettingCB\", this.servercfg);\r\n            glGame.emitter.emit(MESSAGE.UPDATE_SERVER_CFG);\r\n        }\r\n    };\r\n    xhr.timeout = 5000;\r\n    xhr.onerror = (error) => {\r\n        setTimeout(() => {\r\n            if (this.localTag) glGame.servercfg.loadSettingCB(glGame.servercfg.localTag);\r\n            else glGame.servercfg.loadSetting();\r\n        }, 5000)\r\n    }\r\n    let URLProducttag = data.producttag;\r\n    if (!cc.sys.isNative && window && window.location && window.location.href) {\r\n        URLProducttag = this.analysisURLParameter(window.location.href).args.producttag;\r\n    }\r\n    let wholeurl = `${data.cfgurl}/products/${URLProducttag || data.producttag}.json`;\r\n    console.log(\"wholeurl=\", wholeurl);\r\n    xhr.open(\"GET\", wholeurl, true);\r\n    xhr.send();\r\n};\r\n\r\n//跳转到QQ对话框/社交软件界面\r\nserver.turnOtherApp = function (type, QQNumber = null) {\r\n    let host = this.servercfg[\"platSvrHost\"];\r\n    let port = this.servercfg[\"platSvrPort\"];\r\n    if (QQNumber) {\r\n        cc.sys.openURL(`http://${host}:${port}/openApp.html?type=${type}&url=${QQNumber}`);\r\n    } else {\r\n        cc.sys.openURL(`http://${host}:${port}/openApp.html?type=${type}`);\r\n    }\r\n}\r\n// 解析URL是否带调试参数\r\nserver.analysisURLParameter = function (URL) {\r\n    let arr = URL.split(\"?\");\r\n    let obj = {\r\n        url: null,\r\n        args: {}\r\n    };\r\n    obj.url = arr[0];\r\n    // 拆分后如果长度小于2说明URL是不带参数的\r\n    if (arr.length < 2) return obj;\r\n    let mapArr = arr[1].split(\"&\");\r\n    for (let i = 0; i < mapArr.length; i++) {\r\n        let parameter = mapArr[i].split(\"=\");\r\n        obj.args[parameter[0]] = parameter[1];\r\n    }\r\n    return obj\r\n};\r\nserver.getLocalTag = function () {\r\n    return this.localTag;\r\n};\r\nserver.isEnableHotUpdate = function () {\r\n    return this.b_enableHotUpdate;\r\n};\r\nserver.getServerCfg = function () {\r\n    return this.servercfg;\r\n};\r\n/**\r\n * 获取分享二维码图片地址\r\n */\r\nserver.getQRCodeURL = function () {\r\n    let host = this.servercfg[\"platSvrHost\"];\r\n    let port = this.servercfg[\"platSvrPort\"];\r\n    return `${host}:${port}/shareimg/code.png`\r\n};\r\n/**\r\n * 获取当前游戏规则\r\n * @param tag 标签页编号\r\n * @param gameName 指定游戏名字\r\n */\r\nserver.getGameRuleURL = function (tag, gameName) {\r\n    let host = this.servercfg[\"platSvrHost\"];\r\n    let port = this.servercfg[\"platSvrPort\"];\r\n    let curGameID = glGame.room.get(\"curEnterGameID\");\r\n    if (!gameName) gameName = glGame.scene.getSceneNameByID(curGameID);\r\n    return `http://${host}:${port}/gamerule/${gameName}/${tag}.html`\r\n};\r\n\r\n/**\r\n * 获取当前游戏热更地址\r\n */\r\nserver.getHotupdateVersionUrl = function () {\r\n    let hotUpdateURL = this.servercfg[\"hotUrl\"];\r\n    let strdiagonal = hotUpdateURL[hotUpdateURL.length - 1] === \"/\" ? \"\" : \"/\";\r\n    return hotUpdateURL + strdiagonal;\r\n}\r\n\r\n/**\r\n * 开启下载地址\r\n */\r\nserver.openDownLoad = function () {\r\n    cc.sys.openURL(this.servercfg[\"downLoadPage\"]);\r\n}\r\n\r\n/**\r\n * 获取当前游戏热更地址\r\n */\r\nserver.getHotDownVersion = function () {\r\n    return this.servercfg[\"downVersion\"];\r\n}\r\n\r\n/**\r\n * 获取紧急公告开关\r\n */\r\nserver.getBolMaintaining = function () {\r\n    return this.servercfg[\"emergencyMaintenanceSwitch\"];\r\n}\r\n\r\n/**\r\n * 获取紧急公告内容\r\n */\r\nserver.getMaintainingContent = function () {\r\n    return this.servercfg[\"emergencyMaintenanceContent\"];\r\n}\r\n\r\nmodule.exports = function () {\r\n    if (!g_instance) {\r\n        g_instance = new Server();\r\n    }\r\n    return g_instance;\r\n};"]}