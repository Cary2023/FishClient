{"version":3,"sources":["assets\\frames\\base\\loader.js"],"names":["Loader","loader","prototype","g_instance","releaseRes","path","type","cc","releaseAsset","obj","remoteLoad","url","Promise","resolve","reject","load","err","data","console","error","SpriteFrame","loadRes","res","loadSpriteAtlas","AtlasPath","SpriteAtlas","atlas","loadSpriteFrame","ImagePath","spriteFrame","loadResDir","loadPath","iconFile","filepath","loadList","split","pngName","length","base_path","jsb","fileUtils","getWritablePath","isDirectoryExist","createDirectory","isFileExist","iconPush","arraybuffer","writeDataToFile","Uint8Array","loadUrlpic","glGame","xhr","getXMLHttpRequest","responseType","onreadystatechange","readyState","status","response","timeout","open","onerror","ontimeout","self","send","audioPush","loadUrlaudio","downloader","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * resources 目录资源加载管理\r\n */\r\nlet\r\n    Loader = function () { },\r\n    loader = Loader.prototype,\r\n    g_instance = null;\r\n\r\n/**\r\n * 资源释放\r\n * @param {String} path\r\n * @param {String} type\r\n */\r\nloader.releaseRes = function (path, type) {\r\n    cc.loader.releaseRes(path, type);\r\n};\r\n/**\r\n * 资源释放\r\n * @param {Object} obj\r\n */\r\nloader.releaseAsset = function (obj) {\r\n    cc.loader.releaseAsset(obj);\r\n};\r\nloader.remoteLoad = function (url) {\r\n    return new Promise(function (resolve, reject) {\r\n        cc.loader.load(url, function (err, data) {\r\n            if (err) {\r\n                reject(\"加载远程资源失败\")\r\n                return console.error(err)\r\n            }\r\n            resolve(new cc.SpriteFrame(data));\r\n        })\r\n    })\r\n};\r\n/**\r\n * 单一资源加载\r\n * @param path\r\n * @returns {Promise<any>}\r\n */\r\nloader.loadRes = function (path) {\r\n    return new Promise(function (resolve, reject) {\r\n        cc.loader.loadRes(path, function (err, res) {\r\n            if (err) {\r\n                reject(\"单一资源加载失败\")\r\n                return console.error(err)\r\n            }\r\n            resolve(res);\r\n        })\r\n    })\r\n};\r\n/**\r\n * 加载 SpriteAtlas 图集\r\n * @param {String} AtlasPath\r\n * @returns {Promise}\r\n */\r\nloader.loadSpriteAtlas = function (AtlasPath) {\r\n    return new Promise(function (resolve, reject) {\r\n        cc.loader.loadRes(AtlasPath, cc.SpriteAtlas, function (err, atlas) {\r\n            if (err) {\r\n                reject(\"加载 SpriteAtlas 图集失败\");\r\n                return cc.error(err);\r\n            }\r\n            // resolve(atlas.getSpriteFrame(ImageName));\r\n            resolve(atlas);\r\n        })\r\n    })\r\n};\r\n/**\r\n * 加载独立的 SpriteFrame\r\n * @param {String} ImagePath\r\n * @returns {Promise}\r\n */\r\nloader.loadSpriteFrame = function (ImagePath) {\r\n    return new Promise(function (resolve, reject) {\r\n        cc.loader.loadRes(ImagePath, cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (err) {\r\n                reject(\"加载独立的 SpriteFrame 失败\");\r\n                return cc.error(err);\r\n            }\r\n            resolve(spriteFrame)\r\n        })\r\n    })\r\n};\r\n/**\r\n * 资源批量加载\r\n * @param {String} loadPath\r\n * @returns {Promise}\r\n */\r\nloader.loadResDir = function (loadPath) {\r\n    return new Promise(function (resolve, reject) {\r\n        cc.loader.loadResDir(loadPath, function (err, data) {\r\n            if (err) {\r\n                reject(\"资源批量加载失败\");\r\n                return console.error(err);\r\n            }\r\n            resolve(data)\r\n        });\r\n    })\r\n};\r\n\r\n\r\n/**\r\n * 获取图标本地地址\r\n * @param {String} loadPath\r\n */\r\nloader.iconFile = function (loadPath) {\r\n    let filepath = \"\";\r\n    let loadList = loadPath.split('/'),\r\n        pngName = loadList[loadList.length - 1],\r\n        base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"master/res/raw-assets/icon\";\r\n    if (!jsb.fileUtils.isDirectoryExist(base_path)) {\r\n        jsb.fileUtils.createDirectory(base_path);\r\n    }\r\n    filepath = `${base_path}/${pngName}`;\r\n    if (jsb.fileUtils.isFileExist(filepath))\r\n        return filepath;\r\n    return \"\";\r\n}\r\n\r\n/**\r\n * 添加远程端的图片地址\r\n * @param {String} loadPath\r\n */\r\nloader.iconPush = function (loadPath, arraybuffer) {\r\n    let filepath = \"\";\r\n    let loadList = loadPath.split('/'),\r\n        pngName = loadList[loadList.length - 1],\r\n        base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"master/res/raw-assets/icon\";\r\n    if (!jsb.fileUtils.isDirectoryExist(base_path)) {\r\n        jsb.fileUtils.createDirectory(base_path);\r\n    }\r\n    filepath = `${base_path}/${pngName}`;\r\n    if (typeof arraybuffer !== 'undefined') {\r\n        if (!jsb.fileUtils.isDirectoryExist(base_path)) {\r\n            jsb.fileUtils.createDirectory(base_path);\r\n        }\r\n\r\n        if (jsb.fileUtils.writeDataToFile(new Uint8Array(arraybuffer), filepath)) {\r\n            return filepath;\r\n        } else {\r\n            console.error('Remote write file failed.');\r\n        }\r\n    } else {\r\n        console.error('Remote download file failed.');\r\n    }\r\n    return \"\";\r\n}\r\n\r\n\r\n/**\r\n * 下载远程端的文件保存在本地并返回相关地址（已有文件直接返回地址）\r\n * @param {String} loadPath\r\n * @returns {Promise}\r\n */\r\nloader.loadUrlpic = function (loadPath) {\r\n    return new Promise(function (resolve, reject) {\r\n        let filepath = glGame.loader.iconFile(loadPath);\r\n        if (filepath !== \"\") resolve(filepath);\r\n        else {\r\n            let xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.responseType = \"arraybuffer\";\r\n            xhr.onreadystatechange = () => {\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    let arraybuffer = xhr.response;\r\n                    filepath = glGame.loader.iconPush(loadPath, arraybuffer);\r\n                    if (filepath !== \"\") resolve(filepath);\r\n                    else reject();\r\n                }\r\n            };\r\n            xhr.timeout = 20000;\r\n            xhr.open(\"GET\", loadPath, true);\r\n            xhr.onerror = (error) => { console.error(\"icon url error fail!\"); reject(); }\r\n            xhr.ontimeout = (self) => { self.send(); };\r\n            xhr.send();\r\n        }\r\n    })\r\n};\r\n\r\n\r\n/**\r\n * 添加远程端的图片地址\r\n * @param {String} loadPath\r\n */\r\nloader.audioPush = function (loadPath, arraybuffer) {\r\n    let filepath = \"\";\r\n    let loadList = loadPath.split('/'),\r\n        pngName = loadList[loadList.length - 1],\r\n        base_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"master/res/raw-assets/audio\";\r\n    if (!jsb.fileUtils.isDirectoryExist(base_path)) {\r\n        jsb.fileUtils.createDirectory(base_path);\r\n    }\r\n    filepath = `${base_path}/${pngName}`;\r\n    if (typeof arraybuffer !== 'undefined') {\r\n        if (!jsb.fileUtils.isDirectoryExist(base_path)) {\r\n            jsb.fileUtils.createDirectory(base_path);\r\n        }\r\n\r\n        if (jsb.fileUtils.writeDataToFile(new Uint8Array(arraybuffer), filepath)) {\r\n            return filepath;\r\n        } else {\r\n            console.error('Remote write file failed.');\r\n        }\r\n    } else {\r\n        console.error('Remote download file failed.');\r\n    }\r\n    return \"\";\r\n}\r\n\r\n\r\n\r\n/**\r\n * 下载远程端的文件保存在本地并返回相关地址（已有文件直接返回地址）\r\n * @param {String} loadPath\r\n * @returns {Promise}\r\n */\r\nloader.loadUrlaudio = function (loadPath) {\r\n    return new Promise(function (resolve, reject) {\r\n        let filepath = glGame.loader.iconFile(loadPath);\r\n        if (filepath !== \"\") resolve(filepath);\r\n        else {\r\n            let xhr = cc.loader.downloader();\r\n            xhr.responseType = \"arraybuffer\";\r\n            xhr.onreadystatechange = () => {\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    let arraybuffer = xhr.response;\r\n                    filepath = glGame.loader.audioPush(loadPath, arraybuffer);\r\n                    if (filepath !== \"\") resolve(filepath);\r\n                    else reject();\r\n                }\r\n            };\r\n            xhr.timeout = 20000;\r\n            xhr.open(\"GET\", loadPath, true);\r\n            xhr.onerror = (error) => { console.error(\"icon url error fail!\"); reject(); }\r\n            xhr.ontimeout = (self) => { self.send(); };\r\n            xhr.send();\r\n        }\r\n    })\r\n};\r\n\r\nmodule.exports = function () {\r\n    if (!g_instance) {\r\n        g_instance = new Loader();\r\n    }\r\n    return g_instance;\r\n};"]}