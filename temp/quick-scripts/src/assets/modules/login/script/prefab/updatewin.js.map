{"version":3,"sources":["assets\\modules\\login\\script\\prefab\\updatewin.js"],"names":["glGame","baseclass","extend","properties","fileProgress","cc","ProgressBar","fileLabel","Label","lab_percent","lab_tipcenter","lab_center","lab_po","Node","onLoad","_updating","_canRetry","_storagePath","start_update","start_flow","tipdelay","update_error","node","active","panel","preloadLoinMode","then","updateServerCfg","registerEvent","servercfg","loadSetting","string","lab_tip","actState","setState","version","fetchJSON","emitter","on","MESSAGE","UPDATE_SERVER_CFG","DOWNLOAD","OPEN_PATH","downLoadGame","STOP","updateStop","NETWORK","PODOT_ON","pomelo_dot_on","unRegisterEvent","off","onoff","_am","setEventCallback","clear","stateUpdate","getBolMaintaining","showMaintainNotice","getMaintainingContent","isEnableHotUpdate","enterLoginScene","systemclass","comparisonVersion","getHotDownVersion","initProject","showDialog","user","reqDownLoadJump","game","end","isAndroid","strUrl","get","downloadAndroidUrl","substr","platform","DownloadApk","emit","BAG","sys","openURL","download_jump","checkVersion","gameName","update_data","storage","getItem","hotUpdateURL","getHotupdateVersionUrl","url","gamelistcfg","getGameVersion","data","console","log","createUpdate","jsb","fileUtils","getWritablePath","ver_txt","isFileExist","manifestUrl","fileutil","readManifest","manifestjson","JSON","parse","packageUrl","remoteManifestUrl","remoteVersionUrl","customManifestStr","stringify","checkUpProject","path","getStringFromFile","ProjectData","customManifest","writeStringToFile","versionCompareHandle","versionA","versionB","AssetsManager","setVerifyCallback","asset","compressed","expectedMD5","md5","relativePath","size","os","OS_ANDROID","setMaxConcurrentTask","checkUpdate","preloadedPrefab","preloadPublicMode","scene","setNextSceneTag","scenetag","PLAZA","blAuto","logon","autoLogin","reqTouLogin","remove","getState","State","UNINITED","loadLocalManifest","getLocalManifest","isLoaded","manifest","Manifest","checkCb","bind","hotUpdate","updateCb","_failCount","update","event","needUpdate","reCheckState","getEventCode","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","isRemove","removeDirectory","reStartGame","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","progress","_checkListener","getFloat","value","Math","ceil","Number","div","toString","needRestart","failed","UPDATE_PROGRESSION","getPercent","getDownloadedBytes","getTotalBytes","upsize","max","parseInt","UPDATE_FINISHED","fileError","downloadFailedAssets","getMessage","UPDATE_FAILED","ERROR_UPDATING","errorfile","getAssetId","removeFile","ERROR_DECOMPRESS","_updateListener","setItem","hotUpdateSearchPaths","localStorage","setSearchPaths","searchPaths","getSearchPaths","unshift","dot","dot_max","runAction","repeatForever","sequence","delayTime","callFunc","str_dot","i","bol","TipsList","json","playTips","index","floor","random","length","onDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n    properties: {\r\n        fileProgress: cc.ProgressBar,\r\n        fileLabel: cc.Label,\r\n        lab_percent: cc.Label,\r\n        lab_tipcenter: cc.Label,\r\n        lab_center: cc.Label,\r\n        lab_po: cc.Node,\r\n        // byteProgress: cc.ProgressBar,\r\n        // byteLabel: cc.Label,\r\n    },\r\n\r\n    onLoad: function () {\r\n\r\n        this._updating = false;\r\n        this._canRetry = false;\r\n        this._storagePath = '';\r\n        this.start_update = 0;\r\n        this.start_flow = 2;        //目前倆個流程 1 预加载提示框  2 获取热更数据\r\n        this.tipdelay = 3;\r\n        this.update_error = 0;\r\n\r\n        this.fileProgress.node.active = false;\r\n\r\n        glGame.panel.preloadLoinMode().then(() => {\r\n            this.updateServerCfg();\r\n        });\r\n        this.registerEvent();\r\n        glGame.servercfg.loadSetting();\r\n        this.fileLabel.node.active = true;\r\n        this.fileLabel.string = '';\r\n        this.lab_tip = \"正在连接服务器\";\r\n        this.actState();\r\n        this.setState(\"正在连接服务器\", true);\r\n        this.lab_percent.node.active = false;\r\n        this.version = \"\";\r\n        this.fetchJSON();\r\n    },\r\n\r\n    registerEvent() {\r\n        glGame.emitter.on(MESSAGE.UPDATE_SERVER_CFG, this.updateServerCfg, this);\r\n        glGame.emitter.on(MESSAGE.DOWNLOAD.OPEN_PATH, this.downLoadGame, this);\r\n        glGame.emitter.on(MESSAGE.DOWNLOAD.STOP, this.updateStop, this);\r\n        glGame.emitter.on(MESSAGE.NETWORK.PODOT_ON, this.pomelo_dot_on, this);\r\n    },\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(MESSAGE.UPDATE_SERVER_CFG, this);\r\n        glGame.emitter.off(MESSAGE.DOWNLOAD.OPEN_PATH, this);\r\n        glGame.emitter.off(MESSAGE.DOWNLOAD.STOP, this);\r\n        glGame.emitter.off(MESSAGE.NETWORK.PODOT_ON, this);\r\n    },\r\n\r\n    pomelo_dot_on(onoff) {\r\n        this.lab_po.active = onoff;\r\n    },\r\n\r\n    updateStop() {\r\n        if (this._am) {\r\n            this._am.setEventCallback(null);\r\n            this._am.clear();\r\n        }\r\n    },\r\n    /**\r\n    * 热更前的准备\r\n    */\r\n    updateServerCfg: function () {\r\n        this.start_update++;\r\n        this.stateUpdate();\r\n    },\r\n    /**\r\n     * 开始热更游戏\r\n     */\r\n    stateUpdate() {\r\n        if (this.start_update >= this.start_flow) {\r\n            if (glGame.servercfg.getBolMaintaining() == 1) {\r\n                glGame.panel.showMaintainNotice(glGame.servercfg.getMaintainingContent());\r\n            } else if (!isEnableHotUpdate) {\r\n                this.enterLoginScene();\r\n            } else {\r\n                if (glGame.systemclass.comparisonVersion(glGame.servercfg.getHotDownVersion())) {\r\n                    this.initProject();\r\n                } else {\r\n                    glGame.panel.showDialog(\"温馨提示\", \"当前版本不匹配需要重新下载游戏包，是否前往下载？\", () => {\r\n                        // glGame.servercfg.openDownLoad();\r\n                        glGame.user.reqDownLoadJump();\r\n                    }, () => {\r\n                        cc.game.end();\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    },\r\n    downLoadGame() {\r\n        if (!isEnableHotUpdate) return;\r\n        if (isAndroid) {\r\n            let strUrl = glGame.user.get(\"url\").downloadAndroidUrl;\r\n            if (typeof strUrl === \"string\" && strUrl.substr(-4) === \".apk\") {\r\n                glGame.platform.DownloadApk(strUrl);\r\n                glGame.emitter.emit(MESSAGE.DOWNLOAD.BAG);\r\n            } else {\r\n                //glGame.panel.showTip(\"热更地址有误，请联系客服人员。\");\r\n                cc.sys.openURL(glGame.user.get(\"url\").download_jump);\r\n                glGame.panel.showDialog(\"温馨提示\", \"当前版本不匹配需要重新下载游戏包，是否前往下载？\", () => {\r\n                    // glGame.servercfg.openDownLoad();\r\n                    glGame.user.reqDownLoadJump();\r\n                }, () => {\r\n                    cc.game.end();\r\n                });\r\n            }\r\n        } else {\r\n            cc.sys.openURL(glGame.user.get(\"url\").download_jump);\r\n            glGame.panel.showDialog(\"温馨提示\", \"当前版本不匹配需要重新下载游戏包，是否前往下载？\", () => {\r\n                // glGame.servercfg.openDownLoad();\r\n                glGame.user.reqDownLoadJump();\r\n            }, () => {\r\n                cc.game.end();\r\n            });\r\n        }\r\n    },\r\n\r\n    //根据缓存的热更ver 进行对比，减少不必要的热更加载，并对版本进行一定的热更维护\r\n    checkVersion() {\r\n        let gameName = \"master\";\r\n        let update_data = glGame.storage.getItem('update_data');\r\n        let hotUpdateURL = glGame.servercfg.getHotupdateVersionUrl();\r\n        let url = `${hotUpdateURL}${gameName}/${gameName}version.manifest`\r\n\r\n        glGame.gamelistcfg.getGameVersion(url).then(data => {\r\n            this.version = data.version;\r\n            if (update_data && update_data[gameName]) {\r\n                if (data.version === update_data[gameName]) {\r\n                    console.log(\"跳过热更，目前版本是最新的！\")\r\n                    this.enterLoginScene();\r\n                } else this.createUpdate();\r\n            } else this.createUpdate();\r\n        }, () => {\r\n            this.createUpdate();\r\n        });\r\n    },\r\n    //检验本地文件\r\n    initProject() {\r\n        let gameName = \"master\";\r\n        this._storagePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : \"/\") + gameName + \"/\";\r\n\r\n        this.ver_txt = jsb.fileUtils.isFileExist(`${this._storagePath}project.manifest`);\r\n        this.manifestUrl = `project.manifest`;\r\n        console.log('本地路径 : ' + this._storagePath, this.manifestUrl);\r\n\r\n        let hotUpdateURL = glGame.servercfg.getHotupdateVersionUrl();\r\n        //是否获取本地的热更地址\r\n        glGame.fileutil.readManifest(\"config/masterproject\").then(data => {\r\n            //本地校验文件\r\n            let manifestjson = JSON.parse(data);\r\n            manifestjson.packageUrl = `${hotUpdateURL}${gameName}/`;\r\n            manifestjson.remoteManifestUrl = `${hotUpdateURL}${gameName}/${gameName}project.manifest`;\r\n            manifestjson.remoteVersionUrl = `${hotUpdateURL}${gameName}/${gameName}version.manifest`;\r\n            this.customManifestStr = JSON.stringify(manifestjson);\r\n\r\n            if (this.ver_txt) this.checkUpProject(`${this._storagePath}project.manifest`);\r\n            this.checkVersion();\r\n        }).catch(() => {\r\n            //未找到本地校验文件\r\n            this.customManifestStr = JSON.stringify({\r\n                \"packageUrl\": `${hotUpdateURL}${gameName}/`,\r\n                \"remoteManifestUrl\": `${hotUpdateURL}${gameName}/${gameName}project.manifest`,\r\n                \"remoteVersionUrl\": `${hotUpdateURL}${gameName}/${gameName}version.manifest`,\r\n                \"version\": \"0.0.0\",\r\n                \"assets\": {},\r\n                \"searchPaths\": []\r\n            });\r\n            if (this.ver_txt) this.checkUpProject(`${this._storagePath}project.manifest`);\r\n            this.checkVersion();\r\n        })\r\n    },\r\n\r\n\r\n    /**\r\n     * 检查热更文件并替换其热更地址\r\n     * @param {string} path\r\n     */\r\n    checkUpProject(path) {\r\n        let data = jsb.fileUtils.getStringFromFile(path);\r\n        let ProjectData = JSON.parse(data),\r\n            customManifest = JSON.parse(this.customManifestStr)\r\n        if (customManifest.packageUrl != ProjectData.packageUrl ||\r\n            customManifest.remoteManifestUrl != ProjectData.remoteManifestUrl ||\r\n            customManifest.remoteVersionUrl != ProjectData.remoteVersionUrl) {\r\n            ProjectData.packageUrl = customManifest.packageUrl;\r\n            ProjectData.remoteManifestUrl = customManifest.remoteManifestUrl;\r\n            ProjectData.remoteVersionUrl = customManifest.remoteVersionUrl;\r\n            jsb.fileUtils.writeStringToFile(JSON.stringify(ProjectData), path);\r\n        }\r\n    },\r\n\r\n    createUpdate() {\r\n        // Setup your own version compare handler, versionA and B is versions in string\r\n        // if the return value greater than 0, versionA is greater than B,\r\n        // if the return value equals 0, versionA equals to B,\r\n        // if the return value smaller than 0, versionA is smaller than B.\r\n        this.versionCompareHandle = function (versionA, versionB) {\r\n            console.log(\"JS 自定义版本比较: version A : \" + versionA + ', version B : ' + versionB);\r\n            return versionA === versionB ? 0 : -1;\r\n        };\r\n\r\n        // Init with empty manifest url for testing custom manifest\r\n        this._am = new jsb.AssetsManager(\"\", this._storagePath, this.versionCompareHandle);\r\n        // if (!cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS) {\r\n        //     this._am.retain();\r\n        // }\r\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\r\n        // Return true if the verification passed, otherwise return false\r\n        this._am.setVerifyCallback(function (path, asset) {\r\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\r\n            var compressed = asset.compressed;\r\n            // Retrieve the correct md5 value.\r\n            var expectedMD5 = asset.md5;\r\n            // asset.path is relative path and path is absolute.\r\n            var relativePath = asset.path;\r\n            //console.log(\"验证通过 : \" + relativePath + ' (' + expectedMD5 + ')');\r\n            // The size of asset file, but this value could be absent.\r\n            var size = asset.size;\r\n            if (compressed) {\r\n                // info.string = \"验证通过 : \" + relativePath;\r\n                return true;\r\n            }\r\n            else {\r\n                // info.string = \"验证通过 : \" + relativePath + ' (' + expectedMD5 + ')';\r\n                return true;\r\n            }\r\n        });\r\n\r\n        console.log('热更新已就绪,请检查或直接更新.');\r\n\r\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n            // Some Android device may slow down the download process when concurrent tasks is too much.\r\n            // The value may not be accurate, please do more test and find what's most suitable for your game.\r\n            this._am.setMaxConcurrentTask(10);\r\n        }\r\n        // 检测更新\r\n        this.checkUpdate();\r\n    },\r\n    //预加载通用模块\r\n    preloadedPrefab: function () {\r\n        this.setState(\"正在加载游戏配置\", true);\r\n        this.lab_percent.node.active = false;\r\n        return glGame.panel.preloadPublicMode();\r\n    },\r\n\r\n    enterLoginScene: function () {\r\n        //this.preloadedPrefab().then(() => {\r\n        glGame.scene.setNextSceneTag(glGame.scenetag.PLAZA);\r\n        this.setState(\"正在进入游戏\", true);\r\n        //判定是否属于自动登入\r\n        let blAuto = glGame.logon.autoLogin();\r\n        if (blAuto) {\r\n            return;\r\n        }\r\n        glGame.logon.reqTouLogin();\r\n        //glGame.emitter.emit(MESSAGE.DOWNLOAD.END);\r\n        this.remove();\r\n        //})\r\n    },\r\n\r\n    checkUpdate: function () {\r\n        if (this._updating) {\r\n            console.log('正在检查或更新, 请稍等 ...');\r\n            return;\r\n        }\r\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\r\n            console.log('正在检查是否需要更新中, 请稍等 ...', this.manifestUrl);\r\n            this._am.loadLocalManifest(this.manifestUrl);\r\n        }\r\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\r\n            if (this._am.getState() !== jsb.AssetsManager.State.UNINITED) return;\r\n            console.log(\"无法加载本地清单, 使用默认更新清单 ...\", this.customManifestStr, this._storagePath);\r\n            let manifest = new jsb.Manifest(this.customManifestStr, this._storagePath);\r\n            this._am.loadLocalManifest(manifest, this._storagePath);\r\n        }\r\n        this._am.setEventCallback(this.checkCb.bind(this))\r\n\r\n        this._am.checkUpdate();\r\n        this._updating = true;\r\n    },\r\n\r\n    hotUpdate: function () {\r\n        if (this._am && !this._updating) {\r\n            this._am.setEventCallback(this.updateCb.bind(this))\r\n\r\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\r\n                this._am.loadLocalManifest(this.manifestUrl);\r\n            }\r\n\r\n            this._failCount = 0;\r\n            this._am.update();\r\n            this._updating = true;\r\n        }\r\n    },\r\n\r\n    // ----------------> 检测事件回掉函数\r\n    checkCb: function (event) {\r\n        let needUpdate = false;\r\n        let reCheckState = false;\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                let isRemove = null;\r\n                if (this._am.getState() !== jsb.AssetsManager.State.UNINITED) {\r\n                    glGame.panel.showDialog(\"错误\", \"游戏更新失败, 点击确定重启...\", () => {\r\n                        isRemove = jsb.fileUtils.removeDirectory(this._storagePath);\r\n                        reStartGame();\r\n                    }, () => {\r\n                        isRemove = jsb.fileUtils.removeDirectory(this._storagePath);\r\n                        cc.game.end();\r\n                    });\r\n                    return;\r\n                }\r\n                let manifest = new jsb.Manifest(this.customManifestStr, this._storagePath);\r\n                this._am.loadLocalManifest(manifest, this._storagePath);\r\n                reCheckState = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                console.log(\"已经更新了最新的远程版本.\");\r\n                this.enterLoginScene();\r\n                break;\r\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\r\n                console.log('找到新版本, 请尝试更新.');\r\n                needUpdate = true;\r\n                this.fileProgress.progress = 0;\r\n                this.lab_percent.node.active = true\r\n                this.lab_percent.string = '0%';\r\n                this.setState(\"\", false);\r\n                this.fileLabel.string = `正在更新中.......`;\r\n                // this.byteProgress.progress = 0;\r\n                this.fileProgress.node.active = true;\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n\r\n        // cc.eventManager.removeListener(this._checkListener);\r\n        this._am.setEventCallback(null);\r\n        this._checkListener = null;\r\n        this._updating = false;\r\n        if (reCheckState) this.checkUpdate();\r\n        else if (needUpdate) this.hotUpdate();\r\n    },\r\n    //浮点型运算取俩位\r\n    getFloat: function (value) {\r\n        value = Math.ceil(value / 10 / 1024);\r\n        return (Number(value).div(100)).toString();\r\n    },\r\n\r\n    // ----------------> 热更新事件回掉函数\r\n    updateCb: function (event) {\r\n        var needRestart = false;\r\n        var failed = false;\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n                console.log('找不到本地清单文件，跳过热更新.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\r\n                // this.byteProgress.progress = event.getPercent();\r\n                // this.fileProgress.progress = event.getPercentByFile();\r\n\r\n                // this.byteProgress.progress = event.getDownloadedBytes()/event.getTotalBytes();\r\n                // this.byteLabel.string = event.getDownloadedBytes() + ' / ' + event.getTotalBytes();\r\n\r\n                if (this.lab_percent.string >= \"100%\" && event.getPercent() >= 1) {\r\n                    this.fileLabel.node.active = false;\r\n                    this.fileLabel.string = ``;\r\n                    this.setState(\"正在为您校验热更文件\", true);\r\n                    //this.fileLabel.node.x = -this.fileLabel.node.width / 2;\r\n                    // console.log('打出来提示字的位置',this.fileLabel.node.x)\r\n                    this.lab_percent.node.active = false;\r\n                    return;\r\n                }\r\n                this.setState(\"\", false);\r\n                let progress = event.getDownloadedBytes() >= event.getTotalBytes() ? event.getTotalBytes() : event.getDownloadedBytes();\r\n                let upsize = event.getDownloadedBytes() ? `${this.getFloat(progress)}Mb/${this.getFloat(event.getTotalBytes())}Mb` : \"\"\r\n                this.fileLabel.string = `正在更新中......${upsize}`;\r\n                this.fileProgress.node.active = true;\r\n                this.fileProgress.progress = Math.max(this.fileProgress.progress, event.getPercent() || 0);\r\n                this.lab_percent.node.active = true;\r\n                this.lab_percent.string = `${parseInt(event.getPercent() * 100) || 0}%`\r\n                // var msg = event.getMessage();\r\n                // if (msg) {\r\n                //     console.log('更新后的文件: ' + msg);\r\n                //     // console.log(event.getPercent()/100 + '% : ' + msg);\r\n                // }\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                console.log('无法下载清单文件，跳过热更新.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                console.log('已经更新了最新的远程版本.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\r\n                if (this.fileError) {\r\n                    this._am.downloadFailedAssets();\r\n                    this.fileError = false;\r\n                } else {\r\n                    console.log('更新完成. ' + event.getMessage());\r\n                    needRestart = true;\r\n                }\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FAILED:\r\n                console.log('更新失败. ' + event.getMessage());\r\n                if (this.update_error <= 2) {\r\n                    this.update_error++;\r\n                    this._am.downloadFailedAssets();\r\n                    this.fileError = false;\r\n                } else {\r\n                    glGame.panel.showDialog(\"错误\", \"游戏更新失败, 点击确定重试...\", () => {\r\n                        if (!this._updating && this._canRetry) {\r\n                            this._canRetry = false;\r\n                            this._am.downloadFailedAssets();\r\n                        }\r\n                    }, () => {\r\n                        cc.game.end();\r\n                    });\r\n                    this._updating = false;\r\n                    this._canRetry = true;\r\n                }\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_UPDATING:\r\n                let errorfile = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : \"/\") + \"master_temp/\" + event.getAssetId() + \".tmp\";\r\n                console.log(\"删除无法转换文件：\", errorfile);\r\n                jsb.fileUtils.removeFile(errorfile);\r\n                console.log('资源更新错误: ' + event.getAssetId() + ', ' + event.getMessage());\r\n                this.fileError = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\r\n                console.log(event.getMessage());\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (failed) {\r\n            // cc.eventManager.removeListener(this._updateListener);\r\n            this._am.setEventCallback(null)\r\n            this._updateListener = null;\r\n            this._updating = false;\r\n        }\r\n\r\n        if (needRestart) {\r\n            // cc.eventManager.removeListener(this._updateListener);\r\n            this._am.setEventCallback(null);\r\n            this._updateListener = null;\r\n            // 本次设计搜索路径为单一的不并存\r\n\r\n            //处理热更缓存记录\r\n            if (this.version) {\r\n                let data = glGame.storage.getItem('update_data');\r\n                if (data) {\r\n                    data[\"master\"] = this.version;\r\n                } else {\r\n                    data = {};\r\n                    data[\"master\"] = this.version;\r\n                }\r\n                glGame.storage.setItem('update_data', data);\r\n            }\r\n            var hotUpdateSearchPaths = localStorage.getItem('HotUpdateSearchPaths');\r\n            if (hotUpdateSearchPaths) {\r\n                jsb.fileUtils.setSearchPaths(JSON.parse(hotUpdateSearchPaths));\r\n                console.log(`找到热更新路径: ${hotUpdateSearchPaths}`)\r\n            } else {\r\n                let searchPaths = jsb.fileUtils.getSearchPaths();\r\n                searchPaths.unshift(jsb.fileUtils.getWritablePath() + 'master/');\r\n                jsb.fileUtils.setSearchPaths(searchPaths)\r\n                localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\r\n            }\r\n            reStartGame();\r\n        }\r\n    },\r\n    /**\r\n     * 文字波动\r\n     */\r\n    actState: function () {\r\n        var dot = 0;\r\n        var dot_max = 5;\r\n        this.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(0.3),\r\n            cc.callFunc(() => {\r\n                if (!this.lab_center.node.active) return;\r\n                dot >= dot_max ? dot = 0 : dot++;\r\n                let str_dot = \"\";\r\n                for (let i = 0; i < dot; i++)str_dot = str_dot + \".\";\r\n                this.lab_center.string = this.lab_tip + str_dot;\r\n            }))))\r\n    },\r\n\r\n    /**\r\n     * 设置当前流程状态\r\n     * @param {*} string \r\n     * @param {*} bol \r\n     */\r\n    setState: function (string, bol) {\r\n        this.lab_center.node.active = bol;\r\n        this.lab_center.string = string;\r\n        this.lab_tip = string;\r\n    },\r\n\r\n    fetchJSON() {\r\n        glGame.fileutil.fetchJSON(\"TipsList\").then(data => {\r\n            this.TipsList = data.json;\r\n            this.playTips();\r\n        })\r\n    },\r\n\r\n    playTips() {\r\n        this.node.runAction(cc.repeatForever(cc.sequence(\r\n            cc.callFunc(() => {\r\n                let index = Math.floor(Math.random() * 100) % this.TipsList.length;\r\n                this.lab_tipcenter.string = this.TipsList[index];\r\n            }),\r\n            cc.delayTime(this.tipdelay)\r\n        )))\r\n    },\r\n\r\n    onDestroy() {\r\n        this.unRegisterEvent();\r\n        if (this._updateListener) {\r\n            this._am.setEventCallback(null);\r\n            this._updateListener = null;\r\n        }\r\n    },\r\n\r\n});\r\n"]}