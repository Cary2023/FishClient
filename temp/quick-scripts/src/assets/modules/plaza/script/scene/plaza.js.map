{"version":3,"sources":["assets\\modules\\plaza\\script\\scene\\plaza.js"],"names":["WEBVIEW_NORMAL","WEBVIEW_EXIT","WEBVIEW_ERROR","WebViewEx","require","glGame","baseclass","extend","properties","plaza_hall","cc","Prefab","onLoad","game_web","webview_mask","emitter","on","updatePlazaSwitch","MESSAGE","UI","WEBVIEW_ON","gameWebStart","WEBVIEW_OFF","gameWebExit","onFloatButton","isfirstEnterPlaza","node","stopAllActions","runAction","sequence","delayTime","callFunc","checkShowPanel","plazaNode","panel","showPanel","showHriseRaceLamp","showRegister","closelimitJuhua","start","width","height","showsize","size","bpersist","showRollNotice","v2","notice","enterPlaza","scene","getUpScene","scenetag","LOGIN","reqGetHorseRaceLamp","arr","user","registerGetCoin","push","type","awardtype","COIN","value","cutFloat","registerGetDiamond","DIAMOND","console","log","length","showAwardBox","tips","PLAZA","CONGRATULATE","resetAward","plazaShowPanel","isShowSetupPanel","storage","getItem","sys","platform","IPHONE","nowTime","Date","toLocaleDateString","getTime","setItem","isSetup","time","pushPlazaShowPanel","get","repair_switch","showSuspicious","isTourist","activity_pop_up","isAnnouncement","showFirstEnterPanel","jsCallback","target","url","str","replace","scheme","strData","split","data","state","Number","code","gameWebOpen","changeOrientation","systemclass","offSuspension","THIRD_CODE","showTip","addNodeWidget","adNode","webWidget","addComponent","Widget","isAlignTop","isAlignBottom","isAlignLeft","isAlignRight","top","bottom","left","right","alignMode","AlignMode","ALWAYS","gamewebNew","instantiate","gameMaskPanel","parent","director","getScene","webNode","Node","isBrowser","showFloatButton","WebView","setJavascriptInterfaceScheme","setOnJSCallback","bind","addChild","active","preHandleH5","preHandleNative","getWebGameUrl","gameid","audio","pauseAllMusic","scheduleOnce","gameNet","send_msg","g","route","msg","result","action","getWebGameUrlH5","sendData","getNetMgr","getLoginToken","JSON","stringify","evaluateJS","unschedule","destroy","continueAllMusic","drager","document","getElementById","style","visibility","hideFloatButton","OnDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 三个弹出的顺序：紧急公告，游客注册，七日签到;\r\n */\r\n\r\nconst WEBVIEW_NORMAL = 0;\r\nconst WEBVIEW_EXIT = 1;\r\nconst WEBVIEW_ERROR = 2;\r\n\r\nconst WebViewEx = require('./WebViewEx');\r\n\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        plaza_hall: cc.Prefab,\r\n    },\r\n    onLoad() {\r\n        this.game_web = null;\r\n        this.webview_mask = null;\r\n        glGame.emitter.on(\"updatePlazaSwitch\", this.updatePlazaSwitch, this);\r\n        glGame.emitter.on(MESSAGE.UI.WEBVIEW_ON, this.gameWebStart, this);\r\n        glGame.emitter.on(MESSAGE.UI.WEBVIEW_OFF, this.gameWebExit, this);\r\n        glGame.emitter.on(\"floatButton\", this.onFloatButton, this);\r\n\r\n        if (glGame.isfirstEnterPlaza) {\r\n            this.node.stopAllActions();\r\n            this.node.runAction(cc.sequence(cc.delayTime(0.2), cc.callFunc(() => {\r\n                this.checkShowPanel();\r\n            })));\r\n        }\r\n\r\n        // glGame.user.reqHomeView();\r\n        this.plazaNode = glGame.panel.showPanel(this.plaza_hall);\r\n        this.showHriseRaceLamp();\r\n        this.showRegister();\r\n        glGame.panel.closelimitJuhua();\r\n    },\r\n\r\n    start() {\r\n        // glGame.panel.showJuHua();\r\n    },\r\n    updatePlazaSwitch() {\r\n        this.checkShowPanel();\r\n    },\r\n\r\n    showHriseRaceLamp() {\r\n        let width = 1190, height = 68;\r\n        let showsize = cc.size(this.node.width * 0.65, height);\r\n        let bpersist = false;\r\n        glGame.panel.showRollNotice(cc.v2(this.node.width / 2 + 439 / 2, this.node.height - 185), showsize, bpersist);\r\n        glGame.notice.enterPlaza();\r\n        if (glGame.scene.getUpScene() != glGame.scenetag.LOGIN) {\r\n            glGame.notice.reqGetHorseRaceLamp();\r\n        }\r\n    },\r\n\r\n    showRegister() {\r\n        let arr = [];\r\n        if (glGame.user.registerGetCoin && glGame.user.registerGetCoin > 0) arr.push({ type: glGame.awardtype.COIN, value: glGame.user.cutFloat(glGame.user.registerGetCoin) });\r\n        if (glGame.user.registerGetDiamond && glGame.user.registerGetDiamond > 0) arr.push({ type: glGame.awardtype.DIAMOND, value: glGame.user.cutFloat(glGame.user.registerGetDiamond) });\r\n        console.log(\"这是当前的数组\", glGame.user.registerGetCoin, glGame.user.registerGetDiamond, arr)\r\n        if (arr.length > 0) {\r\n            glGame.panel.showAwardBox(glGame.tips.PLAZA.CONGRATULATE, arr, () => { glGame.user.resetAward(); });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 第一次进入大厅，判断需要弹出哪些弹窗\r\n     */\r\n    checkShowPanel() {\r\n        glGame.panel.plazaShowPanel = [];\r\n        // glGame.panel.hidejuhua();\r\n        let isShowSetupPanel = glGame.storage.getItem('isShowSetupPanel');\r\n        // 1.每天启动第一次弹出\r\n        // 2.安装后第一次进入弹出\r\n        //new Date(new Date().toLocaleDateString()).getTime();\r\n        if (cc.sys.platform == cc.sys.IPHONE) {\r\n            let nowTime = new Date(new Date().toLocaleDateString()).getTime();\r\n            if (!isShowSetupPanel) {\r\n                glGame.storage.setItem('isShowSetupPanel', { isSetup: false, time: nowTime });\r\n                glGame.panel.pushPlazaShowPanel(\"setupRepairTool\");\r\n            } else if (!isShowSetupPanel.isSetup\r\n                && glGame.user.get(\"url\").repair_switch\r\n                && glGame.user.get(\"url\").repair_switch == 1\r\n                && isShowSetupPanel.time < nowTime) {\r\n                isShowSetupPanel.time = nowTime;\r\n                glGame.storage.setItem('isShowSetupPanel', isShowSetupPanel);\r\n                glGame.panel.pushPlazaShowPanel(\"setupRepairTool\");\r\n            }\r\n        }\r\n        if (!glGame.isfirstEnterPlaza) return\r\n        if (!glGame.panel.showSuspicious()) {\r\n            glGame.panel.pushPlazaShowPanel(\"urgentnotice\")\r\n        }\r\n        if (glGame.user.isTourist() && glGame.user.get('tips') && glGame.isfirstEnterPlaza) {\r\n            glGame.panel.pushPlazaShowPanel(\"touristtip\")\r\n        }\r\n        if (glGame.user.get(\"sign_state\")) {\r\n            glGame.panel.pushPlazaShowPanel(\"signin\")\r\n        }\r\n        if (glGame.user.get(\"loginSwitch\").activity_pop_up == 2) {\r\n            glGame.panel.pushPlazaShowPanel(\"announcement\");\r\n        } else if (glGame.user.get(\"loginSwitch\").activity_pop_up == 3) {\r\n            let isAnnouncement = glGame.storage.getItem('isAnnouncement');\r\n            let nowTime = new Date(new Date().toLocaleDateString()).getTime();\r\n            if (!isAnnouncement) {\r\n                glGame.storage.setItem('isAnnouncement', { time: nowTime });\r\n                glGame.panel.pushPlazaShowPanel(\"announcement\");\r\n            } else if (isAnnouncement.time < nowTime) {\r\n                isAnnouncement.time = nowTime;\r\n                glGame.storage.setItem('isAnnouncement', isAnnouncement);\r\n                glGame.panel.pushPlazaShowPanel(\"announcement\");\r\n            }\r\n        }\r\n        glGame.panel.showFirstEnterPanel();\r\n        glGame.isfirstEnterPlaza = false;\r\n    },\r\n\r\n    /**\r\n     * 设置回调\r\n     * @param {*} target        //webview 对象 \r\n     * @param {*} url           //回调scheme,带参数  scheme://state:0&code:0\r\n     *                                      --state:状态（int）0为无状态 1为退出状态  2错误状态  \r\n     *                                      --code:错误信息 --> 错误码(int)\r\n     */\r\n    jsCallback(target, url) {\r\n        //this.game_web.url = \"\";\r\n        var str = url.replace(this.scheme + '://', ''); // str === 'a=1&b=2'\r\n        let strData = str.split(\"&\"), data = {};\r\n        data.state = Number(strData[0].replace(\"state:\", \"\"));\r\n        data.code = Number(strData[1].replace(\"code:\", \"\"));\r\n        if (data.state == WEBVIEW_NORMAL && data.code == 0) {\r\n            this.gameWebOpen();\r\n        } else if (data.state != WEBVIEW_NORMAL && data.code != 0) {\r\n            this.gameWebExit();\r\n            glGame.platform.changeOrientation(true);\r\n            glGame.systemclass.changeOrientation(true);\r\n            glGame.platform.offSuspension();\r\n            if (data.state == WEBVIEW_ERROR && THIRD_CODE[data.code]) glGame.panel.showTip(THIRD_CODE[data.code]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 创建widget  全屏铺满\r\n     * @param {object} adNode 需要添加的node对象\r\n     */\r\n    addNodeWidget(adNode) {\r\n        var webWidget = adNode.addComponent(cc.Widget);\r\n        webWidget.isAlignTop = true;\r\n        webWidget.isAlignBottom = true;\r\n        webWidget.isAlignLeft = true;\r\n        webWidget.isAlignRight = true;\r\n        webWidget.top = 0;\r\n        webWidget.bottom = 0;\r\n        webWidget.left = 0;\r\n        webWidget.right = 0;\r\n        webWidget.alignMode = cc.Widget.AlignMode.ALWAYS;\r\n        return webWidget;\r\n    },\r\n\r\n    /**\r\n     * 动态创建web\r\n     */\r\n    gamewebNew() {\r\n        if (this.game_web) return;\r\n\r\n        if (!this.webview_mask) {\r\n            this.webview_mask = cc.instantiate(glGame.panel.gameMaskPanel);\r\n            this.webview_mask.parent = cc.director.getScene();\r\n        }\r\n\r\n        var webNode = new cc.Node();\r\n\r\n        webNode.size = cc.size(this.node.width, this.node.height);\r\n        this.addNodeWidget(webNode);\r\n\r\n        if(cc.sys.isBrowser) {\r\n            this.game_web = webNode.addComponent(WebViewEx);\r\n            this.showFloatButton();\r\n        } else {\r\n            this.game_web = webNode.addComponent(cc.WebView);\r\n            this.scheme = \"ongamedata\";\r\n            this.game_web.setJavascriptInterfaceScheme(this.scheme);\r\n            this.game_web.setOnJSCallback(this.jsCallback.bind(this));\r\n        }\r\n\r\n        this.node.addChild(webNode);\r\n        this.plazaNode.active = false;\r\n    },\r\n\r\n    gameWebStart(data) {\r\n        if(cc.sys.isBrowser) {\r\n            this.preHandleH5(data);\r\n        } else {\r\n            this.preHandleNative(data);\r\n        }\r\n    },\r\n\r\n    // 原生平台预处理\r\n    preHandleNative(data) {\r\n        this.gamewebNew();\r\n        this.game_web.url = glGame.user.getWebGameUrl(data.gameid);\r\n        glGame.audio.pauseAllMusic();\r\n        this.scheduleOnce(this.changeOrientation, 1);\r\n    },\r\n\r\n    // h5平台预处理\r\n    preHandleH5(data) {\r\n        glGame.gameNet.send_msg(\"http.ForwardH5\", {g: data.gameid}, (route, msg) => { \r\n            let data = msg.result;\r\n            this.gamewebNew();\r\n            let url = data.url;\r\n            if(data.action == 'post') {\r\n                url = glGame.user.getWebGameUrlH5(data.url);\r\n            }\r\n\r\n            this.game_web.url = url;\r\n            glGame.audio.pauseAllMusic();\r\n            this.scheduleOnce(this.changeOrientation, 1);\r\n        });\r\n    },\r\n\r\n    changeOrientation() {\r\n        glGame.platform.changeOrientation(false);\r\n    },\r\n\r\n    gameWebOpen() {\r\n        let sendData = {};\r\n        sendData.data = glGame.gameNet.getNetMgr().getLoginToken()\r\n        sendData = JSON.stringify(sendData);\r\n        this.game_web.evaluateJS(`check(${sendData})`);\r\n    },\r\n\r\n    gameWebExit() {\r\n        this.unschedule(this.changeOrientation);\r\n        this.plazaNode.active = true;\r\n        if (this.game_web != null) {\r\n            this.game_web.url = \"\";\r\n            //this.game_web.node.removeFromParent(true);\r\n            this.game_web.node.destroy();\r\n            this.game_web = null;\r\n            if (this.webview_mask) {\r\n                this.webview_mask.destroy();\r\n                this.webview_mask = null;\r\n            }\r\n            glGame.audio.continueAllMusic();\r\n            this.scheduleOnce(() => {\r\n                if (!this.game_web) glGame.gameNet.send_msg(\"http.reqBack\", {}, (route, msg) => { });\r\n            }, 1);\r\n        }\r\n    },\r\n\r\n    showFloatButton() {\r\n        let drager = document.getElementById('drager');\r\n        if(drager)\r\n            drager.style.visibility = \"visible\";\r\n    },\r\n\r\n    hideFloatButton() {\r\n        let drager = document.getElementById('drager');\r\n        if(drager)\r\n            drager.style.visibility = \"hidden\";\r\n    },\r\n\r\n    onFloatButton() {\r\n        this.hideFloatButton();\r\n        this.gameWebExit();\r\n    },\r\n\r\n    OnDestroy() {\r\n        glGame.emitter.off(\"updatePlazaSwitch\", this);\r\n        glGame.emitter.off(MESSAGE.UI.WEBVIEW_ON, this);\r\n        glGame.emitter.off(MESSAGE.UI.WEBVIEW_OFF, this);\r\n        glGame.emitter.off(\"floatButton\", this);\r\n    },\r\n});\r\n"]}