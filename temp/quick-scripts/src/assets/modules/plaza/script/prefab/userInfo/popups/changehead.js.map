{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\userInfo\\popups\\changehead.js"],"names":["glGame","baseclass","extend","properties","scrollview","cc","ScrollView","listview","Node","headItem","node_re","man","woman","onLoad","sex","user","get","isLock","resetData","headMax","emitter","on","showUI","reqGetHeadList","clickHeadItemID","getComponent","Toggle","isChecked","OnClickToggle","index","headObj","keys","Object","count","length","removeAllChildren","log","i","panel","instantiate","active","name","parent","showHeadImage","getChildByName","onClick","node","click_close","click_confirm","click_refresh","click_headItem","click_sex","indexOf","split","remove","color","dty","delayTime","cb","callFunc","runAction","sequence","showErrorTip","tips","USER","CHANGEHEAD","FAIL","reqEditHead","headURL","msg","gameNet","send_msg","route","data","userSex","emit","Number","OnDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 更新头像面板\r\n */\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        scrollview: cc.ScrollView,\r\n        listview: cc.Node,      // 头像滑动列表\r\n        headItem: cc.Node,    // 头像Item Node\r\n        node_re: cc.Node,\r\n\r\n        man: cc.Node,\r\n        woman: cc.Node,\r\n    },\r\n    onLoad() {\r\n        this.sex = glGame.user.get(\"userSex\");\r\n        this.isLock = false;\r\n        this.resetData();\r\n        this.headMax = 20;\r\n        glGame.emitter.on(\"upheadlist\", this.showUI, this);\r\n        if (glGame.user.get(\"headList\")[this.sex]) {\r\n            this.showUI(this.sex)\r\n        } else {\r\n            glGame.user.reqGetHeadList(this.sex, this.headMax);\r\n        }\r\n    },\r\n    // 初始化界面数据\r\n    resetData() {\r\n        this.clickHeadItemID = null;\r\n        if (glGame.user.get(\"userSex\") == 1) {\r\n            this.man.getComponent(cc.Toggle).isChecked = true\r\n            this.woman.getComponent(cc.Toggle).isChecked = false\r\n        } else if (glGame.user.get(\"userSex\") == 2) {\r\n            this.man.getComponent(cc.Toggle).isChecked = false\r\n            this.woman.getComponent(cc.Toggle).isChecked = true\r\n        }\r\n\r\n        this.man.on(\"toggle\", this.OnClickToggle, this);\r\n        this.woman.on(\"toggle\", this.OnClickToggle, this);\r\n    },\r\n    // 显示可替换头像\r\n    showUI(index) {\r\n        let headObj = glGame.user.get(\"headList\")[index];\r\n        let keys = Object.keys(headObj);\r\n        let count = keys.length > this.headMax ? this.headMax : keys.length;\r\n        this.listview.removeAllChildren();\r\n        cc.log(\"头像\", headObj, count);\r\n        for (let i = 0; i < count; i++) {\r\n            let panel = cc.instantiate(this.headItem);\r\n            panel.active = true;\r\n            panel.name = `head_${keys[i]}`;\r\n            panel.parent = this.listview;\r\n            glGame.panel.showHeadImage(panel.getChildByName(\"mask\").getChildByName(\"image\"), headObj[keys[i]]);\r\n            if (i == 0) this.clickHeadItemID = keys[i];\r\n        }\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"close\": this.click_close(); break;\r\n            case \"confirm\": this.click_confirm(); break;\r\n            case \"refresh\": this.click_refresh(); break;\r\n            case \"head\": this.click_headItem(node); break;\r\n            case \"man\": this.click_sex(1); break;\r\n            case \"woman\": this.click_sex(2); break;\r\n            default:\r\n                if (name.indexOf(\"head\") > -1) {\r\n                    let index = name.split(\"_\")[1];\r\n                    this.click_headItem(index)\r\n                }\r\n                break\r\n        }\r\n    },\r\n    click_sex(index) {\r\n        this.sex = index;\r\n        if (glGame.user.get(\"headList\")[index]) {\r\n            this.showUI(index);\r\n        } else {\r\n            glGame.user.reqGetHeadList(index, this.headMax);\r\n        }\r\n    },\r\n    click_close() {\r\n        this.remove();\r\n    },\r\n    click_refresh() {\r\n        if (!this.isLock) {\r\n            this.isLock = true;\r\n            this.node_re.color = cc.color(165, 139, 139);\r\n            //this.node_re.children[0].color = cc.color(165, 139, 139);\r\n            glGame.user.reqGetHeadList(this.sex, this.headMax);\r\n            let dty = cc.delayTime(3);\r\n            let cb = cc.callFunc(() => {\r\n                this.isLock = false;\r\n                this.node_re.color = cc.color(255, 255, 255);\r\n                //this.node_re.children[0].color = cc.color(255, 255, 255);\r\n            })\r\n            this.node.runAction(cc.sequence(dty, cb));\r\n        } else {\r\n            glGame.panel.showErrorTip(\"刷新太频繁，请稍后重试！\")\r\n        }\r\n    },\r\n    // 确认更换头像\r\n    click_confirm() {\r\n        if (!this.clickHeadItemID) {\r\n            return glGame.panel.showErrorTip(glGame.tips.USER.CHANGEHEAD.FAIL);\r\n        }\r\n        cc.log(\"确认更换头像\", this.clickHeadItemID);\r\n        glGame.user.reqEditHead(this.clickHeadItemID, () => {\r\n            let headObj = glGame.user.get(\"headList\")[this.sex];\r\n            glGame.user.headURL = headObj[this.clickHeadItemID]\r\n            if (this.sex != glGame.user.get(\"userSex\")) {\r\n                let msg = { \"sex\": this.sex };\r\n                glGame.gameNet.send_msg('http.reqEditMyInfo', msg, (route, data) => {\r\n                    glGame.user.userSex = this.sex;\r\n                    glGame.emitter.emit(\"updateUserData\");\r\n                })\r\n            } else glGame.emitter.emit(\"updateUserData\");\r\n            this.remove();\r\n        });\r\n    },\r\n    // 选择头像\r\n    click_headItem(index) {\r\n        this.clickHeadItemID = Number(index);\r\n    },\r\n\r\n    OnDestroy() {\r\n        glGame.emitter.off(\"upheadlist\", this);\r\n    },\r\n});\r\n"]}