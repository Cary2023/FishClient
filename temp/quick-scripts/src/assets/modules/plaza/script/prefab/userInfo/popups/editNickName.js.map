{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\userInfo\\popups\\editNickName.js"],"names":["glGame","baseclass","extend","properties","edit_nickname","cc","EditBox","onLoad","registerEvent","OnDestroy","unRegisterEvent","onClick","name","node","click_close","editNickSure_cb","console","error","remove","checkNickName","nameNum","checkStrLength","panel","showErrorTip","tips","USER","EDITINFO","LENTHLIMIT","checkEmoji","regStr","test","nickname","string","length","EMPTYNICK","NICKNAMEERROR","gameNet","send_msg","route","data","result","showTip","NICKNAME","user","emitter","emit","onEditChanged","nTextLength","nickName","i","charAt","charCodeAt","substr","str","min","max","mTextMaxlenght","arr","split"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\n/**\r\n * 修改账号登陆密码面板\r\n */\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        //修改昵称\r\n        edit_nickname: cc.EditBox,\r\n    },\r\n    onLoad () {\r\n        this.registerEvent();\r\n    },\r\n    registerEvent () {\r\n    },\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n    unRegisterEvent () {\r\n    },\r\n    onClick (name, node) {\r\n        switch (name) {\r\n            case \"btn_editNickCancel\": this.click_close(); break;\r\n            case \"btn_editNickSure\": this.editNickSure_cb(); break;\r\n            default: console.error(\"no find button name -> %s\", name);\r\n        }\r\n    },\r\n    click_close () {\r\n        this.remove();\r\n    },\r\n    // 昵称检查\r\n    checkNickName(nameNum) {\r\n        if (this.checkStrLength(nameNum, 2, 6)) {\r\n            glGame.panel.showErrorTip(glGame.tips.USER.EDITINFO.LENTHLIMIT);\r\n            return false\r\n        }\r\n        return true;\r\n    },\r\n\r\n    // emoji屏蔽昵称\r\n    checkEmoji(nameNum){\r\n        var regStr = /[\\uD83C|\\uD83D|\\uD83E][\\uDC00-\\uDFFF][\\u200D|\\uFE0F]|[\\uD83C|\\uD83D|\\uD83E][\\uDC00-\\uDFFF]|[0-9|*|#]\\uFE0F\\u20E3|[0-9|#]\\u20E3|[\\u203C-\\u3299]\\uFE0F\\u200D|[\\u203C-\\u3299]\\uFE0F|[\\u2122-\\u2B55]|\\u303D|[\\A9|\\AE]\\u3030|\\uA9|\\uAE|\\u3030/gi;\r\n        if (regStr.test(nameNum))return true;\r\n        return false;\r\n    },\r\n\r\n    editNickSure_cb() {\r\n        let nickname = this.edit_nickname.string;\r\n        if(nickname.length == 0) {\r\n            glGame.panel.showErrorTip(glGame.tips.USER.EDITINFO.EMPTYNICK);\r\n            return;\r\n        }\r\n        if (this.checkEmoji(nickname)){\r\n            glGame.panel.showErrorTip(glGame.tips.USER.EDITINFO.NICKNAMEERROR);\r\n            return;\r\n        }\r\n\r\n        //if(this.checkNickName(nickname)){\r\n            glGame.gameNet.send_msg('http.reqEditMyInfo', { nickname: nickname }, (route, data) => {\r\n                if (data.result) {\r\n                    glGame.panel.showTip(glGame.tips.USER.EDITINFO.NICKNAME);\r\n                    glGame.user.nickname = nickname;\r\n                    glGame.emitter.emit(\"updateUserData\");\r\n                } else {\r\n                    glGame.panel.showTip(`${data}`);\r\n                }\r\n                this.remove();\r\n            })\r\n        //}\r\n    },\r\n    onEditChanged() {\r\n        let nTextLength = 0;\r\n        let nickName = this.edit_nickname.string;\r\n        for(let i = 0; i < nickName.length; i++) {\r\n            let charAt = nickName[i].charCodeAt();\r\n\r\n            if (charAt >= 32 && charAt <= 122) {\r\n                nTextLength++;\r\n            } else {\r\n                nTextLength += 2;\r\n            }\r\n\r\n            if(nTextLength > 12) {\r\n                this.edit_nickname.string = nickName.substr(0, i);\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    //检查中文和英文混合的字符长度\r\n    checkStrLength(str, min, max) {\r\n        let mTextMaxlenght = 0;\r\n        let arr = str.split(\"\");\r\n        for (let i = 0; i < arr.length; i++) {\r\n            let charAt = arr[i].charCodeAt();\r\n            //32-122包含了空格，大小写字母，数字和一些常用的符号，\r\n            //如果在这个范围内则算一个字符，\r\n            //如果不在这个范围比如是汉字的话就是两个字符\r\n            if (charAt >= 32 && charAt <= 122) {\r\n                mTextMaxlenght++;\r\n            } else {\r\n                mTextMaxlenght += 2;\r\n            }\r\n        }\r\n        return mTextMaxlenght < min || mTextMaxlenght > max\r\n    },\r\n});"]}