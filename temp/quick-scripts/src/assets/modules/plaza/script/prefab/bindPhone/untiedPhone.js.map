{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\bindPhone\\untiedPhone.js"],"names":["glGame","baseclass","extend","properties","label_untied","cc","Node","edit_untiedCode","EditBox","node_untiedSend","label_untiedCD","Label","btn_send","Button","onLoad","registerEvent","user","untiedCodeState","untiedVerifiCD","UntiedCode","start","phoneStr","get","toString","new_str","i","length","valueNum","getSelfFunc","setString","emitter","on","unRegisterEvent","off","OnDestroy","onClick","name","node","close","untiedSure_cb","untiedSend_cb","phone","code","string","panel","showErrorTip","tips","USER","EDITINFO","UNCODE","gameNet","send_msg","route","msg","showTip","BIND","UNTIED","emit","clearUntiedInterval","reqUntiedCode","type","getComponent","interactable","getChildByName","active","children","remove","checkPhone","acc","REGISTRATION","PHONENULL","reg","isacc_matcher","test","PHONETYPE","cutFloat","num","Number","div"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n    properties: {\r\n        //解绑手机\r\n        label_untied: cc.Node,\r\n        edit_untiedCode: cc.EditBox,\r\n        node_untiedSend: cc.Node,\r\n        label_untiedCD: cc.Label,\r\n        btn_send: cc.Button,\r\n    },\r\n    onLoad() {\r\n        this.registerEvent();\r\n        \r\n        if (glGame.user.untiedCodeState && glGame.user.untiedVerifiCD > 0) this.UntiedCode(glGame.user.untiedVerifiCD);\r\n    },\r\n\r\n    start() {\r\n        let phoneStr = glGame.user.get(\"phone\").toString();\r\n        let new_str = '';\r\n        for (let i = 0; i < phoneStr.length; i++) {\r\n            let valueNum = phoneStr[i];\r\n            if (i > 2 && i < 8) {\r\n                valueNum = '*';\r\n            }\r\n            new_str += valueNum\r\n        }\r\n        this.label_untied.getSelfFunc().setString(glGame.user.get(\"phone\") ? new_str : \"\");\r\n    },\r\n    registerEvent() {\r\n        glGame.emitter.on(\"UntiedCode\", this.UntiedCode, this);\r\n    },\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(\"UntiedCode\", this);\r\n    },\r\n\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"close\": this.close(); break;\r\n            case \"btn_untiedSure\": this.untiedSure_cb(); break;\r\n            case \"btn_untiedSend\": this.untiedSend_cb(); break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    untiedSure_cb() {\r\n        let phone = glGame.user.get(\"phone\").toString();\r\n        let code = this.edit_untiedCode.string;\r\n        this.edit_untiedCode.string = '';\r\n        if (!code || code == '') return glGame.panel.showErrorTip(glGame.tips.USER.EDITINFO.UNCODE);\r\n        glGame.gameNet.send_msg('http.ReqUntyingPhone', { phone: phone, code: code }, (route, msg) => {\r\n            glGame.panel.showTip(glGame.tips.USER.BIND.UNTIED);\r\n            glGame.user.phone = ''\r\n            glGame.emitter.emit(\"updateUserData\");\r\n            glGame.emitter.emit('updatePlazaSwitch');\r\n            glGame.user.clearUntiedInterval();\r\n            this.UntiedCode(0);\r\n\r\n            this.close();\r\n        });\r\n    },\r\n\r\n    //解绑手机\r\n    untiedSend_cb() {\r\n        let phone = glGame.user.get(\"phone\").toString();\r\n        glGame.user.reqUntiedCode({ phone: phone, type: 10 })\r\n    },\r\n\r\n    UntiedCode(msg) {\r\n        if (glGame.user.get(\"untiedCodeState\") && msg > 0) {            //解绑手机验证码倒计时\r\n            this.node_untiedSend.getComponent(cc.Button).interactable = false;\r\n            this.btn_send.node.getChildByName(\"img_liang\").active = false;\r\n            this.btn_send.node.getChildByName(\"img_an\").active = true;\r\n            this.node_untiedSend.children[0].active = false;\r\n            this.node_untiedSend.children[1].active = true;\r\n            this.label_untiedCD.node.active = true;\r\n            this.node_untiedSend.getChildByName(\"img_fasong\").active = false;\r\n            this.label_untiedCD.string = `${msg}秒`;\r\n        } else {\r\n            this.node_untiedSend.getComponent(cc.Button).interactable = true;\r\n            this.btn_send.node.getChildByName(\"img_liang\").active = true;\r\n            this.btn_send.node.getChildByName(\"img_an\").active = false;\r\n            this.node_untiedSend.children[0].active = true;\r\n            this.node_untiedSend.children[1].active = false;\r\n        }\r\n    },\r\n\r\n    close() {\r\n        this.remove()\r\n    },\r\n\r\n    // 手机号码检查\r\n    checkPhone(acc) {\r\n        if (!acc) {\r\n            glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONENULL);\r\n            return null;\r\n        }\r\n\r\n        //let reg = /^\\d{11}$/; //验证规则\r\n        var reg = /^134[0-8]\\d{7}$|^13[^4]\\d{8}$|^14[5-9]\\d{8}$|^15[^4]\\d{8}$|^16[6]\\d{8}$|^17[0-8]\\d{8}$|^18[\\d]{9}$|^19[0-9]\\d{8}$/;\r\n        let isacc_matcher = reg.test(acc);\r\n        if (!isacc_matcher) {\r\n            glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONETYPE);\r\n            return false;\r\n        }\r\n        return acc;\r\n    },\r\n\r\n\r\n    //浮点型运算取俩位\r\n    cutFloat(num) {\r\n        return (Number(num).div(100)).toString();\r\n    },\r\n});\r\n"]}