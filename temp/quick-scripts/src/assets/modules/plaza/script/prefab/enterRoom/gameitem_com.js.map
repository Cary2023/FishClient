{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\enterRoom\\gameitem_com.js"],"names":["BGCOLOR","BLUE","ORANGE","GREEN","RED","PURPLE","CORNER_MARK","glGame","baseclass","extend","properties","game_icon","cc","Node","game_name","Label","pic_downloadBg","Sprite","processNew","progressPic","cornerMark","atlas_corner_mark","SpriteAtlas","atlas_game_icon","onLoad","emitter","on","roomEntrance","hotUIRefresh","gameid","gameID","console","log","onClick","initUI","gameList","id","gameName","scene","getSceneNameByID","string","tag","spriteFrame","getSpriteFrame","node","getChildByName","getComponent","active","processState","newMaterial","Material","createWithBuiltin","BUILTIN_NAME","GRAY_SPRITE","setMaterial","icon","url","user","get","resource_url","panel","showRemoteImage","gameIsHotStatus","set","key","value","name","gamelistcfg","openTripartiteGame","gamesList","type","onEnterGame","sys","isNative","is_update_queue","assetsManager","isBeingUpdate","data","isActive","isStatus","isNeedUpdate","schedule","fillRange","parseInt","process","OnDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 大厅子游戏图标通用脚本\r\n */\r\nconst BGCOLOR = {\r\n    BLUE: 0,\r\n    ORANGE: 1,\r\n    GREEN: 2,\r\n    RED: 3,\r\n    PURPLE: 4,\r\n}\r\nconst CORNER_MARK = {\r\n    0: \"维护\",\r\n    1: \"推荐\",\r\n    2: \"火爆\",\r\n    3: \"最新\",\r\n}\r\nglGame.baseclass.extend({\r\n    properties: {\r\n        game_icon: cc.Node,\r\n        game_name: cc.Label,\r\n        pic_downloadBg: cc.Sprite,\r\n        processNew: cc.Node,\r\n        progressPic: cc.Sprite,\r\n        cornerMark: cc.Sprite,\r\n\r\n        atlas_corner_mark: cc.SpriteAtlas,\r\n        atlas_game_icon: cc.SpriteAtlas,\r\n    },\r\n\r\n    onLoad() {\r\n        glGame.emitter.on(\"roomEntrance\", this.roomEntrance, this);\r\n        glGame.emitter.on(\"hotUIRefresh\", this.hotUIRefresh, this);\r\n    },\r\n\r\n    roomEntrance(gameid) {\r\n        if (gameid == this.gameID) {\r\n            console.log(\"gameitem_com , 进入游戏监听===》\", gameid);\r\n            this.onClick();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 初始化图标状态\r\n     */\r\n    initUI(gameList) {\r\n        this.gameList = gameList;\r\n        this.gameID = gameList.id;\r\n        this.gameName = glGame.scene.getSceneNameByID(this.gameID);\r\n\r\n        // if (!this.gameName) return this.node.active = false;                          //临时措施，PHP已给游戏，客户端还未完成\r\n\r\n        this.game_name.string = this.gameList.gameName; // 设置游戏名称\r\n        // this.game_name._forceUpdateRenderData();\r\n        // console.log(\"this.game_name 2222 ===> \", this.game_name.node, this.game_name.node.width);\r\n        if (this.gameList.tag > 0) {    //设置角标\r\n            this.cornerMark.spriteFrame = this.atlas_corner_mark.getSpriteFrame(`img_corner_mark${this.gameList.tag}`);\r\n            this.cornerMark.node.getChildByName(\"txt\").getComponent(cc.Label).string = CORNER_MARK[this.gameList.tag];\r\n            this.cornerMark.node.active = true;\r\n        }\r\n\r\n        if (this.gameList.processState == 2) {\r\n            this.cornerMark.spriteFrame = this.atlas_corner_mark.getSpriteFrame(\"img_corner_mark0\");\r\n            this.cornerMark.node.getChildByName(\"txt\").getComponent(cc.Label).string = CORNER_MARK[0];\r\n            this.cornerMark.node.active = true;\r\n            let newMaterial = cc.Material.createWithBuiltin(cc.Material.BUILTIN_NAME.GRAY_SPRITE, 0);\r\n            this.game_icon.getComponent(cc.Sprite).setMaterial(0, newMaterial); //给精灵添加新材质\r\n        }\r\n        \r\n        // 加载游戏图片\r\n        if (this.gameID < 10000) {\r\n            this.game_icon.getComponent(cc.Sprite).spriteFrame = this.atlas_game_icon.getSpriteFrame(`icon_${this.gameID}`);\r\n        } else {\r\n            if (this.gameList.icon) {\r\n                let url = glGame.user.get('url').resource_url;\r\n                glGame.panel.showRemoteImage(this.game_icon, url + this.gameList.icon);\r\n            }\r\n        }\r\n\r\n        if (this.gameID < 10000) {\r\n            this.gameIsHotStatus();\r\n        }\r\n    },\r\n\r\n    set(key, value) {\r\n        this[key] = value;\r\n    },\r\n    \r\n    // 按钮点击事件\r\n    onClick(name, node) {\r\n        console.log(\"点击了游戏\", this.gameID);\r\n        // 打开三方游戏\r\n        if (this.gameID > 9999) {\r\n            // if (!isEnableHotUpdate) return;\r\n            glGame.gamelistcfg.openTripartiteGame({ gamesList: this.gameList, type: 1 });\r\n            return;\r\n        }\r\n\r\n        // 打开自己游戏\r\n        glGame.gamelistcfg.onEnterGame(this.gameID, false);\r\n\r\n        // // 查找是否需要更新\r\n        // glGame.gamelistcfg.isNeedUpdate(this.gameID).then(bol => {\r\n        //     console.log(\"开始进入游戏\", bol);\r\n        //     // 需要更新\r\n        //     if (bol) glGame.gamelistcfg.setGameUpdate(this.gameName, false);\r\n        //     console.log(\"打开自己游戏=====>\")\r\n        //     // 打开自己游戏\r\n        //     glGame.gamelistcfg.onEnterGame(this.gameID);\r\n        // });\r\n    },\r\n\r\n    // 判断游戏是否在热更\r\n    gameIsHotStatus() {\r\n        if (!cc.sys.isNative) return;\r\n        // 检查当前是否有游戏正在跟新\r\n        let is_update_queue = glGame.assetsManager.isBeingUpdate(this.gameName);\r\n        if (is_update_queue != null) {\r\n            let data = {gameName:this.gameName, isActive:true}\r\n            if (is_update_queue) {\r\n                data.isStatus = 0;\r\n            }\r\n            this.hotUIRefresh(data);\r\n        } else {\r\n            // 查找是否需要更新\r\n            glGame.assetsManager.isNeedUpdate(this.gameName);\r\n        }\r\n    },\r\n\r\n    // 热更刷新UI\r\n    hotUIRefresh(data) {\r\n        if (data.gameName == this.gameName) {\r\n            // 黑色遮罩\r\n            this.pic_downloadBg.node.active = data.isActive;\r\n            // 进度条\r\n            this.processNew.active = data.isActive;\r\n            // 显示下载进度\r\n            let schedule = this.processNew.getChildByName(\"label\").getComponent(cc.Label)\r\n            switch (data.isStatus) {\r\n                case 0:\r\n                    // 热更接续\r\n                    schedule.string = \"0%\";\r\n                    this.progressPic.fillRange = 0;\r\n                    break;\r\n                case 1:\r\n                    // 下载中\r\n                    schedule.string = `${parseInt(data.process * 100) || 0}%`;\r\n                    this.progressPic.fillRange = data.process;\r\n                    break;\r\n                default:\r\n                    // 下载列表大于最大同时下载量的时候显示等待中\r\n                    schedule.string = \"等待中\";\r\n                    this.progressPic.fillRange = 0;\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    OnDestroy() {\r\n        glGame.emitter.off(\"roomEntrance\", this);\r\n        glGame.emitter.off(\"hotUIRefresh\", this);\r\n    }\r\n});\r\n"]}