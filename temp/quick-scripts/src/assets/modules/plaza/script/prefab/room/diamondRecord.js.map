{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\room\\diamondRecord.js"],"names":["glGame","baseclass","extend","properties","norecord","cc","Node","content","item","labPage","Label","onLoad","PageIndex","pageCount","recordList","registerEvent","reqDiamondTransactionRecord","unRegisterEvent","OnDestroy","onClick","name","node","remove","lastPage_cb","nextPage_cb","console","error","panel","showTip","msg","page","pageSize","log","initRecordUI","gameNet","send_msg","route","data","result","totalPage","list","removeAllChildren","count","length","active","hiadShowNode","string","i","instantiate","getChildByName","parent","timeStamp","Date","createTime","strTime","getFullYear","getMonth","getDate","tips","WEEKNAME","getDay","getHours","getMinutes","getSeconds","getComponent","typeDes","diamondNum","diamondIncome","diamondExpenses","getFixNumber","color","value","value1","Number","div","isNaN","toString","toFixed","isBool"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n    properties: {\r\n        norecord: cc.Node,\r\n        content: cc.Node,\r\n        item: cc.Node,\r\n        labPage: cc.Label,\r\n    },\r\n    onLoad() {\r\n        this.PageIndex = 1;\r\n        this.pageCount = 1;\r\n        this.recordList = {};\r\n        this.registerEvent();\r\n        this.reqDiamondTransactionRecord();\r\n    },\r\n    registerEvent() {\r\n    },\r\n    unRegisterEvent() {\r\n    },\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"btn_close\": this.remove(); break;\r\n            case \"btn_lastPage\": this.lastPage_cb(); break;\r\n            case \"btn_nextPage\": this.nextPage_cb(); break;\r\n            default: console.error(\"no find button name -> %s\", name);\r\n        }\r\n    },\r\n\r\n    lastPage_cb() {\r\n        if (this.PageIndex == 1 || this.PageIndex == 0) return glGame.panel.showTip(\"已经是第一页了！\")\r\n        this.PageIndex--;\r\n        this.reqDiamondTransactionRecord();\r\n    },\r\n\r\n    nextPage_cb() {\r\n        if (this.PageIndex >= this.pageCount || this.PageIndex == 0) return glGame.panel.showTip(\"已经是最后一页了！\")\r\n        this.PageIndex++;\r\n        this.reqDiamondTransactionRecord();\r\n    },\r\n\r\n    reqDiamondTransactionRecord() {\r\n        let msg = {};\r\n        msg.page = this.PageIndex;\r\n        msg.pageSize = 8;\r\n        console.log(this.recordList, \"this.recordList\");\r\n        if (this.recordList[this.PageIndex]) {\r\n            this.initRecordUI(this.recordList[this.PageIndex]);\r\n        } else {\r\n            glGame.gameNet.send_msg('http.ReqDiamondTransactionRecord', msg, (route, data) => {\r\n                let result = data.result;\r\n                this.pageCount = result.totalPage;\r\n                this.recordList ? null : this.recordList = {};\r\n                this.recordList[this.PageIndex] = result.data;\r\n                this.initRecordUI(result.data);\r\n            })\r\n        }\r\n\r\n    },\r\n\r\n    //渲染牌局记录\r\n    initRecordUI(list) {\r\n        this.content.removeAllChildren();\r\n        // if (list.length == 0) {\r\n        //     this.labPage.string = '第0/0页';\r\n        //     return;\r\n        // }\r\n        let count = list.length;\r\n        if (count == 0) {\r\n            this.norecord.active = true;\r\n            return;\r\n        }\r\n        this.hiadShowNode(count > 0);\r\n\r\n        this.labPage.string = `第${this.PageIndex}/${this.pageCount}页`;\r\n        for (let i = 0; i < list.length; i++) {\r\n            let node = cc.instantiate(this.item);\r\n            node.getChildByName(\"bg\").active = i % 2 != 0;\r\n            node.parent = this.content;\r\n            node.active = true;\r\n\r\n            let timeStamp = new Date(list[i].createTime * 1000);\r\n            let strTime = `${timeStamp.getFullYear()}/${timeStamp.getMonth() + 1 >= 10 ? timeStamp.getMonth() + 1 : \"0\" + (timeStamp.getMonth() + 1)}/${timeStamp.getDate() >= 10 ? timeStamp.getDate() : '0' + timeStamp.getDate()}`\r\n            strTime += `（${glGame.tips.WEEKNAME[timeStamp.getDay()]}）`\r\n            strTime += `${timeStamp.getHours() >= 10 ?timeStamp.getHours(): \"0\" + timeStamp.getHours()}:`\r\n            strTime += `${timeStamp.getMinutes() >= 10 ?timeStamp.getMinutes(): \"0\" + timeStamp.getMinutes()}:`\r\n            strTime += `${timeStamp.getSeconds() >= 10 ?timeStamp.getSeconds(): \"0\" + timeStamp.getSeconds()}`\r\n            node.getChildByName(\"time\").getComponent(cc.Label).string = strTime;\r\n            node.getChildByName(\"type\").getComponent(cc.Label).string = list[i].typeDes;\r\n            let diamondNum = 0;\r\n            diamondNum += list[i].diamondIncome;\r\n            diamondNum -= list[i].diamondExpenses;\r\n            node.getChildByName(\"diamond\").getComponent(cc.Label).string = this.getFixNumber(diamondNum);\r\n            node.getChildByName(\"diamond\").color = diamondNum > 0 ? cc.color(0x66, 0x90, 0xcc) : cc.color(0xf4, 0xc4, 0x04);\r\n        }\r\n    },\r\n    getFixNumber(value) {\r\n        let value1 = Number(value).div(10);\r\n        value = Number(value).div(100);\r\n        if (isNaN(value)) return;\r\n        if (~~value === value) {\r\n            return value.toString();\r\n        } else if (~~value1 === value1) {\r\n            return value.toFixed(1);\r\n        } else {\r\n            return value.toFixed(2);\r\n        }\r\n    },\r\n    hiadShowNode(isBool) {\r\n        this.node.getChildByName(\"btn_lastPage\").active = isBool;\r\n        this.node.getChildByName(\"btn_nextPage\").active = isBool;\r\n        this.node.getChildByName(\"pageIndex\").active = isBool;\r\n        this.node.getChildByName(\"downtips\").active = isBool;\r\n    },\r\n});\r\n"]}