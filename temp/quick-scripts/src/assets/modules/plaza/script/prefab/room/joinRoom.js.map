{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\room\\joinRoom.js"],"names":["glGame","baseclass","extend","properties","lab_roomid","cc","Label","labDiamonds","onLoad","registerEvent","index","indexMax","indexMin","updataInfo","start","emitter","on","getGameIdByRoomNum","roomgameupdateend","MESSAGE","UI","REFRESH_ROOM_NUM","click_numclose","unRegisterEvent","off","string","getFixNumber","user","get","msg","gameId","assetsManager","isUpdateQueue","gamelistcfg","isNeedUpdate","then","bol","panel","showTip","room","getGameDictById","gameName","scene","getSceneNameByID","setGameUpdate","gameUpdata","gameID","manifestUrl","remove","EnterRoomCheck","onClick","name","node","click_numreturn","showPanelByName","indexOf","click_number","event","type","audio","playLoadSoundEffectByPath","target","text","substring","numStr","key","roomNum","Math","min","max","value","value1","Number","div","isNaN","toString","toFixed","OnDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n\r\n    properties: {\r\n        lab_roomid: [cc.Label],\r\n        labDiamonds: cc.Label,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    onLoad() {\r\n        this.registerEvent();\r\n        this.index = 0;\r\n        this.indexMax = 5;\r\n        this.indexMin = 0;\r\n        this.updataInfo();\r\n    },\r\n    start() {\r\n    },\r\n\r\n    // 注册界面监听事件\r\n    registerEvent() {\r\n        glGame.emitter.on(\"updateUserData\", this.updataInfo, this);\r\n        glGame.emitter.on(\"getGameIdByRoomNum\", this.getGameIdByRoomNum, this);\r\n        glGame.emitter.on(\"roomgameupdateend\", this.roomgameupdateend, this);\r\n        glGame.emitter.on(MESSAGE.UI.REFRESH_ROOM_NUM, this.click_numclose, this);\r\n    },\r\n    // 销毁界面监听事件\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(\"updateUserData\", this);\r\n        glGame.emitter.off(\"getGameIdByRoomNum\", this);\r\n        glGame.emitter.off(\"roomgameupdateend\", this);\r\n        glGame.emitter.off(MESSAGE.UI.REFRESH_ROOM_NUM, this);\r\n    },\r\n\r\n    //刷新钻石数量\r\n    updataInfo() {\r\n        this.labDiamonds.string = this.getFixNumber(glGame.user.get(\"diamond\"));\r\n    },\r\n\r\n    getGameIdByRoomNum(msg) {\r\n        this.gameId = msg.gameId;\r\n        // 检查当前游戏是否已经在更新队列\r\n        if (glGame.assetsManager.isUpdateQueue(this.gameId)) return;\r\n\r\n        // 检查游戏是否需要更新\r\n        glGame.gamelistcfg.isNeedUpdate(this.gameId).then(bol => {\r\n            if (bol) {\r\n                // 开始更新【%s(游戏名称)】，请耐心等待...\r\n                glGame.panel.showTip(`开始更新【${glGame.room.getGameDictById(this.gameId)}】，请耐心等待...`);\r\n                let gameName = glGame.scene.getSceneNameByID(this.gameId);\r\n                glGame.gamelistcfg.setGameUpdate(gameName, false);\r\n                glGame.assetsManager.gameUpdata({gameID: this.gameId, manifestUrl: null});\r\n                this.remove();\r\n            } else {\r\n                glGame.room.EnterRoomCheck();\r\n            }\r\n        });\r\n    },\r\n\r\n    roomgameupdateend() {\r\n        glGame.room.EnterRoomCheck();\r\n    },\r\n\r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"btn_close\": this.remove(); break;\r\n            case \"btn_numclose\": this.click_numclose(); break;\r\n            case \"btn_numreturn\": this.click_numreturn(); break;\r\n            case \"btn_add\": glGame.panel.showPanelByName(\"exchangeDiamond\"); break;\r\n            default:\r\n                if (name.indexOf(\"btn_num\") > -1) return this.click_number(name);\r\n                break;\r\n        }\r\n    },\r\n\r\n    click_number(event, type) {\r\n        glGame.audio.playLoadSoundEffectByPath(\"click\");\r\n        if (this.index > this.indexMax) return;\r\n\r\n        let name = event.target.name;\r\n        let text = name.substring(7);\r\n        this.lab_roomid[this.index++].string = text;\r\n\r\n        if (this.index > this.indexMax) {\r\n            // TODO 进入游戏\r\n            let numStr = \"\";\r\n            for (let key in this.lab_roomid) numStr += this.lab_roomid[key].string;\r\n            glGame.room.getGameIdByRoomNum({ roomNum: numStr });\r\n        };\r\n    },\r\n\r\n    click_numclose() {\r\n        glGame.audio.playLoadSoundEffectByPath(\"click\");\r\n        if (this.index <= this.indexMin) return;\r\n        this.index = this.indexMin;\r\n        for (let key in this.lab_roomid) {\r\n            this.lab_roomid[key].string = \"\";\r\n        }\r\n    },\r\n\r\n    click_numreturn() {\r\n        glGame.audio.playLoadSoundEffectByPath(\"click\");\r\n        this.index = Math.min(this.index, this.indexMax);\r\n        if (this.lab_roomid[this.index].string == \"\") this.index = Math.max(this.index - 1, this.indexMin);\r\n        this.lab_roomid[this.index].string = \"\";\r\n    },\r\n\r\n    getFixNumber(value) {\r\n        let value1 = Number(value).div(10);\r\n        value = Number(value).div(100);\r\n        if (isNaN(value)) return;\r\n        if (~~value === value) {\r\n            return value.toString();\r\n        } else if (~~value1 === value1) {\r\n            return value.toFixed(1);\r\n        } else {\r\n            return value.toFixed(2);\r\n        }\r\n    },\r\n\r\n\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n\r\n})"]}