{"version":3,"sources":["assets\\modules\\plaza\\script\\prefab\\bindPhone\\bindPhone.js"],"names":["glGame","baseclass","extend","properties","edit_bindPhoneNumber","cc","EditBox","edit_bindPhoneCode","btn_send","Button","pic_send","Node","lab_phoneCd","Label","audio","type","AudioClip","onLoad","registerEvent","playSoundEffect","user","bindPhoneCodeState","bindPhoneVerifiCD","bindPhoneCodeCD","start","emitter","on","unRegisterEvent","off","OnDestroy","onClick","name","node","click_sendVerfic","bindPhoneSure_cb","remove","phone","checkPhone","string","reqBindPhoneCode","msg","get","interactable","getChildByName","active","panel","showErrorTip","tips","REGISTRATION","VERIFICAEMPTY","code","reg","verif","test","Number","VERIFICA","gameNet","send_msg","route","result","isReceive","is_receive_register_phone_coin","showAwardBox","USER","BIND","CONGRATULATE","awardtype","COIN","value","cutFloat","bindPhoneFirst","emit","showTip","PHONE","acc","PHONENULL","length","PHONETYPE","isacc_matcher","INVALIDPHONE","num","div","toString"],"mappings":"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","sourceRoot":"/","sourcesContent":["glGame.baseclass.extend({\r\n    properties: {\r\n        //绑定手机\r\n        edit_bindPhoneNumber: cc.EditBox,\r\n        edit_bindPhoneCode: cc.EditBox,\r\n\r\n        btn_send: cc.Button,\r\n        pic_send: cc.Node,\r\n        lab_phoneCd: cc.Label,\r\n        audio: {\r\n            type: cc.AudioClip,\r\n            default: null\r\n        },\r\n    },\r\n    onLoad() {\r\n        this.registerEvent();\r\n        glGame.audio.playSoundEffect(this.audio)\r\n        if (glGame.user.bindPhoneCodeState && glGame.user.bindPhoneVerifiCD > 0) this.bindPhoneCodeCD(glGame.user.bindPhoneVerifiCD);\r\n    },\r\n\r\n    start() {\r\n    },\r\n    registerEvent() {\r\n        glGame.emitter.on(\"bindPhoneCodeCD\", this.bindPhoneCodeCD, this);\r\n    },\r\n    unRegisterEvent() {\r\n        glGame.emitter.off(\"bindPhoneCodeCD\", this);\r\n    },\r\n\r\n    OnDestroy() {\r\n        this.unRegisterEvent();\r\n    },\r\n    \r\n    onClick(name, node) {\r\n        switch (name) {\r\n            case \"btn_bindPhoneSend\": this.click_sendVerfic(); break;\r\n            case \"btn_bindPhoneSure\": this.bindPhoneSure_cb(); break;\r\n            case \"close\": this.remove(); break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n    click_sendVerfic() {\r\n        let phone = this.checkPhone(this.edit_bindPhoneNumber.string)\r\n        if (!phone) return;\r\n        glGame.user.reqBindPhoneCode({ phone: phone, type: 1 });\r\n    },\r\n\r\n    bindPhoneCodeCD(msg) {\r\n        if (glGame.user.get(\"bindPhoneCodeState\") && msg > 0) {              //绑定手机验证码倒计时\r\n            this.btn_send.interactable = false;\r\n            this.btn_send.node.getChildByName(\"img_liang\").active = false;\r\n            this.btn_send.node.getChildByName(\"img_an\").active = true;\r\n            this.pic_send.active = false;\r\n            this.lab_phoneCd.node.active = true;\r\n            this.lab_phoneCd.string = `${msg}秒`;\r\n        } else {\r\n            this.btn_send.node.getChildByName(\"img_liang\").active = true;\r\n            this.btn_send.node.getChildByName(\"img_an\").active = false;\r\n            this.btn_send.interactable = true;\r\n            this.pic_send.active = true;\r\n            this.lab_phoneCd.node.active = false;\r\n        }\r\n    },\r\n\r\n    bindPhoneSure_cb() {\r\n\r\n        let phone = this.checkPhone(this.edit_bindPhoneNumber.string)       //绑定手机确定\r\n        if (!phone) return;\r\n        if (this.edit_bindPhoneCode.string == \"\")return glGame.panel.showErrorTip(glGame.tips.REGISTRATION.VERIFICAEMPTY);\r\n        let code = this.edit_bindPhoneCode.string;\r\n        let reg = /^[0-9]{0,6}$/;//验证规则\r\n        let verif = reg.test(Number(this.edit_bindPhoneCode.string));\r\n        if (!verif) {\r\n            return glGame.panel.showErrorTip(glGame.tips.REGISTRATION.VERIFICA);\r\n        }\r\n        // this.edit_untiedCode.string='';\r\n        glGame.gameNet.send_msg('http.reqBindPhone', { phone: phone, code: code }, (route, msg) => {\r\n            if (msg.result) {\r\n                glGame.user.phone = phone\r\n                if (msg.isReceive == true && glGame.user.is_receive_register_phone_coin == 0 && Number(glGame.user.get('bind_phone_gold')) > 0) {\r\n                    glGame.user.is_receive_register_phone_coin = 1;\r\n                    glGame.panel.showAwardBox(glGame.tips.USER.BIND.CONGRATULATE, [{ type: glGame.awardtype.COIN, value: this.cutFloat(Number(glGame.user.get('bind_phone_gold')))}]);\r\n                }\r\n                glGame.user.bindPhoneFirst = 1;\r\n                glGame.emitter.emit(\"updateUserData\");\r\n                glGame.emitter.emit('updatePlazaSwitch');\r\n                this.bindPhoneCodeCD(0);\r\n\r\n                glGame.panel.showTip(glGame.tips.USER.BIND.PHONE);\r\n                this.remove()\r\n            }\r\n        })\r\n    },\r\n\r\n    // 手机号码检查\r\n    checkPhone(acc) {\r\n        if (!acc) {\r\n            glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONENULL);\r\n            return null;\r\n        }\r\n\r\n        if (acc.length != 11) {\r\n            glGame.panel.showErrorTip(glGame.tips.REGISTRATION.PHONETYPE);\r\n            return false\r\n        }\r\n        //let reg = /^\\d{11}$/; //验证规则\r\n        var reg = /^134[0-8]\\d{7}$|^13[^4]\\d{8}$|^14[5-9]\\d{8}$|^15[^4]\\d{8}$|^16[6]\\d{8}$|^17[0-8]\\d{8}$|^18[\\d]{9}$|^19[0-9]\\d{8}$/;\r\n        let isacc_matcher = reg.test(acc);\r\n        if (!isacc_matcher) {\r\n            glGame.panel.showErrorTip(glGame.tips.USER.BIND.INVALIDPHONE);\r\n            return false;\r\n        }\r\n        return acc;\r\n    },\r\n\r\n\r\n    //浮点型运算取俩位\r\n    cutFloat(num) {\r\n        return (Number(num).div(100)).toString();\r\n    },\r\n});\r\n"]}