{"version":3,"sources":["assets\\modules\\public\\script\\control\\webview-impl.js"],"names":["_mat4_temp","cc","mat4","WebViewImplEx","Class","ctor","_EventList","_visible","_parent","_div","_iframe","_listener","_forceUpdate","_m00","_m01","_m04","_m05","_m12","_m13","_w","_h","__eventListeners","_updateVisibility","div","style","visibility","_updateSize","w","h","width","height","_initEvent","iframe","cbs","self","load","_dispatchEvent","EventType","LOADED","error","ERROR","_initStyle","position","bottom","left","_setOpacity","opacity","_createDom","_polyfill","enableDiv","document","createElement","appendChild","enableBG","overflow","border","game","container","_createNativeControl","createDomElementIfNeeded","CC_EDITOR","background","color","removeDom","hasChild","contains","removeChild","removeEventListener","setOnJSCallback","callback","setJavascriptInterfaceScheme","scheme","loadData","data","MIMEType","encoding","baseURL","loadHTMLString","string","loadURL","url","innerText","src","cb","_loaded","LOADING","stopLoading","logID","reload","win","contentWindow","location","canGoBack","canGoForward","goBack","closeHistory","history","back","call","err","log","goForward","forward","evaluateJS","str","eval","JS_EVALUATED","console","setScalesPageToFit","setEventListener","event","_createRenderCmd","WebViewImpl","RenderCmd","destroy","setVisible","visible","updateMatrix","node","getWorldMatrix","renderCamera","Camera","_findRendererCamera","worldMatrixToScreen","canvas","_mat4_tempm","m","_contentSize","dpr","view","_devicePixelRatio","scaleX","scaleY","a","b","c","d","offsetX","paddingLeft","parseInt","offsetY","paddingBottom","appx","_anchorPoint","x","appy","y","tx","ty","matrix","refNode","otherNode","compareDocumentPosition","parentNode","polyfill","devicePixelRatio","sys","os","OS_IOS","isMobile","browserType","BROWSER_TYPE_FIREFOX","BROWSER_TYPE_IE","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["/****************************************************************************\r\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n ****************************************************************************/\r\n\r\nlet _mat4_temp = cc.mat4();\r\n\r\nlet WebViewImplEx = cc.Class({\r\n    ctor () {\r\n        // this.setContentSize(cc.size(300, 200));\r\n        this._EventList = {};\r\n\r\n        this._visible = false;\r\n        this._parent = null;\r\n        this._div = null;\r\n        this._iframe = null;\r\n        this._listener = null;\r\n        this._forceUpdate = false;\r\n\r\n        // update matrix cache\r\n        this._m00 = 0;\r\n        this._m01 = 0;\r\n        this._m04 = 0;\r\n        this._m05 = 0;\r\n        this._m12 = 0;\r\n        this._m13 = 0;\r\n        this._w = 0;\r\n        this._h = 0;\r\n        //\r\n        this.__eventListeners = {};\r\n    },\r\n\r\n    _updateVisibility () {\r\n        if (!this._div) return;\r\n        let div = this._div;\r\n        if (this._visible) {\r\n            div.style.visibility = 'visible';\r\n        }\r\n        else {\r\n            div.style.visibility = 'hidden';\r\n        }\r\n    },\r\n\r\n    _updateSize (w, h) {\r\n        let div = this._div;\r\n        if (div) {\r\n            div.style.width = w + \"px\";\r\n            div.style.height = h + \"px\";\r\n        }\r\n    },\r\n\r\n    _initEvent () {\r\n        let iframe = this._iframe;\r\n        if (iframe) {\r\n            let cbs = this.__eventListeners, self = this;\r\n            cbs.load = function () {\r\n                self._forceUpdate = true;\r\n                self._dispatchEvent(WebViewImplEx.EventType.LOADED);\r\n            };\r\n            cbs.error = function () {\r\n                self._dispatchEvent(WebViewImplEx.EventType.ERROR);\r\n            };\r\n            //iframe.addEventListener(\"load\", cbs.load);\r\n            //iframe.addEventListener(\"error\", cbs.error);\r\n        }\r\n    },\r\n\r\n    _initStyle () {\r\n        if (!this._div) return;\r\n        let div = this._div;\r\n        div.style.position = \"absolute\";\r\n        div.style.bottom = \"0px\";\r\n        div.style.left = \"0px\";\r\n    },\r\n\r\n    _setOpacity (opacity) {\r\n        let iframe = this._iframe;\r\n        if (iframe && iframe.style) {\r\n            iframe.style.opacity = opacity / 255;\r\n        }\r\n    },\r\n\r\n    _createDom (w, h) {\r\n        if (WebViewImplEx._polyfill.enableDiv) {\r\n            this._div = document.createElement(\"div\");\r\n            // this._div.style[\"-webkit-overflow\"] = \"auto\";\r\n            // this._div.style[\"-webkit-overflow-scrolling\"] = \"touch\";\r\n            this._iframe = document.createElement(\"iframe\");\r\n            this._div.appendChild(this._iframe);\r\n            this._iframe.style.width = \"100%\";\r\n            this._iframe.style.height = \"100%\";\r\n        }\r\n        else {\r\n            this._div = this._iframe = document.createElement(\"iframe\");\r\n        }\r\n\r\n        if (WebViewImplEx._polyfill.enableBG)\r\n            this._div.style[\"background\"] = \"#FFF\";\r\n\r\n        this._div.style[\"background\"] = \"#FFF\";\r\n        // this._div.style.height = h + \"px\";\r\n        // this._div.style.width = w + \"px\";\r\n        this._div.style.height = \"100%\";\r\n        this._div.style.width = \"100%\";\r\n        this._div.style.overflow = \"scroll\";\r\n        this._iframe.style.border = \"none\";\r\n\r\n        cc.game.container.appendChild(this._div);\r\n        this._updateVisibility();\r\n    },\r\n\r\n    _createNativeControl (w, h) {\r\n        this._createDom(w, h);\r\n        this._initStyle();\r\n        this._initEvent();\r\n    },\r\n\r\n    createDomElementIfNeeded: CC_EDITOR ? function (w, h) {\r\n        this._div = document.createElement('div');\r\n        this._div.style.background = 'rgba(255, 255, 255, 0.8)';\r\n        this._div.style.color = 'rgb(51, 51, 51)';\r\n        this._div.style.height = w + 'px';\r\n        this._div.style.width = h + 'px';\r\n        this._div.style.position = 'absolute';\r\n        this._div.style.bottom = '0px';\r\n        this._div.style.left = '0px';\r\n        this._div.style['word-wrap'] = 'break-word';\r\n        cc.game.container.appendChild(this._div);\r\n    } : function (w, h) {\r\n        if (!this._div) {\r\n            this._createNativeControl(w, h);\r\n        }\r\n        else {\r\n            this._updateSize(w, h);\r\n        }\r\n    },\r\n\r\n    removeDom () {\r\n        let div = this._div;\r\n        if (div) {\r\n            let hasChild = this.contains(cc.game.container, div);\r\n            if (hasChild)\r\n                cc.game.container.removeChild(div);\r\n\r\n            this._div = null;\r\n        }\r\n        let iframe = this._iframe;\r\n        if (iframe) {\r\n            let cbs = this.__eventListeners;\r\n            iframe.removeEventListener(\"load\", cbs.load);\r\n            iframe.removeEventListener(\"error\", cbs.error);\r\n            cbs.load = null;\r\n            cbs.error = null;\r\n            this._iframe = null;\r\n        }\r\n    },\r\n\r\n    setOnJSCallback (callback) {},\r\n    setJavascriptInterfaceScheme (scheme) {},\r\n    // private method\r\n    loadData (data, MIMEType, encoding, baseURL) {},\r\n    loadHTMLString (string, baseURL) {},\r\n\r\n    /**\r\n     * Load an URL\r\n     * @param {String} url\r\n     */\r\n    loadURL: CC_EDITOR ? function (url) {\r\n        this._div.innerText = url;\r\n    } : function (url) {\r\n        let iframe = this._iframe;\r\n        if (iframe) {\r\n            iframe.src = url;\r\n            let self = this;\r\n            let cb = function () {\r\n                self._loaded = true;\r\n                self._updateVisibility();\r\n                iframe.removeEventListener(\"load\", cb);\r\n            };\r\n            //iframe.addEventListener(\"load\", cb);\r\n            this._dispatchEvent(WebViewImplEx.EventType.LOADING);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Stop loading\r\n     */\r\n    stopLoading () {\r\n        cc.logID(7800);\r\n    },\r\n\r\n    /**\r\n     * Reload the WebView\r\n     */\r\n    reload () {\r\n        let iframe = this._iframe;\r\n        if (iframe) {\r\n            let win = iframe.contentWindow;\r\n            if (win && win.location)\r\n                win.location.reload();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Determine whether to go back\r\n     */\r\n    canGoBack () {\r\n        cc.logID(7801);\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * Determine whether to go forward\r\n     */\r\n    canGoForward () {\r\n        cc.logID(7802);\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * go back\r\n     */\r\n    goBack () {\r\n        try {\r\n            if (WebViewImplEx._polyfill.closeHistory)\r\n                return cc.logID(7803);\r\n            let iframe = this._iframe;\r\n            if (iframe) {\r\n                let win = iframe.contentWindow;\r\n                if (win && win.location)\r\n                    win.history.back.call(win);\r\n            }\r\n        } catch (err) {\r\n            cc.log(err);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * go forward\r\n     */\r\n    goForward () {\r\n        try {\r\n            if (WebViewImplEx._polyfill.closeHistory)\r\n                return cc.logID(7804);\r\n            let iframe = this._iframe;\r\n            if (iframe) {\r\n                let win = iframe.contentWindow;\r\n                if (win && win.location)\r\n                    win.history.forward.call(win);\r\n            }\r\n        } catch (err) {\r\n            cc.log(err);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * In the webview execution within a period of js string\r\n     * @param {String} str\r\n     */\r\n    evaluateJS (str) {\r\n        let iframe = this._iframe;\r\n        if (iframe) {\r\n            let win = iframe.contentWindow;\r\n            try {\r\n                win.eval(str);\r\n                this._dispatchEvent(WebViewImplEx.EventType.JS_EVALUATED);\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Limited scale\r\n     */\r\n    setScalesPageToFit () {\r\n        cc.logID(7805);\r\n    },\r\n\r\n    /**\r\n     * The binding event\r\n     * @param {WebViewImpl.EventType} event\r\n     * @param {Function} callback\r\n     */\r\n    setEventListener (event, callback) {\r\n        this._EventList[event] = callback;\r\n    },\r\n\r\n    /**\r\n     * Delete events\r\n     * @param {WebViewImpl.EventType} event\r\n     */\r\n    removeEventListener (event) {\r\n        this._EventList[event] = null;\r\n    },\r\n\r\n    _dispatchEvent (event) {\r\n        let callback = this._EventList[event];\r\n        if (callback)\r\n            callback.call(this, this, this._iframe.src);\r\n    },\r\n\r\n    _createRenderCmd () {\r\n        return new WebViewImpl.RenderCmd(this);\r\n    },\r\n\r\n    destroy () {\r\n        this.removeDom();\r\n    },\r\n\r\n    setVisible (visible) {\r\n        if (this._visible !== visible) {\r\n            this._visible = !!visible;\r\n            this._updateVisibility();\r\n        }\r\n    },\r\n\r\n    updateMatrix (node) {\r\n        if (!this._div || !this._visible) return;\r\n\r\n        node.getWorldMatrix(_mat4_temp);\r\n\r\n        let renderCamera = cc.Camera._findRendererCamera(node);\r\n        if (renderCamera) {\r\n            renderCamera.worldMatrixToScreen(_mat4_temp, _mat4_temp, cc.game.canvas.width, cc.game.canvas.height);\r\n        }\r\n\r\n        let _mat4_tempm = _mat4_temp.m;\r\n        if (!this._forceUpdate &&\r\n            this._m00 === _mat4_tempm[0] && this._m01 === _mat4_tempm[1] &&\r\n            this._m04 === _mat4_tempm[4] && this._m05 === _mat4_tempm[5] &&\r\n            this._m12 === _mat4_tempm[12] && this._m13 === _mat4_tempm[13] &&\r\n            this._w === node._contentSize.width && this._h === node._contentSize.height) {\r\n            return;\r\n        }\r\n\r\n        // update matrix cache\r\n        this._m00 = _mat4_tempm[0];\r\n        this._m01 = _mat4_tempm[1];\r\n        this._m04 = _mat4_tempm[4];\r\n        this._m05 = _mat4_tempm[5];\r\n        this._m12 = _mat4_tempm[12];\r\n        this._m13 = _mat4_tempm[13];\r\n        this._w = node._contentSize.width;\r\n        this._h = node._contentSize.height;\r\n\r\n        let dpr = cc.view._devicePixelRatio;\r\n        let scaleX = 1 / dpr;\r\n        let scaleY = 1 / dpr;\r\n\r\n        let container = cc.game.container;\r\n        let a = _mat4_tempm[0] * scaleX, b = _mat4_tempm[1], c = _mat4_tempm[4], d = _mat4_tempm[5] * scaleY;\r\n\r\n        let offsetX = container && container.style.paddingLeft ? parseInt(container.style.paddingLeft) : 0;\r\n        let offsetY = container && container.style.paddingBottom ? parseInt(container.style.paddingBottom) : 0;\r\n        this._updateSize(this._w, this._h);\r\n        let w = this._w * scaleX;\r\n        let h = this._h * scaleY;\r\n\r\n        let appx = (w * _mat4_tempm[0]) * node._anchorPoint.x;\r\n        let appy = (h * _mat4_tempm[5]) * node._anchorPoint.y;\r\n\r\n\r\n        let tx = _mat4_tempm[12] * scaleX - appx + offsetX, ty = _mat4_tempm[13] * scaleY - appy + offsetY;\r\n\r\n        let matrix = \"matrix(\" + a + \",\" + -b + \",\" + -c + \",\" + d + \",\" + tx + \",\" + -ty + \")\";\r\n        this._div.style['transform'] = matrix;\r\n        this._div.style['-webkit-transform'] = matrix;\r\n        this._div.style['transform-origin'] = '0px 100% 0px';\r\n        this._div.style['-webkit-transform-origin'] = '0px 100% 0px';\r\n\r\n        // chagned iframe opacity\r\n        this._setOpacity(node.opacity);\r\n        this._forceUpdate = false;\r\n    },\r\n\r\n    contains: function (refNode, otherNode) {\r\n        if(typeof refNode.contains == 'function'){\r\n            return refNode.contains(otherNode);\r\n        }else if(typeof refNode.compareDocumentPosition == 'function' ) {\r\n            return !!(refNode.compareDocumentPosition(otherNode) & 16);\r\n        }else {\r\n            var node = otherNode.parentNode;\r\n            if (node) {\r\n                do {\r\n                    if (node === refNode) {\r\n                        return true;\r\n                    } else {\r\n                        node = node.parentNode;\r\n                    }\r\n                } while (node !==null);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n});\r\n\r\nWebViewImplEx.EventType = {\r\n    LOADING: 0,\r\n    LOADED: 1,\r\n    ERROR: 2,\r\n    JS_EVALUATED: 3\r\n};\r\n\r\nlet polyfill = WebViewImplEx._polyfill = {\r\n    devicePixelRatio: false,\r\n    enableDiv: false\r\n};\r\n\r\nif (cc.sys.os === cc.sys.OS_IOS)\r\n    polyfill.enableDiv = true;\r\n\r\nif (cc.sys.isMobile) {\r\n    if (cc.sys.browserType === cc.sys.BROWSER_TYPE_FIREFOX) {\r\n        polyfill.enableBG = true;\r\n    }\r\n}\r\nelse {\r\n    if (cc.sys.browserType === cc.sys.BROWSER_TYPE_IE) {\r\n        polyfill.closeHistory = true;\r\n    }\r\n}\r\n\r\nmodule.exports = WebViewImplEx;\r\n"]}